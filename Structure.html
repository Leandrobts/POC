<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 Size Hunter V2</title>
    <style>
        body { background: #111; color: #0f0; font-family: monospace; padding: 20px; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; border: 1px solid #333; padding: 20px; }
        textarea { width: 100%; height: 300px; background: #000; color: #fff; border: 1px solid #555; margin-top: 10px; }
        button { padding: 15px 30px; background: #005500; color: #fff; border: 1px solid #0f0; cursor: pointer; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ SIZE HUNTER V2 (Precision Mode)</h1>
        <p>Alvo Confirmado: <b>0x839A9B</b> (SharedWorker Code)</p>
        <p>Carregue: <b>1200_libSceNKWebKit.sprx.elf</b></p>
        
        <input type="file" id="fileInput" />
        <br><br>
        <button onclick="scanSize()">ANALISAR OFFSET 0x839A9B</button>
        <textarea id="output" readonly>Aguardando arquivo...</textarea>
    </div>

    <script>
        function scanSize() {
            const file = document.getElementById('fileInput').files[0];
            if(!file) return alert("Selecione o arquivo!");

            const reader = new FileReader();
            document.getElementById('output').value = "Lendo e analisando...";

            reader.onload = function(e) {
                const view = new DataView(e.target.result);
                const bytes = new Uint8Array(e.target.result);
                
                // O endereÃ§o que vocÃª encontrou
                const TARGET = 0x839A9B; 
                
                // Vamos olhar os 500 bytes ANTES desse endereÃ§o
                // Procurando por: BF XX XX 00 00 (MOV EDI, TAMANHO)
                // EDI Ã© o registrador usado para passar o tamanho para o 'operator new' no PS4 (ABI System V)
                
                let log = `=== VARREDURA EM TORNO DE 0x${TARGET.toString(16).toUpperCase()} ===\n\n`;
                let found = false;
                
                // Varre de trÃ¡s para frente (do cÃ³digo para o malloc)
                for (let i = TARGET; i > TARGET - 1000; i--) {
                    // Opcode BF = MOV EDI, imm32
                    if (bytes[i] === 0xBF) {
                        const size = view.getInt32(i + 1, true); // Little Endian
                        
                        // Filtro: Objetos DOM raramente sÃ£o maiores que 2048 bytes (0x800)
                        // e raramente menores que 32 bytes (0x20)
                        if (size > 0x20 && size <= 0x800) {
                            found = true;
                            log += `[POTENCIAL TAMANHO ENCONTRADO]\n`;
                            log += `   EndereÃ§o da InstruÃ§Ã£o: 0x${i.toString(16).toUpperCase()}\n`;
                            log += `   DistÃ¢ncia do Alvo: -${TARGET - i} bytes\n`;
                            log += `   >>> SIZE: 0x${size.toString(16).toUpperCase()} (${size} bytes) <<<\n`;
                            log += `   ----------------------------------------\n`;
                        }
                    }
                }

                if (!found) {
                    log += "Nenhum padrÃ£o 'MOV EDI' Ã³bvio encontrado.\n";
                    log += "O cÃ³digo pode estar usando 'MOV ESI' (BE XX...) ou registrador diferente.\n";
                    log += "Tentando padrÃ£o alternativo (BE = MOV ESI)...\n";
                    
                    for (let i = TARGET; i > TARGET - 1000; i--) {
                        if (bytes[i] === 0xBE) {
                             const size = view.getInt32(i + 1, true);
                             if (size > 0x20 && size <= 0x800) {
                                log += `[ALTERNATIVA MOV ESI]\n`;
                                log += `   >>> SIZE: 0x${size.toString(16).toUpperCase()} <<<\n`;
                             }
                        }
                    }
                }

                document.getElementById('output').value = log;
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
