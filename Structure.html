<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 FUNCTION DUMPER</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Consolas', monospace; padding: 20px; text-align: center; }
        textarea { width: 95%; height: 600px; background: #111; color: #fff; border: 1px solid #555; margin-top: 15px; font-size: 13px; line-height: 1.4; }
        button { padding: 15px 30px; background: #b30000; color: #fff; border: none; cursor: pointer; font-weight: bold; font-size: 16px; border-radius: 5px; }
        .info { color: #aaa; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>FUNCTION RAW DUMPER</h1>
    <p class="info">Extração de Código de Máquina para Análise Manual</p>
    <p>Alvo: <b>0x839A98</b> (SharedWorker)</p>
    
    <input type="file" id="fileInput" />
    <br><br>
    <button onclick="dumpFunction()">EXTRAIR CÓDIGO BRUTO</button>
    
    <textarea id="output" readonly>Aguardando arquivo...</textarea>

    <script>
        function dumpFunction() {
            const file = document.getElementById('fileInput').files[0];
            if(!file) return alert("Selecione o arquivo!");

            const reader = new FileReader();
            document.getElementById('output').value = "Lendo...";

            reader.onload = function(e) {
                const view = new DataView(e.target.result);
                const bytes = new Uint8Array(e.target.result);
                
                // Ponto de referência (String XREF)
                const REF = 0x839A98;
                
                // 1. Tentar achar o início da função (Prologue)
                // Padrão comum x64: 55 48 89 E5 (PUSH RBP; MOV RBP, RSP)
                let funcStart = -1;
                for(let i = REF; i > REF - 2000; i--) {
                    if (bytes[i] === 0x55 && bytes[i+1] === 0x48 && bytes[i+2] === 0x89 && bytes[i+3] === 0xE5) {
                        funcStart = i;
                        break;
                    }
                }

                // Se não achar prólogo padrão, pega um bloco fixo de 500 bytes antes
                if (funcStart === -1) funcStart = Math.max(0, REF - 500);
                
                const endDump = REF + 64; // Um pouco depois da referência

                let log = `=== DUMP DA FUNÇÃO (SharedWorker::create?) ===\n`;
                log += `Início do Dump: 0x${funcStart.toString(16).toUpperCase()}\n`;
                log += `Referência:     0x${REF.toString(16).toUpperCase()}\n\n`;
                
                log += "OFFSET     | BYTES (Copie tudo isso!)\n";
                log += "-----------|-------------------------------------------------\n";

                for (let i = funcStart; i < endDump; i += 16) {
                    const offset = `0x${i.toString(16).toUpperCase().padStart(8, '0')}`;
                    let hex = "";
                    
                    for (let j = 0; j < 16; j++) {
                        if (i + j < endDump) {
                            const b = bytes[i + j];
                            hex += b.toString(16).toUpperCase().padStart(2, '0') + " ";
                            
                            // Marcadores visuais para eu achar rápido
                            if ((i+j) === REF) hex += "[REF] ";
                        }
                    }
                    log += `${offset} | ${hex}\n`;
                }
                
                document.getElementById('output').value = log;
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
