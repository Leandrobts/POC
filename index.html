<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Debugger V4: Swiss Cheese</title>
<style>
    body { background-color: #111; color: #fa0; font-family: monospace; text-align: center; padding: 20px; }
    button { background: #630; color: white; border: 2px solid #fa0; padding: 20px 40px; font-size: 1.5em; cursor: pointer; margin: 10px; }
    #log { text-align: left; margin: 20px auto; border: 1px solid #444; padding: 10px; height: 300px; overflow-y: scroll; background: #000; }
</style>
</head>
<body>

<h1>DEBUGGER V4: SWISS CHEESE</h1>
<p>Estratégia: Criar buracos alternados para forçar o encaixe.</p>

<button onclick="step1()">1. ALOCAR (BEACON)</button>
<br>
<button onclick="step2()">2. GATILHO (OPTIONS)</button>

<div id="log">Logs...</div>

<script>
    const Log = document.getElementById('log');
    function log(txt) { Log.innerHTML += ">> " + txt + "<br>"; Log.scrollTop = Log.scrollHeight;}

    // Configuração
    const BEACON_VAL = 0xDEADBEEF; // Hex Busca: EFBEADDE
    const POISON_VAL = 0x41414141; // Hex Busca: 41414141

    let victims = [];
    let spray_storage = [];
    
    // Aumentamos para 40.000 para criar mais pressão
    const COUNT = 40000; 

    function step1() {
        log("Alocando 40.000 arrays (Enchendo a RAM)...");
        
        // Usamos Uint32Array(32) -> 128 bytes
        for(let i=0; i<COUNT; i++) {
            let v = new Uint32Array(32);
            v.fill(BEACON_VAL);
            // Marcamos o índice para você ver a sequência no Hex Editor
            v[0] = i; 
            victims.push(v);
        }

        log("MEMÓRIA PRONTA!");
        log("No PC: Busque Hex 'EFBEADDE'.");
        log("Abra o Hex Editor. Você verá blocos contínuos.");
    }

    function step2() {
        log("Gatilho armado...");
        
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        window.onblur = function() {
            log("BLUR! Criando buracos (Queijo Suíço)...");
            document.body.style.background = "#500";

            // A MÁGICA: Apagar apenas os PARES
            // Isso deixa os ÍMPARES vivos. O alocador fica cheio de buracos
            // de 128 bytes entre dados vivos. Ele TEM que usar esses buracos.
            for(let i=0; i<COUNT; i+=2) {
                victims[i] = null; 
            }

            // Tentar preencher esses buracos exatos
            log("Injetando Spray nos buracos...");
            try {
                for(let i=0; i<COUNT/2 + 5000; i++) {
                    let s = new Uint32Array(32); // Mesmo tamanho
                    s.fill(POISON_VAL);
                    spray_storage.push(s);
                }
            } catch(e) {}

            log("PROCESSO CONCLUÍDO!");
            log("Dê Refresh no Hex Editor.");
            log("O padrão deve ser: 4141... DEADBEEF... 4141... DEADBEEF");
        };
    }
</script>
</body>
</html>
