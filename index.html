<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 Rapid-Fire Kernel Stress</title>
    
    
</head>
<body>

    <h1>RAPID-FIRE SCHEDULER TUNER</h1>

    <div class="panel">
        <div class="group">
            <label>Limite Máximo de Workers:</label>
            <input type="number" id="limit" value="40">
            <div class="note">Mantenha BAIXO (20-60) para evitar travamento do navegador.</div>
        </div>
        <div class="group">
            <label>Spawns por Tick:</label>
            <input type="number" id="rate" value="15">
            <div class="note">Aumente para forçar o Kernel.</div>
        </div>
        <div class="group">
            <label>Velocidade (ms):</label>
            <input type="number" id="speed" value="2">
            <div class="note">Use 0, 1 ou 2 para velocidade máxima.</div>
        </div>
        
        <button id="btn-start" onclick="toggle()">INICIAR FIRE</button>
    </div>

    <div id="stats">Sistema Pronto.</div>

    <script>
        let running = false;
        let timer = null;
        let workers = [];
        
        // Payload: Worker que recebe mensagem e responde (Estressa IPC e Scheduler)
        const blob = new Blob([`
            onmessage = function(e) {
                // Ao receber, apenas mantemos a thread "quente"
                postMessage(e.data);
            }
        `], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        
        // Buffer de dados para enviar (suja a memória do kernel)
        const junkData = new Uint8Array(1024).fill(0x41);

        function toggle() {
            if(running) {
                clearInterval(timer);
                cleanup();
                running = false;
                document.getElementById('btn-start').innerText = "INICIAR FIRE";
                document.getElementById('stats').innerText = "Parado.";
            } else {
                running = true;
                document.getElementById('btn-start').innerText = "PARAR";
                const limit = parseInt(document.getElementById('limit').value);
                const rate = parseInt(document.getElementById('rate').value);
                const speed = parseInt(document.getElementById('speed').value);
                run(limit, rate, speed);
            }
        }

        function run(maxLimit, spawnRate, interval) {
            timer = setInterval(() => {
                try {
                    // 1. Fase de Spawn (Criar + Enviar Dados)
                    for(let i=0; i < spawnRate; i++) {
                        const w = new Worker(url);
                        // AQUI ESTÁ O TRUQUE: Enviar dados força alocação no kernel IMEDIATA
                        w.postMessage(junkData, [junkData.buffer.slice(0)]); 
                        workers.push(w);
                    }

                    // 2. Fase de Kill (Reciclagem Agressiva)
                    // Se passar do limite, mate TODOS os antigos para causar um "vácuo"
                    if(workers.length > maxLimit) {
                        // Mata o excesso imediatamente
                        while(workers.length > 10) { // Deixa sempre 10 vivos para base
                            const w = workers.shift();
                            w.terminate();
                        }
                    }

                    document.getElementById('stats').innerText = 
                        `Workers Vivos: ${workers.length} (Churning...)`;

                } catch(e) {
                    // Ignora erros de alocação, pois é o que queremos causar no Kernel
                }
            }, interval);
        }

        function cleanup() {
            workers.forEach(w => w.terminate());
            workers = [];
        }
    </script>
</body>
</html>
