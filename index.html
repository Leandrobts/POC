<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Browser Security Tests - Set 3 (101-150)</title>
</head>
<body>

<h1>PlayStation 4 Browser - Advanced UAF & Race Tests - Set 3</h1>
<p>Security Research - Bug Bounty Testing (Tests 101-150)</p>
<p>User Agent: PlayStation 4/12.00 WebKit/605.1.15</p>

<hr>

<h2>Test 101: Deep Nested DOM UAF</h2>
<div id="test101">
<button onclick="test101()">Run Test 101</button>
</div>
<script>
function test101() {
  var root = document.createElement('div');
  var current = root;
  for(var i = 0; i < 100; i++) {
    var child = document.createElement('div');
    current.appendChild(child);
    current = child;
  }
  document.body.appendChild(root);
  var deepRef = current;
  document.body.removeChild(root);
  deepRef.innerHTML = 'deep uaf';
  deepRef.click();
}
</script>

<hr>

<h2>Test 102: ArrayBuffer Transfer UAF</h2>
<div id="test102">
<button onclick="test102()">Run Test 102</button>
</div>
<script>
function test102() {
  try {
    var buffer = new ArrayBuffer(1024);
    var view = new Uint8Array(buffer);
    view[0] = 255;
    var transferred = new ArrayBuffer(buffer);
    view[1] = 128;
  } catch(e) {
    console.log('ArrayBuffer error:', e);
  }
}
</script>

<hr>

<h2>Test 103: Circular Reference DOM UAF</h2>
<div id="test103">
<button onclick="test103()">Run Test 103</button>
</div>
<script>
function test103() {
  var div1 = document.createElement('div');
  var div2 = document.createElement('div');
  div1.appendChild(div2);
  div2.appendChild(div1);
  document.body.appendChild(div1);
  var ref = div2;
  document.body.removeChild(div1);
  ref.innerHTML = 'circular uaf';
}
</script>

<hr>

<h2>Test 104: Race - Rapid Table Row Manipulation</h2>
<div id="test104">
<button onclick="test104()">Run Test 104</button>
</div>
<script>
function test104() {
  var table = document.createElement('table');
  var tbody = document.createElement('tbody');
  table.appendChild(tbody);
  document.body.appendChild(table);
  for(var i = 0; i < 500; i++) {
    setTimeout(function() {
      var row = tbody.insertRow();
      var cell = row.insertCell();
      tbody.deleteRow(0);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 105: Multiple Canvas Context Types UAF</h2>
<div id="test105">
<button onclick="test105()">Run Test 105</button>
</div>
<script>
function test105() {
  var canvas = document.createElement('canvas');
  document.body.appendChild(canvas);
  var ctx2d = canvas.getContext('2d');
  try {
    var ctxWebgl = canvas.getContext('webgl');
  } catch(e) {}
  document.body.removeChild(canvas);
  ctx2d.fillRect(0, 0, 100, 100);
}
</script>

<hr>

<h2>Test 106: Race - Document.write During Parse</h2>
<div id="test106">
<button onclick="test106()">Run Test 106</button>
</div>
<script>
function test106() {
  var iframe = document.createElement('iframe');
  document.body.appendChild(iframe);
  var doc = iframe.contentDocument;
  for(var i = 0; i < 100; i++) {
    setTimeout(function(n) {
      doc.write('<div>test' + n + '</div>');
    }, 0, i);
  }
  setTimeout(function() {
    doc.close();
  }, 50);
}
</script>

<hr>

<h2>Test 107: SVG Element UAF</h2>
<div id="test107">
<button onclick="test107()">Run Test 107</button>
</div>
<script>
function test107() {
  var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
  svg.appendChild(circle);
  document.body.appendChild(svg);
  var ref = circle;
  svg.removeChild(circle);
  ref.setAttribute('r', '50');
}
</script>

<hr>

<h2>Test 108: Race - Concurrent execCommand</h2>
<div id="test108">
<button onclick="test108()">Run Test 108</button>
</div>
<script>
function test108() {
  var div = document.createElement('div');
  div.contentEditable = true;
  div.innerHTML = 'editable content';
  document.body.appendChild(div);
  div.focus();
  for(var i = 0; i < 200; i++) {
    setTimeout(function() {
      document.execCommand('bold');
      document.execCommand('italic');
      document.execCommand('undo');
    }, 0);
  }
}
</script>

<hr>

<h2>Test 109: Template Element UAF</h2>
<div id="test109">
<button onclick="test109()">Run Test 109</button>
</div>
<script>
function test109() {
  var template = document.createElement('template');
  template.innerHTML = '<div>template content</div>';
  document.body.appendChild(template);
  var content = template.content;
  document.body.removeChild(template);
  content.firstChild.innerHTML = 'modified';
}
</script>

<hr>

<h2>Test 110: Race - Rapid iframe src Changes</h2>
<div id="test110">
<button onclick="test110()">Run Test 110</button>
</div>
<script>
function test110() {
  var iframe = document.createElement('iframe');
  document.body.appendChild(iframe);
  for(var i = 0; i < 100; i++) {
    setTimeout(function(n) {
      iframe.src = 'about:blank#' + n;
    }, i);
  }
  setTimeout(function() {
    document.body.removeChild(iframe);
  }, 150);
}
</script>

<hr>

<h2>Test 111: Option Element Collection UAF</h2>
<div id="test111">
<button onclick="test111()">Run Test 111</button>
</div>
<script>
function test111() {
  var select = document.createElement('select');
  for(var i = 0; i < 10; i++) {
    var option = document.createElement('option');
    select.appendChild(option);
  }
  document.body.appendChild(select);
  var options = select.options;
  document.body.removeChild(select);
  options[0].value = 'modified';
}
</script>

<hr>

<h2>Test 112: Race - Multiple Range.surroundContents</h2>
<div id="test112">
<button onclick="test112()">Run Test 112</button>
</div>
<script>
function test112() {
  var div = document.createElement('div');
  div.innerHTML = 'text for range testing';
  document.body.appendChild(div);
  for(var i = 0; i < 100; i++) {
    setTimeout(function() {
      var range = document.createRange();
      range.selectNodeContents(div);
      var span = document.createElement('span');
      try {
        range.surroundContents(span);
      } catch(e) {}
    }, 0);
  }
}
</script>

<hr>

<h2>Test 113: FormData UAF</h2>
<div id="test113">
<button onclick="test113()">Run Test 113</button>
</div>
<script>
function test113() {
  var form = document.createElement('form');
  var input = document.createElement('input');
  input.name = 'test';
  input.value = 'value';
  form.appendChild(input);
  document.body.appendChild(form);
  var fd = new FormData(form);
  document.body.removeChild(form);
  fd.append('extra', 'data');
}
</script>

<hr>

<h2>Test 114: Race - createContextualFragment Concurrent</h2>
<div id="test114">
<button onclick="test114()">Run Test 114</button>
</div>
<script>
function test114() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  var range = document.createRange();
  range.selectNode(div);
  for(var i = 0; i < 200; i++) {
    setTimeout(function(n) {
      var frag = range.createContextualFragment('<span>' + n + '</span>');
      div.appendChild(frag);
    }, 0, i);
  }
}
</script>

<hr>

<h2>Test 115: Link Element Sheet UAF</h2>
<div id="test115">
<button onclick="test115()">Run Test 115</button>
</div>
<script>
function test115() {
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.href = 'data:text/css,body{}';
  document.head.appendChild(link);
  setTimeout(function() {
    var sheet = link.sheet;
    document.head.removeChild(link);
    if(sheet) sheet.insertRule('div{}', 0);
  }, 100);
}
</script>

<hr>

<h2>Test 116: Race - Rapid createEvent/dispatchEvent</h2>
<div id="test116">
<button onclick="test116()">Run Test 116</button>
</div>
<script>
function test116() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  div.addEventListener('custom', function() {});
  for(var i = 0; i < 300; i++) {
    setTimeout(function() {
      var evt = document.createEvent('Event');
      evt.initEvent('custom', true, true);
      div.dispatchEvent(evt);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 117: Input File List UAF</h2>
<div id="test117">
<button onclick="test117()">Run Test 117</button>
</div>
<script>
function test117() {
  var input = document.createElement('input');
  input.type = 'file';
  document.body.appendChild(input);
  var files = input.files;
  document.body.removeChild(input);
  var length = files.length;
}
</script>

<hr>

<h2>Test 118: Race - Multiple createAttribute</h2>
<div id="test118">
<button onclick="test118()">Run Test 118</button>
</div>
<script>
function test118() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 500; i++) {
    setTimeout(function(n) {
      var attr = document.createAttribute('data-test' + n);
      attr.value = 'value' + n;
      div.setAttributeNode(attr);
    }, 0, i);
  }
}
</script>

<hr>

<h2>Test 119: Video Track UAF</h2>
<div id="test119">
<button onclick="test119()">Run Test 119</button>
</div>
<script>
function test119() {
  var video = document.createElement('video');
  document.body.appendChild(video);
  var tracks = video.videoTracks;
  document.body.removeChild(video);
  var count = tracks.length;
}
</script>

<hr>

<h2>Test 120: Race - Selection.modify Rapid Calls</h2>
<div id="test120">
<button onclick="test120()">Run Test 120</button>
</div>
<script>
function test120() {
  var div = document.createElement('div');
  div.innerHTML = 'selection modification test text';
  document.body.appendChild(div);
  var sel = window.getSelection();
  sel.selectAllChildren(div);
  for(var i = 0; i < 200; i++) {
    setTimeout(function() {
      try {
        sel.modify('move', 'forward', 'character');
      } catch(e) {}
    }, 0);
  }
}
</script>

<hr>

<h2>Test 121: WebGL Texture UAF</h2>
<div id="test121">
<button onclick="test121()">Run Test 121</button>
</div>
<script>
function test121() {
  try {
    var canvas = document.createElement('canvas');
    var gl = canvas.getContext('webgl');
    if(gl) {
      var texture = gl.createTexture();
      gl.bindTexture(gl.TEXTURE_2D, texture);
      gl.deleteTexture(texture);
      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
    }
  } catch(e) {
    console.log('WebGL error:', e);
  }
}
</script>

<hr>

<h2>Test 122: Race - Multiple preventDefault Calls</h2>
<div id="test122">
<button onclick="test122()">Run Test 122</button>
</div>
<script>
function test122() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 100; i++) {
    div.addEventListener('click', function(e) {
      e.preventDefault();
    });
  }
  for(var j = 0; j < 100; j++) {
    setTimeout(function() {
      div.click();
    }, 0);
  }
}
</script>

<hr>

<h2>Test 123: Script Element Execution UAF</h2>
<div id="test123">
<button onclick="test123()">Run Test 123</button>
</div>
<script>
function test123() {
  var script = document.createElement('script');
  script.textContent = 'console.log("executed");';
  document.body.appendChild(script);
  var ref = script;
  document.body.removeChild(script);
  ref.textContent = 'console.log("modified");';
}
</script>

<hr>

<h2>Test 124: Race - Rapid createTreeWalker</h2>
<div id="test124">
<button onclick="test124()">Run Test 124</button>
</div>
<script>
function test124() {
  var div = document.createElement('div');
  div.innerHTML = '<span>a</span><span>b</span><span>c</span>';
  document.body.appendChild(div);
  for(var i = 0; i < 200; i++) {
    setTimeout(function() {
      var walker = document.createTreeWalker(div, NodeFilter.SHOW_ELEMENT);
      while(walker.nextNode()) {}
    }, 0);
  }
}
</script>

<hr>

<h2>Test 125: Meta Element UAF</h2>
<div id="test125">
<button onclick="test125()">Run Test 125</button>
</div>
<script>
function test125() {
  var meta = document.createElement('meta');
  meta.name = 'test';
  meta.content = 'value';
  document.head.appendChild(meta);
  var ref = meta;
  document.head.removeChild(meta);
  ref.content = 'modified';
}
</script>

<hr>

<h2>Test 126: Race - Concurrent Element.matches</h2>
<div id="test126">
<button onclick="test126()">Run Test 126</button>
</div>
<script>
function test126() {
  var div = document.createElement('div');
  div.className = 'test-class';
  document.body.appendChild(div);
  for(var i = 0; i < 400; i++) {
    setTimeout(function() {
      div.matches('.test-class');
      div.matches('div.test-class');
      div.matches('body > div');
    }, 0);
  }
}
</script>

<hr>

<h2>Test 127: Base Element UAF</h2>
<div id="test127">
<button onclick="test127()">Run Test 127</button>
</div>
<script>
function test127() {
  var base = document.createElement('base');
  base.href = 'http://example.com/';
  document.head.appendChild(base);
  var ref = base;
  document.head.removeChild(base);
  ref.href = 'http://modified.com/';
}
</script>

<hr>

<h2>Test 128: Race - Multiple Range.insertNode</h2>
<div id="test128">
<button onclick="test128()">Run Test 128</button>
</div>
<script>
function test128() {
  var div = document.createElement('div');
  div.innerHTML = 'range insert test';
  document.body.appendChild(div);
  var range = document.createRange();
  range.setStart(div.firstChild, 0);
  for(var i = 0; i < 100; i++) {
    setTimeout(function() {
      var span = document.createElement('span');
      span.textContent = 'x';
      try {
        range.insertNode(span);
      } catch(e) {}
    }, 0);
  }
}
</script>

<hr>

<h2>Test 129: Dialog Element UAF</h2>
<div id="test129">
<button onclick="test129()">Run Test 129</button>
</div>
<script>
function test129() {
  try {
    var dialog = document.createElement('dialog');
    document.body.appendChild(dialog);
    dialog.showModal();
    var ref = dialog;
    document.body.removeChild(dialog);
    ref.close();
  } catch(e) {
    console.log('Dialog error:', e);
  }
}
</script>

<hr>

<h2>Test 130: Race - stopPropagation During Dispatch</h2>
<div id="test130">
<button onclick="test130()">Run Test 130</button>
</div>
<script>
function test130() {
  var parent = document.createElement('div');
  var child = document.createElement('div');
  parent.appendChild(child);
  document.body.appendChild(parent);
  parent.addEventListener('click', function(e) {
    e.stopPropagation();
  });
  for(var i = 0; i < 200; i++) {
    setTimeout(function() {
      child.click();
    }, 0);
  }
}
</script>

<hr>

<h2>Test 131: Details Element UAF</h2>
<div id="test131">
<button onclick="test131()">Run Test 131</button>
</div>
<script>
function test131() {
  var details = document.createElement('details');
  var summary = document.createElement('summary');
  summary.textContent = 'Summary';
  details.appendChild(summary);
  document.body.appendChild(details);
  var ref = details;
  document.body.removeChild(details);
  ref.open = true;
}
</script>

<hr>

<h2>Test 132: Race - Multiple compareDocumentPosition</h2>
<div id="test132">
<button onclick="test132()">Run Test 132</button>
</div>
<script>
function test132() {
  var div1 = document.createElement('div');
  var div2 = document.createElement('div');
  document.body.appendChild(div1);
  document.body.appendChild(div2);
  for(var i = 0; i < 300; i++) {
    setTimeout(function() {
      div1.compareDocumentPosition(div2);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 133: Progress Element UAF</h2>
<div id="test133">
<button onclick="test133()">Run Test 133</button>
</div>
<script>
function test133() {
  var progress = document.createElement('progress');
  progress.value = 50;
  progress.max = 100;
  document.body.appendChild(progress);
  var ref = progress;
  document.body.removeChild(progress);
  ref.value = 75;
}
</script>

<hr>

<h2>Test 134: Race - Rapid insertAdjacentHTML</h2>
<div id="test134">
<button onclick="test134()">Run Test 134</button>
</div>
<script>
function test134() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 200; i++) {
    setTimeout(function(n) {
      div.insertAdjacentHTML('beforeend', '<span>' + n + '</span>');
    }, 0, i);
  }
}
</script>

<hr>

<h2>Test 135: Meter Element UAF</h2>
<div id="test135">
<button onclick="test135()">Run Test 135</button>
</div>
<script>
function test135() {
  var meter = document.createElement('meter');
  meter.value = 0.5;
  meter.min = 0;
  meter.max = 1;
  document.body.appendChild(meter);
  var ref = meter;
  document.body.removeChild(meter);
  ref.value = 0.8;
}
</script>

<hr>

<h2>Test 136: Race - Multiple closest() Calls</h2>
<div id="test136">
<button onclick="test136()">Run Test 136</button>
</div>
<script>
function test136() {
  var parent = document.createElement('div');
  parent.className = 'parent';
  var child = document.createElement('span');
  parent.appendChild(child);
  document.body.appendChild(parent);
  for(var i = 0; i < 300; i++) {
    setTimeout(function() {
      child.closest('.parent');
      child.closest('div');
    }, 0);
  }
}
</script>

<hr>

<h2>Test 137: Output Element UAF</h2>
<div id="test137">
<button onclick="test137()">Run Test 137</button>
</div>
<script>
function test137() {
  var output = document.createElement('output');
  output.value = 'result';
  document.body.appendChild(output);
  var ref = output;
  document.body.removeChild(output);
  ref.value = 'modified';
}
</script>

<hr>

<h2>Test 138: Race - Concurrent toggleAttribute</h2>
<div id="test138">
<button onclick="test138()">Run Test 138</button>
</div>
<script>
function test138() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 500; i++) {
    setTimeout(function() {
      try {
        div.toggleAttribute('data-test');
      } catch(e) {
        div.setAttribute('data-test', '');
        div.removeAttribute('data-test');
      }
    }, 0);
  }
}
</script>

<hr>

<h2>Test 139: Picture Element Source UAF</h2>
<div id="test139">
<button onclick="test139()">Run Test 139</button>
</div>
<script>
function test139() {
  var picture = document.createElement('picture');
  var source = document.createElement('source');
  source.srcset = 'image.jpg';
  picture.appendChild(source);
  document.body.appendChild(picture);
  var ref = source;
  picture.removeChild(source);
  ref.srcset = 'modified.jpg';
}
</script>

<hr>

<h2>Test 140: Race - Multiple contains() Checks</h2>
<div id="test140">
<button onclick="test140()">Run Test 140</button>
</div>
<script>
function test140() {
  var parent = document.createElement('div');
  var child = document.createElement('span');
  parent.appendChild(child);
  document.body.appendChild(parent);
  for(var i = 0; i < 400; i++) {
    setTimeout(function() {
      parent.contains(child);
    }, i % 40);
    setTimeout(function() {
      if(child.parentNode) parent.removeChild(child);
    }, (i % 40) + 1);
    setTimeout(function() {
      parent.appendChild(child);
    }, (i % 40) + 2);
  }
}
</script>

<hr>

<h2>Test 141: Slot Element UAF</h2>
<div id="test141">
<button onclick="test141()">Run Test 141</button>
</div>
<script>
function test141() {
  try {
    var div = document.createElement('div');
    var shadow = div.attachShadow({mode: 'open'});
    var slot = document.createElement('slot');
    shadow.appendChild(slot);
    document.body.appendChild(div);
    var ref = slot;
    shadow.removeChild(slot);
    ref.name = 'modified';
  } catch(e) {
    console.log('Slot error:', e);
  }
}
</script>

<hr>

<h2>Test 142: Race - Multiple getAttributeNames</h2>
<div id="test142">
<button onclick="test142()">Run Test 142</button>
</div>
<script>
function test142() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 300; i++) {
    setTimeout(function(n) {
      div.setAttribute('attr' + n, 'val' + n);
      try {
        div.getAttributeNames();
      } catch(e) {
        for(var j = 0; j < div.attributes.length; j++) {
          div.attributes[j].name;
        }
      }
    }, 0, i);
  }
}
</script>

<hr>

<h2>Test 143: Track Element UAF</h2>
<div id="test143">
<button onclick="test143()">Run Test 143</button>
</div>
<script>
function test143() {
  var video = document.createElement('video');
  var track = document.createElement('track');
  track.kind = 'subtitles';
  video.appendChild(track);
  document.body.appendChild(video);
  var ref = track;
  video.removeChild(track);
  ref.srclang = 'en';
}
</script>

<hr>

<h2>Test 144: Race - Rapid assignedSlot Access</h2>
<div id="test144">
<button onclick="test144()">Run Test 144</button>
</div>
<script>
function test144() {
  try {
    var host = document.createElement('div');
    var shadow = host.attachShadow({mode: 'open'});
    var slot = document.createElement('slot');
    shadow.appendChild(slot);
    var content = document.createElement('span');
    host.appendChild(content);
    document.body.appendChild(host);
    for(var i = 0; i < 100; i++) {
      setTimeout(function() {
        content.assignedSlot;
      }, 0);
    }
  } catch(e) {
    console.log('Shadow DOM error:', e);
  }
}
</script>

<hr>

<h2>Test 145: Map Element Area UAF</h2>
<div id="test145">
<button onclick="test145()">Run Test 145</button>
</div>
<script>
function test145() {
  var map = document.createElement('map');
  var area = document.createElement('area');
  area.coords = '0,0,100,100';
  map.appendChild(area);
  document.body.appendChild(map);
  var ref = area;
  map.removeChild(area);
  ref.coords = '0,0,200,200';
}
</script>

<hr>

<h2>Test 146: Race - Multiple isEqualNode Calls</h2>
<div id="test146">
<button onclick="test146()">Run Test 146</button>
</div>
<script>
function test146() {
  var div1 = document.createElement('div');
  var div2 = document.createElement('div');
  div1.innerHTML = 'test';
  div2.innerHTML = 'test';
  document.body.appendChild(div1);
  document.body.appendChild(div2);
  for(var i = 0; i < 300; i++) {
    setTimeout(function() {
      div1.isEqualNode(div2);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 147: Data Element UAF</h2>
<div id="test147">
<button onclick="test147()">Run Test 147</button>
</div>
<script>
function test147() {
  var data = document.createElement('data');
  data.value = '12345';
  document.body.appendChild(data);
  var ref = data;
  document.body.removeChild(data);
  ref.value = '67890';
}
</script>

<hr>

<h2>Test 148: Race - Concurrent isSameNode</h2>
<div id="test148">
<button onclick="test148()">Run Test 148</button>
</div>
<script>
function test148() {
  var div = document.createElement('div');
  var clone = div.cloneNode(true);
  document.body.appendChild(div);
  for(var i = 0; i < 300; i++) {
    setTimeout(function() {
      div.isSameNode(clone);
      div.isSameNode(div);
    }, 0);
  }
}
</script>

</body>

</html>


