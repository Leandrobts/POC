<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Fullscreen Blur – Intra-Array Corruption Audit</title>
</head>
<body>

<h1>Float64Array Internal Corruption Test</h1>
<button onclick="start()">START</button>
<pre id="log"></pre>

<script>
const log = m => document.getElementById("log").textContent += m + "\n";

let arr;
let snapshot = [];

function snapshotArray(tag) {
    log("=== SNAPSHOT: " + tag + " ===");
    log("length: " + arr.length);
    log("byteLength: " + arr.byteLength);
    log("buffer same: " + (arr.buffer === bufferRef));

    for (let i = 0; i < arr.length; i++) {
        snapshot.push(arr[i]);
        log("[" + i + "] = " + arr[i]);
    }
}

let bufferRef;

function start() {
    log("[*] Creating single Float64Array");
    arr = new Float64Array(8);

    for (let i = 0; i < arr.length; i++) {
        arr[i] = 0x1337 + i;
    }

    bufferRef = arr.buffer;

    snapshotArray("BEFORE FULLSCREEN");

    const el = document.documentElement;
    if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();

    window.onblur = () => {
        log("");
        log("[!] BLUR DETECTED");
        snapshotArray("AFTER BLUR (NO REFRESH)");
        log("");
        log("[*] Test finished – NO teardown performed");
    };
}
</script>

</body>
</html>
