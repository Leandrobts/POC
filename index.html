<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Memory Corruption Tests 51-100</title>
</head>
<body>
    <h1>PS4 Memory Corruption Tests 51-100</h1>
    
    <button onclick="test51()">51: Array Holes Type Confuse</button>
    <button onclick="test52()">52: Object Freeze Mutation</button>
    <button onclick="test53()">53: Function Prototype Replace</button>
    <button onclick="test54()">54: Constructor Return Trick</button>
    <button onclick="test55()">55: Array Splice During Sort</button>
    <button onclick="test56()">56: String CharAt OOB</button>
    <button onclick="test57()">57: RegExp Exec Mutation</button>
    <button onclick="test58()">58: JSON Reviver Corrupt</button>
    <button onclick="test59()">59: Object Assign Race</button>
    <button onclick="test60()">60: Array Reduce Mutation</button>
    <button onclick="test61()">61: Canvas ContextLost UAF</button>
    <button onclick="test62()">62: Canvas ToBlob Detach</button>
    <button onclick="test63()">63: Canvas ImageBitmap UAF</button>
    <button onclick="test64()">64: Canvas Pattern UAF</button>
    <button onclick="test65()">65: Canvas Gradient Stale</button>
    <button onclick="test66()">66: Audio Buffer Detach</button>
    <button onclick="test67()">67: Audio Source UAF</button>
    <button onclick="test68()">68: Video Track Detach</button>
    <button onclick="test69()">69: Media Stream UAF</button>
    <button onclick="test70()">70: DOM Rect Stale</button>
    <button onclick="test71()">71: DOM TokenList Modify</button>
    <button onclick="test72()">72: Style Declaration UAF</button>
    <button onclick="test73()">73: CSS Rule Reorder</button>
    <button onclick="test74()">74: MediaQueryList Detach</button>
    <button onclick="test75()">75: FontFace Load UAF</button>
    <button onclick="test76()">76: Animation Cancel UAF</button>
    <button onclick="test77()">77: Animation Effect Timing</button>
    <button onclick="test78()">78: KeyframeEffect Detach</button>
    <button onclick="test79()">79: Transition End UAF</button>
    <button onclick="test80()">80: Focus Event Race</button>
    <button onclick="test81()">81: Input Validation UAF</button>
    <button onclick="test82()">82: Form Submit Detach</button>
    <button onclick="test83()">83: Select Option Stale</button>
    <button onclick="test84()">84: TextArea Value Race</button>
    <button onclick="test85()">85: Radio Group Corrupt</button>
    <button onclick="test86()">86: Checkbox State UAF</button>
    <button onclick="test87()">87: Label Control Detach</button>
    <button onclick="test88()">88: Fieldset Elements Stale</button>
    <button onclick="test89()">89: Table Cell Access</button>
    <button onclick="test90()">90: Table Row Mutation</button>
    <button onclick="test91()">91: List Item Remove UAF</button>
    <button onclick="test92()">92: Anchor Hash Change</button>
    <button onclick="test93()">93: Image Load Detach</button>
    <button onclick="test94()">94: Script Async Race</button>
    <button onclick="test95()">95: Link Sheet Disable</button>
    <button onclick="test96()">96: Base Href Change</button>
    <button onclick="test97()">97: Meta Content Modify</button>
    <button onclick="test98()">98: Title Node Detach</button>
    <button onclick="test99()">99: Template Content UAF</button>
    <button onclick="test100()">100: Slot Assign Detach</button>

    <script>
        function test51() {
            const arr = new Array(10);
            arr[0] = 1;
            arr[2] = 3;
            arr[4] = {buffer: new ArrayBuffer(512)};
            
            arr.sort((a, b) => {
                if (a === undefined) arr[1] = 2;
                return 0;
            });
            
            const val = arr[4];
        }

        function test52() {
            const obj = {
                a: 1,
                b: {nested: new ArrayBuffer(512)}
            };
            
            Object.freeze(obj);
            
            Object.defineProperty(obj, 'c', {
                get: function() {
                    obj.b = null;
                    return 3;
                }
            });
            
            const val = obj.c;
        }

        function test53() {
            function Constructor() {
                this.data = new ArrayBuffer(512);
            }
            
            Constructor.prototype.method = function() {
                return this.data;
            };
            
            const instance = new Constructor();
            const oldProto = Constructor.prototype;
            
            Constructor.prototype = {
                method: function() {
                    return null;
                }
            };
            
            const result = instance.method();
        }

        function test54() {
            function Trick() {
                return {spoofed: new ArrayBuffer(1024)};
            }
            
            const instance = new Trick();
            instance.data = new Uint8Array(512);
            
            const check = instance instanceof Trick;
        }

        function test55() {
            const arr = [1, 2, 3, 4, 5];
            
            arr.sort((a, b) => {
                arr.splice(1, 2);
                arr.push(new ArrayBuffer(512));
                return a - b;
            });
        }

        function test56() {
            let str = 'ABC';
            
            Object.defineProperty(str, 'length', {
                get: function() {
                    return 1000;
                }
            });
            
            const char = str.charAt(100);
        }

        function test57() {
            const regex = /a/g;
            const str = 'aaa';
            
            let result;
            while ((result = regex.exec(str)) !== null) {
                regex.lastIndex = 0;
                if (result.index > 10) break;
            }
        }

        function test58() {
            const json = '{"a":1,"b":{"c":2}}';
            
            JSON.parse(json, function(key, value) {
                if (key === 'b') {
                    this.a = new ArrayBuffer(512);
                }
                return value;
            });
        }

        function test59() {
            const target = {a: 1};
            const source = {
                get b() {
                    delete target.a;
                    target.a = new Uint8Array(100);
                    return 2;
                }
            };
            
            Object.assign(target, source);
        }

        function test60() {
            const arr = [1, 2, 3, 4, 5];
            
            arr.reduce((acc, val, idx) => {
                if (idx === 2) {
                    arr.length = 0;
                    arr.push(new ArrayBuffer(512));
                }
                return acc + val;
            }, 0);
        }

        function test61() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            ctx.fillRect(0, 0, 256, 256);
            
            const event = new Event('webglcontextlost');
            canvas.dispatchEvent(event);
            
            setTimeout(() => {
                ctx.fillRect(0, 0, 256, 256);
            }, 10);
        }

        function test62() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            ctx.fillRect(0, 0, 256, 256);
            
            canvas.toBlob(blob => {
                canvas.width = 512;
            });
        }

        function test63() {
            if (!window.createImageBitmap) return;
            
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            
            createImageBitmap(canvas).then(bitmap => {
                canvas.width = 512;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(bitmap, 0, 0);
            });
        }

        function test64() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            const patternCanvas = document.createElement('canvas');
            patternCanvas.width = 64;
            patternCanvas.height = 64;
            
            const pattern = ctx.createPattern(patternCanvas, 'repeat');
            
            patternCanvas.width = 128;
            
            ctx.fillStyle = pattern;
            ctx.fillRect(0, 0, 256, 256);
        }

        function test65() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            const gradient = ctx.createLinearGradient(0, 0, 256, 256);
            gradient.addColorStop(0, 'red');
            gradient.addColorStop(1, 'blue');
            
            canvas.width = 512;
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 512, 512);
        }

        function test66() {
            if (!window.AudioContext && !window.webkitAudioContext) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            
            const ctx = new AudioContext();
            const buffer = ctx.createBuffer(2, 1024, ctx.sampleRate);
            
            const data = buffer.getChannelData(0);
            data[0] = 0.5;
            
            ctx.close();
            
            setTimeout(() => {
                data[0] = 1.0;
            }, 10);
        }

        function test67() {
            if (!window.AudioContext && !window.webkitAudioContext) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            
            const ctx = new AudioContext();
            const buffer = ctx.createBuffer(1, 1024, ctx.sampleRate);
            const source = ctx.createBufferSource();
            
            source.buffer = buffer;
            source.start(0);
            source.stop();
            
            setTimeout(() => {
                source.connect(ctx.destination);
            }, 10);
        }

        function test68() {
            const video = document.createElement('video');
            document.body.appendChild(video);
            
            const track = video.addTextTrack('subtitles', 'English', 'en');
            
            document.body.removeChild(video);
            
            setTimeout(() => {
                track.mode = 'showing';
            }, 10);
        }

        function test69() {
            if (!navigator.mediaDevices) return;
            
            navigator.mediaDevices.getUserMedia({audio: true, video: false})
                .then(stream => {
                    const track = stream.getTracks()[0];
                    stream.removeTrack(track);
                    
                    setTimeout(() => {
                        track.stop();
                    }, 10);
                })
                .catch(e => {});
        }

        function test70() {
            const elem = document.createElement('div');
            elem.style.width = '100px';
            elem.style.height = '100px';
            document.body.appendChild(elem);
            
            const rect = elem.getBoundingClientRect();
            
            document.body.removeChild(elem);
            
            setTimeout(() => {
                const x = rect.x;
                const y = rect.y;
            }, 10);
        }

        function test71() {
            const elem = document.createElement('div');
            elem.className = 'a b c';
            document.body.appendChild(elem);
            
            const classList = elem.classList;
            
            document.body.removeChild(elem);
            
            setTimeout(() => {
                classList.add('d');
                classList.remove('a');
            }, 10);
        }

        function test72() {
            const elem = document.createElement('div');
            elem.style.cssText = 'width: 100px; height: 100px;';
            document.body.appendChild(elem);
            
            const style = elem.style;
            
            document.body.removeChild(elem);
            
            setTimeout(() => {
                style.width = '200px';
            }, 10);
        }

        function test73() {
            const style = document.createElement('style');
            document.head.appendChild(style);
            
            style.sheet.insertRule('.a { color: red; }', 0);
            style.sheet.insertRule('.b { color: blue; }', 1);
            
            const rules = style.sheet.cssRules;
            
            style.sheet.deleteRule(0);
            
            setTimeout(() => {
                const rule = rules[1];
                if (rule) rule.style.color = 'green';
            }, 10);
        }

        function test74() {
            if (!window.matchMedia) return;
            
            const mql = matchMedia('(min-width: 600px)');
            
            const iframe = document.createElement('iframe');
            document.body.appendChild(iframe);
            
            const iframeMql = iframe.contentWindow.matchMedia('(min-width: 600px)');
            
            document.body.removeChild(iframe);
            
            setTimeout(() => {
                const matches = iframeMql.matches;
            }, 10);
        }

        function test75() {
            if (!window.FontFace) return;
            
            const font = new FontFace('TestFont', 'url(data:font/woff2;base64,d09GMgABAAAAAA)');
            
            font.load().then(loadedFont => {
                document.fonts.delete(loadedFont);
                
                setTimeout(() => {
                    const status = loadedFont.status;
                }, 10);
            }).catch(e => {});
        }

        function test76() {
            const elem = document.createElement('div');
            elem.style.width = '100px';
            document.body.appendChild(elem);
            
            const animation = elem.animate([
                {width: '100px'},
                {width: '200px'}
            ], 1000);
            
            animation.cancel();
            
            setTimeout(() => {
                animation.play();
            }, 10);
        }

        function test77() {
            const elem = document.createElement('div');
            document.body.appendChild(elem);
            
            const animation = elem.animate([
                {opacity: 0},
                {opacity: 1}
            ], {duration: 1000});
            
            const effect = animation.effect;
            
            document.body.removeChild(elem);
            
            setTimeout(() => {
                effect.updateTiming({duration: 2000});
            }, 10);
        }

        function test78() {
            const elem = document.createElement('div');
            document.body.appendChild(elem);
            
            const keyframes = new KeyframeEffect(elem, [
                {transform: 'scale(1)'},
                {transform: 'scale(2)'}
            ], 1000);
            
            document.body.removeChild(elem);
            
            setTimeout(() => {
                const target = keyframes.target;
            }, 10);
        }

        function test79() {
            const elem = document.createElement('div');
            elem.style.transition = 'width 1s';
            elem.style.width = '100px';
            document.body.appendChild(elem);
            
            let event = null;
            
            elem.addEventListener('transitionend', e => {
                event = e;
                document.body.removeChild(elem);
            });
            
            elem.style.width = '200px';
            
            setTimeout(() => {
                if (event) {
                    const target = event.target;
                }
            }, 1100);
        }

        function test80() {
            const input1 = document.createElement('input');
            const input2 = document.createElement('input');
            document.body.appendChild(input1);
            document.body.appendChild(input2);
            
            input1.addEventListener('focus', () => {
                document.body.removeChild(input2);
                input2.focus();
            });
            
            input1.focus();
        }

        function test81() {
            const form = document.createElement('form');
            const input = document.createElement('input');
            input.required = true;
            form.appendChild(input);
            document.body.appendChild(form);
            
            form.addEventListener('invalid', e => {
                document.body.removeChild(form);
            }, true);
            
            form.reportValidity();
        }

        function test82() {
            const form = document.createElement('form');
            const input = document.createElement('input');
            input.name = 'test';
            input.value = 'data';
            form.appendChild(input);
            document.body.appendChild(form);
            
            form.addEventListener('submit', e => {
                e.preventDefault();
                document.body.removeChild(form);
            });
            
            form.submit();
        }

        function test83() {
            const select = document.createElement('select');
            const option1 = document.createElement('option');
            option1.value = '1';
            const option2 = document.createElement('option');
            option2.value = '2';
            
            select.appendChild(option1);
            select.appendChild(option2);
            document.body.appendChild(select);
            
            const options = select.options;
            
            select.removeChild(option1);
            
            setTimeout(() => {
                const opt = options[0];
                if (opt) opt.selected = true;
            }, 10);
        }

        function test84() {
            const textarea = document.createElement('textarea');
            textarea.value = 'Initial';
            document.body.appendChild(textarea);
            
            let value = textarea.value;
            
            document.body.removeChild(textarea);
            
            setTimeout(() => {
                textarea.value = 'Modified';
                value = textarea.value;
            }, 10);
        }

        function test85() {
            const form = document.createElement('form');
            const radio1 = document.createElement('input');
            radio1.type = 'radio';
            radio1.name = 'group';
            const radio2 = document.createElement('input');
            radio2.type = 'radio';
            radio2.name = 'group';
            
            form.appendChild(radio1);
            form.appendChild(radio2);
            document.body.appendChild(form);
            
            radio1.checked = true;
            
            document.body.removeChild(form);
            
            setTimeout(() => {
                radio2.checked = true;
            }, 10);
        }

        function test86() {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            document.body.appendChild(checkbox);
            
            checkbox.checked = true;
            
            document.body.removeChild(checkbox);
            
            setTimeout(() => {
                checkbox.checked = false;
                const state = checkbox.checked;
            }, 10);
        }

        function test87() {
            const label = document.createElement('label');
            const input = document.createElement('input');
            label.appendChild(input);
            document.body.appendChild(label);
            
            const control = label.control;
            
            document.body.removeChild(label);
            
            setTimeout(() => {
                if (control) control.focus();
            }, 10);
        }

        function test88() {
            const fieldset = document.createElement('fieldset');
            const input = document.createElement('input');
            fieldset.appendChild(input);
            document.body.appendChild(fieldset);
            
            const elements = fieldset.elements;
            
            document.body.removeChild(fieldset);
            
            setTimeout(() => {
                const elem = elements[0];
                if (elem) elem.value = 'test';
            }, 10);
        }

        function test89() {
            const table = document.createElement('table');
            const row = table.insertRow();
            const cell = row.insertCell();
            cell.textContent = 'Data';
            document.body.appendChild(table);
            
            document.body.removeChild(table);
            
            setTimeout(() => {
                cell.textContent = 'Modified';
            }, 10);
        }

        function test90() {
            const table = document.createElement('table');
            const tbody = table.createTBody();
            const row1 = tbody.insertRow();
            const row2 = tbody.insertRow();
            document.body.appendChild(table);
            
            const rows = tbody.rows;
            
            tbody.deleteRow(0);
            
            setTimeout(() => {
                const row = rows[0];
                if (row) row.insertCell();
            }, 10);
        }

        function test91() {
            const ul = document.createElement('ul');
            const li = document.createElement('li');
            li.textContent = 'Item';
            ul.appendChild(li);
            document.body.appendChild(ul);
            
            ul.removeChild(li);
            
            setTimeout(() => {
                li.textContent = 'Modified';
            }, 10);
        }

        function test92() {
            const anchor = document.createElement('a');
            anchor.href = '#section1';
            document.body.appendChild(anchor);
            
            anchor.addEventListener('click', e => {
                e.preventDefault();
                document.body.removeChild(anchor);
                location.hash = '#section2';
            });
            
            anchor.click();
        }

        function test93() {
            const img = new Image();
            
            img.onload = function() {
                const parent = img.parentNode;
                if (parent) parent.removeChild(img);
            };
            
            document.body.appendChild(img);
            img.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';
        }

        function test94() {
            const script = document.createElement('script');
            script.async = true;
            script.textContent = 'console.log("test")';
            
            document.head.appendChild(script);
            
            setTimeout(() => {
                document.head.removeChild(script);
            }, 5);
        }

        function test95() {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'data:text/css,body{color:red;}';
            document.head.appendChild(link);
            
            setTimeout(() => {
                link.disabled = true;
                link.disabled = false;
                document.head.removeChild(link);
            }, 10);
        }

        function test96() {
            const base = document.createElement('base');
            base.href = 'http://example.com/';
            document.head.appendChild(base);
            
            const anchor = document.createElement('a');
            anchor.href = 'page.html';
            const href1 = anchor.href;
            
            base.href = 'http://other.com/';
            const href2 = anchor.href;
        }

        function test97() {
            const meta = document.createElement('meta');
            meta.name = 'viewport';
            meta.content = 'width=device-width';
            document.head.appendChild(meta);
            
            meta.content = 'width=1024';
            
            document.head.removeChild(meta);
            
            setTimeout(() => {
                meta.content = 'width=512';
            }, 10);
        }

        function test98() {
            const title = document.createElement('title');
            title.textContent = 'Test';
            document.head.appendChild(title);
            
            const textNode = title.firstChild;
            
            document.head.removeChild(title);
            
            setTimeout(() => {
                if (textNode) textNode.textContent = 'Modified';
            }, 10);
        }

        function test99() {
            const template = document.createElement('template');
            template.innerHTML = '<div>Content</div>';
            document.body.appendChild(template);
            
            const content = template.content;
            const div = content.firstChild;
            
            document.body.removeChild(template);
            
            setTimeout(() => {
                if (div) div.textContent = 'Modified';
            }, 10);
        }

        function test100() {
            if (!document.body.attachShadow) return;
            
            const host = document.createElement('div');
            document.body.appendChild(host);
            
            const shadow = host.attachShadow({mode: 'open'});
            const slot = document.createElement('slot');
            shadow.appendChild(slot);
            
            const content = document.createElement('span');
            content.textContent = 'Slotted';
            host.appendChild(content);
            
            document.body.removeChild(host);
            
            setTimeout(() => {
                content.textContent = 'Modified';
            }, 10);
        }
    </script>
</body>
</html>
