<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Browser Security Tests - Set 2 (51-100)</title>
</head>
<body>

<h1>PlayStation 4 Browser - UAF & Race Condition Tests - Set 2</h1>
<p>Security Research - Bug Bounty Testing (Tests 51-100)</p>
<p>User Agent: PlayStation 4/12.00 WebKit/605.1.15</p>

<hr>

<h2>Test 51: DocumentType Node UAF</h2>
<div id="test51">
<button onclick="test51()">Run Test 51</button>
</div>
<script>
function test51() {
  var doctype = document.implementation.createDocumentType('html', '', '');
  var doc = document.implementation.createDocument('', '', doctype);
  var ref = doctype;
  doc.removeChild(doctype);
  ref.name;
}
</script>

<hr>

<h2>Test 52: Race Condition - Rapid classList Toggle</h2>
<div id="test52">
<button onclick="test52()">Run Test 52</button>
</div>
<script>
function test52() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 1000; i++) {
    div.classList.toggle('test');
  }
  document.body.removeChild(div);
}
</script>

<hr>

<h2>Test 53: ProcessingInstruction UAF</h2>
<div id="test53">
<button onclick="test53()">Run Test 53</button>
</div>
<script>
function test53() {
  var pi = document.createProcessingInstruction('xml-stylesheet', 'href="style.css"');
  var div = document.createElement('div');
  div.appendChild(pi);
  document.body.appendChild(div);
  var ref = pi;
  div.removeChild(pi);
  ref.data = 'modified';
}
</script>

<hr>

<h2>Test 54: Race Condition - Multiple insertBefore Operations</h2>
<div id="test54">
<button onclick="test54()">Run Test 54</button>
</div>
<script>
function test54() {
  var parent = document.createElement('div');
  var child1 = document.createElement('span');
  var child2 = document.createElement('span');
  document.body.appendChild(parent);
  parent.appendChild(child2);
  for(var i = 0; i < 500; i++) {
    setTimeout(function() { parent.insertBefore(child1, child2); }, i % 10);
    setTimeout(function() { parent.removeChild(child1); }, (i % 10) + 5);
  }
}
</script>

<hr>

<h2>Test 55: CDATASection UAF</h2>
<div id="test55">
<button onclick="test55()">Run Test 55</button>
</div>
<script>
function test55() {
  var doc = document.implementation.createDocument('', '', null);
  var cdata = doc.createCDATASection('test data');
  var elem = doc.createElement('div');
  elem.appendChild(cdata);
  var ref = cdata;
  elem.removeChild(cdata);
  ref.data = 'modified';
}
</script>

<hr>

<h2>Test 56: Race Condition - Parallel cloneNode Operations</h2>
<div id="test56">
<button onclick="test56()">Run Test 56</button>
</div>
<script>
function test56() {
  var div = document.createElement('div');
  div.innerHTML = '<span>test</span>';
  document.body.appendChild(div);
  for(var i = 0; i < 100; i++) {
    setTimeout(function() {
      var clone = div.cloneNode(true);
      document.body.appendChild(clone);
      document.body.removeChild(clone);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 57: EntityReference UAF</h2>
<div id="test57">
<button onclick="test57()">Run Test 57</button>
</div>
<script>
function test57() {
  try {
    var doc = document.implementation.createDocument('', '', null);
    var entity = doc.createEntityReference('test');
    var div = doc.createElement('div');
    div.appendChild(entity);
    var ref = entity;
    div.removeChild(entity);
    ref.nodeName;
  } catch(e) {
    console.log('EntityReference not supported or error:', e);
  }
}
</script>

<hr>

<h2>Test 58: Race Condition - Concurrent normalize() Calls</h2>
<div id="test58">
<button onclick="test58()">Run Test 58</button>
</div>
<script>
function test58() {
  var div = document.createElement('div');
  div.appendChild(document.createTextNode('text1'));
  div.appendChild(document.createTextNode('text2'));
  document.body.appendChild(div);
  for(var i = 0; i < 100; i++) {
    setTimeout(function() { div.normalize(); }, 0);
  }
}
</script>

<hr>

<h2>Test 59: NamedNodeMap UAF</h2>
<div id="test59">
<button onclick="test59()">Run Test 59</button>
</div>
<script>
function test59() {
  var div = document.createElement('div');
  div.setAttribute('data-test', 'value');
  var attrs = div.attributes;
  document.body.appendChild(div);
  document.body.removeChild(div);
  attrs.item(0).value = 'modified';
}
</script>

<hr>

<h2>Test 60: Race Condition - replaceChild During Iteration</h2>
<div id="test60">
<button onclick="test60()">Run Test 60</button>
</div>
<script>
function test60() {
  var parent = document.createElement('div');
  var old = document.createElement('span');
  var newEl = document.createElement('span');
  parent.appendChild(old);
  document.body.appendChild(parent);
  for(var i = 0; i < 200; i++) {
    setTimeout(function() {
      try { parent.replaceChild(newEl, old); } catch(e) {}
      try { parent.replaceChild(old, newEl); } catch(e) {}
    }, 0);
  }
}
</script>

<hr>

<h2>Test 61: DOMImplementation UAF</h2>
<div id="test61">
<button onclick="test61()">Run Test 61</button>
</div>
<script>
function test61() {
  var impl = document.implementation;
  var doc = impl.createHTMLDocument('test');
  var body = doc.body;
  doc.removeChild(doc.documentElement);
  body.innerHTML = 'modified';
}
</script>

<hr>

<h2>Test 62: Race Condition - Multiple importNode Calls</h2>
<div id="test62">
<button onclick="test62()">Run Test 62</button>
</div>
<script>
function test62() {
  var doc1 = document.implementation.createHTMLDocument('doc1');
  var doc2 = document.implementation.createHTMLDocument('doc2');
  var div = doc1.createElement('div');
  for(var i = 0; i < 100; i++) {
    setTimeout(function() {
      var imported = doc2.importNode(div, true);
      doc2.body.appendChild(imported);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 63: HTMLCollection UAF</h2>
<div id="test63">
<button onclick="test63()">Run Test 63</button>
</div>
<script>
function test63() {
  var div = document.createElement('div');
  div.innerHTML = '<span></span><span></span>';
  document.body.appendChild(div);
  var collection = div.getElementsByTagName('span');
  document.body.removeChild(div);
  collection[0].innerHTML = 'test';
}
</script>

<hr>

<h2>Test 64: Race Condition - Rapid getBoundingClientRect</h2>
<div id="test64">
<button onclick="test64()">Run Test 64</button>
</div>
<script>
function test64() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 500; i++) {
    setTimeout(function() {
      div.getBoundingClientRect();
      div.innerHTML = 'test' + Math.random();
    }, 0);
  }
}
</script>

<hr>

<h2>Test 65: NodeList UAF</h2>
<div id="test65">
<button onclick="test65()">Run Test 65</button>
</div>
<script>
function test65() {
  var div = document.createElement('div');
  div.innerHTML = '<p></p><p></p><p></p>';
  document.body.appendChild(div);
  var nodeList = div.querySelectorAll('p');
  document.body.removeChild(div);
  nodeList[1].textContent = 'modified';
}
</script>

<hr>

<h2>Test 66: Race Condition - Concurrent scrollIntoView</h2>
<div id="test66">
<button onclick="test66()">Run Test 66</button>
</div>
<script>
function test66() {
  var div = document.createElement('div');
  div.textContent = 'scroll target';
  document.body.appendChild(div);
  for(var i = 0; i < 100; i++) {
    setTimeout(function() {
      div.scrollIntoView();
    }, i);
  }
  setTimeout(function() { document.body.removeChild(div); }, 50);
}
</script>

<hr>

<h2>Test 67: DOMStringMap UAF</h2>
<div id="test67">
<button onclick="test67()">Run Test 67</button>
</div>
<script>
function test67() {
  var div = document.createElement('div');
  div.setAttribute('data-test', 'value');
  var dataset = div.dataset;
  document.body.appendChild(div);
  document.body.removeChild(div);
  dataset.test = 'modified';
}
</script>

<hr>

<h2>Test 68: Race Condition - matches() During Removal</h2>
<div id="test68">
<button onclick="test68()">Run Test 68</button>
</div>
<script>
function test68() {
  var div = document.createElement('div');
  div.className = 'test-class';
  document.body.appendChild(div);
  setTimeout(function() { document.body.removeChild(div); }, 10);
  for(var i = 0; i < 100; i++) {
    setTimeout(function() {
      div.matches('.test-class');
    }, i);
  }
}
</script>

<hr>

<h2>Test 69: CSSStyleDeclaration UAF</h2>
<div id="test69">
<button onclick="test69()">Run Test 69</button>
</div>
<script>
function test69() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  var style = div.style;
  document.body.removeChild(div);
  style.color = 'red';
  style.fontSize = '20px';
}
</script>

<hr>

<h2>Test 70: Race Condition - Parallel getComputedStyle</h2>
<div id="test70">
<button onclick="test70()">Run Test 70</button>
</div>
<script>
function test70() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 200; i++) {
    setTimeout(function() {
      window.getComputedStyle(div);
    }, 0);
  }
  setTimeout(function() { document.body.removeChild(div); }, 50);
}
</script>

<hr>

<h2>Test 71: MediaList UAF</h2>
<div id="test71">
<button onclick="test71()">Run Test 71</button>
</div>
<script>
function test71() {
  var style = document.createElement('style');
  style.media = 'screen';
  document.head.appendChild(style);
  var mediaList = style.sheet.media;
  document.head.removeChild(style);
  mediaList.appendMedium('print');
}
</script>

<hr>

<h2>Test 72: Race Condition - Multiple focus() Calls</h2>
<div id="test72">
<button onclick="test72()">Run Test 72</button>
</div>
<script>
function test72() {
  var inputs = [];
  for(var i = 0; i < 10; i++) {
    var input = document.createElement('input');
    document.body.appendChild(input);
    inputs.push(input);
  }
  for(var j = 0; j < 100; j++) {
    setTimeout(function() {
      inputs[Math.floor(Math.random() * inputs.length)].focus();
    }, j);
  }
}
</script>

<hr>

<h2>Test 73: CSSRuleList UAF</h2>
<div id="test73">
<button onclick="test73()">Run Test 73</button>
</div>
<script>
function test73() {
  var style = document.createElement('style');
  document.head.appendChild(style);
  style.sheet.insertRule('body {}', 0);
  var rules = style.sheet.cssRules;
  document.head.removeChild(style);
  rules[0].cssText;
}
</script>

<hr>

<h2>Test 74: Race Condition - Blur During Focus</h2>
<div id="test74">
<button onclick="test74()">Run Test 74</button>
</div>
<script>
function test74() {
  var input = document.createElement('input');
  document.body.appendChild(input);
  for(var i = 0; i < 200; i++) {
    setTimeout(function() { input.focus(); }, i * 2);
    setTimeout(function() { input.blur(); }, i * 2 + 1);
  }
}
</script>

<hr>

<h2>Test 75: Performance Timeline UAF</h2>
<div id="test75">
<button onclick="test75()">Run Test 75</button>
</div>
<script>
function test75() {
  try {
    performance.mark('test-mark');
    var entries = performance.getEntriesByName('test-mark');
    performance.clearMarks('test-mark');
    entries[0].duration;
  } catch(e) {
    console.log('Performance API error:', e);
  }
}
</script>

<hr>

<h2>Test 76: Race Condition - Multiple select() on Input</h2>
<div id="test76">
<button onclick="test76()">Run Test 76</button>
</div>
<script>
function test76() {
  var input = document.createElement('input');
  input.value = 'test value';
  document.body.appendChild(input);
  for(var i = 0; i < 300; i++) {
    setTimeout(function() {
      input.select();
    }, 0);
  }
}
</script>

<hr>

<h2>Test 77: Geolocation UAF</h2>
<div id="test77">
<button onclick="test77()">Run Test 77</button>
</div>
<script>
function test77() {
  try {
    var id = navigator.geolocation.watchPosition(
      function(pos) { console.log(pos); },
      function(err) { console.log(err); }
    );
    navigator.geolocation.clearWatch(id);
    navigator.geolocation.clearWatch(id);
  } catch(e) {
    console.log('Geolocation error:', e);
  }
}
</script>

<hr>

<h2>Test 78: Race Condition - setSelectionRange Concurrent</h2>
<div id="test78">
<button onclick="test78()">Run Test 78</button>
</div>
<script>
function test78() {
  var input = document.createElement('input');
  input.value = 'test selection range';
  document.body.appendChild(input);
  for(var i = 0; i < 200; i++) {
    setTimeout(function(n) {
      input.setSelectionRange(n % 10, (n % 10) + 5);
    }, 0, i);
  }
}
</script>

<hr>

<h2>Test 79: Battery Status UAF</h2>
<div id="test79">
<button onclick="test79()">Run Test 79</button>
</div>
<script>
function test79() {
  try {
    if(navigator.getBattery) {
      navigator.getBattery().then(function(battery) {
        battery.onchargingchange = function() { console.log('charging'); };
        battery = null;
      });
    }
  } catch(e) {
    console.log('Battery API error:', e);
  }
}
</script>

<hr>

<h2>Test 80: Race Condition - createObjectURL/revokeObjectURL</h2>
<div id="test80">
<button onclick="test80()">Run Test 80</button>
</div>
<script>
function test80() {
  var blob = new Blob(['test'], {type: 'text/plain'});
  var urls = [];
  for(var i = 0; i < 100; i++) {
    urls.push(URL.createObjectURL(blob));
  }
  setTimeout(function() {
    urls.forEach(function(url) {
      URL.revokeObjectURL(url);
    });
  }, 10);
}
</script>

<hr>

<h2>Test 81: MediaQueryList UAF</h2>
<div id="test81">
<button onclick="test81()">Run Test 81</button>
</div>
<script>
function test81() {
  var mql = window.matchMedia('(max-width: 600px)');
  var listener = function(e) { console.log(e.matches); };
  mql.addListener(listener);
  mql.removeListener(listener);
  mql.addListener(listener);
}
</script>

<hr>

<h2>Test 82: Race Condition - Multiple appendChild Same Node</h2>
<div id="test82">
<button onclick="test82()">Run Test 82</button>
</div>
<script>
function test82() {
  var child = document.createElement('div');
  var parents = [];
  for(var i = 0; i < 5; i++) {
    var parent = document.createElement('div');
    document.body.appendChild(parent);
    parents.push(parent);
  }
  for(var j = 0; j < 100; j++) {
    setTimeout(function() {
      var p = parents[Math.floor(Math.random() * parents.length)];
      p.appendChild(child);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 83: Screen Orientation UAF</h2>
<div id="test83">
<button onclick="test83()">Run Test 83</button>
</div>
<script>
function test83() {
  try {
    if(screen.orientation) {
      var listener = function() { console.log('orientation change'); };
      screen.orientation.addEventListener('change', listener);
      screen.orientation.removeEventListener('change', listener);
      screen.orientation.addEventListener('change', listener);
    }
  } catch(e) {
    console.log('Screen Orientation error:', e);
  }
}
</script>

<hr>

<h2>Test 84: Race Condition - Rapid textContent Changes</h2>
<div id="test84">
<button onclick="test84()">Run Test 84</button>
</div>
<script>
function test84() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 1000; i++) {
    setTimeout(function(n) {
      div.textContent = 'Text ' + n;
    }, 0, i);
  }
}
</script>

<hr>

<h2>Test 85: Blob URL UAF</h2>
<div id="test85">
<button onclick="test85()">Run Test 85</button>
</div>
<script>
function test85() {
  var blob = new Blob(['<h1>test</h1>'], {type: 'text/html'});
  var url = URL.createObjectURL(blob);
  var iframe = document.createElement('iframe');
  iframe.src = url;
  document.body.appendChild(iframe);
  URL.revokeObjectURL(url);
  setTimeout(function() {
    iframe.contentWindow.document.body.innerHTML = 'modified';
  }, 100);
}
</script>

<hr>

<h2>Test 86: Race Condition - hasAttribute During Mutation</h2>
<div id="test86">
<button onclick="test86()">Run Test 86</button>
</div>
<script>
function test86() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 500; i++) {
    setTimeout(function() {
      div.setAttribute('data-test', 'value');
    }, i % 50);
    setTimeout(function() {
      div.hasAttribute('data-test');
    }, (i % 50) + 1);
    setTimeout(function() {
      div.removeAttribute('data-test');
    }, (i % 50) + 2);
  }
}
</script>

<hr>

<h2>Test 87: PerformanceObserver UAF</h2>
<div id="test87">
<button onclick="test87()">Run Test 87</button>
</div>
<script>
function test87() {
  try {
    var obs = new PerformanceObserver(function(list) {
      console.log(list.getEntries());
    });
    obs.observe({entryTypes: ['mark']});
    obs.disconnect();
    performance.mark('test');
  } catch(e) {
    console.log('PerformanceObserver error:', e);
  }
}
</script>

<hr>

<h2>Test 88: Race Condition - Rapid createElement/remove</h2>
<div id="test88">
<button onclick="test88()">Run Test 88</button>
</div>
<script>
function test88() {
  for(var i = 0; i < 1000; i++) {
    setTimeout(function() {
      var elem = document.createElement('div');
      document.body.appendChild(elem);
      document.body.removeChild(elem);
    }, 0);
  }
}
</script>

<hr>

<h2>Test 89: SharedWorker UAF</h2>
<div id="test89">
<button onclick="test89()">Run Test 89</button>
</div>
<script>
function test89() {
  try {
    var blob = new Blob(['onconnect = function(e) { e.ports[0].postMessage("test"); }'], {type: 'application/javascript'});
    var worker = new SharedWorker(URL.createObjectURL(blob));
    worker.port.onmessage = function(e) { console.log(e.data); };
    worker.port.start();
    worker.port.close();
    worker.port.postMessage('after close');
  } catch(e) {
    console.log('SharedWorker error:', e);
  }
}
</script>

<hr>

<h2>Test 90: Race Condition - offsetWidth/Height Reading</h2>
<div id="test90">
<button onclick="test90()">Run Test 90</button>
</div>
<script>
function test90() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 500; i++) {
    setTimeout(function() {
      var w = div.offsetWidth;
      var h = div.offsetHeight;
      div.innerHTML = '<span>test</span>';
    }, 0);
  }
}
</script>

<hr>

<h2>Test 91: ResizeObserver UAF</h2>
<div id="test91">
<button onclick="test91()">Run Test 91</button>
</div>
<script>
function test91() {
  try {
    var div = document.createElement('div');
    document.body.appendChild(div);
    var obs = new ResizeObserver(function(entries) {
      console.log(entries);
    });
    obs.observe(div);
    document.body.removeChild(div);
    obs.disconnect();
  } catch(e) {
    console.log('ResizeObserver error:', e);
  }
}
</script>

<hr>

<h2>Test 92: Race Condition - Multiple createTextNode</h2>
<div id="test92">
<button onclick="test92()">Run Test 92</button>
</div>
<script>
function test92() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 500; i++) {
    setTimeout(function(n) {
      var txt = document.createTextNode('Text ' + n);
      div.appendChild(txt);
    }, 0, i);
  }
  setTimeout(function() {
    div.innerHTML = '';
  }, 100);
}
</script>

<hr>

<h2>Test 93: ServiceWorker Registration UAF</h2>
<div id="test93">
<button onclick="test93()">Run Test 93</button>
</div>
<script>
function test93() {
  try {
    if('serviceWorker' in navigator) {
      navigator.serviceWorker.register('data:application/javascript,console.log("sw")')
        .then(function(reg) {
          reg.unregister();
          return reg.update();
        })
        .catch(function(e) { console.log('SW error:', e); });
    }
  } catch(e) {
    console.log('ServiceWorker error:', e);
  }
}
</script>

<hr>

<h2>Test 94: Race Condition - firstChild/lastChild Access</h2>
<div id="test94">
<button onclick="test94()">Run Test 94</button>
</div>
<script>
function test94() {
  var div = document.createElement('div');
  document.body.appendChild(div);
  for(var i = 0; i < 300; i++) {
    setTimeout(function() {
      div.appendChild(document.createElement('span'));
    }, i % 30);
    setTimeout(function() {
      var f = div.firstChild;
      var l = div.lastChild;
    }, (i % 30) + 1);
    setTimeout(function() {
      if(div.firstChild) div.removeChild(div.firstChild);
    }, (i % 30) + 2);
  }
}
</script>

<hr>

<h2>Test 95: Gamepad API UAF</h2>
<div id="test95">
<button onclick="test95()">Run Test 95</button>
</div>
<script>
function test95() {
  try {
    var gamepads = navigator.getGamepads();
    var listener = function(e) { console.log(e.gamepad); };
    window.addEventListener('gamepadconnected', listener);
    window.removeEventListener('gamepadconnected', listener);
  } catch(e) {
    console.log('Gamepad API error:', e);
  }
}
</script>

<hr>

<h2>Test 96: Race Condition - parentNode Access During Removal</h2>
<div id="test96">
<button onclick="test96()">Run Test 96</button>
</div>
<script>
function test96() {
  var parent = document.createElement('div');
  var child = document.createElement('span');
  parent.appendChild(child);
  document.body.appendChild(parent);
  for(var i = 0; i < 200; i++) {
    setTimeout(function() {
      var p = child.parentNode;
    }, i % 20);
    setTimeout(function() {
      if(child.parentNode) child.parentNode.removeChild(child);
    }, (i % 20) + 1);
    setTimeout(function() {
      parent.appendChild(child);
    }, (i % 20) + 2);
  }
}
</script>

<hr>

<h2>Test 97: History State UAF</h2>
<div id="test97">
<button onclick="test97()">Run Test 97</button>
</div>
<script>
function test97() {
  try {
    var state = {data: 'test'};
    history.pushState(state, '', '#test');
    state = null;
    history.back();
    setTimeout(function() {
      var s = history.state;
      s.data = 'modified';
    }, 100);
  } catch(e) {
    console.log('History API error:', e);
  }
}
</script>

<hr>

<h2>Test 98: Race Condition - Multiple replaceData on TextNode</h2>
<div id="test98">
<button onclick="test98()">Run Test 98</button>
</div>
<script>
function test98() {
  var txt = document.createTextNode('initial text content');
  var div = document.createElement('div');
  div.appendChild(txt);
  document.body.appendChild(div);
  for(var i = 0; i < 300; i++) {
    setTimeout(function(n) {
      txt.replaceData(0, 7, 'Text' + n);
    }, 0, i);
  }
}
</script>

<hr>

<h2>Test 99: Crypto Random Values UAF</h2>
<div id="test99">
<button onclick="test99()">Run Test 99</button>
</div>
<script>
function test99() {
  try {
    var array = new Uint8Array(100);
    crypto.getRandomValues(array);
    array = null;
    crypto.getRandomValues(new Uint8Array(100));
  } catch(e) {
    console.log('Crypto error:', e);
  }
}
</script>

<hr>

<h2>Test 100: Race Condition - Simultaneous querySelectorAll</h2>
<div id="test100">
<button onclick="test100()">Run Test 100</button>
</div>
