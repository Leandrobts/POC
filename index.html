<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Memory Debugger V3 (Surgical Swap)</title>
<style>
    body { background-color: #000; color: #0f0; font-family: monospace; text-align: center; padding: 20px; }
    button { background: #004400; color: white; border: 2px solid #0f0; padding: 20px 40px; font-size: 1.5em; cursor: pointer; margin: 10px; }
    #log { text-align: left; margin: 20px auto; border: 1px solid #444; padding: 10px; height: 300px; overflow-y: scroll; background: #111; }
</style>
</head>
<body>

<h1>DEBUGGER V3: SURGICAL SWAP</h1>
<p>Estratégia: Free(1) -> Alloc(1). Força o reuso imediato do endereço.</p>

<button onclick="step1()">1. ALOCAR (BEACON)</button>
<br>
<button onclick="step2()">2. GATILHO (OPTIONS)</button>

<div id="log">Logs...</div>

<script>
    const Log = document.getElementById('log');
    function log(txt) { Log.innerHTML += ">> " + txt + "<br>"; Log.scrollTop = Log.scrollHeight;}

    // Configuração
    const BEACON_VAL = 0xDEADBEEF; // Procure por EFBEADDE no Hex
    const POISON_VAL = 0x41414141; // Spray

    let victims = [];
    let spray_storage = [];
    const COUNT = 20000; 

    function step1() {
        log("Alocando 20.000 arrays (BEACON)...");
        
        // Criamos arrays de Uint32 com tamanho 32 (128 bytes)
        for(let i=0; i<COUNT; i++) {
            let v = new Uint32Array(32);
            v.fill(BEACON_VAL);
            // Vamos marcar o primeiro elemento com o índice para você ver "01, 02, 03"
            v[0] = i; 
            victims.push(v);
        }

        log("MEMÓRIA PRONTA!");
        log("No Cheater Neo: Busque Hex 'EFBEADDE'.");
        log("Note que o primeiro byte de cada array agora será o índice (01, 02...).");
    }

    function step2() {
        log("Gatilho armado...");
        
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        window.onblur = function() {
            log("BLUR! Iniciando Troca Cirúrgica...");
            document.body.style.background = "#500";

            // A MÁGICA: Loop de Troca Imediata
            for(let i=0; i<COUNT; i++) {
                
                // 1. Libera UMA vítima
                victims[i] = null; 

                // 2. Aloca UM spray imediatamente (tentando pegar a vaga)
                try {
                    let s = new Uint32Array(32); 
                    s.fill(POISON_VAL);
                    spray_storage.push(s);
                } catch(e) {}
            }

            // Limpeza final para garantir
            victims = null;

            log("TROCA FEITA! Dê Refresh no Hex Editor.");
            log("Verifique se a contagem de EFBEADDE diminuiu.");
        };
    }
</script>
</body>
</html>
