<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>History.pushState Boundary Test (Rate Limit Safe)</title>
</head>
<body>

<h1>History.pushState Boundary Test</h1>
<button onclick="run()">RUN TEST</button>
<pre id="log"></pre>

<script>
function log(m){
  document.getElementById("log").textContent += m + "\n";
}

let count = 0;
const MAX = 3000;

function pushStep(){
  try {
    history.pushState(
      { x: "A".repeat(10000) },
      "",
      "#" + count
    );
    count++;
    log("pushState " + count);

    if (count < MAX) {
      setTimeout(pushStep, 110); // respeita rate-limit
    } else {
      log("[+] History filled");

      // Heap pressure tardia
      for (let i = 0; i < 4000; i++) {
        new ArrayBuffer(1024 * 512);
      }

      log("[+] Heap pressure applied");
      history.back();
      log("[!] history.back() executed");
    }

  } catch(e) {
    log("[EXCEPTION] " + e);
  }
}

function run(){
  log("[*] Test started");
  pushStep();
}
</script>

</body>
</html>

