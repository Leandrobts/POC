<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Suite v540000: Modal Focus War</title>
<style>
    body { background: #000; color: #ff0; font-family: monospace; text-align: center; padding: 10px; }
    h1 { border-bottom: 2px solid #ff0; color: #fff; }
    .status { 
        border: 2px solid #fff; padding: 15px; margin-bottom: 20px; 
        font-size: 1.2em; background: #400; color: #fff; font-weight: bold;
    }
    .inst { font-size: 0.9em; color: #fff; margin-bottom: 15px; }
    
    button {
        display: block; width: 100%; padding: 25px; margin: 15px 0;
        background: #220; color: #fff; border: 2px solid #ff0;
        font-size: 20px; font-weight: bold; cursor: pointer; text-transform: uppercase;
    }
    button:hover { background: #ff0; color: #000; }
    
    #stage { background: #111; height: 50px; border: 1px solid #555; margin-top: 20px; }
</style>
</head>
<body>

<h1>v540000: MODAL FOCUS WAR</h1>

<div class="status" id="msg">
    ESTRATÉGIA: CONFLITO DE JANELAS (FULLSCREEN vs ALERT)<br>
    CLIQUE -> FULLSCREEN -> INTERAJA COM O ALERTA
</div>

<button onclick="modal_war(m01)">01. Resize Loop Trap (Stack Overflow)</button>

<button onclick="modal_war(m02)">02. Prompt Allocator -> Fullscreen</button>

<button onclick="modal_war(m03)">03. Confirm Denial (Logic Break)</button>

<button onclick="modal_war(m04)">04. Triple Alert Stack (UI Freeze)</button>

<button onclick="modal_war(m05)">05. Print/Alert Overlay Conflict</button>

<div id="stage">ALVO</div>

<script>
    const Stage = document.getElementById('stage');
    
    // Spray de memória para estabilizar crashes
    let junk = [];

    function modal_war(vectorFunc) {
        Stage.innerHTML = "";
        junk = [];
        
        // 1. Configura
        const target = vectorFunc(Stage);
        
        // 2. Executa a lógica
        // Alguns testes pedem Fullscreen automático, outros pedem manual via alerta
        setTimeout(() => {
            if(target._start) target._start();
        }, 200);
    }

    // =================================================================
    // 01. Resize Loop Trap (Stack Overflow)
    // Tenta entrar em Fullscreen. O evento 'resize' dispara.
    // Dentro do resize, abrimos um Alert. O Alert muda o tamanho da janela.
    // O 'resize' dispara de novo -> Loop Infinito de Alertas.
    // =================================================================
    function m01(stage) {
        const d = document.createElement('div');
        d.innerText = "RESIZE TRAP";
        stage.appendChild(d);

        // Prepara o evento armadilha
        window.onresize = () => {
            // ALOCAÇÃO: Cria pressão na memória a cada redimensionamento
            junk.push(new Uint8Array(1024*1024));
            
            // O ALERTA PAUSA O RESIZE
            // Quando você fecha, o navegador tenta terminar o resize anterior
            // mas dispara um novo.
            window.alert("⚠️ RESIZE DETECTED ⚠️\nEstamos presos num loop de geometria?");
        };

        d._start = () => {
            // Gatilho inicial
            if (document.body.webkitRequestFullscreen) document.body.webkitRequestFullscreen();
            else if (document.body.requestFullscreen) document.body.requestFullscreen();
        };
        return d;
    }

    // =================================================================
    // 02. Prompt Allocator -> Fullscreen
    // Usa 'prompt' para alocar memória de string e pede fullscreen
    // IMEDIATAMENTE após o usuário fechar a caixa.
    // =================================================================
    function m02(stage) {
        const d = document.createElement('div');
        d.innerText = "PROMPT FULLSCREEN";
        stage.appendChild(d);

        d._start = () => {
            // 1. Pausa e Aloca
            const input = window.prompt("⚠️ PREPARE-SE ⚠️\nDigite algo aleatório para alocar memória e clique OK.", "AAAAAAA");
            
            // 2. Imediatamente após o OK (Sync)
            // O navegador ainda está limpando a caixa de diálogo
            
            // Tenta destruir o palco
            stage.innerHTML = "<h1>TRANSITION...</h1>";
            
            // Pede Fullscreen
            if (document.body.webkitRequestFullscreen) document.body.webkitRequestFullscreen();
            else if (document.body.requestFullscreen) document.body.requestFullscreen();
            
            // Spray
            for(let i=0; i<1000; i++) junk.push(new Float64Array(100).fill(1.1));
        };
        return d;
    }

    // =================================================================
    // 03. Confirm Denial (Logic Break)
    // Pede Fullscreen. Se entrar, pede confirmação para SAIR.
    // Se o usuário clicar em Cancelar (Não Sair), tentamos forçar
    // uma mudança de DOM agressiva mantendo o fullscreen.
    // =================================================================
    function m03(stage) {
        const d = document.createElement('div');
        d.innerText = "CONFIRM LOGIC";
        stage.appendChild(d);

        document.onwebkitfullscreenchange = () => {
            if (document.webkitFullscreenElement) {
                // Estamos em Fullscreen. Agora a armadilha.
                setTimeout(() => {
                    const exit = window.confirm("⚠️ MODO FULLSCREEN ATIVO ⚠️\nDeseja sair para evitar o crash?\n\nCancelar = FICAR e CORROMPER.");
                    
                    if (!exit) {
                        // O usuário escolheu o perigo
                        document.body.innerHTML = ""; // Nuke
                        // Loop infinito para travar o renderizador em tela cheia
                        while(true) { history.pushState(0,0,0); } 
                    } else {
                        document.exitFullscreen();
                    }
                }, 500);
            }
        };

        d._start = () => {
            if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
            else if (d.requestFullscreen) d.requestFullscreen();
        };
        return d;
    }

    // =================================================================
    // 04. Triple Alert Stack (UI Freeze)
    // Abre 3 alertas aninhados (Alert dentro de Alert).
    // O objetivo é estourar a pilha de gerenciamento de janelas do PS4.
    // =================================================================
    function m04(stage) {
        const d = document.createElement('div');
        d.innerText = "TRIPLE STACK";
        stage.appendChild(d);

        d._start = () => {
            // Alerta 1
            window.alert("NÍVEL 1\nClique OK para descer.");
            
            // Alerta 2 (Imediatamente após o 1 fechar)
            // Injetamos um pedido de Fullscreen entre os alertas
            try {
                if (document.body.webkitRequestFullscreen) document.body.webkitRequestFullscreen();
            } catch(e) {}
            
            window.alert("NÍVEL 2 (Fullscreen Background?)\nClique OK.");
            
            // Alerta 3 + Nuke
            document.body.innerHTML = "DEAD";
            window.alert("NÍVEL 3 (DOM Morto)\nO navegador ainda existe?");
            
            // Se chegou aqui, tenta reload forçado
            window.location.reload();
        };
        return d;
    }

    // =================================================================
    // 05. Print/Alert Overlay Conflict
    // Tenta chamar window.print() (se existir no PS4) junto com Alert.
    // Se print não existir, usamos window.find() que também abre overlay.
    // =================================================================
    function m05(stage) {
        const d = document.createElement('div');
        d.innerText = "OVERLAY CONFLICT";
        stage.appendChild(d);

        d._start = () => {
            // Tenta abrir a busca de texto (Overlay do Sistema)
            if(window.find) window.find("a");
            
            // Imediatamente joga um alerta por cima
            window.alert("⚠️ CONFLITO DE OVERLAY ⚠️\nUma caixa de busca ou print tentou abrir?");
            
            // Quando fecha o alerta, tenta Fullscreen
            if (document.body.webkitRequestFullscreen) document.body.webkitRequestFullscreen();
        };
        return d;
    }

</script>
</body>
</html>
