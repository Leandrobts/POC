<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Time Bomb Test</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 20px; text-align: center; }
        #timer { font-size: 80px; font-weight: bold; margin: 20px 0; color: #fff; }
        .panel { border: 2px solid #333; padding: 20px; margin: 20px auto; max-width: 600px; background: #111; }
        button { cursor: pointer; padding: 15px 30px; background: #b00; color: #fff; border: none; font-size: 20px; font-weight: bold; }
        button:disabled { background: #333; color: #777; }
        #log { text-align: left; font-size: 14px; color: #888; margin-top: 20px; }
        .status-ok { color: #0f0; }
        .status-danger { color: #f00; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <h1>Teste da "Bomba Relógio"</h1>
    <p>Objetivo: Descobrir o intervalo exato de limpeza do Kernel.</p>
    
    <div class="panel">
        <div id="status">Status: Aguardando Início...</div>
        <div id="timer">00.00</div>
        <br>
        <button id="btnArm" onclick="armBomb()">ARMAR BOMBA (Criar Zumbis)</button>
    </div>

    <div id="log">Logs...</div>

    <script>
        const logEl = document.getElementById('log');
        const timerEl = document.getElementById('timer');
        const statusEl = document.getElementById('status');
        let workers = [];
        let startTime = 0;
        let timerInterval = null;

        function log(msg) {
            logEl.innerHTML = `> ${msg}<br>` + logEl.innerHTML;
        }

        // 1. Enche a base segura (250 - bem longe do limite de quantidade)
        async function armBomb() {
            document.getElementById('btnArm').disabled = true;
            statusEl.innerText = "Preparando a base (250)...";
            statusEl.className = "status-ok";
            
            // Cria base
            for(let i=0; i<250; i++) {
                try {
                    const sw = new SharedWorker("data:text/javascript,onconnect=e=>{}", `base_${i}`);
                    sw.port.start();
                    workers.push(sw);
                } catch(e) {}
                if(i%50===0) await new Promise(r => setTimeout(r, 10));
            }

            log("Base criada. Iniciando injeção de Zumbis...");
            
            // 2. Cria o cenário de perigo (Race Condition Controlada)
            // Vamos fazer apenas 100 tentativas de corrupção e PARAR.
            // Se o crash for por tempo, isso será suficiente para "sujar" o kernel.
            let zombies = 0;
            const attackLoop = setInterval(() => {
                zombies++;
                const id = `zombie_${Date.now()}_${zombies}`;
                try {
                    const sw = new SharedWorker("data:text/javascript,onconnect=e=>{}", id);
                    sw.port.postMessage("ping"); // Suja o IPC
                    sw.port.close(); // Cria o fantasma
                    
                    // Spray leve de WebSocket para tentar ocupar o lugar
                    const ws = new WebSocket(`ws://127.0.0.1:${9000 + (zombies%50)}`);
                    ws.close(); // Fecha logo em seguida para deixar o descritor "pendente"
                } catch(e) {}

                if(zombies >= 100) {
                    clearInterval(attackLoop);
                    startTimer(); // AQUI COMEÇA O TESTE REAL
                }
            }, 10);
        }

        function startTimer() {
            log("Injeção parada. O Kernel está sujo.");
            log("AGUARDANDO O FAXINEIRO DO KERNEL...");
            statusEl.innerText = "PERIGO: BOMBA ARMADA. NÃO TOQUE EM NADA.";
            statusEl.className = "status-danger";
            
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const diff = (Date.now() - startTime) / 1000;
                timerEl.innerText = diff.toFixed(2);
            }, 50);
        }
    </script>
</body>
</html>
