<!DOCTYPE html>
<html>
<head>
    <title>PS4 Phantom GC (Stealth Mode)</title>
    <style>
        body { background: #050010; color: #d0f; font-family: monospace; padding: 20px; font-size: 24px; }
        #hud { border: 2px solid #90f; padding: 15px; background: #100020; }
        .crit { color: #f00; font-weight: bold; }
    </style>
</head>
<body>
    <div id="hud">
        PHANTOM MODE: <span id="status" style="color:yellow">INICIANDO...</span><br>
        TENTATIVAS: <span id="count">0</span>
    </div>

    <script>
        const status = document.getElementById('status');
        const countDisp = document.getElementById('count');
        let attempts = 0;

        // Spray de memória massivo para forçar GC imediato
        function forceGC() {
            try {
                let a = [];
                // Aloca 500MB de Strings (pressiona o Heap diferente de ArrayBuffer)
                for(let i=0; i<100; i++) a.push(new Array(100000).join("A"));
                return a; // Mantém vivo por um micro-segundo
            } catch(e) {}
        }

        function runPhantom() {
            attempts++;
            countDisp.innerText = attempts;

            // 1. O Objeto Fantasma
            // Usamos uma estrutura que o JSON vai navegar profundamente
            let root = {
                a: {
                    get b() {
                        // AQUI É O TRUQUE:
                        // Criamos o alvo (Target) AQUI dentro.
                        // Ele não existe na stack da chamada inicial do stringify.
                        let target = {
                            id: 1,
                            // O toJSON do alvo é a armadilha
                            toJSON: function() {
                                status.innerText = ">>> FANTASMA ATIVO <<<";
                                status.style.color = "magenta";

                                // 1. Apaga a ÚNICA referência ao 'target' (que é a variável local 'target')
                                // Como estamos dentro da função, 'this' é o target.
                                // Mas não temos como deletar 'this'.
                                // O truque é fazer o GC rodar AGORA.
                                
                                // 2. Pressão Insana
                                let pressure = forceGC();

                                // 3. Verifica se fomos deletados?
                                // Em um exploit real, aqui tentaríamos acessar memória corrompida.
                                // Para teste, verificamos se o objeto ainda está "inteiro".
                                
                                return "phantom_executed";
                            }
                        };
                        return target;
                    }
                }
            };

            try {
                // Inicia a serialização no objeto raiz (que não é o alvo)
                // O alvo nasce e morre lá dentro
                JSON.stringify(root);
                
                if(attempts < 50) {
                    setTimeout(runPhantom, 50); // Tenta de novo rápido
                } else {
                    status.innerText = "FALHA: O Phantom sobreviveu (Stack Scanning muito forte).";
                    status.style.color = "gray";
                }
            } catch(e) {
                status.innerText = "CRASH/ERRO: " + e.message;
                status.className = "crit";
            }
        }

        setTimeout(runPhantom, 1000);
    </script>
</body>
</html>
