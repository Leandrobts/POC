<!DOCTYPE html>
<html>
<head>
    <title>PS4 Hyper Fuzzer (Endurance + Layout Thrashing)</title>
    <style>
        body { background: #000; color: #00ff00; font-family: monospace; overflow: hidden; }
        #hud { 
            position: fixed; top: 0; left: 0; width: 100%; 
            background: rgba(0,20,0,0.9); border-bottom: 2px solid #0f0; padding: 10px; z-index: 999;
        }
        .chaos { position: absolute; transition: all 0.1s; border: 1px solid red; }
        /* CSS que confunde a aceleração de hardware do PS4 */
        .gpu-killer { transform: translate3d(0,0,0); backface-visibility: hidden; filter: contrast(150%); }
    </style>
</head>
<body>
    <div id="hud">
        <div>STATUS: <span id="status">Iniciando...</span></div>
        <div>SEED ATUAL: <span id="seed-disp">...</span> | OBJETOS VIVOS: <span id="nodes-count">0</span></div>
        <div id="heartbeat" style="color: white;">❤</div>
    </div>
    <div id="arena" style="margin-top: 100px;"></div>

    <script>
        // ================= CONFIGURAÇÃO =================
        const MAX_NODES = 800; // Limite para evitar travamento por falta de RAM (OOM)
        // ================================================

        // PRNG (Gerador de números pseudo-aleatórios)
        let currentSeed = parseInt(localStorage.getItem('hyper_seed') || Math.floor(Math.random() * 100000));
        
        // Salva a seed inicial caso o console trave imediatamente
        localStorage.setItem('hyper_last_start', currentSeed);

        function seed(s) { currentSeed = s; }
        function rnd() {
            var t = currentSeed += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
        function pick(arr) { return arr[Math.floor(rnd() * arr.length)]; }
        function coinflip() { return rnd() > 0.5; }

        const TAGS = ['div', 'span', 'iframe', 'table', 'img', 'button', 'canvas', 'details', 'summary', 'svg', 'foreignObject'];
        const arena = document.getElementById('arena');
        const statusSpan = document.getElementById('status');
        const seedSpan = document.getElementById('seed-disp');
        const nodesSpan = document.getElementById('nodes-count');
        const beatSpan = document.getElementById('heartbeat');

        let liveNodes = [];

        // --- VETORES DE ATAQUE AVANÇADOS ---

        // 1. Layout Thrashing (O Assassino de WebKit Antigo)
        // Lê propriedades geométricas forçando o navegador a recalcular tudo AGORA
        function thrashLayout(el) {
            try {
                let _ = el.offsetHeight; // Força reflow síncrono
                _ = el.getBoundingClientRect().top;
                if (coinflip()) el.style.width = (rnd() * 500) + "px"; // Invalida o layout logo em seguida
            } catch(e){}
        }

        // 2. Iframe Cycling
        // Carrega páginas vazias ou "about:blank" para estressar o loader
        function fuzzIframe(el) {
            if (el.tagName === 'IFRAME') {
                try {
                    el.src = coinflip() ? 'about:blank' : '';
                    // Tenta acessar o contentWindow enquanto ele carrega/descarrega
                    let win = el.contentWindow; 
                    if (win && coinflip()) win.document.body.innerHTML = "<b>Fuzz</b>";
                } catch(e){}
            }
        }

        // 3. Tree Surgery (Cirurgia de Árvore)
        // Move elementos de lugar drasticamente
        function reparent(el) {
            if (liveNodes.length > 5 && coinflip()) {
                let newParent = pick(liveNodes);
                // Evita ciclos (colocar pai dentro do filho)
                if (newParent !== el && !el.contains(newParent)) {
                    try { newParent.appendChild(el); } catch(e){}
                }
            }
        }

        // LOOP PRINCIPAL (RODA ETERNAMENTE)
        function loop() {
            // Atualiza HUD
            seedSpan.innerText = currentSeed;
            nodesSpan.innerText = liveNodes.length;
            beatSpan.innerText = (beatSpan.innerText === "❤") ? "." : "❤"; // Pisca
            
            // Salva checkpoint a cada 100 seeds (para não matar o SSD do PS4 com escrita)
            if (currentSeed % 100 === 0) {
                localStorage.setItem('hyper_seed', currentSeed);
            }

            try {
                // --- FASE 1: NASCIMENTO ---
                // Se tivermos poucos nós, cria mais agressivamente
                if (liveNodes.length < MAX_NODES) {
                    for (let i = 0; i < 10; i++) {
                        let tag = pick(TAGS);
                        let el;
                        if (['svg','foreignObject'].includes(tag)) el = document.createElementNS("http://www.w3.org/2000/svg", tag);
                        else el = document.createElement(tag);

                        el.className = "chaos";
                        if (coinflip()) el.classList.add("gpu-killer");

                        // Adiciona na arena ou dentro de outro nó
                        if (liveNodes.length > 0 && coinflip()) {
                            try { pick(liveNodes).appendChild(el); } catch(e){ arena.appendChild(el); }
                        } else {
                            arena.appendChild(el);
                        }
                        liveNodes.push(el);
                    }
                }

                // --- FASE 2: TORTURA ---
                for (let i = 0; i < 20; i++) {
                    let victim = pick(liveNodes);
                    if (!victim) continue;

                    thrashLayout(victim);
                    fuzzIframe(victim);
                    reparent(victim);

                    // Range & Selection (Vetor UAF clássico)
                    if (rnd() > 0.8) {
                        let s = window.getSelection();
                        let r = document.createRange();
                        r.selectNode(victim);
                        s.removeAllRanges();
                        s.addRange(r);
                        if (coinflip()) s.deleteFromDocument();
                    }
                }

                // --- FASE 3: MORTE (Com atraso para Race Conditions) ---
                // Removemos nós antigos para dar espaço
                if (liveNodes.length > MAX_NODES * 0.8) {
                    for (let i = 0; i < 15; i++) {
                        let idx = Math.floor(rnd() * liveNodes.length);
                        let victim = liveNodes[idx];
                        
                        // Remove da lista JS
                        liveNodes.splice(idx, 1);

                        // Remove do DOM com atraso (setTimeout 0)
                        if (coinflip()) {
                            setTimeout(() => { try{ victim.remove(); }catch(e){} }, 0);
                        } else {
                            try{ victim.remove(); }catch(e){}
                        }
                    }
                }

                // --- FASE 4: GARBAGE COLLECTION FORÇADO ---
                // Trigger mais leve para não travar a UI, mas constante
                if (currentSeed % 50 === 0) {
                     let junk = [];
                     for(let k=0; k<5000; k++) junk.push({}); // Cria 5000 objetos vazios
                     junk = null; // Solta tudo
                }

            } catch (e) {
                // Erros de JS são esperados
            }

            // Ageda o próximo frame (permite que o navegador respire e renderize)
            requestAnimationFrame(loop);
        }

        // INÍCIO
        statusSpan.innerText = "RODANDO - NÃO DESLIGUE O PS4";
        loop();

    </script>
</body>
</html>
