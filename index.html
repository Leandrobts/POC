<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Suite v220000: Freeze Frame</title>
<style>
    body { background: #000; color: #fff; font-family: monospace; text-align: center; padding: 20px; }
    h1 { color: #f0f; text-shadow: 0 0 5px #f0f; }
    .instruction { border: 1px solid #555; padding: 10px; margin-bottom: 20px; color: #ff0; }
    
    button {
        display: block; width: 100%; padding: 20px; margin: 10px 0;
        background: #202; color: #f0f; border: 2px solid #f0f;
        font-size: 18px; font-weight: bold; cursor: pointer;
    }
    button:hover { background: #f0f; color: #000; }
    
    #stage { width: 100%; height: 50px; background: #333; margin-top: 20px; }
</style>
</head>
<body>

<h1>v220000: FREEZE FRAME</h1>

<div class="instruction">
    1. CLIQUE NO BOTÃO.<br>
    2. O NAVEGADOR VAI TENTAR TELA CHEIA.<br>
    3. UM ALERTA VAI APARECER IMEDIATAMENTE.<br>
    4. FECHE O ALERTA (APERTE X) PARA DETONAR.
</div>

<button onclick="freeze(t01)">01. Fullscreen -> Alert -> Body Remove</button>
<button onclick="freeze(t02)">02. Fullscreen -> Alert -> Canvas Detach</button>
<button onclick="freeze(t03)">03. Fullscreen -> Alert -> Iframe Nav</button>
<button onclick="freeze(t04)">04. Fullscreen -> Alert -> Video Source Kill</button>
<button onclick="freeze(t05)">05. Fullscreen -> Alert -> Infinite Loop</button>
<button onclick="freeze(t06)">06. Fullscreen -> Alert -> History Spam</button>
<button onclick="freeze(t07)">07. Fullscreen -> Alert -> SVG Mutation</button>
<button onclick="freeze(t08)">08. Fullscreen -> Alert -> CSS Transform</button>
<button onclick="freeze(t09)">09. Fullscreen -> Alert -> GC Pressure</button>
<button onclick="freeze(t10)">10. Fullscreen -> Prompt -> Recursion</button>

<div id="stage">ALVO</div>

<script>
    const Stage = document.getElementById('stage');

    function freeze(vector) {
        // 1. Prepara o alvo
        Stage.innerHTML = "";
        const target = vector(Stage);
        
        // 2. Solicita Fullscreen (Inicia a transição GPU)
        // Usamos webkitRequestFullscreen pois é o padrão PS4
        if (target.webkitRequestFullscreen) {
            target.webkitRequestFullscreen();
        } else if (target.requestFullscreen) {
            target.requestFullscreen();
        }

        // 3. A ARMADILHA (Race Condition)
        // Agendamos o alerta para disparar 10ms-50ms DEPOIS do início da transição.
        // Isso deve pegar o navegador "no meio do caminho".
        setTimeout(() => {
            // Executa a destruição ANTES do alerta (prepara o terreno)
            if(target._preKill) target._preKill();

            // CONGELA A THREAD
            window.alert("⚠️ THREAD BLOQUEADA ⚠️\n\nO navegador está no meio da transição.\nAo fechar este alerta, ele tentará renderizar o impossível.");

            // Executa a destruição PÓS alerta (O golpe final)
            if(target._postKill) target._postKill();
            
            // Se sobreviveu...
            Stage.innerHTML = "FALHA: NAVEGADOR SOBREVIVEU.";
        }, 50); 
    }

    // =================================================================
    // 01. Body Remove
    // =================================================================
    function t01(stage) {
        const d = document.createElement('div');
        d.innerHTML = "<h1>ALVO CORPO</h1>";
        d.style.background = "red";
        stage.appendChild(d);
        
        d._postKill = () => {
            document.body.innerHTML = ""; // Apaga tudo na volta do alerta
            // Tenta forçar repaint em body vazio
            document.body.style.display = "none";
            document.body.style.display = "block";
        };
        return d;
    }

    // =================================================================
    // 02. Canvas Detach
    // =================================================================
    function t02(stage) {
        const c = document.createElement('canvas');
        const ctx = c.getContext('2d');
        ctx.fillStyle = 'blue'; ctx.fillRect(0,0,300,150);
        stage.appendChild(c);
        
        const w = new Worker(URL.createObjectURL(new Blob(["onmessage=e=>{}"],{type:'text/javascript'})));
        const buffer = ctx.getImageData(0,0,300,150).data.buffer;

        d._preKill = () => {
            // Transfere o buffer ANTES do alerta aparecer
            w.postMessage(buffer, [buffer]);
        };
        
        d._postKill = () => {
            // Tenta desenhar DEPOIS do alerta
            ctx.fillRect(0,0,1,1); 
            c.remove();
        };
        return c;
    }

    // =================================================================
    // 03. Iframe Navigation
    // =================================================================
    function t03(stage) {
        const ifr = document.createElement('iframe');
        ifr.src = "about:blank";
        stage.appendChild(ifr);
        
        d._postKill = () => {
            // Navega o iframe para um esquema inválido na volta
            ifr.src = "unsafe:crash";
            setTimeout(() => ifr.remove(), 0);
        };
        return ifr;
    }

    // =================================================================
    // 04. Video Source Kill
    // =================================================================
    function t04(stage) {
        const v = document.createElement('video');
        v.controls = true;
        // Blob válido
        v.src = URL.createObjectURL(new Blob([""], {type:'video/mp4'}));
        stage.appendChild(v);
        
        d._postKill = () => {
            v.src = "";
            v.load();
            v.remove();
        };
        return v;
    }

    // =================================================================
    // 05. Infinite Loop (Stack Smash)
    // =================================================================
    function t05(stage) {
        const d = document.createElement('div');
        d.innerText = "STACK SMASH";
        stage.appendChild(d);
        
        d._postKill = () => {
            // Tenta travar a thread JS assim que o alerta fecha
            // O navegador tenta terminar a animação fullscreen mas a CPU está em 100%
            function f() { f(); }
            f();
        };
        return d;
    }

    // =================================================================
    // 06. History Spam
    // =================================================================
    function t06(stage) {
        const d = document.createElement('div');
        d.innerText = "HISTORY";
        stage.appendChild(d);
        
        d._postKill = () => {
            // Inunda o histórico
            for(let i=0; i<1000; i++) history.pushState({}, "x", "x"+i);
            history.go(-500);
        };
        return d;
    }

    // =================================================================
    // 07. SVG Mutation
    // =================================================================
    function t07(stage) {
        stage.innerHTML = '<svg id="svgtarget"><rect width="100" height="100" fill="green"/></svg>';
        const s = document.getElementById('svgtarget');
        
        d._postKill = () => {
            s.setAttribute("viewBox", "NaN NaN NaN NaN");
            s.innerHTML = "";
        };
        return s;
    }

    // =================================================================
    // 08. CSS Transform
    // =================================================================
    function t08(stage) {
        const d = document.createElement('div');
        d.style.width = "100px"; d.style.height = "100px"; d.style.background = "yellow";
        d.style.transition = "all 5s";
        stage.appendChild(d);
        
        d._preKill = () => {
            d.style.transform = "rotate(180deg) scale(2)";
        };
        
        d._postKill = () => {
            d.style.display = "none"; // Corta a renderização no meio da animação
            d.remove();
        };
        return d;
    }

    // =================================================================
    // 09. GC Pressure
    // =================================================================
    function t09(stage) {
        const d = document.createElement('div');
        d.innerText = "GC BOMB";
        stage.appendChild(d);
        
        d._postKill = () => {
            d.remove();
            // Heap Spray massivo
            const trash = [];
            for(let i=0; i<10000; i++) trash.push({a:1});
        };
        return d;
    }

    // =================================================================
    // 10. Prompt -> Recursion
    // =================================================================
    function t10(stage) {
        const d = document.createElement('div');
        d.innerText = "RECURSIVE MODAL";
        stage.appendChild(d);
        
        d._postKill = () => {
            // Abre outro modal imediatamente
            window.prompt("Crash?");
            window.confirm("Crash??");
        };
        return d;
    }

</script>
</body>
</html>
