<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Vulnerability Tests</title>
    
</head>
<body>
    <h1>PS4 WebKit Vulnerability Test Suite</h1>
    
    <div id="testButtons">
        <button onclick="addLog('Running Test 1...'); test1_TableRowUAF()">Test 1: Table Row UAF</button>
        <button onclick="addLog('Running Test 2...'); test2_RemoveChildBlur()">Test 2: RemoveChild Blur</button>
        <button onclick="addLog('Running Test 3...'); test3_AdoptNodeRace()">Test 3: AdoptNode Race</button>
        <button onclick="addLog('Running Test 4...'); test4_FullscreenTable()">Test 4: Fullscreen Table</button>
        <button onclick="addLog('Running Test 5...'); test5_SVGDetach()">Test 5: SVG Detach</button>        
        <button onclick="addLog('Running Test 6...'); test6_RangeDeleteContents()">Test 6: Range DeleteContents</button>
        <button onclick="addLog('Running Test 7...'); test7_WebSocketRace()">Test 7: WebSocket Race</button>
        <button onclick="addLog('Running Test 8...'); test8_CanvasUAF()">Test 8: Canvas UAF</button>
        <button onclick="addLog('Running Test 9...'); test9_VideoEmptied()">Test 9: Video Emptied</button>
        <button onclick="addLog('Running Test 10...'); test10_IframeDetach()">Test 10: Iframe Detach</button>    
        <button onclick="addLog('Running Test 11...'); test11_CSSOMRace()">Test 11: CSSSOM Race</button>
        <button onclick="addLog('Running Test 12...'); test12_InnerHTMLHash()">Test 12: innerHTML Hash</button>
        <button onclick="addLog('Running Test 13...'); test13_CloneNodeTouch()">Test 13: CloneNode Touch</button>
        <button onclick="addLog('Running Test 14...'); test14_WorkerTerminate()">Test 14: Worker Terminate</button>
        <button onclick="addLog('Running Test 15...'); test15_StorageDelete()">Test 15: Storage Delete</button>       
        <button onclick="addLog('Running Test 16...'); test16_FormReset()">Test 16: Form Reset</button>
        <button onclick="addLog('Running Test 17...'); test17_PopstateReplace()">Test 17: Popstate Replace</button>
        <button onclick="addLog('Running Test 18...'); test18_DragRemove()">Test 18: Drag Remove</button>
        <button onclick="addLog('Running Test 19...'); test19_AudioError()">Test 19: Audio Error</button>
        <button onclick="addLog('Running Test 20...'); test20_InsertAdjacent()">Test 20: InsertAdjacent</button>      
        <button onclick="addLog('Running Test 21...'); test21_FragmentPageHide()">Test 21: Fragment PageHide</button>
        <button onclick="addLog('Running Test 22...'); test22_TableHeadUAF()">Test 22: Table Head UAF</button>
        <button onclick="addLog('Running Test 23...'); test23_SVGMatrix()">Test 23: SVG Matrix</button>
        <button onclick="addLog('Running Test 24...'); test24_ImportNodeUnload()">Test 24: ImportNode Unload</button>
        <button onclick="addLog('Running Test 25...'); test25_CanvasDataURL()">Test 25: Canvas DataURL</button>   
        <button onclick="addLog('Running Test 26...'); test26_TextareaRange()">Test 26: Textarea Range</button>
        <button onclick="addLog('Running Test 27...'); test27_VideoTimeUpdate()">Test 27: Video TimeUpdate</button>
        <button onclick="addLog('Running Test 28...'); test28_WebGLLoseContext()">Test 28: WebGL LoseContext</button>
        <button onclick="addLog('Running Test 29...'); test29_MessageChannel()">Test 29: MessageChannel</button>
        <button onclick="addLog('Running Test 30...'); test30_OuterHTMLAnimation()">Test 30: OuterHTML Animation</button>    
        <button onclick="addLog('Running Test 31...'); test31_IndexedDBRecursive()">Test 31: IndexedDB Recursive</button>
        <button onclick="addLog('Running Test 32...'); test32_SVGSuspendRedraw()">Test 32: SVG SuspendRedraw</button>
        <button onclick="addLog('Running Test 33...'); test33_TextContentPointer()">Test 33: TextContent Pointer</button>
        <button onclick="addLog('Running Test 34...'); test34_CSSTextVolume()">Test 34: CSSText Volume</button>
        <button onclick="addLog('Running Test 35...'); test35_NestedIframes()">Test 35: Nested Iframes</button>
        <button onclick="addLog('Running Test 36...'); test36_TableFootStalled()">Test 36: Table Foot Stalled</button>
        <button onclick="addLog('Running Test 37...'); test37_IndexDeleteSuspend()">Test 37: Index Delete Suspend</button>
        <button onclick="addLog('Running Test 38...'); test38_CSSMediaCanPlay()">Test 38: CSS Media CanPlay</button>
        <button onclick="addLog('Running Test 39...'); test39_WebGLBufferCanPlay()">Test 39: WebGL Buffer CanPlay</button>
        <button onclick="addLog('Running Test 40...'); test40_WebGLTextureWaiting()">Test 40: WebGL Texture Waiting</button>        
        <button onclick="addLog('Running Test 41...'); test41_CloseBrowsingContext()">Test 41: Close Browsing Context</button>
        <button onclick="addLog('Running Test 42...'); test42_ReleaseLockMetadata()">Test 42: Release Lock Metadata</button>
        <button onclick="addLog('Running Test 43...'); test43_SVGForceRedraw()">Test 43: SVG Force Redraw</button>
        <button onclick="addLog('Running Test 44...'); test44_IsPointInPath()">Test 44: IsPointInPath</button>
        <button onclick="addLog('Running Test 45...'); test45_SVGPathSeg()">Test 45: SVG Path Seg</button>       
        <button onclick="addLog('Running Test 46...'); test46_GetSVGDocument()">Test 46: Get SVG Document</button>
        <button onclick="addLog('Running Test 47...'); test47_InsertBeforeAnimation()">Test 47: InsertBefore Animation</button>
        <button onclick="addLog('Running Test 48...'); test48_InsertAdjacentEnded()">Test 48: InsertAdjacent Ended</button>
        <button onclick="addLog('Running Test 49...'); test49_InsertAdjacentText()">Test 49: InsertAdjacentText</button>
        <button onclick="addLog('Running Test 50...'); test50_AddRuleTransition()">Test 50: AddRule Transition</button>     
        <button onclick="addLog('Running Test 51...'); test51_RemoveRuleMessage()">Test 51: RemoveRule Message</button>
        <button onclick="addLog('Running Test 52...'); test52_SetPropertyStorage()">Test 52: SetProperty Storage</button>
        <button onclick="addLog('Running Test 53...'); test53_RemovePropertyHash()">Test 53: RemoveProperty Hash</button>
        <button onclick="addLog('Running Test 54...'); test54_CreateImageDataError()">Test 54: CreateImageData Error</button>
        <button onclick="addLog('Running Test 55...'); test55_SVGTransformClose()">Test 55: SVG Transform Close</button>      
        <button onclick="addLog('Running Test 56...'); test56_SVGRectTouch()">Test 56: SVGRect Touch</button>
        <button onclick="addLog('Running Test 57...'); test57_PutImageDataDrag()">Test 57: PutImageData Drag</button>
        <button onclick="addLog('Running Test 58...'); test58_WorkerPageHide()">Test 58: Worker PageHide</button>
        <button onclick="addLog('Running Test 59...'); test59_WindowClosePageShow()">Test 59: Window Close PageShow</button>
        <button onclick="addLog('Running Test 60...'); test60_MultipleDeleteDB()">Test 60: Multiple DeleteDB</button>     
        <button onclick="addLog('Running Test 61...'); test61_CloneNodeScroll()">Test 61: CloneNode Scroll</button>
        <button onclick="addLog('Running Test 62...'); test62_AdoptNodeFullscreenError()">Test 62: AdoptNode FullscreenError</button>
        <button onclick="addLog('Running Test 63...'); test63_MatchMediaDeleteRule()">Test 63: MatchMedia DeleteRule</button>
        <button onclick="addLog('Running Test 64...'); test64_ImportInsertRace()">Test 64: Import Insert Race</button>
        <button onclick="addLog('Running Test 65...'); test65_SVGVideoTable()">Test 65: SVG Video Table</button>       
        <button onclick="addLog('Running Test 66...'); test66_FormCanvasIndexedDB()">Test 66: Form Canvas IndexedDB</button>
        <button onclick="addLog('Running Test 67...'); test67_TextareaRangeComplex()">Test 67: Textarea Range Complex</button>
    </div>
    

    <div id="log"></div>   
    <div id="testArea"></div>


    <script>
        const log = document.getElementById('log');
        const testArea = document.getElementById('testArea');
        // testButtons var kept to avoid errors if referenced, though unused now in script
        const testButtons = document.getElementById('testButtons');
        let crashes = 0;

        function addLog(msg, isError = false) {
            const p = document.createElement('p');
            p.textContent = `[${new Date().toISOString()}] ${msg}`;
            if (isError) p.textContent = 'ðŸ”´ ' + p.textContent;
            log.appendChild(p);
            console.log(msg);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            log.innerHTML = '';
            crashes = 0;
            addLog('Log cleared');
        }

        function clearTestArea() {
            testArea.innerHTML = '';
            addLog('Test area cleared');
        }

        // Test 1: UAF via deleteRow + Event Handler
        function test1_TableRowUAF() {
            // addLog('TEST 1: Table Row UAF via deleteRow + onfocus');
            try {
                const table = document.createElement('table');
                const tbody = table.createTBody();
                const row = tbody.insertRow();
                const cell = row.insertCell();
                
                row.onfocus = function() {
                    tbody.deleteRow(0);
                    cell.textContent = 'UAF trigger';
                };
                
                testArea.appendChild(table);
                row.focus();
                setTimeout(() => row.blur(), 10);
            } catch(e) {
                addLog('Test 1 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 2: Race condition - removeChild + onblur
        function test2_RemoveChildBlur() {
            // addLog('TEST 2: removeChild during onblur');
            try {
                const div = document.createElement('div');
                const input = document.createElement('input');
                
                input.onblur = function() {
                    div.removeChild(input);
                    input.focus();
                };
                
                div.appendChild(input);
                testArea.appendChild(div);
                input.focus();
                setTimeout(() => input.blur(), 10);
            } catch(e) {
                addLog('Test 2 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 3: adoptNode + replaceChild race
        function test3_AdoptNodeRace() {
            // addLog('TEST 3: adoptNode + replaceChild race condition');
            try {
                const iframe1 = document.createElement('iframe');
                const iframe2 = document.createElement('iframe');
                testArea.appendChild(iframe1);
                testArea.appendChild(iframe2);
                
                iframe1.onload = function() {
                    const doc1 = iframe1.contentDocument;
                    const doc2 = iframe2.contentDocument;
                    const div = doc1.createElement('div');
                    
                    div.onbeforeunload = function() {
                        doc2.adoptNode(div);
                        doc1.body.replaceChild(div, doc1.body.firstChild);
                    };
                    
                    doc1.body.appendChild(div);
                    iframe1.src = 'about:blank';
                };
                
                iframe1.src = 'about:blank';
            } catch(e) {
                addLog('Test 3 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 4: WebKit fullscreen + deleteCaption
        function test4_FullscreenTable() {
            // addLog('TEST 4: webkitRequestFullscreen + deleteCaption');
            try {
                const table = document.createElement('table');
                const caption = table.createCaption();
                caption.textContent = 'Test';
                
                table.onwebkitfullscreenchange = function() {
                    table.deleteCaption();
                    table.createCaption().textContent = 'New';
                };
                
                testArea.appendChild(table);
                if (table.webkitRequestFullscreen) {
                    table.webkitRequestFullscreen();
                    setTimeout(() => {
                        if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        }
                    }, 100);
                }
            } catch(e) {
                addLog('Test 4 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 5: SVG + detach + onanimationend
        function test5_SVGDetach() {
            // addLog('TEST 5: SVG element detach during animation');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                
                rect.onwebkitanimationend = function() {
                    svg.removeChild(rect);
                    rect.setAttribute('x', '100');
                };
                
                svg.appendChild(rect);
                testArea.appendChild(svg);
            } catch(e) {
                addLog('Test 5 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 6: Range deleteContents + Selection
        function test6_RangeDeleteContents() {
            // addLog('TEST 6: Range.deleteContents with Selection');
            try {
                const div = document.createElement('div');
                div.innerHTML = 'Test content for selection';
                testArea.appendChild(div);
                
                const range = document.createRange();
                range.selectNodeContents(div);
                
                div.onselect = function() {
                    range.deleteContents();
                    div.textContent = 'Modified';
                };
                
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            } catch(e) {
                addLog('Test 6 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 7: WebSocket close + onmessage
        function test7_WebSocketRace() {
            // addLog('TEST 7: WebSocket close during onmessage');
            try {
                const ws = new WebSocket('ws://localhost:9999');
                
                ws.onmessage = function(e) {
                    ws.close();
                    ws.send('after close');
                };
                
                ws.onerror = function() {
                    addLog('WebSocket error (expected)');
                };
            } catch(e) {
                addLog('Test 7 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 8: Canvas getImageData + removeChild
        function test8_CanvasUAF() {
            // addLog('TEST 8: Canvas getImageData after removal');
            try {
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 100;
                const ctx = canvas.getContext('2d');
                
                testArea.appendChild(canvas);
                
                setTimeout(() => {
                    testArea.removeChild(canvas);
                    const imageData = ctx.getImageData(0, 0, 100, 100);
                    ctx.putImageData(imageData, 0, 0);
                }, 10);
            } catch(e) {
                addLog('Test 8 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 9: Video element + onemptied + IndexedDB
        function test9_VideoEmptied() {
            // addLog('TEST 9: Video onemptied + IndexedDB');
            try {
                const video = document.createElement('video');
                
                video.onemptied = function() {
                    const request = indexedDB.open('testDB', 1);
                    request.onupgradeneeded = function(e) {
                        const db = e.target.result;
                        const store = db.createObjectStore('test', {keyPath: 'id'});
                        db.deleteObjectStore('test');
                    };
                };
                
                testArea.appendChild(video);
                video.src = 'data:video/mp4;base64,AAAAAA==';
                video.load();
            } catch(e) {
                addLog('Test 9 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 10: Multiple iframe detach + onpageshow
        function test10_IframeDetach() {
            // addLog('TEST 10: Multiple iframe detach during onpageshow');
            try {
                const iframes = [];
                for (let i = 0; i < 5; i++) {
                    const iframe = document.createElement('iframe');
                    iframe.onpageshow = function() {
                        iframes.forEach(f => {
                            if (f.parentNode) {
                                f.parentNode.removeChild(f);
                            }
                        });
                    };
                    testArea.appendChild(iframe);
                    iframes.push(iframe);
                }
                
                iframes[0].src = 'about:blank';
            } catch(e) {
                addLog('Test 10 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 11: CSSSOM deleteRule + matchMedia
        function test11_CSSOMRace() {
            // addLog('TEST 11: CSSSOM deleteRule + matchMedia');
            try {
                const style = document.createElement('style');
                document.head.appendChild(style);
                const sheet = style.sheet;
                
                sheet.insertRule('body { color: red; }', 0);
                sheet.insertRule('div { margin: 10px; }', 1);
                
                const mql = window.matchMedia('(min-width: 500px)');
                mql.addListener(function() {
                    sheet.deleteRule(0);
                    sheet.insertRule('body { color: blue; }', 0);
                });
                
                window.dispatchEvent(new Event('resize'));
            } catch(e) {
                addLog('Test 11 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 12: innerHTML + onhashchange
        function test12_InnerHTMLHash() {
            // addLog('TEST 12: innerHTML modification during onhashchange');
            try {
                const div = document.createElement('div');
                div.innerHTML = '<a href="#test">Link</a>';
                testArea.appendChild(div);
                
                window.onhashchange = function() {
                    div.innerHTML = '';
                    div.innerHTML = '<span>Changed</span>';
                };
                
                window.location.hash = 'test';
                setTimeout(() => window.location.hash = '', 100);
            } catch(e) {
                addLog('Test 12 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 13: cloneNode deep + ontouchstart
        function test13_CloneNodeTouch() {
            // addLog('TEST 13: Deep cloneNode during ontouchstart');
            try {
                const div = document.createElement('div');
                for (let i = 0; i < 100; i++) {
                    const child = document.createElement('span');
                    child.textContent = 'Child ' + i;
                    div.appendChild(child);
                }
                
                div.ontouchstart = function() {
                    const clone = div.cloneNode(true);
                    testArea.appendChild(clone);
                    div.parentNode.removeChild(div);
                };
                
                testArea.appendChild(div);
            } catch(e) {
                addLog('Test 13 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 14: Worker terminate + onmessage
        function test14_WorkerTerminate() {
            // addLog('TEST 14: Worker terminate during onmessage');
            try {
                const blob = new Blob(['self.postMessage("test");'], {type: 'application/javascript'});
                const worker = new Worker(URL.createObjectURL(blob));
                
                worker.onmessage = function(e) {
                    worker.terminate();
                    worker.postMessage('after terminate');
                };
            } catch(e) {
                addLog('Test 14 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 15: Storage event + deleteDatabase
        function test15_StorageDelete() {
            // addLog('TEST 15: Storage event + IndexedDB deleteDatabase');
            try {
                window.onstorage = function() {
                    const request = indexedDB.deleteDatabase('testDB2');
                    request.onsuccess = function() {
                        localStorage.setItem('test', 'value');
                    };
                };
                
                localStorage.setItem('trigger', 'test');
            } catch(e) {
                addLog('Test 15 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 16: Form reset + deleteRow
        function test16_FormReset() {
            // addLog('TEST 16: Form reset + table deleteRow');
            try {
                const form = document.createElement('form');
                const table = document.createElement('table');
                const tbody = table.createTBody();
                const row = tbody.insertRow();
                
                form.onreset = function() {
                    tbody.deleteRow(0);
                    tbody.insertRow();
                };
                
                form.appendChild(table);
                testArea.appendChild(form);
                form.reset();
            } catch(e) {
                addLog('Test 16 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 17: popstate + replaceChild
        function test17_PopstateReplace() {
            // addLog('TEST 17: popstate event + replaceChild');
            try {
                const div1 = document.createElement('div');
                const div2 = document.createElement('div');
                div1.textContent = 'Original';
                testArea.appendChild(div1);
                
                window.onpopstate = function() {
                    testArea.replaceChild(div2, div1);
                    div1.textContent = 'After replace';
                };
                
                history.pushState({}, '', '#state1');
                history.back();
            } catch(e) {
                addLog('Test 17 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 18: Drag events + removeChild
        function test18_DragRemove() {
            // addLog('TEST 18: ondragend + removeChild');
            try {
                const div = document.createElement('div');
                div.draggable = true;
                div.textContent = 'Drag me';
                
                div.ondragend = function() {
                    testArea.removeChild(div);
                    div.textContent = 'Dragged';
                };
                
                testArea.appendChild(div);
            } catch(e) {
                addLog('Test 18 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 19: Audio context + onerror
        function test19_AudioError() {
            // addLog('TEST 19: Audio element error + context manipulation');
            try {
                const audio = document.createElement('audio');
                
                audio.onerror = function() {
                    audio.src = 'data:audio/wav;base64,INVALID';
                    audio.load();
                };
                
                testArea.appendChild(audio);
                audio.src = 'invalid.mp3';
            } catch(e) {
                addLog('Test 19 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // Test 20: insertAdjacentHTML + onscroll
        function test20_InsertAdjacent() {
            // addLog('TEST 20: insertAdjacentHTML during onscroll');
            try {
                const div = document.createElement('div');
                div.innerHTML = 'Content';
                
                div.onscroll = function() {
                    div.insertAdjacentHTML('beforeend', '<p>Inserted</p>');
                    div.innerHTML = '';
                };
                
                testArea.appendChild(div);
                div.scrollTop = 10;
            } catch(e) {
                addLog('Test 20 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 21: createDocumentFragment + onpagehide
        function test21_FragmentPageHide() {
            // addLog('TEST 21: DocumentFragment + onpagehide');
            try {
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < 50; i++) {
                    const div = document.createElement('div');
                    div.textContent = 'Fragment ' + i;
                    fragment.appendChild(div);
                }
                
                window.onpagehide = function() {
                    testArea.appendChild(fragment);
                    fragment.appendChild(document.createElement('div'));
                };
                
                testArea.appendChild(fragment);
            } catch(e) {
                addLog('Test 21 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 22: deleteTHead + onfocus
        function test22_TableHeadUAF() {
            // addLog('TEST 22: deleteTHead during onfocus');
            try {
                const table = document.createElement('table');
                const thead = table.createTHead();
                const row = thead.insertRow();
                const cell = row.insertCell();
                cell.textContent = 'Header';
                
                table.onfocus = function() {
                    table.deleteTHead();
                    const newHead = table.createTHead();
                    newHead.insertRow().insertCell().textContent = 'New';
                };
                
                testArea.appendChild(table);
                table.setAttribute('tabindex', '0');
                table.focus();
            } catch(e) {
                addLog('Test 22 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 23: SVG createSVGMatrix + onwebkittransitionend
        function test23_SVGMatrix() {
            // addLog('TEST 23: SVG createSVGMatrix + transition');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                
                if (svg.createSVGMatrix) {
                    const matrix = svg.createSVGMatrix();
                    
                    rect.onwebkittransitionend = function() {
                        matrix.a = 2;
                        testArea.removeChild(svg);
                        matrix.b = 3;
                    };
                    
                    svg.appendChild(rect);
                    testArea.appendChild(svg);
                }
            } catch(e) {
                addLog('Test 23 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 24: importNode + onunload
        function test24_ImportNodeUnload() {
            // addLog('TEST 24: importNode during onunload');
            try {
                const iframe = document.createElement('iframe');
                testArea.appendChild(iframe);
                
                iframe.onload = function() {
                    const iframeDoc = iframe.contentDocument;
                    const div = iframeDoc.createElement('div');
                    div.innerHTML = '<span>Test</span>';
                    
                    window.onunload = function() {
                        const imported = document.importNode(div, true);
                        testArea.appendChild(imported);
                    };
                    
                    iframeDoc.body.appendChild(div);
                };
                
                iframe.src = 'about:blank';
            } catch(e) {
                addLog('Test 24 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 25: Canvas toDataURL + releaseEvents
        function test25_CanvasDataURL() {
            // addLog('TEST 25: Canvas toDataURL + event release');
            try {
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');
                
                ctx.fillRect(0, 0, 200, 200);
                
                canvas.onclick = function() {
                    const dataURL = canvas.toDataURL();
                    if (window.releaseEvents) {
                        window.releaseEvents();
                    }
                    canvas.toDataURL();
                };
                
                testArea.appendChild(canvas);
                canvas.click();
            } catch(e) {
                addLog('Test 25 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 26: textarea onselect + Range detach
        function test26_TextareaRange() {
            // addLog('TEST 26: Textarea selection + Range.detach');
            try {
                const textarea = document.createElement('textarea');
                textarea.value = 'Test content for range manipulation';
                
                textarea.onselect = function() {
                    const range = document.createRange();
                    range.selectNodeContents(textarea);
                    if (range.detach) {
                        range.detach();
                    }
                    textarea.setSelectionRange(0, 5);
                };
                
                testArea.appendChild(textarea);
                textarea.select();
            } catch(e) {
                addLog('Test 26 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 27: Video timeupdate + deleteCell
        function test27_VideoTimeUpdate() {
            // addLog('TEST 27: Video ontimeupdate + table deleteCell');
            try {
                const video = document.createElement('video');
                const table = document.createElement('table');
                const row = table.insertRow();
                const cell = row.insertCell();
                
                video.ontimeupdate = function() {
                    row.deleteCell(0);
                    row.insertCell().textContent = 'Updated';
                };
                
                testArea.appendChild(video);
                testArea.appendChild(table);
                video.currentTime = 1;
            } catch(e) {
                addLog('Test 27 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 28: WebGL loseContext + onresize
        function test28_WebGLLoseContext() {
            // addLog('TEST 28: WebGL loseContext during resize');
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (gl) {
                    const ext = gl.getExtension('WEBGL_lose_context');
                    
                    window.onresize = function() {
                        if (ext) {
                            ext.loseContext();
                            gl.clear(gl.COLOR_BUFFER_BIT);
                        }
                    };
                    
                    testArea.appendChild(canvas);
                    window.dispatchEvent(new Event('resize'));
                }
            } catch(e) {
                addLog('Test 28 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 29: MessageChannel + onclose
        function test29_MessageChannel() {
            // addLog('TEST 29: MessageChannel port close race');
            try {
                const channel = new MessageChannel();
                
                channel.port1.onmessage = function(e) {
                    channel.port1.close();
                    channel.port2.postMessage('after close');
                };
                
                channel.port2.onclose = function() {
                    channel.port1.postMessage('test');
                };
                
                channel.port1.start();
                channel.port2.start();
                channel.port2.postMessage('trigger');
            } catch(e) {
                addLog('Test 29 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 30: outerHTML + onanimationiteration
        function test30_OuterHTMLAnimation() {
            // addLog('TEST 30: outerHTML during animation iteration');
            try {
                const div = document.createElement('div');
                div.innerHTML = '<p>Original</p>';
                
                div.onanimationiteration = function() {
                    div.outerHTML = '<span>Replaced</span>';
                };
                
                testArea.appendChild(div);
            } catch(e) {
                addLog('Test 30 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 31: createObjectStore recursive + onseeking
        function test31_IndexedDBRecursive() {
            // addLog('TEST 31: IndexedDB recursive operations');
            try {
                const video = document.createElement('video');
                
                video.onseeking = function() {
                    const request = indexedDB.open('recursiveDB', 1);
                    request.onupgradeneeded = function(e) {
                        const db = e.target.result;
                        for (let i = 0; i < 10; i++) {
                            const store = db.createObjectStore('store' + i, {keyPath: 'id'});
                            db.deleteObjectStore('store' + i);
                        }
                    };
                };
                
                testArea.appendChild(video);
                video.currentTime = 0.5;
            } catch(e) {
                addLog('Test 31 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 32: SVG suspendRedraw + ondurationchange
        function test32_SVGSuspendRedraw() {
            // addLog('TEST 32: SVG suspendRedraw manipulation');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const video = document.createElement('video');
                
                video.ondurationchange = function() {
                    if (svg.suspendRedraw) {
                        const id = svg.suspendRedraw(1000);
                        testArea.removeChild(svg);
                        if (svg.unsuspendRedraw) {
                            svg.unsuspendRedraw(id);
                        }
                    }
                };
                
                testArea.appendChild(svg);
                testArea.appendChild(video);
            } catch(e) {
                addLog('Test 32 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 33: textContent setter + onpointerup
        function test33_TextContentPointer() {
            // addLog('TEST 33: textContent setter during pointer events');
            try {
                const div = document.createElement('div');
                div.innerHTML = '<span>Original</span><b>Text</b>';
                
                div.onpointerup = function() {
                    div.textContent = 'New content';
                    div.innerHTML = '<p>Changed</p>';
                };
                
                div.onpointerdown = function() {
                    div.textContent = '';
                };
                
                testArea.appendChild(div);
                div.dispatchEvent(new PointerEvent('pointerdown'));
                div.dispatchEvent(new PointerEvent('pointerup'));
            } catch(e) {
                addLog('Test 33 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 34: CSSSOM cssText + onvolumechange
        function test34_CSSTextVolume() {
            // addLog('TEST 34: CSSSOM cssText manipulation');
            try {
                const audio = document.createElement('audio');
                const style = document.createElement('style');
                document.head.appendChild(style);
                
                audio.onvolumechange = function() {
                    if (style.sheet) {
                        style.sheet.insertRule('body { background: red; }', 0);
                        style.sheet.cssRules[0].style.cssText = 'background: blue;';
                        style.sheet.deleteRule(0);
                    }
                };
                
                testArea.appendChild(audio);
                audio.volume = 0.5;
            } catch(e) {
                addLog('Test 34 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 35: Multiple nested iframes + onbeforeunload
        function test35_NestedIframes() {
            // addLog('TEST 35: Nested iframes onbeforeunload chain');
            try {
                const iframe1 = document.createElement('iframe');
                testArea.appendChild(iframe1);
                
                iframe1.onload = function() {
                    const doc1 = iframe1.contentDocument;
                    const iframe2 = doc1.createElement('iframe');
                    
                    iframe2.onload = function() {
                        const doc2 = iframe2.contentDocument;
                        
                        doc2.body.onbeforeunload = function() {
                            doc1.body.removeChild(iframe2);
                            doc1.body.appendChild(iframe2);
                        };
                        
                        iframe2.src = 'about:blank';
                    };
                    
                    doc1.body.appendChild(iframe2);
                    iframe2.src = 'about:blank';
                };
                
                iframe1.src = 'about:blank';
            } catch(e) {
                addLog('Test 35 Exception: ' + e.message, true);
                crashes++;
            }
        }
 // NEW TEST 36: deleteTFoot + onstalled (media)
        function test36_TableFootStalled() {
            addLog('TEST 36: deleteTFoot during video stall');
            try {
                const table = document.createElement('table');
                const tfoot = table.createTFoot();
                const row = tfoot.insertRow();
                row.insertCell().textContent = 'Footer';
                
                const video = document.createElement('video');
                video.onstalled = function() {
                    table.deleteTFoot();
                    const newFoot = table.createTFoot();
                    newFoot.insertRow().insertCell().textContent = 'New Footer';
                };
                
                testArea.appendChild(table);
                testArea.appendChild(video);
                video.load();
            } catch(e) {
                addLog('Test 36 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 37: deleteIndex (IndexedDB) + onsuspend
        function test37_IndexDeleteSuspend() {
            addLog('TEST 37: IndexedDB deleteIndex + media suspend');
            try {
                const audio = document.createElement('audio');
                
                audio.onsuspend = function() {
                    const request = indexedDB.open('indexTestDB', 1);
                    request.onupgradeneeded = function(e) {
                        const db = e.target.result;
                        const store = db.createObjectStore('testStore', {keyPath: 'id'});
                        const index = store.createIndex('nameIndex', 'name');
                        store.deleteIndex('nameIndex');
                    };
                };
                
                testArea.appendChild(audio);
                audio.load();
            } catch(e) {
                addLog('Test 37 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 38: deleteMedium + oncanplay
        function test38_CSSMediaCanPlay() {
            addLog('TEST 38: CSS deleteMedium + video canplay');
            try {
                const style = document.createElement('style');
                style.textContent = '@media screen { body { color: red; } }';
                document.head.appendChild(style);
                
                const video = document.createElement('video');
                video.oncanplay = function() {
                    if (style.sheet && style.sheet.media && style.sheet.media.deleteMedium) {
                        style.sheet.media.deleteMedium('screen');
                    }
                };
                
                testArea.appendChild(video);
            } catch(e) {
                addLog('Test 38 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 39: WebGL deleteBuffer + oncanplaythrough
        function test39_WebGLBufferCanPlay() {
            addLog('TEST 39: WebGL deleteBuffer during canplaythrough');
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (gl) {
                    const buffer = gl.createBuffer();
                    const video = document.createElement('video');
                    
                    video.oncanplaythrough = function() {
                        gl.deleteBuffer(buffer);
                        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                    };
                    
                    testArea.appendChild(canvas);
                    testArea.appendChild(video);
                }
            } catch(e) {
                addLog('Test 39 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 40: WebGL deleteTexture + onwaiting
        function test40_WebGLTextureWaiting() {
            addLog('TEST 40: WebGL deleteTexture + video waiting');
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (gl) {
                    const texture = gl.createTexture();
                    const video = document.createElement('video');
                    
                    video.onwaiting = function() {
                        gl.deleteTexture(texture);
                        gl.bindTexture(gl.TEXTURE_2D, texture);
                    };
                    
                    testArea.appendChild(canvas);
                    testArea.appendChild(video);
                    video.load();
                }
            } catch(e) {
                addLog('Test 40 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 41: closeBrowsingContext + onloadeddata
        function test41_CloseBrowsingContext() {
            addLog('TEST 41: Close browsing context simulation');
            try {
                const iframe = document.createElement('iframe');
                const video = document.createElement('video');
                
                video.onloadeddata = function() {
                    if (iframe.contentWindow) {
                        testArea.removeChild(iframe);
                        iframe.src = 'about:blank';
                    }
                };
                
                testArea.appendChild(iframe);
                testArea.appendChild(video);
                iframe.src = 'about:blank';
            } catch(e) {
                addLog('Test 41 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 42: releaseLock + onloadedmetadata
        function test42_ReleaseLockMetadata() {
            addLog('TEST 42: Navigator locks + video metadata');
            try {
                const video = document.createElement('video');
                
                video.onloadedmetadata = function() {
                    if (navigator.locks && navigator.locks.request) {
                        navigator.locks.request('test-lock', lock => {
                            return new Promise((resolve) => {
                                setTimeout(resolve, 10);
                            });
                        });
                    }
                };
                
                testArea.appendChild(video);
            } catch(e) {
                addLog('Test 42 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 43: SVG forceRedraw + onratechange
        function test43_SVGForceRedraw() {
            addLog('TEST 43: SVG forceRedraw + video rate change');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const video = document.createElement('video');
                
                video.onratechange = function() {
                    if (svg.forceRedraw) {
                        svg.forceRedraw();
                        testArea.removeChild(svg);
                        svg.forceRedraw();
                    }
                };
                
                testArea.appendChild(svg);
                testArea.appendChild(video);
                video.playbackRate = 2.0;
            } catch(e) {
                addLog('Test 43 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 44: Canvas isPointInPath + onseeked
        function test44_IsPointInPath() {
            addLog('TEST 44: Canvas isPointInPath + video seeked');
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const video = document.createElement('video');
                
                ctx.rect(10, 10, 100, 100);
                
                video.onseeked = function() {
                    const result = ctx.isPointInPath(50, 50);
                    testArea.removeChild(canvas);
                    ctx.isPointInStroke(50, 50);
                };
                
                testArea.appendChild(canvas);
                testArea.appendChild(video);
            } catch(e) {
                addLog('Test 44 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 45: SVG createSVGPathSegClosePath + onsearch
        function test45_SVGPathSeg() {
            addLog('TEST 45: SVG Path Segment + search input');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const input = document.createElement('input');
                input.type = 'search';
                
                input.onsearch = function() {
                    if (path.createSVGPathSegClosePath) {
                        const seg = path.createSVGPathSegClosePath();
                        testArea.removeChild(svg);
                    }
                };
                
                svg.appendChild(path);
                testArea.appendChild(svg);
                testArea.appendChild(input);
                input.value = 'test';
                input.dispatchEvent(new Event('search'));
            } catch(e) {
                addLog('Test 45 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 46: SVG getSVGDocument + onsubmit
        function test46_GetSVGDocument() {
            addLog('TEST 46: getSVGDocument + form submit');
            try {
                const object = document.createElement('object');
                object.type = 'image/svg+xml';
                object.data = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"/>';
                
                const form = document.createElement('form');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    if (object.getSVGDocument) {
                        const doc = object.getSVGDocument();
                        testArea.removeChild(object);
                    }
                };
                
                testArea.appendChild(object);
                testArea.appendChild(form);
                form.submit();
            } catch(e) {
                addLog('Test 46 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 47: insertBefore deep + onanimationstart
        function test47_InsertBeforeAnimation() {
            addLog('TEST 47: insertBefore + animation start');
            try {
                const container = document.createElement('div');
                const div1 = document.createElement('div');
                const div2 = document.createElement('div');
                
                div1.onanimationstart = function() {
                    container.insertBefore(div2, div1);
                    container.removeChild(div1);
                };
                
                container.appendChild(div1);
                testArea.appendChild(container);
            } catch(e) {
                addLog('Test 47 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 48: insertAdjacentElement + onended
        function test48_InsertAdjacentEnded() {
            addLog('TEST 48: insertAdjacentElement + video ended');
            try {
                const div = document.createElement('div');
                const video = document.createElement('video');
                const newElement = document.createElement('span');
                
                video.onended = function() {
                    div.insertAdjacentElement('beforeend', newElement);
                    div.removeChild(newElement);
                    div.insertAdjacentElement('afterbegin', newElement);
                };
                
                testArea.appendChild(div);
                testArea.appendChild(video);
            } catch(e) {
                addLog('Test 48 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 49: insertAdjacentText + onanimationend
        function test49_InsertAdjacentText() {
            addLog('TEST 49: insertAdjacentText + animation end');
            try {
                const div = document.createElement('div');
                
                div.onanimationend = function() {
                    div.insertAdjacentText('beforeend', 'Text1');
                    div.innerHTML = '';
                    div.insertAdjacentText('afterbegin', 'Text2');
                };
                
                testArea.appendChild(div);
            } catch(e) {
                addLog('Test 49 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 50: CSSSOM addRule + ontransitionend
        function test50_AddRuleTransition() {
            addLog('TEST 50: CSSSOM addRule + transition end');
            try {
                const style = document.createElement('style');
                document.head.appendChild(style);
                const div = document.createElement('div');
                
                div.ontransitionend = function() {
                    if (style.sheet && style.sheet.addRule) {
                        style.sheet.addRule('body', 'color: blue');
                        style.sheet.removeRule(0);
                    }
                };
                
                testArea.appendChild(div);
            } catch(e) {
                addLog('Test 50 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 51: CSSSOM removeRule + onmessage
        function test51_RemoveRuleMessage() {
            addLog('TEST 51: CSSSOM removeRule + postMessage');
            try {
                const style = document.createElement('style');
                document.head.appendChild(style);
                
                window.onmessage = function(e) {
                    if (style.sheet && style.sheet.insertRule) {
                        style.sheet.insertRule('body { margin: 0; }', 0);
                        if (style.sheet.removeRule) {
                            style.sheet.removeRule(0);
                        }
                    }
                };
                
                window.postMessage('test', '*');
            } catch(e) {
                addLog('Test 51 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 52: CSSSOM setProperty + onstorage
        function test52_SetPropertyStorage() {
            addLog('TEST 52: CSSSOM setProperty + storage event');
            try {
                const div = document.createElement('div');
                
                window.onstorage = function() {
                    div.style.setProperty('color', 'red');
                    div.style.removeProperty('color');
                    div.style.setProperty('background', 'blue');
                };
                
                testArea.appendChild(div);
                localStorage.setItem('test-key', 'value');
            } catch(e) {
                addLog('Test 52 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 53: CSSSOM removeProperty + onhashchange
        function test53_RemovePropertyHash() {
            addLog('TEST 53: CSSSOM removeProperty + hashchange');
            try {
                const div = document.createElement('div');
                div.style.color = 'red';
                div.style.background = 'blue';
                
                window.onhashchange = function() {
                    div.style.removeProperty('color');
                    div.style.cssText = '';
                    div.style.setProperty('border', '1px solid black');
                };
                
                testArea.appendChild(div);
                window.location.hash = 'test-hash';
            } catch(e) {
                addLog('Test 53 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 54: createImageData + onerror (global)
        function test54_CreateImageDataError() {
            addLog('TEST 54: createImageData + window error');
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                window.onerror = function() {
                    const imageData = ctx.createImageData(100, 100);
                    testArea.removeChild(canvas);
                    ctx.putImageData(imageData, 0, 0);
                    return true;
                };
                
                testArea.appendChild(canvas);
                throw new Error('Trigger error');
            } catch(e) {
                addLog('Test 54 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 55: SVG createSVGTransform + onclose (WebSocket)
        function test55_SVGTransformClose() {
            addLog('TEST 55: SVG createSVGTransform + WebSocket close');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                
                try {
                    const ws = new WebSocket('ws://localhost:8888');
                    ws.onclose = function() {
                        if (svg.createSVGTransform) {
                            const transform = svg.createSVGTransform();
                            testArea.removeChild(svg);
                        }
                    };
                    ws.onerror = function() {};
                } catch(wsError) {
                    addLog('WebSocket creation failed (expected)');
                }
                
                testArea.appendChild(svg);
            } catch(e) {
                addLog('Test 55 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 56: SVG createSVGRect + ontouchend
        function test56_SVGRectTouch() {
            addLog('TEST 56: SVG createSVGRect + touch end');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                
                rect.ontouchend = function() {
                    if (svg.createSVGRect) {
                        const svgRect = svg.createSVGRect();
                        svgRect.x = 10;
                        testArea.removeChild(svg);
                        svgRect.y = 20;
                    }
                };
                
                svg.appendChild(rect);
                testArea.appendChild(svg);
            } catch(e) {
                addLog('Test 56 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 57: Canvas putImageData + ondrag
        function test57_PutImageDataDrag() {
            addLog('TEST 57: putImageData during drag');
            try {
                const canvas = document.createElement('canvas');
                canvas.width = 150;
                canvas.height = 150;
                const ctx = canvas.getContext('2d');
                const imageData = ctx.createImageData(100, 100);
                
                canvas.draggable = true;
                canvas.ondrag = function() {
                    ctx.putImageData(imageData, 0, 0);
                    testArea.removeChild(canvas);
                    ctx.getImageData(0, 0, 100, 100);
                };
                
                testArea.appendChild(canvas);
            } catch(e) {
                addLog('Test 57 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 58: terminate (Worker) + onpagehide
        function test58_WorkerPageHide() {
            addLog('TEST 58: Worker terminate + pagehide');
            try {
                const blob = new Blob(['setInterval(() => self.postMessage("tick"), 100);'], {type: 'application/javascript'});
                const worker = new Worker(URL.createObjectURL(blob));
                
                window.onpagehide = function() {
                    worker.terminate();
                    worker.postMessage('after terminate');
                };
                
                worker.onmessage = function(e) {
                    addLog('Worker message: ' + e.data);
                };
            } catch(e) {
                addLog('Test 58 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 59: close (Window) + onpageshow
        function test59_WindowClosePageShow() {
            addLog('TEST 59: Window close attempt + pageshow');
            try {
                const newWin = window.open('', '_blank', 'width=100,height=100');
                
                if (newWin) {
                    window.onpageshow = function() {
                        newWin.close();
                        newWin.document.write('After close');
                    };
                    
                    setTimeout(() => {
                        if (newWin && !newWin.closed) {
                            newWin.close();
                        }
                    }, 100);
                }
            } catch(e) {
                addLog('Test 59 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 60: Multiple deleteDatabase + onresize
        function test60_MultipleDeleteDB() {
            addLog('TEST 60: Multiple deleteDatabase + resize');
            try {
                window.onresize = function() {
                    for (let i = 0; i < 5; i++) {
                        const request = indexedDB.deleteDatabase('testDB' + i);
                        request.onsuccess = function() {
                            indexedDB.open('testDB' + i, 1);
                        };
                    }
                };
                
                window.dispatchEvent(new Event('resize'));
            } catch(e) {
                addLog('Test 60 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 61: cloneNode + onscroll nested
        function test61_CloneNodeScroll() {
            addLog('TEST 61: cloneNode deep + nested scroll');
            try {
                const container = document.createElement('div');
                const inner = document.createElement('div');
                
                for (let i = 0; i < 50; i++) {
                    const child = document.createElement('p');
                    child.textContent = 'Paragraph ' + i;
                    inner.appendChild(child);
                }
                
                container.onscroll = function() {
                    const clone = inner.cloneNode(true);
                    container.replaceChild(clone, inner);
                };
                
                container.appendChild(inner);
                testArea.appendChild(container);
                container.scrollTop = 10;
            } catch(e) {
                addLog('Test 61 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 62: adoptNode loop + onwebkitfullscreenerror
        function test62_AdoptNodeFullscreenError() {
            addLog('TEST 62: adoptNode loop + fullscreen error');
            try {
                const iframe1 = document.createElement('iframe');
                const iframe2 = document.createElement('iframe');
                testArea.appendChild(iframe1);
                testArea.appendChild(iframe2);
                
                document.onwebkitfullscreenerror = function() {
                    if (iframe1.contentDocument && iframe2.contentDocument) {
                        const div = iframe1.contentDocument.createElement('div');
                        iframe1.contentDocument.body.appendChild(div);
                        iframe2.contentDocument.adoptNode(div);
                        iframe1.contentDocument.adoptNode(div);
                    }
                };
                
                iframe1.src = 'about:blank';
                iframe2.src = 'about:blank';
            } catch(e) {
                addLog('Test 62 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 63: matchMedia + deleteRule chain
        function test63_MatchMediaDeleteRule() {
            addLog('TEST 63: matchMedia listeners + deleteRule chain');
            try {
                const style = document.createElement('style');
                document.head.appendChild(style);
                const sheet = style.sheet;
                
                for (let i = 0; i < 10; i++) {
                    sheet.insertRule(`body { padding-${i}px: ${i}px; }`, i);
                }
                
                const mql = window.matchMedia('(orientation: portrait)');
                mql.addListener(function() {
                    for (let i = sheet.cssRules.length - 1; i >= 0; i--) {
                        sheet.deleteRule(i);
                    }
                });
                
                window.dispatchEvent(new Event('resize'));
            } catch(e) {
                addLog('Test 63 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 64: importNode + insertBefore race
        function test64_ImportInsertRace() {
            addLog('TEST 64: importNode + insertBefore race');
            try {
                const iframe = document.createElement('iframe');
                testArea.appendChild(iframe);
                
                iframe.onload = function() {
                    const iframeDoc = iframe.contentDocument;
                    const div = iframeDoc.createElement('div');
                    div.innerHTML = '<span>Test</span><b>Bold</b>';
                    
                    const imported = document.importNode(div, true);
                    const container = document.createElement('div');
                    testArea.appendChild(container);
                    
                    container.insertBefore(imported, null);
                    container.removeChild(imported);
                    container.insertBefore(imported, null);
                };
                
                iframe.src = 'about:blank';
            } catch(e) {
                addLog('Test 64 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 65: SVG + video + table combo
        function test65_SVGVideoTable() {
            addLog('TEST 65: SVG + Video + Table combination');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const video = document.createElement('video');
                const table = document.createElement('table');
                const tbody = table.createTBody();
                const row = tbody.insertRow();
                
                video.onloadedmetadata = function() {
                    tbody.deleteRow(0);
                    testArea.removeChild(svg);
                    const newRow = tbody.insertRow();
                };
                
                testArea.appendChild(svg);
                testArea.appendChild(video);
                testArea.appendChild(table);
            } catch(e) {
                addLog('Test 65 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 66: Form + Canvas + IndexedDB combo
        function test66_FormCanvasIndexedDB() {
            addLog('TEST 66: Form + Canvas + IndexedDB combo');
            try {
                const form = document.createElement('form');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                form.onreset = function() {
                    const imageData = ctx.createImageData(50, 50);
                    const request = indexedDB.open('comboTest', 1);
                    request.onupgradeneeded = function(e) {
                        const db = e.target.result;
                        db.createObjectStore('store');
                    };
                    ctx.putImageData(imageData, 0, 0);
                };
                
                form.appendChild(canvas);
                testArea.appendChild(form);
                form.reset();
            } catch(e) {
                addLog('Test 66 Exception: ' + e.message, true);
                crashes++;
            }
        }

        // NEW TEST 67: Textarea + Range + Selection complex
        function test67_TextareaRangeComplex() {
            addLog('TEST 67: Textarea + Range + Selection complex');
            try {
                const textarea = document.createElement('textarea');
                textarea.value = 'Line 1\nLine 2\nLine 3\nLine 4';
                
                textarea.onselect = function() {
                    const range = document.createRange();
                    const selection = window.getSelection();
                    
                    selection.removeAllRanges();
                    range.selectNodeContents(textarea);
                    selection.addRange(range);
                    range.deleteContents();
                    
                    if (range.detach) {
                        range.detach();
                    }
                };
                
                testArea.appendChild(textarea);
                textarea.select();
            } catch(e) {
                addLog('Test 67 Exception: ' + e.message, true);
                crashes++;
            }
        }

    </script>
</body>
</html>
