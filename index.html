<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 High-Load Thread Saturator</title>
    
</head>
<body>

    <h1>HIGH-LOAD THREAD SATURATOR</h1>

    <div class="panel">
        <div class="group">
            <label>Alvo de Workers (Zona de Perigo):</label>
            <input type="number" id="target" value="450">
            <div class="warning">Você disse que o gatilho é 400+. Mire um pouco acima.</div>
        </div>
        <div class="group">
            <label>Spawns por Tick (Aceleração):</label>
            <input type="number" id="rate" value="5">
            <div class="warning">Quantos nascem por ciclo.</div>
        </div>
        <div class="group">
            <label>Delay (ms):</label>
            <input type="number" id="speed" value="10">
            <div class="warning">Se travar muito antes de 400, aumente isso para 20 ou 30.</div>
        </div>
        
        <button id="btn-start" onclick="toggle()">INICIAR SATURAÇÃO</button>
    </div>

    <div id="stats">Sistema Pronto.</div>

    <script>
        let running = false;
        let timer = null;
        let workers = [];
        
        // Worker Mínimo: Apenas existe para ocupar espaço na tabela do Kernel
        const blob = new Blob(["setInterval(()=>{}, 1000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);

        function toggle() {
            if(running) {
                clearInterval(timer);
                cleanup();
                running = false;
                document.getElementById('btn-start').innerText = "INICIAR SATURAÇÃO";
                document.getElementById('stats').innerText = "Parado (Limpando...)";
            } else {
                running = true;
                document.getElementById('btn-start').innerText = "PARAR";
                
                const target = parseInt(document.getElementById('target').value); // 450
                const rate = parseInt(document.getElementById('rate').value);     // 5
                const speed = parseInt(document.getElementById('speed').value);   // 10
                
                runHighLoad(target, rate, speed);
            }
        }

        function runHighLoad(targetZone, spawnRate, interval) {
            timer = setInterval(() => {
                try {
                    // 1. Fase de Enchimento (Fill)
                    // Tenta chegar na zona de 400+ o mais rápido possível
                    if (workers.length < targetZone) {
                        for(let i=0; i < spawnRate; i++) {
                            workers.push(new Worker(url));
                        }
                    } 
                    // 2. Fase de Oscilação (Hover)
                    // Se passamos do alvo (ex: 455), matamos APENAS o excesso para voltar a 450
                    // Isso mantém o Kernel estressado no limite máximo sem esvaziar a tabela.
                    else {
                        // Mata apenas o excesso + 1 para forçar um novo spawn no próximo ciclo
                        const excess = workers.length - targetZone + 1;
                        for(let k=0; k < excess; k++) {
                            const w = workers.shift();
                            w.terminate();
                        }
                    }

                    document.getElementById('stats').innerText = 
                        `Workers: ${workers.length} / ${targetZone} (Pressão Constante)`;

                } catch(e) {
                    // Se falhar ao criar (OOM ou Limite de Threads), é um ótimo sinal.
                    // Significa que estamos no teto. Continuamos tentando forçar.
                    document.getElementById('stats').innerText = 
                        `Workers: ${workers.length} (FALHA DE ALOCAÇÃO - CRASH IMINENTE?)`;
                }
            }, interval);
        }

        function cleanup() {
            workers.forEach(w => w.terminate());
            workers = [];
        }
    </script>
</body>
</html>
