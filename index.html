<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit Float64Array Backing Store Diagnostics</title>
<style>
body { font-family: monospace; }
</style>
</head>
<body>

<h2>Float64Array Backing Store Diagnostic</h2>
<button onclick="start()">START TEST</button>
<pre id="log"></pre>

<script>
let f64 = null;
let buf = null;
let phase = 0;

function log(msg) {
    document.getElementById('log').textContent += msg + "\n";
}

function dumpState(tag) {
    try {
        log("[" + tag + "]");
        log("  typeof f64: " + typeof f64);
        log("  class: " + Object.prototype.toString.call(f64));
        log("  length: " + f64.length);
        log("  byteLength: " + f64.byteLength);
        log("  buffer.byteLength: " + f64.buffer.byteLength);
        log("  is buffer frozen: " + Object.isFrozen(f64.buffer));
        log("  f64[0]: " + f64[0]);
    } catch (e) {
        log("  EXCEPTION: " + e);
    }
}

function start() {
    log("[INIT] creating Float64Array");

    buf = new ArrayBuffer(0x40);
    f64 = new Float64Array(buf);
    f64[0] = 13.37;

    dumpState("BEFORE FULLSCREEN");

    document.documentElement.webkitRequestFullscreen();

    window.onblur = () => {
        log("[EVENT] onblur triggered");

        dumpState("AFTER BLUR (NO TEARDOWN)");

        log("[INFO] Test finished. No document.write executed.");
    };
}
</script>

</body>
</html>
