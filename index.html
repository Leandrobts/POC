<!DOCTYPE html>
<html>
<head>
    <title>PS4 Fuzzer (SNIPER)</title>
    <style>
        body { background-color: #000; color: #ff00ff; font-family: monospace; padding: 20px; font-size: 24px; }
        .box { border: 2px solid #550055; padding: 20px; margin-bottom: 20px; }
        button { font-size: 24px; padding: 15px; cursor: pointer; background: #111; color: #fff; width: 100%; border: 1px solid #ff00ff; }
        .danger { color: #ff3333; font-weight: bold; font-size: 32px; }
        .highlight { color: #fff; background-color: #330033; padding: 2px 5px; }
    </style>
</head>
<body>

    <h3>PS4 Fuzzer - Fase Final (Byte a Byte)</h3>
    <p>Buscando o "Cliff Edge" entre 709.300 e 709.520...</p>

    <div class="box">
        <div>Testando Offset: <span id="current-display" class="highlight">---</span></div>
        <div id="log">Pronto.</div>
    </div>

    <div class="box" style="border-color: red;">
        <strong>O NÚMERO MÁGICO (CRASH):</strong><br>
        <span id="last-attempt" class="danger">Nenhum</span>
    </div>

    <button onclick="startFuzz()">INICIAR BUSCA FINAL</button>
    <button onclick="resetData()">RESETAR</button>

    <script>
        // --- CONFIGURAÇÃO FINAL ---
        
        // Começamos um pouco antes do ponto onde você sabe que estava seguro
        const START_SIZE = 709300; 
        
        // Agora vamos de 1 em 1. Isso vai achar o byte exato que transborda.
        const STEP_SIZE = 1; 
        
        const DELAY_MS = 500; // Mais rápido, pois a faixa é curta
        const ORIGINAL_URL = window.location.href.split('?')[0].split('#')[0];

        // Elementos
        const logEl = document.getElementById('log');
        const currDisplay = document.getElementById('current-display');
        const lastEl = document.getElementById('last-attempt');

        // Dados
        let currentSize = parseInt(localStorage.getItem('fuzz_sniper_size')) || START_SIZE;
        let lastCrash = localStorage.getItem('fuzz_sniper_crash');
        let isRunning = localStorage.getItem('fuzz_sniper_active') === 'true';

        if (lastCrash) {
            lastEl.innerText = lastCrash;
            lastEl.innerHTML += "<br><span style='color:white; font-size:18px'>Este é o tamanho exato do seu buffer overflow.</span>";
        }

        currDisplay.innerText = currentSize;

        if (isRunning) {
            runTest();
        }

        function startFuzz() {
            localStorage.setItem('fuzz_sniper_active', 'true');
            // Zera o contador se ele estiver fora da faixa de teste para evitar erros
            if(currentSize < START_SIZE) {
                 localStorage.setItem('fuzz_sniper_size', START_SIZE);
            }
            window.location.href = ORIGINAL_URL;
        }

        function resetData() {
            localStorage.removeItem('fuzz_sniper_size');
            localStorage.removeItem('fuzz_sniper_crash');
            localStorage.removeItem('fuzz_sniper_active');
            location.reload();
        }

        function runTest() {
            localStorage.setItem('fuzz_sniper_crash', currentSize);
            localStorage.setItem('fuzz_sniper_size', currentSize + STEP_SIZE);

            logEl.innerText = "Testando: " + currentSize + "...";

            window.fuzzTimer = setTimeout(() => {
                try {
                    const payload = "/" + "A".repeat(currentSize);

                    history.pushState({}, "crash", payload);
                    
                    history.replaceState({}, "clean", "clean"); 
                    window.location.href = ORIGINAL_URL;

                } catch (e) {
                    console.log(e);
                    window.location.href = ORIGINAL_URL;
                }
            }, DELAY_MS);
        }
    </script>
</body>
</html>
