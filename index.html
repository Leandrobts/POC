<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Thread Limit Finder</title>    
</head>
<body>

    <h1>Busca do Limite de Threads</h1>
    <p>Safe: 200 | Crash: 400</p>
    
    Limit: <input type="number" id="limitInput" value="250">
    <button onclick="runTest()">RODAR TESTE</button>
    <button onclick="window.location.reload()">RESET</button>

    <div id="status">Parado.</div>
    <div id="log"></div>

    <script>
        function log(msg) { 
            const el = document.getElementById('log');
            el.innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>` + el.innerHTML;
        }

        function runTest() {
            const limit = parseInt(document.getElementById('limitInput').value);
            document.getElementById('status').innerText = `Testando limite: ${limit}...`;
            log(`Iniciando teste com limite ${limit}...`);
            
            const workerCode = `
                function deep(n) {
                    const v = new Float64Array(128);
                    if (n > 0) deep(n-1);
                }
                deep(10); 
                postMessage("Done");
            `;
            const url = URL.createObjectURL(new Blob([workerCode], {type:"text/javascript"}));
            
            let count = 0;
            const interval = setInterval(() => {
                // Criação em batches pequenos para precisão
                for(let i=0; i<10; i++) {
                    new Worker(url).onmessage = () => {};
                }
                count += 10;
                
                if(count % 50 === 0) log(`Threads: ${count}`);

                if(count >= limit) {
                    clearInterval(interval);
                    log(`FIM DO TESTE. Limite ${limit} atingido.`);
                    document.getElementById('status').innerText = `Sobreviveu a ${limit}! Tente aumentar.`;
                }
            }, 20); // Intervalo ligeiramente maior para dar chance ao crash acontecer
        }
    </script>
</body>
</html>
