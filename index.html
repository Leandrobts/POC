
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit TypedArray Selective Audit</title>
<style>
body { font-family: monospace; background:#000; color:#0f0; }
fieldset { margin-bottom:10px; }
button { font-size:18px; padding:8px; }
pre { white-space: pre-wrap; }
</style>
</head>
<body>

<h1>TypedArray Selective Teardown Audit</h1>

<fieldset>
<legend>Array Type</legend>
<label><input type="checkbox" id="f64"> Float64Array</label><br>
<label><input type="checkbox" id="u32"> Uint32Array</label><br>
<label><input type="checkbox" id="u8"> Uint8Array</label>
</fieldset>

<fieldset>
<legend>Timing</legend>
<label><input type="checkbox" id="before"> Create BEFORE fullscreen</label><br>
<label><input type="checkbox" id="after"> Create AFTER fullscreen</label><br>
<label><input type="checkbox" id="blur"> Create ON blur</label>
</fieldset>

<fieldset>
<legend>Access</legend>
<label><input type="checkbox" id="write"> Write element [0]</label>
</fieldset>

<button onclick="run()">RUN TEST</button>
<pre id="log"></pre>

<script>
const log = m => document.getElementById("log").textContent += m + "\n";
let keep = [];

function create(type, label, write) {
    let a;
    if (type === "f64") a = new Float64Array(4);
    if (type === "u32") a = new Uint32Array(4);
    if (type === "u8")  a = new Uint8Array(4);
    if (write) a[0] = 1;
    keep.push(a);
    log(`[+] ${label}: ${type} ${write ? "(write)" : "(no-write)"}`);
}

function selectedTypes() {
    let t = [];
    if (f64.checked) t.push("f64");
    if (u32.checked) t.push("u32");
    if (u8.checked)  t.push("u8");
    return t;
}

function run() {
    log("=== SETUP ===");
    let types = selectedTypes();
    let doWrite = write.checked;

    if (before.checked) {
        types.forEach(t => create(t, "BEFORE FS", doWrite));
    }

    document.documentElement.webkitRequestFullscreen();

    setTimeout(() => {
        if (after.checked) {
            types.forEach(t => create(t, "AFTER FS", doWrite));
        }
        log("[*] Fullscreen active â€“ press OPTIONS");
    }, 200);

    window.onblur = () => {
        log("=== BLUR DETECTED ===");
        if (blur.checked) {
            types.forEach(t => create(t, "ON BLUR", doWrite));
        }
        log("[*] Now REFRESH via OPTIONS");
    };
}
</script>

</body>
</html>
