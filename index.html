<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PS4 WebKit TypedArray Teardown Matrix</title>
<style>
body { font-family: monospace; background:#000; color:#0f0; }
button { font-size:18px; padding:10px; }
pre { white-space: pre-wrap; }
</style>
</head>
<body>

<h1>TypedArray Teardown Matrix – Fullscreen + Blur</h1>
<button onclick="run()">RUN TEST</button>
<pre id="log"></pre>

<script>
const log = m => document.getElementById("log").textContent += m + "\n";

let keepAlive = [];

function makeArray(type, label, write) {
    let arr;
    switch(type) {
        case "f64": arr = new Float64Array(4); break;
        case "u32": arr = new Uint32Array(4); break;
        case "u8":  arr = new Uint8Array(4); break;
    }
    if (write) arr[0] = 1;
    keepAlive.push(arr);
    log(`[+] ${label}: ${type} (${write ? "write" : "no-write"})`);
}

function run() {
    log("=== SETUP ===");

    // Opção 3A: BEFORE fullscreen
    makeArray("f64", "BEFORE FS", false);
    makeArray("u32", "BEFORE FS", false);
    makeArray("u8",  "BEFORE FS", false);

    document.documentElement.webkitRequestFullscreen();

    // Opção 3B: AFTER fullscreen
    setTimeout(() => {
        makeArray("f64", "AFTER FS", true);
        makeArray("u32", "AFTER FS", true);
        makeArray("u8",  "AFTER FS", true);
        log("[*] Fullscreen active, waiting for OPTIONS...");
    }, 200);

    window.onblur = () => {
        log("=== BLUR DETECTED ===");

        // Opção 3C: DURING blur
        makeArray("f64", "ON BLUR", false);
        makeArray("f64", "ON BLUR", true);

        makeArray("u32", "ON BLUR", false);
        makeArray("u32", "ON BLUR", true);

        makeArray("u8", "ON BLUR", false);
        makeArray("u8", "ON BLUR", true);

        log("[*] Arrays created during blur");
        log("[*] NOW REFRESH VIA OPTIONS");
    };
}
</script>

</body>
</html>
